<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PwC Delivery Launchpad</title>
  <link rel="icon" href="data:,">
<style>
*,
*::before,
*::after {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
  font-family: system-ui, sans-serif;
}
:root {
  --orange500: #fd5108;
  --orange300: #ffaa72;
  --orange100: #ffe8d4;
  --black: #000000;
  --white: #ffffff;
  --grey100: #eeeff1;
  --grey200: #dfe3e6;
  --grey300: #cbd1d6;
  --grey400: #b5bcc4;
  --grey500: #a1a8b3;
  --success: #22c55e;
  --successBg: #dcfce7;
  --warning: #eab308;
  --warningBg: #fef3c7;
  --bgColor: #eeeff1;
  --cardBg: #ffffff;
  --textColor: #000000;
  --secondaryText: #a1a8b3;
  --borderColor: #dfe3e6;
  --surfaceColor: #eeeff1;
}

@keyframes fadeIn {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}
@keyframes slideDown {
  from {
    opacity: 0;
    transform: translateY(-10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

body {
  font-family: system-ui, sans-serif;
  background-color: var(--bgColor);
  color: var(--textColor);
  font-size: 14px;
  line-height: 1.6;
}

/* HEADER */
.header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 10px 24px;
  background: var(--cardBg);
  border-bottom: 1px solid var(--borderColor);
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  z-index: 200;
}
.header-left {
  display: flex;
  align-items: center;
  gap: 16px;
}
.header-divider {
  width: 1px;
  height: 24px;
  background: var(--borderColor);
}
.header-title {
  font-size: 16px;
  font-weight: 600;
  color: var(--textColor);
}
.header-subtitle {
  font-size: 13px;
  color: var(--secondaryText);
  font-weight: 400;
}

/* ─── LANDING PAGE ─── */

#landingPage.active ~ .header {
  display: none !important;
}

#lp-wrap {
  height: 100vh;
  background: #f4f4f6;
  display: flex;
  flex-direction: column;
  position: relative;
}

/* subtle dot grid */
#lp-grid {
  display: none;
}

/* ── TOP NAV BAR ── */
#lp-nav {
  position: relative;
  z-index: 10;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 20px 64px;
}

#lp-nav-brand {
  font-size: 13px;
  font-weight: 700;
  color: #111;
  letter-spacing: -0.01em;
}

#lp-nav-badge {
  font-size: 10px;
  font-weight: 600;
  letter-spacing: 0.1em;
  text-transform: uppercase;
  color: #e8530e;
  background: rgba(232, 83, 14, 0.08);
  padding: 4px 10px;
  border-radius: 100px;
}

/* ── HERO ── */
#lp-hero {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  text-align: center;
  padding: 16px 64px 24px 64px;
  position: relative;
  z-index: 1;
}

#lp-contact {
  position: absolute;
  bottom: 12px;
  left: 64px;
  font-size: 11px;
  color: #bbbbbb;
  text-align: left;
}
#lp-contact a {
  color: #aaaaaa;
  text-decoration: none;
}
#lp-contact a:hover {
  color: #e8530e;
}

#lp-title {
  font-size: 56px;
  font-weight: 600;
  color: #111;
  line-height: 1.1;
  letter-spacing: -0.01em;
  font-family: Georgia, serif !important;
  margin: 0 0 16px;
}

#lp-title em {
  font-style: normal;
  color: #e8530e;
}

#lp-sub {
  font-size: 15px;
  color: #666;
  line-height: 1.75;
  margin: 0 0 28px;
  max-width: 520px;
  text-align: center;
}

/* ── CTA ROW ── */
#lp-cta-row {
  display: flex;
  align-items: center;
  gap: 10px;
  flex-wrap: wrap;
}

/* Guided mode toggle */
.lp-guided-toggle {
  display: inline-flex;
  align-items: center;
  gap: 10px;
}
.lp-toggle-label {
  font-size: 13px;
  font-weight: 500;
  font-family: system-ui, sans-serif;
  color: var(--textColor);
  user-select: none;
  cursor: pointer;
}
.lp-toggle-track {
  width: 44px;
  height: 24px;
  border-radius: 12px;
  background-color: #FD5108;
  border: none;
  cursor: pointer;
  position: relative;
  transition: background-color 0.2s ease;
  outline: none;
  padding: 0;
  flex-shrink: 0;
}
.lp-toggle-track[aria-checked="false"] {
  background-color: #CBD1D6;
}
.lp-toggle-thumb {
  width: 20px;
  height: 20px;
  border-radius: 50%;
  background-color: #ffffff;
  position: absolute;
  top: 2px;
  left: 22px;
  transition: left 0.2s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 1px 3px rgba(0,0,0,0.2);
  pointer-events: none;
}
.lp-toggle-track[aria-checked="false"] .lp-toggle-thumb {
  left: 2px;
}

#lp-start-btn {
  display: inline-flex;
  align-items: center;
  padding: 8px 16px;
  background-color: #FFAA72;
  border: none;
  color: var(--textColor);
  font-weight: 600;
  font-size: 13px;
  font-family: system-ui, sans-serif;
  letter-spacing: -0.01em;
  box-shadow: 0 1px 3px rgba(0,0,0,0.1);
  cursor: pointer;
  transition: all 0.15s ease;
  border-radius: 100px;
  outline: none;
}
#lp-start-btn:hover {
  background-color: var(--orange500);
  color: #fff;
  box-shadow: 0 2px 6px rgba(0,0,0,0.15);
}
#lp-start-btn:focus {
  outline: 2px solid #FFAA72;
  outline-offset: 3px;
}

/* ══════════════════════════════════════
   CONVEYOR CHAIN
══════════════════════════════════════ */
#lp-chain-wrap {
  position: relative;
  z-index: 1;
  padding: 0 0 28px;
  flex: 0 0 auto;
  display: flex;
  flex-direction: column;
  justify-content: flex-end;
  margin-bottom: 120px;
}
#lp-chain-label {
  font-size: 10px;
  font-weight: 600;
  letter-spacing: 0.1em;
  text-transform: uppercase;
  color: #bbbbbb;
  padding: 0 64px 12px;
}
#lp-conveyor-outer {
  position: relative;
  overflow: hidden;
  padding: 24px 0 8px;
}
#lp-conveyor-outer::before,
#lp-conveyor-outer::after {
  content: "";
  position: absolute;
  top: 0;
  bottom: 0;
  width: 120px;
  z-index: 2;
  pointer-events: none;
}
#lp-conveyor-outer::before {
  left: 0;
  background: linear-gradient(to right, #f4f4f6, transparent);
}
#lp-conveyor-outer::after {
  right: 0;
  background: linear-gradient(to left, #f4f4f6, transparent);
}
#lp-conveyor-track {
  position: absolute;
  top: 24px;
  left: 0;
  right: 0;
  height: 1px;
  background: #e0e0e0;
  z-index: 0;
}
#lp-conveyor {
  display: flex;
  gap: 0;
  padding: 0 64px;
  transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  z-index: 1;
}
.lp-cv-card {
  flex: 0 0 200px;
  background: transparent;
  border: none;
  padding: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 0;
  transition: all 0.35s ease;
  opacity: 0.45;
  cursor: default;
  position: relative;
}
.lp-cv-card.lp-cv-active {
  opacity: 1;
}
/* Node dot on the line */
.lp-cv-card::before {
  content: "";
  width: 10px;
  height: 10px;
  border-radius: 50%;
  background: #d0d0d0;
  border: 2px solid #d0d0d0;
  flex-shrink: 0;
  transition:
    background 0.35s ease,
    border-color 0.35s ease,
    transform 0.35s ease;
  margin-bottom: 10px;
}
.lp-cv-card.lp-cv-active::before {
  background: #e8530e;
  border-color: #e8530e;
  transform: scale(1.4);
}
.lp-cv-id {
  display: none;
}
.lp-cv-name {
  font-size: 12px;
  font-weight: 600;
  color: #bbbbbb;
  line-height: 1.3;
  text-align: center;
  padding: 0 8px;
  transition: color 0.35s ease;
}
.lp-cv-card.lp-cv-active .lp-cv-name {
  color: #111;
}
.lp-cv-artifact {
  display: none;
}
.lp-cv-desc {
  font-size: 11px;
  color: #cccccc;
  line-height: 1.5;
  text-align: center;
  padding: 4px 8px 0;
  transition: color 0.35s ease;
}
.lp-cv-card.lp-cv-active .lp-cv-desc {
  color: #888;
}
.lp-cv-gate-badge {
  display: none;
}

.page {
  display: none;
}
.page.active {
  display: block;
  animation: fadeIn 0.2s ease;
}

/* LOADING */
.loading-overlay {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(255, 255, 255, 0.85);
  z-index: 500;
  align-items: center;
  justify-content: center;
  flex-direction: column;
  gap: 16px;
}
.loading-overlay.visible {
  display: flex;
}
.loading-spinner {
  width: 40px;
  height: 40px;
  border: 3px solid var(--grey200);
  border-top-color: var(--orange500);
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
}
@keyframes spin {
  to {
    transform: rotate(360deg);
  }
}
.loading-text {
  font-size: 14px;
  color: var(--secondaryText);
}

/* ── FORM ── */

#lp-title,
#lp-title em {
  font-family: Georgia, serif !important;
}
h1 {
  font-size: 32px;
  font-weight: 600;
  line-height: 1.25;
  margin: 0;
}
h2 {
  font-size: 24px;
  font-weight: 600;
  line-height: 1.3;
  margin: 0;
}
h3 {
  font-size: 18px;
  font-weight: 600;
  line-height: 1.35;
  margin: 0;
}
h4 {
  font-size: 16px;
  font-weight: 600;
  line-height: 1.4;
  margin: 0;
}
p,
body {
  font-size: 14px;
  font-weight: 400;
  line-height: 1.6;
}

.form-container {
  max-width: 860px;
  margin: 0 auto;
  padding: 0 24px 60px;
}
/* form intro row: title + start button */
.form-intro {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 16px;
  position: sticky;
  top: 0;
  z-index: 150;
  background: var(--bgColor);
  padding: 16px 24px;
  margin: 0 -24px 16px -24px;
  border-bottom: 1px solid var(--borderColor);
}
.form-intro-text h2 {
  font-size: 24px;
  font-weight: 600;
  margin-bottom: 4px;
}
.form-intro-text p {
  font-size: 13px;
  color: var(--secondaryText);
  line-height: 1.5;
}

/* nav pills */
.nav-pills {
  display: flex;
  gap: 4px;
  flex-wrap: wrap;
  margin-bottom: 14px;
}
.nav-pill {
  padding: 4px 12px;
  font-size: 11px;
  font-weight: 500;
  cursor: pointer;
  border: 1px solid var(--borderColor);
  background: var(--cardBg);
  color: var(--secondaryText);
  border-radius: 100px;
  transition: all 140ms ease;
}
.nav-pill:hover {
  background: var(--orange100);
  border-color: var(--orange500);
  color: var(--orange500);
}

/* sections */
.section {
  background: var(--cardBg);
  margin-bottom: 2px;
  border: 1px solid var(--borderColor);
  overflow: hidden;
}
.section-header {
  padding: 11px 18px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  cursor: pointer;
  border-left: 3px solid var(--orange500);
  transition: background-color 140ms ease;
  user-select: none;
}
.section-header:hover {
  background: var(--grey100);
}
.section-header-left {
  display: flex;
  align-items: center;
  gap: 12px;
}
.section-number {
  width: 20px;
  height: 20px;
  border-radius: 50%;
  background: var(--orange500);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 10px;
  font-weight: 700;
  color: #fff;
  flex-shrink: 0;
}
.section-title {
  font-size: 14px;
  font-weight: 600;
}
.section-subtitle {
  font-size: 11px;
  font-weight: 400;
  color: var(--secondaryText);
  margin-top: 1px;
}
.chevron {
  font-size: 11px;
  color: var(--grey400);
  transition: transform 180ms ease;
}
.section.open .chevron {
  transform: rotate(180deg);
}
.section-body {
  display: none;
  padding: 14px 18px;
  border-top: 1px solid var(--borderColor);
}
.section.open .section-body {
  display: block;
  animation: slideDown 160ms ease;
}

/* fields */
.field-group {
  display: flex;
  flex-direction: column;
  gap: 12px;
}
.field-row {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
}
.field-row.single {
  grid-template-columns: 1fr;
}
.field-row.triple {
  grid-template-columns: 1fr 1fr 1fr;
}
.field {
  display: flex;
  flex-direction: column;
}
.field-label-row {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 5px;
}
label.field-label {
  font-size: 11px;
  font-weight: 500;
  color: #666;
  text-transform: uppercase;
  letter-spacing: 0.05em;
}
label.field-label .required {
  color: var(--orange500);
  margin-left: 2px;
}
.field-label.error-label {
  color: #c62828;
}
.field-hint {
  font-size: 11px;
  font-weight: 400;
  color: var(--secondaryText);
  margin: 2px 0 6px;
  line-height: 1.4;
}
.field-error {
  display: none;
  margin-top: 6px;
  font-size: 11px;
  color: #c62828;
}
.field.has-error .field-error {
  display: block;
}

input[type="text"],
input[type="date"],
select,
textarea {
  width: 100%;
  padding: 7px 10px;
  border: 1px solid var(--borderColor);
  border-radius: 3px;
  font-size: 13px;
  font-weight: 400;
  font-family: system-ui, sans-serif;
  color: var(--textColor);
  background: var(--white);
  transition: border-color 140ms ease;
  appearance: none;
  -webkit-appearance: none;
  box-sizing: border-box;
}
input::placeholder,
textarea::placeholder {
  color: var(--grey400);
}
input:focus,
select:focus,
textarea:focus {
  outline: none;
  border-color: var(--orange500);
  box-shadow: 0 0 0 2px rgba(0, 0, 0, 0.08);
}
.field.has-error input[type="text"],
.field.has-error input[type="date"],
.field.has-error select,
.field.has-error textarea {
  border-color: #c62828;
  box-shadow: 0 0 0 2px rgba(198, 40, 40, 0.08);
}
select {
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='10' viewBox='0 0 10 10'%3E%3Cpath fill='%23B5BCC4' d='M5 7L0 2h10z'/%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 10px center;
  padding-right: 28px;
  cursor: pointer;
}
select:disabled {
  background: var(--grey100);
  color: var(--grey400);
  cursor: not-allowed;
}
textarea {
  resize: vertical;
  min-height: 72px;
}

.btn-toggle-input {
  font-size: 11px;
  font-weight: 500;
  color: var(--orange500);
  background: transparent;
  border: none;
  padding: 0;
  cursor: pointer;
  transition: opacity 140ms ease;
}
.btn-toggle-input:hover {
  opacity: 0.65;
}

/* ── THEME ROW — horizontal layout for objective/theme fields ── */
.theme-row {
  display: grid;
  grid-template-columns: 200px 1fr auto;
  align-items: center;
  gap: 10px;
  padding: 6px 0;
  border-bottom: 1px solid var(--grey100);
}
.theme-row:last-child {
  border-bottom: none;
}
.theme-row-label {
  font-size: 11px;
  font-weight: 600;
  color: var(--textColor);
  text-transform: uppercase;
  letter-spacing: 0.04em;
  line-height: 1.3;
  padding-right: 8px;
}
.theme-row select,
.theme-row input[type="text"] {
  width: 100%;
  margin: 0;
}
.theme-row .btn-toggle-input {
  white-space: nowrap;
  font-size: 11px;
  padding: 4px 8px;
  border: 1px solid var(--orange300);
  border-radius: 3px;
  color: var(--orange500);
  background: transparent;
}
.theme-row .btn-toggle-input:hover {
  background: var(--orange100);
}
.theme-rows-container {
  border: 1px solid var(--borderColor);
  border-radius: 4px;
  overflow: hidden;
  background: var(--white);
  margin-top: 8px;
}
.theme-rows-container .theme-row {
  padding: 8px 12px;
}
.theme-rows-container .theme-row:nth-child(even) {
  background: var(--grey100);
}

/* ── CHIPS (multi-select) ── */
.multi-select-grid {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
  margin-top: 6px;
}
.check-item {
  display: inline-flex;
  align-items: center;
  padding: 4px 11px;
  border: 1.5px solid var(--borderColor);
  border-radius: 100px;
  cursor: pointer;
  transition: all 130ms ease;
  font-size: 12px;
  font-weight: 500;
  font-family: system-ui, sans-serif;
  background: var(--white);
  color: #555;
  user-select: none;
  white-space: nowrap;
  line-height: 1.5;
}
.check-item:hover {
  border-color: var(--orange500);
  color: var(--orange500);
  background: var(--orange100);
}
.check-item.selected {
  border-color: var(--orange500);
  background: var(--orange500);
  color: #fff;
  font-weight: 600;
}
.check-item input[type="checkbox"] {
  display: none;
}

/* cascade blocks */
.cascade-block {
  display: none;
  margin-top: 8px;
  padding: 10px 12px;
  background: var(--surfaceColor);
  border-left: 2px solid var(--orange500);
  animation: slideDown 160ms ease;
}
.cascade-block.visible {
  display: block;
}
.cascade-block.level-3 {
  border-left-color: var(--orange300);
  margin-left: 10px;
  margin-top: 6px;
}
/* ── CHIP-CASCADE INTERLEAVE: .cci wrappers sit inside flex chip containers ── */
.chip-cascade-wrap {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
  align-items: flex-start;
}
.chip-cascade-wrap .grid-search {
  flex: 0 0 100%;
  margin-bottom: 2px;
}
/* transparent wrapper — chip + cascade both live in the parent flex flow */
.cci {
  display: contents;
}
/* cascade panel: hidden by default; full-width row when visible */
.cci > .cascade-block {
  display: none !important;
  flex: 0 0 100%;
  margin: 2px 0 6px;
  box-sizing: border-box;
}
.cci > .cascade-block.visible {
  display: block !important;
}
/* labelled header strip inside each cascade panel */
.cascade-chip-header {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 10px;
  padding-bottom: 8px;
  border-bottom: 1px solid var(--borderColor);
}
.cascade-chip-label {
  font-size: 11px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.06em;
  color: var(--orange500);
}
.cascade-chip-close {
  margin-left: auto;
  background: none;
  border: none;
  cursor: pointer;
  font-size: 16px;
  line-height: 1;
  color: var(--secondaryText);
  padding: 0 4px;
}
.cascade-chip-close:hover {
  color: var(--orange500);
}

.cascade-block .field-group {
  gap: 8px;
}
.section-divider {
  border: none;
  border-top: 1px solid var(--borderColor);
  margin: 12px 0;
}

.form-footer {
  position: sticky;
  bottom: 0;
  z-index: 150;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 10px 24px;
  background: var(--cardBg);
  border-top: 1px solid var(--borderColor);
}
.footer-left {
  display: flex;
  align-items: center;
  gap: 8px;
}
.footer-right {
  display: flex;
  align-items: center;
  gap: 8px;
}

/* ── START WORKFLOW BUTTON (top right of form, no footer bar) ── */
.btn-start-workflow {
  flex-shrink: 0;
  padding: 8px 18px;
  font-size: 13px;
  font-weight: 600;
  font-family: system-ui, sans-serif;
  background: var(--orange500);
  color: #fff;
  border: none;
  cursor: pointer;
  border-radius: 2px;
  transition: background 140ms ease;
  white-space: nowrap;
}
.btn-start-workflow:hover {
  background: #d44000;
}

/* shared btn */
.btn {
  padding: 8px 18px;
  font-size: 13px;
  font-weight: 600;
  font-family: system-ui, sans-serif;
  cursor: pointer;
  transition: all 140ms ease;
  border: none;
  border-radius: 2px;
}
.btn-primary {
  background: var(--orange500);
  color: #fff;
}
.btn-primary:hover {
  background: #d44000;
}
.btn-secondary {
  background: transparent;
  color: var(--textColor);
  border: 1px solid var(--borderColor);
}
.btn-secondary:hover {
  background: var(--grey100);
}

/* workflow layout */
.workflow-container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 0;
  display: grid;
  grid-template-columns: 260px 1fr;
  gap: 0;
  align-items: stretch;
  height: 100%;
}
.workflow-main {
  min-width: 0;
  overflow-y: auto;
  height: 100%;
}
.workflow-sidebar {
  overflow-y: auto;
  height: 100%;
  background: var(--cardBg);
  border-right: 1px solid var(--borderColor);
  display: flex;
  flex-direction: column;
  box-shadow: 2px 0 8px rgba(0, 0, 0, 0.04);
}
/* Sidebar overall progress summary */
.sidebar-summary {
  padding: 14px 14px 12px;
  border-bottom: 1px solid var(--borderColor);
  background: var(--cardBg);
  flex-shrink: 0;
}
.sidebar-summary-title {
  font-size: 10px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.08em;
  color: var(--secondaryText);
  margin-bottom: 6px;
}
.sidebar-summary-count {
  font-size: 15px;
  font-weight: 700;
  color: var(--textColor);
  margin-bottom: 6px;
  line-height: 1.2;
}
.sidebar-summary-subtext {
  font-size: 11px;
  color: var(--secondaryText);
  margin-bottom: 8px;
}
.sidebar-summary-bar-outer {
  height: 6px;
  background: var(--grey200);
  border-radius: 3px;
  overflow: hidden;
}
.sidebar-summary-bar-inner {
  height: 100%;
  background: var(--orange500);
  border-radius: 3px;
  transition: width 0.3s ease;
  width: 0%;
}
.sidebar-phase-list {
  flex: 1;
  overflow-y: auto;
  padding-top: 4px;
}
.sidebar-header {
  background: var(--orange500);
  padding: 10px 14px;
  color: #fff;
  font-size: 11px;
  font-weight: 500;
  text-transform: uppercase;
  letter-spacing: 0.06em;
}
.sidebar-phase {
  border-bottom: 1px solid var(--borderColor);
}
.sidebar-phase-label {
  padding: 8px 14px 6px;
  font-size: 10px;
  font-weight: 700;
  color: var(--secondaryText);
  text-transform: uppercase;
  letter-spacing: 0.08em;
  background: var(--surfaceColor);
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 6px;
}
.sidebar-phase-count-badge {
  font-size: 10px;
  font-weight: 600;
  color: var(--grey400);
  background: var(--grey200);
  padding: 1px 7px;
  border-radius: 100px;
  white-space: nowrap;
  text-transform: none;
  letter-spacing: 0;
}
.sidebar-phase-count-badge.phase-all-done {
  background: var(--successBg);
  color: var(--success);
}
.sidebar-item {
  padding: 8px 14px 8px 16px;
  font-size: 12px;
  font-weight: 400;
  color: var(--textColor);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 9px;
  transition: all 120ms ease;
  border-left: 3px solid transparent;
  line-height: 1.3;
}
.sidebar-item:hover {
  background: var(--orange100);
  color: var(--orange500);
}
.sidebar-item:focus {
  outline: 2px solid var(--orange500);
  outline-offset: -2px;
  background: var(--orange100);
  color: var(--orange500);
}
.sidebar-item.active {
  background: var(--orange100);
  color: var(--orange500);
  border-left-color: var(--orange500);
  font-weight: 600;
}
.sidebar-item.completed {
  color: var(--success);
}
.sidebar-item.locked {
  color: var(--grey400);
  cursor: pointer;
}

.step-dot {
  width: 20px;
  height: 20px;
  border-radius: 50%;
  background-color: var(--grey200);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 9px;
  font-weight: 700;
  color: var(--grey500);
  flex-shrink: 0;
  border: 1.5px solid var(--grey300);
}
.sidebar-item.active .step-dot {
  background-color: var(--orange500);
  color: var(--white);
  border-color: var(--orange500);
}
.sidebar-item.completed .step-dot {
  background-color: var(--success);
  color: var(--white);
  border-color: var(--success);
}
.sidebar-item.locked .step-dot {
  border-color: var(--grey200);
}

.workflow-header {
  background: var(--cardBg);
  border-bottom: 1px solid var(--borderColor);
  padding: 16px 24px;
  margin-bottom: 0;
  display: flex;
  align-items: center;
  justify-content: space-between;
  position: sticky;
  top: 0;
  z-index: 150;
  box-shadow: 0 1px 4px rgba(0, 0, 0, 0.06);
}
.workflow-header h2 {
  font-size: 17px;
  font-weight: 700;
  margin-bottom: 3px;
  letter-spacing: -0.01em;
}
.workflow-header p {
  font-size: 12px;
  color: var(--secondaryText);
}
.progress-wrap {
  text-align: right;
}
.workflow-header-actions {
  display: flex;
  align-items: center;
  gap: 16px;
  flex-shrink: 0;
}
.form-progress-wrap {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 8px 24px 8px;
}
.form-progress-label {
  font-size: 12px;
  color: var(--secondaryText);
  white-space: nowrap;
}
.form-sticky-bar {
  background: var(--bgColor);
  border-bottom: 1px solid var(--borderColor);
  padding-bottom: 6px;
  flex-shrink: 0;
}
.progress-label {
  font-size: 12px;
  font-weight: 600;
  color: var(--textColor);
  margin-bottom: 2px;
}
.progress-breakdown {
  font-size: 11px;
  color: var(--secondaryText);
  margin-bottom: 5px;
  opacity: 0.8;
}
.progress-bar {
  width: 180px;
  height: 7px;
  background-color: var(--grey200);
  border-radius: 4px;
  overflow: hidden;
}
.progress-fill {
  height: 100%;
  background-color: var(--orange500);
  border-radius: 4px;
  transition: width 0.3s ease;
}

.phase-filter-bar {
  background: var(--cardBg);
  border-bottom: 1px solid var(--borderColor);
  padding: 10px 24px;
  position: sticky;
  top: 65px;
  z-index: 140;
}
.phase-filter-pills {
  display: flex;
  gap: 6px;
  flex-wrap: wrap;
  align-items: center;
}
.phase-filter-label {
  font-size: 11px;
  font-weight: 600;
  color: var(--secondaryText);
  text-transform: uppercase;
  letter-spacing: 0.06em;
  margin-right: 2px;
  white-space: nowrap;
}
.phase-filter-pill {
  padding: 5px 14px;
  font-size: 12px;
  font-weight: 500;
  border: 1.5px solid var(--borderColor);
  border-radius: 100px;
  background: var(--cardBg);
  color: var(--secondaryText);
  cursor: pointer;
  transition: all 120ms ease;
  font-family: system-ui, sans-serif;
}
.phase-filter-pill:hover {
  border-color: var(--orange300);
  color: var(--orange500);
  background: var(--orange100);
}
.phase-filter-pill:focus {
  outline: 2px solid var(--orange500);
  outline-offset: 2px;
}
.phase-filter-pill.active {
  background: var(--orange500);
  border-color: var(--orange500);
  color: #fff;
  font-weight: 600;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.15);
}

.workflow-tip-banner {
  display: flex;
  align-items: center;
  gap: 10px;
  background: #eff6ff;
  border-bottom: 1px solid #bfdbfe;
  padding: 9px 24px;
  font-size: 12px;
  color: #1e40af;
}
.workflow-tip-icon {
  font-size: 14px;
  flex-shrink: 0;
  color: #3b82f6;
}
.workflow-tip-text {
  flex: 1;
  line-height: 1.5;
}
.workflow-tip-dismiss {
  background: none;
  border: none;
  cursor: pointer;
  color: #93c5fd;
  font-size: 14px;
  padding: 2px 6px;
  border-radius: 2px;
  transition: color 120ms;
  font-family: system-ui, sans-serif;
}
.workflow-tip-dismiss:hover {
  color: #1e40af;
}

.phase-divider {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 12px 18px;
  margin: 20px 0 10px 0;
  background: var(--cardBg);
  border: 1px solid var(--borderColor);
  border-left: 4px solid var(--orange500);
  border-radius: 6px;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
}
.phase-divider:first-child {
  margin-top: 0;
}
.phase-divider-left {
  display: flex;
  align-items: center;
  gap: 12px;
}
.phase-divider-number {
  font-size: 10px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.08em;
  color: var(--orange500);
  background: var(--orange100);
  padding: 3px 10px;
  border-radius: 100px;
}
.phase-divider-name {
  font-size: 14px;
  font-weight: 700;
  color: var(--textColor);
  letter-spacing: -0.01em;
}
.phase-divider-right {
  display: flex;
  align-items: center;
  gap: 12px;
  flex-shrink: 0;
}
.phase-divider-count {
  font-size: 11px;
  font-weight: 500;
  color: var(--secondaryText);
  white-space: nowrap;
}
.phase-divider-bar-outer {
  width: 90px;
  height: 6px;
  background: var(--grey200);
  border-radius: 3px;
  overflow: hidden;
}
.phase-divider-bar-inner {
  height: 100%;
  background: var(--orange500);
  border-radius: 3px;
  transition: width 0.3s ease;
}

#promptCards {
  padding: 16px 24px 40px;
}

.prompt-card {
  background: var(--cardBg);
  border: 1px solid var(--borderColor);
  margin-bottom: 10px;
  overflow: hidden;
  border-left: 4px solid var(--grey200);
  border-radius: 6px;
  box-shadow: 0 1px 4px rgba(0, 0, 0, 0.06);
  transition:
    border-color 200ms ease,
    box-shadow 200ms ease;
}
.prompt-card:hover {
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
}
.prompt-card.active-card {
  border-left-color: var(--orange500);
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}
.prompt-card.completed-card {
  border-left-color: var(--success);
  box-shadow: 0 2px 8px rgba(34, 197, 94, 0.08);
}
.prompt-card.locked-card {
  opacity: 0.45;
  pointer-events: none;
  box-shadow: none;
}
/* When navigated to via sidebar, locked card becomes fully accessible */
.prompt-card.locked-card.sidebar-override {
  opacity: 1;
  pointer-events: auto;
  border-left-color: var(--grey300);
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
}

@keyframes cardPulse {
  0% {
    box-shadow: 0 0 0 0 rgba(0, 0, 0, 0);
  }
  30% {
    box-shadow: 0 0 0 6px rgba(0, 0, 0, 0.1);
  }
  70% {
    box-shadow: 0 0 0 10px rgba(0, 0, 0, 0.04);
  }
  100% {
    box-shadow: 0 0 0 0 rgba(0, 0, 0, 0);
  }
}
.prompt-card.card-pulse {
  animation: cardPulse 1.2s ease;
}

.prompt-card-header {
  padding: 14px 18px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  cursor: pointer;
  user-select: none;
  transition: background-color 200ms ease;
  gap: 12px;
}
.prompt-card-header:hover {
  background-color: var(--surfaceColor);
}
.prompt-card-header:focus {
  outline: 2px solid var(--orange500);
  outline-offset: -2px;
}
.prompt-card-header-left {
  display: flex;
  align-items: center;
  gap: 12px;
  min-width: 0;
}
.prompt-card-header-right {
  display: flex;
  align-items: center;
  gap: 10px;
  flex-shrink: 0;
}

.prompt-id {
  font-size: 10px;
  font-weight: 700;
  color: var(--orange500);
  background-color: var(--orange100);
  padding: 3px 10px;
  border-radius: 100px;
  white-space: nowrap;
  letter-spacing: 0.04em;
  flex-shrink: 0;
}
.prompt-card.completed-card .prompt-id {
  color: var(--success);
  background-color: var(--successBg);
  border: 1px solid rgba(34, 197, 94, 0.2);
}
.prompt-card.locked-card .prompt-id {
  color: var(--grey400);
  background-color: var(--surfaceColor);
}

.prompt-name {
  font-size: 14px;
  font-weight: 600;
  letter-spacing: -0.01em;
  line-height: 1.3;
}
.prompt-meta {
  font-size: 12px;
  color: var(--secondaryText);
  margin-top: 2px;
  line-height: 1.4;
}

.dep-sublabel {
  font-size: 11px;
  color: var(--secondaryText);
  margin-top: 2px;
  font-style: italic;
  line-height: 1.4;
}

.status-badge {
  font-size: 11px;
  padding: 4px 12px;
  font-weight: 600;
  border-radius: 100px;
  white-space: nowrap;
  flex-shrink: 0;
}
.badge-ready {
  background-color: var(--orange100);
  color: var(--orange500);
  border: 1px solid var(--orange300);
}
.badge-done {
  background-color: var(--successBg);
  color: var(--success);
  border: 1px solid rgba(34, 197, 94, 0.2);
}
.badge-locked {
  background-color: var(--surfaceColor);
  color: var(--secondaryText);
  border: 1px solid var(--borderColor);
}

.prompt-card-body {
  display: none;
  padding: 0 20px 20px;
  border-top: 1px solid var(--borderColor);
}
.prompt-card.open .prompt-card-body {
  display: block;
  animation: slideDown 200ms ease;
}

.meta-row {
  display: flex;
  align-items: flex-start;
  gap: 8px;
  margin-top: 12px;
  flex-wrap: wrap;
}
.meta-label {
  font-size: 11px;
  font-weight: 500;
  color: var(--secondaryText);
  text-transform: uppercase;
  letter-spacing: 0.4px;
  white-space: nowrap;
  margin-top: 3px;
}
.dep-tag {
  font-size: 12px;
  padding: 2px 10px;
  background-color: var(--surfaceColor);
  color: var(--secondaryText);
}
.artifact-tag {
  font-size: 12px;
  padding: 3px 10px;
  background-color: #dbeafe;
  color: #3b82f6;
  border: 1px solid #bfdbfe;
}

.prompt-box-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-top: 16px;
  margin-bottom: 6px;
}
.prompt-box-label {
  font-size: 11px;
  font-weight: 500;
  color: var(--secondaryText);
  text-transform: uppercase;
  letter-spacing: 0.4px;
}

.btn-expand-prompt {
  font-size: 11px;
  font-weight: 500;
  color: var(--secondaryText);
  background: transparent;
  border: 1px solid var(--borderColor);
  border-radius: 6px;
  padding: 4px 10px;
  cursor: pointer;
  transition: all 120ms ease;
  font-family: system-ui, sans-serif;
}
.btn-expand-prompt:hover {
  border-color: var(--orange300);
  color: var(--orange500);
  background: var(--orange100);
}

.prompt-text-box {
  background-color: #1a1b2e;
  color: #d4d8e8;
  border-radius: 6px;
  padding: 10px 12px;
  font-size: 12px;
  font-family: "Courier New", monospace;
  line-height: 1.6;
  white-space: pre-wrap;
  word-break: break-word;
  max-height: 100px;
  overflow-y: auto;
  border: 1px solid #2a2b3d;
  transition: max-height 300ms ease;
  scrollbar-width: thin;
  scrollbar-color: #3a3b5e #1a1b2e;
}
.prompt-text-box::-webkit-scrollbar {
  width: 5px;
}
.prompt-text-box::-webkit-scrollbar-track {
  background: #1a1b2e;
}
.prompt-text-box::-webkit-scrollbar-thumb {
  background: #3a3b5e;
  border-radius: 3px;
}
.prompt-text-box.prompt-text-expanded {
  max-height: 480px;
}

.prompt-actions {
  display: flex;
  gap: 0;
  margin-top: 12px;
  align-items: center;
  flex-wrap: wrap;
}
.prompt-actions-left {
  display: flex;
  gap: 8px;
  align-items: center;
  flex: 1;
  flex-wrap: wrap;
}
.prompt-actions-divider {
  width: 1px;
  height: 32px;
  background: var(--borderColor);
  margin: 0 12px;
  flex-shrink: 0;
}
.prompt-actions-right {
  display: flex;
  gap: 8px;
  align-items: center;
  flex-shrink: 0;
}

/* Primary action */
.btn-copy {
  background-color: var(--orange500);
  color: var(--white);
  padding: 8px 18px;
  font-size: 13px;
  font-weight: 600;
  cursor: pointer;
  border: none;
  border-radius: 6px;
  display: flex;
  align-items: center;
  gap: 6px;
  transition: background-color 200ms ease, box-shadow 200ms ease;
  font-family: system-ui, sans-serif;
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.12);
}
.btn-copy:hover {
  background-color: #d94000;
  box-shadow: 0 3px 8px rgba(0, 0, 0, 0.18);
}
.btn-copy.copied {
  background-color: var(--success);
  box-shadow: 0 2px 6px rgba(34, 197, 94, 0.25);
}

/* Secondary/ghost utility actions — CHANGE 11 */
.btn-secondary-action {
  background: transparent;
  color: var(--secondaryText);
  padding: 6px 12px;
  font-size: 12px;
  font-weight: 500;
  cursor: pointer;
  border: 1px solid var(--borderColor);
  border-radius: 6px;
  transition: all 200ms ease;
  font-family: system-ui, sans-serif;
}
.btn-secondary-action:hover {
  background: var(--grey100);
  color: var(--textColor);
  border-color: var(--grey400);
}

.copy-hint {
  font-size: 12px;
  color: var(--secondaryText);
}

.btn-export {
  background: transparent;
  color: var(--secondaryText);
  padding: 6px 12px;
  font-size: 12px;
  font-weight: 500;
  cursor: pointer;
  border: 1px solid var(--borderColor);
  border-radius: 6px;
  transition: all 200ms ease;
  font-family: system-ui, sans-serif;
}
.btn-export:hover {
  background: var(--grey100);
  color: var(--textColor);
  border-color: var(--grey400);
}
.btn-export.exported {
  background: var(--successBg);
  color: var(--success);
  border-color: var(--success);
}

.export-hint {
  display: none;
}

.stage-gate {
  background-color: var(--warningBg);
  border-left: 4px solid var(--warning);
  padding: 16px 20px;
  font-size: 13px;
  margin-top: 12px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.error-msg {
  background-color: #fee2e2;
  border-left: 4px solid #ef4444;
  padding: 12px 16px;
  font-size: 13px;
  color: #991b1b;
  margin-bottom: 16px;
}
/* #formPage.active — defined in new form CSS below */
.form-scroll-body {
  flex: 1;
  overflow-y: auto;
}
#workflowPage.active {
  position: fixed;
  top: 41px;
  left: 0;
  right: 0;
  bottom: 0;
  overflow: hidden;
}
.guidance-panel {
  display: none;
  position: fixed;
  bottom: 24px;
  right: 24px;
  z-index: 1000;
  width: 340px;
  background: #fff;
  border: 1px solid var(--borderColor);
  border-radius: 6px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.14);
  font-family: system-ui, sans-serif;
}
.guidance-panel.visible {
  display: block;
}
.guidance-panel-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 10px 14px;
  background: var(--orange500);
  border-radius: 6px 6px 0 0;
}
.guidance-panel-title {
  font-size: 11px;
  font-weight: 700;
  color: #fff;
  text-transform: uppercase;
  letter-spacing: 0.06em;
}
.guidance-panel-counter {
  font-size: 11px;
  color: rgba(255, 255, 255, 0.75);
}
.guidance-panel-body {
  padding: 14px;
}
.guidance-panel-step-title {
  font-size: 14px;
  font-weight: 700;
  color: var(--textColor);
  margin-bottom: 6px;
}
.guidance-panel-text {
  font-size: 13px;
  color: #555;
  line-height: 1.6;
  margin: 0 0 8px;
}
.guidance-panel-example {
  font-size: 12px;
  color: var(--secondaryText);
  background: var(--surfaceColor);
  border-left: 2px solid var(--orange300);
  padding: 8px 10px;
  line-height: 1.5;
}
.guidance-panel-footer {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 10px 14px;
  border-top: 1px solid var(--borderColor);
  background: var(--surfaceColor);
  border-radius: 0 0 6px 6px;
}
.guidance-panel-skip {
  font-size: 11px;
  color: var(--secondaryText);
  background: none;
  border: none;
  cursor: pointer;
  padding: 0;
}
.guidance-panel-skip:hover {
  color: var(--textColor);
}
.guidance-panel-actions {
  display: flex;
  gap: 8px;
}
.btn-guidance-back {
  padding: 6px 14px;
  font-size: 12px;
  font-weight: 600;
  background: #fff;
  border: 1px solid var(--borderColor);
  cursor: pointer;
  border-radius: 3px;
}
.btn-guidance-next {
  padding: 6px 14px;
  font-size: 12px;
  font-weight: 600;
  background: var(--orange500);
  color: #fff;
  border: none;
  cursor: pointer;
  border-radius: 3px;
}
.btn-guidance-next:hover {
  background: #d44000;
}
.guidance-highlight {
  outline: 2px solid var(--orange500);
  outline-offset: 3px;
}
/* ── CHUNK 1: Section completion indicators ── */
.section-header {
  position: relative;
}
.section-status-dot {
  width: 9px;
  height: 9px;
  border-radius: 50%;
  background: var(--grey300);
  flex-shrink: 0;
  transition: background 200ms ease;
  margin-left: 4px;
}
.section-status-dot.complete {
  background: var(--success);
}
.section-status-dot.partial {
  background: var(--warning);
}
.section-status-dot.empty {
  background: #e57373;
}

/* ── CHUNK 1: Draft restore banner ── */
#draftBanner {
  display: none;
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  background: #1e293b;
  color: #fff;
  padding: 12px 24px;
  z-index: 999;
  display: none;
  align-items: center;
  justify-content: space-between;
  font-size: 13px;
  gap: 16px;
}
#draftBanner.visible {
  display: flex;
}
.draft-banner-actions {
  display: flex;
  gap: 8px;
  flex-shrink: 0;
}
.btn-draft-restore {
  padding: 6px 14px;
  font-size: 12px;
  font-weight: 600;
  background: var(--orange500);
  color: #fff;
  border: none;
  border-radius: 2px;
  cursor: pointer;
}
.btn-draft-dismiss {
  padding: 6px 14px;
  font-size: 12px;
  font-weight: 500;
  background: transparent;
  color: #aaa;
  border: 1px solid #444;
  border-radius: 2px;
  cursor: pointer;
}
.btn-draft-restore:hover {
  background: #d44000;
}
.btn-draft-dismiss:hover {
  color: #fff;
  border-color: #888;
}

.brief-strength-wrap {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 8px 24px 8px;
}
.brief-strength-label {
  font-size: 12px;
  color: var(--secondaryText);
  white-space: nowrap;
}
.brief-strength-bar-outer {
  flex: 1;
  height: 8px;
  background: var(--grey200);
  border-radius: 4px;
  overflow: hidden;
}
.brief-strength-bar-inner {
  height: 100%;
  border-radius: 4px;
  transition:
    width 400ms ease,
    background 400ms ease;
  width: 0%;
}
.brief-strength-badge {
  font-size: 11px;
  font-weight: 700;
  padding: 2px 10px;
  border-radius: 100px;
  white-space: nowrap;
}
.strength-weak {
  background: #ffebee;
  color: #c62828;
}
.strength-fair {
  background: var(--warningBg);
  color: #92400e;
}
.strength-strong {
  background: #e8f5e9;
  color: #1b5e20;
}
.strength-excellent {
  background: #e8f5e9;
  color: #16a34a;
}
.bar-weak {
  background: #e57373;
}
.bar-fair {
  background: var(--warning);
}
.bar-strong {
  background: var(--success);
}
.bar-excellent {
  background: #16a34a;
}
.btn-load-example {
  padding: 6px 14px;
  font-size: 12px;
  font-weight: 500;
  background: transparent;
  color: var(--secondaryText);
  border: 1px solid var(--borderColor);
  border-radius: 2px;
  cursor: pointer;
  transition: all 140ms ease;
  white-space: nowrap;
}
.btn-load-example:hover {
  background: var(--grey100);
  color: var(--textColor);
  border-color: var(--grey400);
}
#reviewOverlay {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.45);
  z-index: 600;
  align-items: center;
  justify-content: center;
}
#reviewOverlay.visible {
  display: flex;
}
#reviewPanel {
  background: var(--cardBg);
  width: 680px;
  max-width: 95vw;
  max-height: 85vh;
  border-radius: 4px;
  display: flex;
  flex-direction: column;
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.25);
  animation: slideDown 200ms ease;
}
#reviewPanel-header {
  padding: 16px 20px;
  border-bottom: 1px solid var(--borderColor);
  display: flex;
  align-items: center;
  justify-content: space-between;
  flex-shrink: 0;
}
#reviewPanel-header h3 {
  font-size: 16px;
  font-weight: 600;
}
#reviewPanel-header p {
  font-size: 12px;
  color: var(--secondaryText);
  margin-top: 2px;
}
.review-close-btn {
  background: none;
  border: none;
  font-size: 20px;
  cursor: pointer;
  color: var(--secondaryText);
  line-height: 1;
  padding: 4px;
}
.review-close-btn:hover {
  color: var(--textColor);
}
#reviewPanel-body {
  overflow-y: auto;
  padding: 16px 20px;
  flex: 1;
}
.review-section {
  margin-bottom: 16px;
}
.review-section-title {
  font-size: 11px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.06em;
  color: var(--secondaryText);
  margin-bottom: 8px;
  padding-bottom: 4px;
  border-bottom: 1px solid var(--borderColor);
}
.review-row {
  display: flex;
  gap: 8px;
  margin-bottom: 4px;
  font-size: 12px;
  align-items: flex-start;
}
.review-key {
  color: var(--secondaryText);
  min-width: 160px;
  flex-shrink: 0;
  padding-top: 5px;
}
.review-val {
  color: var(--textColor);
  font-weight: 500;
  flex: 1;
  cursor: pointer;
  padding: 4px 6px;
  border-radius: 3px;
  border: 1px solid transparent;
  transition:
    border-color 120ms,
    background 120ms;
}
.review-val:hover {
  border-color: var(--borderColor);
  background: var(--grey100);
}
.review-val.editing {
  border-color: var(--orange500) !important;
  background: #fff !important;
  cursor: text;
}
.review-val.missing {
  color: #e57373;
  font-style: italic;
  font-weight: 400;
}
.review-val-input {
  width: 100%;
  padding: 4px 6px;
  border: 1px solid var(--orange500);
  border-radius: 3px;
  font-size: 12px;
  font-family: system-ui;
  color: var(--textColor);
  font-weight: 500;
  background: #fff;
  box-sizing: border-box;
  resize: vertical;
}
.review-edit-hint {
  font-size: 10px;
  color: var(--secondaryText);
  margin-bottom: 6px;
  font-style: italic;
}
.review-list-item {
  font-size: 12px;
  padding: 3px 0;
  color: var(--textColor);
  border-bottom: 1px dashed var(--borderColor);
}
.review-list-item:last-child {
  border-bottom: none;
}
.review-callout {
  background: var(--warningBg);
  border-left: 3px solid var(--warning);
  padding: 8px 12px;
  font-size: 12px;
  color: #78350f;
  border-radius: 0 2px 2px 0;
  margin-top: 8px;
}
#reviewPanel-footer {
  padding: 14px 20px;
  border-top: 1px solid var(--borderColor);
  display: flex;
  align-items: center;
  justify-content: flex-end;
  gap: 10px;
  flex-shrink: 0;
}
.btn-review-back {
  padding: 8px 18px;
  font-size: 13px;
  font-weight: 500;
  background: transparent;
  color: var(--textColor);
  border: 1px solid var(--borderColor);
  border-radius: 2px;
  cursor: pointer;
}
.btn-review-back:hover {
  background: var(--grey100);
}
.btn-review-launch {
  padding: 8px 20px;
  font-size: 13px;
  font-weight: 600;
  background: var(--orange500);
  color: #fff;
  border: none;
  border-radius: 2px;
  cursor: pointer;
}
.btn-review-launch:hover {
  background: #d44000;
}

.btn-reopen {
  background: transparent;
  color: var(--secondaryText);
  padding: 6px 12px;
  font-size: 12px;
  font-weight: 500;
  cursor: pointer;
  border: 1px solid var(--borderColor);
  border-radius: 6px;
  transition: all 140ms ease;
  display: none;
  font-family: system-ui, sans-serif;
}
.btn-reopen:hover {
  background: var(--grey100);
  color: var(--textColor);
}
.completed-card .btn-reopen {
  display: inline-flex;
}
.completed-card .btn-mark-done {
  display: none;
}
.btn-mark-done {
  background: transparent;
  color: var(--success);
  padding: 7px 16px;
  font-size: 13px;
  font-weight: 600;
  cursor: pointer;
  border: 1.5px solid var(--success);
  border-radius: 6px;
  transition: all 200ms ease;
  font-family: system-ui, sans-serif;
  white-space: nowrap;
}
.btn-mark-done:hover {
  background-color: var(--success);
  color: var(--white);
  box-shadow: 0 2px 6px rgba(34, 197, 94, 0.3);
}
.btn-edit-prompt {
  background: transparent;
  color: var(--secondaryText);
  padding: 6px 12px;
  font-size: 12px;
  font-weight: 500;
  cursor: pointer;
  border: 1px solid var(--borderColor);
  border-radius: 6px;
  transition: all 140ms ease;
  font-family: system-ui, sans-serif;
}
.btn-edit-prompt:hover {
  background: var(--grey100);
  color: var(--textColor);
}
.btn-edit-prompt.active {
  background: var(--orange100);
  color: var(--orange500);
  border-color: var(--orange500);
}
.prompt-text-box[contenteditable="true"] {
  outline: 2px solid var(--orange300);
  background: #fffdf9;
  cursor: text;
}
#gateModal,
#clearFormModal {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.45);
  z-index: 700;
  align-items: center;
  justify-content: center;
}
#gateModal.visible,
#clearFormModal.visible {
  display: flex;
}
#gateModalBox,
#clearFormModalBox {
  background: var(--cardBg);
  width: 460px;
  max-width: 95vw;
  border-radius: 4px;
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.25);
  animation: slideDown 200ms ease;
  overflow: hidden;
}
#gateModalBox .gate-modal-header {
  background: var(--warningBg);
  border-bottom: 1px solid #fde68a;
  padding: 20px 24px;
  display: flex;
  align-items: center;
  gap: 10px;
}
#gateModalBox .gate-modal-icon {
  font-size: 20px;
}
#gateModalBox .gate-modal-title {
  font-size: 15px;
  font-weight: 600;
  color: #78350f;
}
#gateModalBox .gate-modal-body {
  padding: 20px 24px;
  font-size: 13px;
  color: var(--textColor);
  line-height: 1.7;
}
#gateModalBox .gate-modal-body p {
  margin-bottom: 12px;
}
#gateModalBox .gate-modal-checklist {
  list-style: none;
  margin: 8px 0 0;
  padding: 0;
}
#gateModalBox .gate-modal-checklist li {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 6px 0;
  border-bottom: 1px solid var(--borderColor);
  font-size: 12px;
}
#gateModalBox .gate-modal-checklist li:last-child {
  border-bottom: none;
}
#gateModalBox .gate-modal-checklist input[type="checkbox"] {
  width: 15px;
  height: 15px;
  accent-color: var(--orange500);
  flex-shrink: 0;
}
#gateModalBox .gate-modal-footer {
  padding: 16px 24px;
  border-top: 1px solid var(--borderColor);
  display: flex;
  justify-content: flex-end;
  gap: 10px;
}
.btn-gate-cancel {
  padding: 8px 16px;
  font-size: 13px;
  font-weight: 500;
  background: transparent;
  color: var(--textColor);
  border: 1px solid var(--borderColor);
  border-radius: 2px;
  cursor: pointer;
}
.btn-gate-cancel:hover {
  background: var(--grey100);
}
.btn-gate-confirm {
  padding: 8px 18px;
  font-size: 13px;
  font-weight: 600;
  background: var(--orange500);
  color: #fff;
  border: none;
  border-radius: 2px;
  cursor: pointer;
  opacity: 0.45;
  pointer-events: none;
  transition: all 140ms ease;
}
.btn-gate-confirm.ready {
  opacity: 1;
  pointer-events: auto;
}
.btn-gate-confirm.ready:hover {
  background: #d44000;
}
#resumeModal {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.45);
  z-index: 700;
  align-items: center;
  justify-content: center;
}
#resumeModal.visible {
  display: flex;
}
#resumeModalBox {
  background: var(--cardBg);
  width: 420px;
  max-width: 95vw;
  border-radius: 4px;
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.25);
  animation: slideDown 200ms ease;
  overflow: hidden;
}
#sparseBriefModal {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.45);
  z-index: 700;
  align-items: center;
  justify-content: center;
}
#sparseBriefModal.visible {
  display: flex;
}
#sparseBriefModalBox {
  background: var(--cardBg);
  width: 460px;
  max-width: 95vw;
  border-radius: 10px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.18);
  overflow: hidden;
}
#sparseBriefModalBox .gate-modal-header {
  background: var(--warningBg);
  border-bottom: 1px solid #fde68a;
  padding: 20px 24px;
  display: flex;
  align-items: center;
  gap: 10px;
}
#sparseBriefModalBox .gate-modal-icon {
  font-size: 20px;
}
#sparseBriefModalBox .gate-modal-title {
  font-size: 15px;
  font-weight: 600;
  color: #78350f;
}
#sparseBriefModalBox .gate-modal-body {
  padding: 20px 24px;
  font-size: 13px;
  color: var(--textColor);
  line-height: 1.7;
}
#sparseBriefModalBox .gate-modal-body p {
  margin-bottom: 12px;
}
#sparseBriefModalBox .gate-modal-body p:last-child {
  margin-bottom: 0;
}
#sparseBriefModalBox .gate-modal-footer {
  padding: 16px 24px;
  border-top: 1px solid var(--borderColor);
  display: flex;
  justify-content: space-between;
  gap: 10px;
}
#sparseBriefModalBox .btn-gate-confirm {
  opacity: 1;
  pointer-events: auto;
}
.resume-modal-header {
  padding: 16px 20px;
  border-bottom: 1px solid var(--borderColor);
  font-size: 15px;
  font-weight: 600;
}
.resume-modal-body {
  padding: 16px 20px;
  font-size: 13px;
  color: var(--textColor);
  line-height: 1.6;
}
.resume-modal-footer {
  padding: 14px 20px;
  border-top: 1px solid var(--borderColor);
  display: flex;
  justify-content: flex-end;
  gap: 10px;
}
.btn-resume-restart {
  padding: 8px 16px;
  font-size: 13px;
  font-weight: 500;
  background: transparent;
  color: var(--textColor);
  border: 1px solid var(--borderColor);
  border-radius: 2px;
  cursor: pointer;
}
.btn-resume-restart:hover {
  background: var(--grey100);
}
.btn-resume-continue {
  padding: 8px 18px;
  font-size: 13px;
  font-weight: 600;
  background: var(--orange500);
  color: #fff;
  border: none;
  border-radius: 2px;
  cursor: pointer;
}
.btn-resume-continue:hover {
  background: #d44000;
}

#toastContainer {
  position: fixed;
  top: 20px;
  right: 20px;
  z-index: 9999;
  display: flex;
  flex-direction: column;
  gap: 8px;
  pointer-events: none;
}
.toast {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 12px 16px;
  border-radius: 6px;
  font-size: 13px;
  font-weight: 500;
  color: #fff;
  min-width: 260px;
  max-width: 360px;
  box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
  animation: slideDown 250ms ease;
  pointer-events: auto;
  cursor: pointer;
}
.toast-info {
  background: #1e293b;
}
.toast-success {
  background: #16a34a;
}
.toast-warning {
  background: #d97706;
}
.toast-error {
  background: #c62828;
}
.toast-icon {
  font-size: 15px;
  flex-shrink: 0;
}
.toast-msg {
  flex: 1;
  line-height: 1.4;
}
.toast-close {
  font-size: 16px;
  opacity: 0.7;
  cursor: pointer;
  flex-shrink: 0;
}
.toast-close:hover {
  opacity: 1;
}
.nav-pill.pill-partial {
  border-color: var(--orange300);
  background: var(--orange100);
  color: var(--orange500);
}
.nav-pill.pill-complete {
  border-color: var(--success);
  background: #dcfce7;
  color: #16a34a;
  font-weight: 600;
}
.grid-search {
  width: 100%;
  padding: 7px 10px;
  font-size: 12px;
  border: 1px solid var(--borderColor);
  border-radius: 2px;
  margin-bottom: 8px;
  font-family: system-ui, sans-serif;
  background: var(--cardBg);
  color: var(--textColor);
  outline: none;
  box-sizing: border-box;
}
.grid-search:focus {
  border-color: var(--orange300);
}
.check-item.hidden {
  display: none !important;
}
.bb-info-btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 16px;
  height: 16px;
  border-radius: 50%;
  background: var(--grey200);
  color: var(--secondaryText);
  font-size: 10px;
  font-weight: 700;
  cursor: pointer;
  flex-shrink: 0;
  border: none;
  line-height: 1;
  transition: background 120ms ease;
  margin-left: 4px;
  vertical-align: middle;
}
.bb-info-btn:hover {
  background: var(--orange300);
  color: #fff;
}
#bbTooltip {
  display: none;
  position: fixed;
  z-index: 800;
  background: #1e293b;
  color: #f1f5f9;
  font-size: 11px;
  line-height: 1.5;
  padding: 10px 12px;
  border-radius: 3px;
  width: 280px;
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.25);
  pointer-events: none;
}
#bbTooltip.visible {
  display: block;
}
.btn-bulk-export {
  padding: 7px 16px;
  font-size: 12px;
  font-weight: 600;
  background: transparent;
  color: var(--secondaryText);
  border: 1px solid var(--borderColor);
  border-radius: 6px;
  cursor: pointer;
  transition: all 140ms ease;
  white-space: nowrap;
  display: flex;
  align-items: center;
  gap: 6px;
}
.btn-bulk-export:hover {
  background: var(--grey100);
  color: var(--textColor);
  border-color: var(--grey400);
}
.btn-bulk-export.exported {
  background: var(--successBg);
  color: var(--success);
  border-color: var(--success);
}

/* BB tags inside domain columns — compact toggleable */
.cascade-container-flex .check-item {
  width: 100%;
  border-radius: 4px;
  justify-content: space-between;
  padding: 5px 10px;
  font-size: 12px;
  transition:
    background 120ms ease,
    border-color 120ms ease,
    color 120ms ease;
}
.cascade-container-flex .check-item.selected {
  background: var(--orange500);
  border-color: var(--orange500);
  color: #fff;
}
.cascade-container-flex .check-item.selected .bb-info-btn {
  background: rgba(255, 255, 255, 0.25);
  color: #fff;
}

/* S5–S8: flex-wrap chip containers with .cci interleave support */
#techCategoryGrid,
#partnerGrid,
#regulatoryIndustryGrid,
#riskIndustryGrid,
#objectiveTypeGrid,
#domainGrid {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
  align-items: flex-start;
}
/* search input always full width */
#techCategoryGrid .grid-search,
#partnerGrid .grid-search,
#regulatoryIndustryGrid .grid-search,
#riskIndustryGrid .grid-search,
#objectiveTypeGrid .grid-search,
#domainGrid .grid-search {
  flex: 0 0 100%;
}
/* chips: natural pill width — auto-wrap gives multi-col appearance */
#techCategoryGrid > .cci > .check-item {
  min-width: calc(50% - 6px);
  flex: 1 1 calc(50% - 6px);
  border-radius: 4px;
  justify-content: center;
  text-align: center;
}
#partnerGrid > .cci > .check-item {
  min-width: calc(33% - 6px);
  flex: 1 1 calc(33% - 6px);
  border-radius: 4px;
  justify-content: center;
  text-align: center;
}
#regulatoryIndustryGrid > .cci > .check-item {
  min-width: calc(50% - 6px);
  flex: 1 1 calc(50% - 6px);
  border-radius: 4px;
  justify-content: center;
  text-align: center;
}
#riskIndustryGrid > .cci > .check-item {
  min-width: calc(50% - 6px);
  flex: 1 1 calc(50% - 6px);
  border-radius: 4px;
  justify-content: center;
  text-align: center;
}
/* cascade panels always span the full container width */
#techCategoryGrid > .cci > .cascade-block,
#partnerGrid > .cci > .cascade-block,
#regulatoryIndustryGrid > .cci > .cascade-block,
#riskIndustryGrid > .cci > .cascade-block,
#objectiveTypeGrid > .cci > .cascade-block,
#domainGrid > .cci > .cascade-block {
  flex: 0 0 100%;
}

/* S2 Industry breadcrumb */
.industry-breadcrumb-row {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 12px 0;
  flex-wrap: wrap;
}
.industry-step {
  display: flex;
  flex-direction: column;
  gap: 4px;
  flex: 1;
  min-width: 160px;
}
.industry-step-label {
  font-size: 10px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.06em;
  color: var(--secondaryText);
}
.industry-select {
  padding: 7px 10px;
  font-size: 13px;
  border: 1px solid var(--borderColor);
  border-radius: 3px;
  background: var(--cardBg);
  color: var(--textColor);
  font-family: system-ui, sans-serif;
  width: 100%;
}
.industry-select:focus {
  outline: none;
  border-color: var(--orange300);
}
.industry-select:disabled {
  background: var(--grey100);
  color: var(--grey400);
  cursor: not-allowed;
}
.industry-arrow {
  font-size: 20px;
  color: var(--grey400);
  flex-shrink: 0;
  padding-top: 16px;
}

/* S7/S8 regulator/risk checkbox list */
.reg-regulator-row {
  margin-bottom: 6px;
}
.reg-checkbox-label {
  display: flex;
  align-items: center;
  gap: 8px;
  cursor: pointer;
  padding: 6px 8px;
  border-radius: 3px;
  border: 1px solid var(--borderColor);
  background: var(--cardBg);
  font-size: 12px;
  font-weight: 600;
  color: var(--textColor);
  transition: background 120ms;
}
.reg-checkbox-label:hover {
  background: var(--grey100);
}
.reg-checkbox {
  width: 14px;
  height: 14px;
  accent-color: var(--orange500);
  flex-shrink: 0;
}
.req-chips-wrap {
  display: flex;
  flex-wrap: wrap;
  gap: 4px;
  padding: 8px 6px 4px;
}
.req-chip {
  display: inline-flex;
  align-items: center;
  gap: 5px;
  padding: 4px 9px;
  font-size: 11px;
  border: 1px solid var(--borderColor);
  border-radius: 100px;
  cursor: pointer;
  background: var(--cardBg);
  color: var(--textColor);
  transition: all 120ms;
  line-height: 1.3;
}
.req-chip:hover {
  border-color: var(--orange300);
  background: var(--orange100);
}
.req-chip input[type="checkbox"] {
  width: 12px;
  height: 12px;
  accent-color: var(--orange500);
  flex-shrink: 0;
  margin: 0;
}
.req-chip:has(input:checked) {
  background: var(--orange500);
  border-color: var(--orange500);
  color: #fff;
}

/* ══════════════════════════════════════
       FORM BUILDER — NEW DESIGN
       ══════════════════════════════════════ */

/* Page visibility — formPage hidden by default, shown via .active */
#formPage {
  display: none;
}
#formPage.active {
  display: flex !important;
  flex-direction: column;
  position: fixed;
  top: 41px;
  left: 0;
  right: 0;
  bottom: 0;
  overflow: hidden;
  background: #f4f5f6;
}

/* ── Topbar ── */

/* ══════════════════════════════════════
       REBUILT FORM PAGE — v8
    ══════════════════════════════════════ */

#formPage {
  display: none;
}
#formPage.active {
  display: flex !important;
  flex-direction: column;
  position: fixed;
  top: 41px;
  left: 0;
  right: 0;
  bottom: 0;
  overflow: hidden;
  background: #f2f3f5;
}

/* ── Top bar ── */
.fb-topbar {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 24px;
  height: 52px;
  background: #fff;
  border-bottom: 1px solid var(--borderColor);
  flex-shrink: 0;
  z-index: 10;
}
.fb-topbar-left {
  display: flex;
  align-items: center;
}
.fb-topbar-brand {
  display: flex;
  align-items: center;
  gap: 10px;
}
.fb-topbar-title {
  font-size: 14px;
  font-weight: 700;
  color: var(--textColor);
}
.fb-topbar-divider {
  width: 1px;
  height: 16px;
  background: var(--borderColor);
}
.fb-topbar-sub {
  font-size: 13px;
  color: var(--secondaryText);
}
.fb-topbar-right {
  display: flex;
  align-items: center;
  gap: 12px;
}

.fb-btn-primary {
  padding: 8px 20px;
  background: var(--orange500);
  color: #fff;
  border: none;
  border-radius: 4px;
  font-size: 13px;
  font-weight: 600;
  cursor: pointer;
  transition: opacity 140ms;
}
.fb-btn-primary:hover {
  opacity: 0.87;
}
.fb-btn-ghost {
  padding: 7px 14px;
  background: transparent;
  color: var(--textColor);
  border: 1px solid var(--borderColor);
  border-radius: 4px;
  font-size: 13px;
  cursor: pointer;
  transition: background 120ms;
}
.fb-btn-ghost:hover {
  background: var(--grey100);
}

/* Brief strength */
.brief-strength-wrap {
  display: flex;
  align-items: center;
  gap: 8px;
}
.brief-strength-label {
  font-size: 11px;
  font-weight: 600;
  color: var(--secondaryText);
  text-transform: uppercase;
  letter-spacing: 0.05em;
}
.brief-strength-bar-bg {
  width: 130px;
  height: 6px;
  background: var(--grey200);
  border-radius: 3px;
  overflow: hidden;
}
.brief-strength-bar {
  height: 100%;
  width: 0%;
  background: var(--orange500);
  border-radius: 3px;
  transition:
    width 400ms ease,
    background 400ms ease;
}
.brief-strength-value {
  font-size: 12px;
  font-weight: 600;
  color: var(--orange500);
  min-width: 56px;
}

/* ── Stepper ── */
.fb-stepper {
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 0 32px;
  height: 56px;
  background: #fff;
  border-bottom: 1px solid var(--borderColor);
  flex-shrink: 0;
  gap: 0;
  overflow-x: auto;
}
.fb-stepper::-webkit-scrollbar {
  display: none;
}
.fb-step {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 3px;
  cursor: pointer;
  padding: 0 4px;
  flex-shrink: 0;
}
.fb-step-num {
  width: 26px;
  height: 26px;
  border-radius: 50%;
  background: var(--grey200);
  color: var(--secondaryText);
  font-size: 11px;
  font-weight: 700;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 180ms;
  position: relative;
}
.fb-step-label {
  font-size: 10px;
  font-weight: 500;
  color: var(--secondaryText);
  transition: color 180ms;
  white-space: nowrap;
}
.fb-step.active .fb-step-num {
  background: var(--orange500);
  color: #fff;
  box-shadow: 0 0 0 3px rgba(0, 0, 0, 0.1);
}
.fb-step.active .fb-step-label {
  color: var(--orange500);
  font-weight: 700;
}
.fb-step.done .fb-step-num {
  background: #22c55e;
  color: #fff;
  font-size: 0;
}
.fb-step.done .fb-step-num::after {
  content: "✓";
  font-size: 13px;
}
.fb-step.done .fb-step-label {
  color: #16a34a;
}
.fb-step.partial .fb-step-num {
  background: var(--orange300);
  color: #fff;
}
.fb-step.partial .fb-step-label {
  color: var(--orange500);
}
.fb-step:hover:not(.active) .fb-step-num {
  background: var(--grey300);
}
.fb-step-line {
  flex: 1;
  height: 1px;
  background: var(--borderColor);
  min-width: 16px;
  max-width: 48px;
  margin-bottom: 14px;
}

/* ── Panels ── */
.fb-panels {
  flex: 1;
  overflow: hidden;
  position: relative;
}
.fb-panel {
  display: none;
  position: absolute;
  inset: 0;
  overflow-y: auto;
  padding: 28px 32px 100px;
}
.fb-panel.active {
  display: block;
  animation: fbPanelIn 200ms ease;
}
@keyframes fbPanelIn {
  from {
    opacity: 0;
    transform: translateY(8px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}
.fb-panel-inner {
  max-width: 900px;
  margin: 0 auto;
}
.fb-panel-heading {
  margin-bottom: 24px;
}
.fb-panel-title {
  font-size: 20px;
  font-weight: 700;
  color: var(--textColor);
  margin: 0 0 6px;
}
.fb-panel-desc {
  font-size: 13px;
  color: var(--secondaryText);
  margin: 0;
  line-height: 1.6;
}

/* ── Form grid (S1) ── */
.fb-form-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 16px;
  margin-bottom: 16px;
}
.fb-field {
  display: flex;
  flex-direction: column;
  gap: 5px;
}
.fb-field-full {
  grid-column: 1 / -1;
}
.fb-label {
  font-size: 12px;
  font-weight: 600;
  color: var(--textColor);
}
.fb-req {
  color: var(--orange500);
}
.fb-field input[type="text"],
.fb-field input[type="date"],
.fb-field select,
.fb-field textarea {
  padding: 9px 12px;
  border: 1px solid var(--borderColor);
  border-radius: 4px;
  font-size: 13px;
  font-family: system-ui, sans-serif;
  color: var(--textColor);
  background: #fff;
  transition: border-color 120ms;
  width: 100%;
  box-sizing: border-box;
}
.fb-field select {
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='6' viewBox='0 0 10 6'%3E%3Cpath fill='%23B5BCC4' d='M5 6L0 0h10z'/%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 12px center;
  padding-right: 32px;
  appearance: none;
  -webkit-appearance: none;
  cursor: pointer;
}
.fb-field input:focus,
.fb-field select:focus,
.fb-field textarea:focus {
  outline: none;
  border-color: var(--orange500);
  box-shadow: 0 0 0 3px rgba(0, 0, 0, 0.08);
}
.fb-field-error {
  font-size: 11px;
  color: #ef4444;
  min-height: 14px;
}
.fb-required.has-error input,
.fb-required.has-error select {
  border-color: #ef4444;
}
.fb-field textarea {
  resize: vertical;
  min-height: 90px;
}

/* ── Industry cascade (S2) ── */
.fb-cascade {
  display: grid;
  grid-template-columns: 1fr auto 1fr auto 1fr;
  gap: 0;
  align-items: start;
  background: #fff;
  border: 1px solid var(--borderColor);
  border-radius: 6px;
  overflow: hidden;
}
.fb-cascade-col {
  padding: 20px;
  min-height: 300px;
}
.fb-cascade-col + .fb-cascade-col {
  border-left: 1px solid var(--borderColor);
}
.fb-cascade-arrow {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 24px;
  color: var(--grey300);
  font-size: 18px;
  padding-top: 52px;
  flex-shrink: 0;
}
.fb-cascade-label {
  font-size: 11px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.07em;
  color: var(--secondaryText);
  margin-bottom: 12px;
}
.fb-cascade-placeholder {
  font-size: 12px;
  color: var(--grey400);
  font-style: italic;
}
.fb-cascade-dim {
  opacity: 0.45;
  pointer-events: none;
  transition: opacity 200ms;
}
.fb-cascade-dim.ready {
  opacity: 1;
  pointer-events: all;
}

/* ── Pills (industry cascade + general) ── */
.fb-pill-grid {
  display: flex;
  flex-direction: column;
  gap: 4px;
}
.fb-pill {
  display: block;
  padding: 7px 12px;
  border: 1px solid var(--borderColor);
  border-radius: 4px;
  font-size: 12px;
  font-weight: 500;
  cursor: pointer;
  background: #fff;
  color: var(--textColor);
  transition: all 100ms;
  text-align: left;
}
.fb-pill:hover {
  border-color: var(--orange300);
  background: var(--orange100);
  color: var(--orange500);
}
.fb-pill.selected {
  background: var(--orange500);
  border-color: var(--orange500);
  color: #fff;
  font-weight: 600;
}

/* ── Split layout (S3-S8) ── */
.fb-split {
  display: grid;
  grid-template-columns: 220px 1fr;
  gap: 0;
  background: #fff;
  border: 1px solid var(--borderColor);
  border-radius: 6px;
  overflow: hidden;
  min-height: 420px;
}
.fb-split-left {
  border-right: 1px solid var(--borderColor);
  padding: 16px 0;
  overflow-y: auto;
}
.fb-split-right {
  padding: 20px;
  overflow-y: auto;
}
.fb-split-label {
  font-size: 10px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.08em;
  color: var(--secondaryText);
  padding: 0 16px 10px;
}

/* Tab list items */
.fb-tab-list {
  display: flex;
  flex-direction: column;
}
.fb-tab-item {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 9px 16px;
  font-size: 12px;
  font-weight: 500;
  color: var(--textColor);
  cursor: pointer;
  border-left: 3px solid transparent;
  transition: all 100ms;
}
.fb-tab-item:hover {
  background: var(--grey100);
  border-left-color: var(--orange300);
}
.fb-tab-item.active {
  background: var(--orange100);
  border-left-color: var(--orange500);
  color: var(--orange500);
  font-weight: 700;
}
.fb-tab-dot {
  width: 7px;
  height: 7px;
  border-radius: 50%;
  background: var(--grey300);
  flex-shrink: 0;
  transition: background 150ms;
}
.fb-tab-item.has-data .fb-tab-dot {
  background: #22c55e;
}

/* ── Building blocks (S4) ── */
.fb-bb-grid {
  display: flex;
  flex-direction: column;
  gap: 6px;
}
.fb-bb-item {
  display: flex;
  align-items: flex-start;
  gap: 10px;
  padding: 10px 12px;
  border: 1px solid var(--borderColor);
  border-radius: 4px;
  cursor: pointer;
  transition: all 100ms;
}
.fb-bb-item:hover {
  border-color: var(--orange300);
  background: #fff8f5;
}
.fb-bb-item.selected {
  border-color: var(--orange500);
  background: var(--orange100);
}
.fb-bb-check {
  width: 16px;
  height: 16px;
  border: 2px solid var(--borderColor);
  border-radius: 3px;
  flex-shrink: 0;
  margin-top: 1px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 10px;
  color: transparent;
  transition: all 100ms;
}
.fb-bb-item.selected .fb-bb-check {
  background: var(--orange500);
  border-color: var(--orange500);
  color: #fff;
}
.fb-bb-name {
  font-size: 13px;
  font-weight: 500;
  color: var(--textColor);
}
.fb-bb-desc {
  font-size: 11px;
  color: var(--secondaryText);
  margin-top: 2px;
  line-height: 1.4;
}
.fb-bb-edit-btn {
  font-size: 10px;
  font-weight: 500;
  color: var(--orange500);
  background: transparent;
  border: 1px solid var(--orange300);
  border-radius: 3px;
  padding: 3px 7px;
  cursor: pointer;
  white-space: nowrap;
  flex-shrink: 0;
  margin-left: auto;
  align-self: flex-start;
}
.fb-bb-edit-btn:hover {
  background: var(--orange100);
}
.fb-bb-desc-textarea {
  font-size: 11px;
  color: var(--textColor);
  margin-top: 4px;
  width: 100%;
  padding: 5px 8px;
  border: 1px solid var(--orange300);
  border-radius: 3px;
  font-family: system-ui;
  line-height: 1.5;
  resize: vertical;
  min-height: 54px;
  box-sizing: border-box;
  background: #fffaf7;
}
.fb-bb-tooltip {
  position: relative;
  display: inline;
}
.fb-bb-tooltip:hover::after {
  content: attr(data-tip);
  position: absolute;
  left: 0;
  top: 100%;
  z-index: 200;
  background: #1a1a1a;
  color: #fff;
  font-size: 11px;
  line-height: 1.5;
  padding: 8px 12px;
  border-radius: 4px;
  width: 320px;
  white-space: normal;
  pointer-events: none;
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.18);
  margin-top: 4px;
}
/* ── Chips (S5 / S6) ── */
.fb-detail-label {
  font-size: 10px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.07em;
  color: var(--secondaryText);
  margin-bottom: 8px;
  margin-top: 16px;
}
.fb-detail-label:first-child {
  margin-top: 0;
}
.fb-chip-grid {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
  margin-bottom: 4px;
}
.fb-chip {
  padding: 5px 12px;
  border: 1.5px solid var(--borderColor);
  border-radius: 100px;
  font-size: 12px;
  font-weight: 500;
  cursor: pointer;
  background: #fff;
  color: var(--textColor);
  transition: all 100ms;
}
.fb-chip:hover {
  border-color: var(--orange500);
  color: var(--orange500);
  background: var(--orange100);
}
.fb-chip.selected {
  background: var(--orange500);
  border-color: var(--orange500);
  color: #fff;
  font-weight: 600;
}

/* ── Reg / Risk checklist (S7 / S8) ── */
.fb-check-group {
  display: flex;
  flex-direction: column;
  gap: 3px;
  margin-bottom: 8px;
}
.fb-check-item {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 9px 12px;
  border: 1px solid var(--borderColor);
  border-radius: 4px;
  cursor: pointer;
  transition: all 100ms;
}
.fb-check-item:hover {
  border-color: var(--orange300);
  background: #fff8f5;
}
.fb-check-item.checked {
  border-color: var(--orange500);
  background: var(--orange100);
}
.fb-check-box {
  width: 16px;
  height: 16px;
  border: 2px solid var(--borderColor);
  border-radius: 3px;
  flex-shrink: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 10px;
  color: transparent;
  transition: all 100ms;
}
.fb-check-item.checked .fb-check-box {
  background: var(--orange500);
  border-color: var(--orange500);
  color: #fff;
}
.fb-check-name {
  flex: 1;
  font-size: 13px;
  font-weight: 500;
  color: var(--textColor);
}
.fb-check-expand {
  font-size: 11px;
  color: var(--secondaryText);
  flex-shrink: 0;
}
.fb-check-reqs {
  padding: 8px 12px 8px 38px;
}

/* ── Objectives (S3) ── */
.fb-theme-table {
  display: flex;
  flex-direction: column;
  gap: 0;
}
.fb-theme-row {
  display: grid;
  grid-template-columns: 160px 1fr auto;
  align-items: center;
  gap: 10px;
  padding: 8px 0;
  border-bottom: 1px solid var(--grey100);
}
.fb-theme-row:last-child {
  border-bottom: none;
}
.fb-theme-name {
  font-size: 11px;
  font-weight: 600;
  color: var(--textColor);
  text-transform: uppercase;
  letter-spacing: 0.04em;
}
.fb-theme-row select,
.fb-theme-row input[type="text"] {
  padding: 7px 10px;
  border: 1px solid var(--borderColor);
  border-radius: 4px;
  font-size: 13px;
  font-family: system-ui;
  color: var(--textColor);
  background: #fff;
  width: 100%;
  box-sizing: border-box;
}
.fb-theme-row select {
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='6' viewBox='0 0 10 6'%3E%3Cpath fill='%23B5BCC4' d='M5 6L0 0h10z'/%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 10px center;
  padding-right: 28px;
  appearance: none;
  -webkit-appearance: none;
  cursor: pointer;
}
.fb-theme-row select:focus,
.fb-theme-row input:focus {
  outline: none;
  border-color: var(--orange500);
}
.fb-manual-btn {
  font-size: 11px;
  font-weight: 500;
  color: var(--orange500);
  background: transparent;
  border: 1px solid var(--orange300);
  border-radius: 3px;
  padding: 5px 8px;
  cursor: pointer;
  white-space: nowrap;
}
.fb-manual-btn:hover {
  background: var(--orange100);
}
.fb-section-hint {
  font-size: 12px;
  color: var(--secondaryText);
  margin-bottom: 12px;
}
.fb-obj-context {
  margin-top: 14px;
  padding-top: 14px;
  border-top: 1px solid var(--grey100);
}
.fb-panel-empty {
  font-size: 13px;
  color: var(--grey400);
  font-style: italic;
  padding: 20px 0;
}

/* ── Footer nav ── */
.fb-footer {
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  height: 60px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 32px;
  background: #fff;
  border-top: 1px solid var(--borderColor);
  z-index: 10;
}
.fb-foot-prev,
.fb-foot-next {
  padding: 8px 20px;
  border-radius: 4px;
  font-size: 13px;
  font-weight: 600;
  cursor: pointer;
  transition: all 120ms;
  border: 1px solid var(--borderColor);
}
.fb-foot-prev {
  background: #fff;
  color: var(--textColor);
}
.fb-foot-prev:hover:not(:disabled) {
  background: var(--grey100);
}
.fb-foot-prev:disabled {
  opacity: 0.35;
  cursor: default;
}
.fb-foot-next {
  background: var(--orange500);
  color: #fff;
  border-color: var(--orange500);
}
.fb-foot-next:hover {
  opacity: 0.88;
}
.fb-foot-center {
  display: flex;
  align-items: center;
  gap: 8px;
}
.fb-foot-counter {
  font-size: 12px;
  color: var(--secondaryText);
  font-weight: 500;
}

/* ═══════════════════════════════════════════
       CHANGE 9: Responsive / Mobile CSS
       ═══════════════════════════════════════════ */
@media (max-width: 768px) {
  /* Workflow container: single column, sidebar becomes top strip */
  .workflow-container {
    grid-template-columns: 1fr;
    grid-template-rows: auto 1fr;
    height: 100%;
  }
  #workflowPage.active {
    overflow: auto;
  }
  .workflow-sidebar {
    height: auto;
    max-height: 130px;
    overflow-x: auto;
    overflow-y: hidden;
    border-right: none;
    border-bottom: 1px solid var(--borderColor);
    /* Horizontal scroll strip */
    display: flex;
    flex-direction: row;
    align-items: stretch;
    box-shadow: none;
  }
  .sidebar-summary {
    display: none;
  }
  .sidebar-phase-list {
    display: flex;
    flex-direction: row;
    flex: 1;
    overflow-x: auto;
    overflow-y: hidden;
  }
  .workflow-sidebar .sidebar-phase-list #workflowSidebar {
    display: flex;
    flex-direction: row;
    min-width: max-content;
  }
  .sidebar-phase {
    display: flex;
    flex-direction: row;
    border-bottom: none;
    border-right: 1px solid var(--borderColor);
    align-items: stretch;
  }
  .sidebar-phase-label {
    writing-mode: vertical-lr;
    transform: rotate(180deg);
    padding: 8px 6px;
    font-size: 10px;
    background: var(--surfaceColor);
    border-right: 1px solid var(--borderColor);
    min-width: 26px;
    flex-direction: column;
    justify-content: space-between;
  }
  .sidebar-phase-count-badge {
    display: none;
  }
  .sidebar-item {
    padding: 8px 12px;
    font-size: 11px;
    border-left: none;
    border-bottom: 3px solid transparent;
    white-space: nowrap;
    flex-direction: column;
    align-items: center;
    gap: 4px;
    text-align: center;
    min-width: 70px;
  }
  .sidebar-item:hover {
    border-bottom-color: var(--orange300);
  }
  .sidebar-item.active {
    border-bottom-color: var(--orange500);
    background: var(--orange100);
  }
  .step-dot {
    width: 14px;
    height: 14px;
    font-size: 7px;
  }

  /* Workflow main: full width */
  .workflow-main {
    height: auto;
    overflow-y: visible;
  }

  /* Header: stack vertically */
  .workflow-header {
    flex-direction: column;
    align-items: flex-start;
    gap: 10px;
    padding: 12px 14px;
  }
  .workflow-header h2 {
    font-size: 15px;
  }
  .workflow-header p {
    font-size: 12px;
  }
  .progress-bar {
    width: 120px;
  }
  .progress-breakdown {
    font-size: 10px;
  }

  /* Phase filter */
  .phase-filter-bar {
    padding: 6px 14px;
    top: auto;
    position: relative;
  }

  /* Phase dividers */
  .phase-divider {
    padding: 8px 12px;
    flex-wrap: wrap;
    gap: 6px;
  }
  .phase-divider-right {
    flex-wrap: wrap;
  }
  .phase-divider-bar-outer {
    width: 60px;
  }

  /* Prompt cards */
  #promptCards {
    padding: 0 10px 24px;
  }
  .prompt-card-header {
    padding: 12px 14px;
  }
  .prompt-card-body {
    padding: 0 14px 16px;
  }
  .prompt-name {
    font-size: 13px;
  }
  .prompt-actions {
    flex-wrap: wrap;
    gap: 6px;
  }
  .prompt-actions-divider {
    display: none;
  }
  .prompt-actions-left {
    flex-wrap: wrap;
  }
  .prompt-actions-right {
    flex-wrap: wrap;
  }

  /* Tip banner */
  .workflow-tip-banner {
    padding: 8px 14px;
    font-size: 11px;
  }

  /* Bulk export button */
  .btn-bulk-export {
    font-size: 11px;
    padding: 6px 10px;
  }
}

@media (max-width: 480px) {
  #lp-nav {
    padding: 16px 20px;
  }
  #lp-title {
    font-size: 36px;
  }
  #lp-sub {
    font-size: 13px;
  }
  .workflow-header h2 {
    font-size: 14px;
  }
  .prompt-card-header-left {
    gap: 8px;
  }
  .prompt-id {
    font-size: 10px;
    padding: 3px 8px;
  }
}
</style>
</head>
<body>

<!-- PAGE 0: LANDING -->
<div class="page active" id="landingPage">
  <div id="lp-wrap">
    <div id="lp-grid"></div>

    <!-- ── NAV ── -->
    <nav id="lp-nav">
      <span id="lp-nav-brand"><svg style="height:24px;width:auto;vertical-align:middle;margin-right:8px;" viewBox="0 0 104 67" xmlns="http://www.w3.org/2000/svg"><defs><style>.cls-1{fill:#000;}.cls-2{fill:#fd5108;}</style></defs><path class="cls-1" d="M69.26,30.74c-2.53.41-3.83,2.28-3.83,5.57s1.73,5.53,4.37,5.53c1.23,0,2.35-.41,4.7-1.56v2.68c-2.82,1.29-4.48,1.69-6.76,1.69-2.46,0-4.19-.65-5.61-2.09-1.45-1.45-2.17-3.36-2.17-5.5,0-4.74,3.51-7.95,8.64-7.95,3.41,0,5.75,1.56,5.75,3.84,0,1.47-1.09,2.48-2.71,2.48-.83,0-1.51-.22-2.39-.72v-3.98ZM56.76,37.06c2.27-2.86,3.07-4.02,3.07-5.42s-1.11-2.53-2.6-2.53c-.91,0-1.74.43-2.14.88v5.83l-3.72,4.96v-11.31h-3.54l-5.88,9.75v-9.75h-2.03l-5.34,1.3v1.36l2.91.3v11.96h3.76l5.64-9.27v9.27h4.12l5.74-7.34ZM23.34,32.52c.87-.11,1.29-.15,1.7-.15,2.45,0,3.78,1.63,3.78,4.7,0,3.62-1.63,5.51-4.66,5.51-.25,0-.43,0-.83-.02v-10.04ZM23.34,44.25c.98.11,1.93.15,2.5.15,5.04,0,8.24-3.23,8.24-8.03,0-4.15-2.4-7.15-5.65-7.15-1.41,0-2.35.29-5.09,1.92v-2h-1.52l-5.86,1.78v1.43h2.43v16.73l-2.18.54v1.39h9.58v-1.39s-2.44-.54-2.44-.54v-4.84Z"/><path class="cls-2" d="M66.54,24.97h-15.98l2.72-4.51h15.98l-2.72,4.51ZM87.96,15.94h-15.98l-2.72,4.51h15.98l2.72-4.51Z"/></svg>Delivery Launchpad</span>
    </nav>

    <!-- ── HERO ── -->
    <div id="lp-hero">
      <h1 id="lp-title">Delivery<em>Launchpad.</em></h1>
      <p id="lp-sub">an AI-powered workflow that expedites project planning by generating a full suite of tailored artifacts, enabling teams to spend less time on documentation and more time delivering value to clients.
</p>
      <div id="lp-cta-row">
        <div class="lp-guided-toggle">
          <button class="lp-toggle-track" id="guided-toggle" role="switch" aria-checked="true" aria-label="Guided mode" onclick="toggleGuidedMode()">
            <span class="lp-toggle-thumb"></span>
          </button>
          <span class="lp-toggle-label" onclick="toggleGuidedMode()">Guided</span>
        </div>
        <button id="lp-start-btn" onclick="launchSelected()">Start</button>
      </div>
    </div>

  <!-- ── PROCESS CHAIN ── -->
    <div id="lp-chain-wrap">
      <div id="lp-chain-label">What gets produced</div>
      <div id="lp-conveyor-outer">
        <div id="lp-conveyor-track"></div>
        <div id="lp-conveyor">

          <div class="lp-cv-card" data-phase="Initiation">
            <div class="lp-cv-name">Engagement Intake</div>
            <div class="lp-cv-desc">Your brief processed into a structured summary that drives every prompt that follows.</div>
          </div>

          <div class="lp-cv-card" data-phase="Initiation">
            <div class="lp-cv-name">Stakeholder Analysis</div>
            <div class="lp-cv-desc">Every key stakeholder mapped by role, influence and interest, with a tailored engagement approach for each.</div>
          </div>

          <div class="lp-cv-card" data-phase="Initiation">
            <div class="lp-cv-name">Scope, Objectives & Success Criteria</div>
            <div class="lp-cv-desc">What is in, what is out, measurable objectives and success criteria — defined and agreed before planning begins.</div>
          </div>

          <div class="lp-cv-card lp-cv-gate" data-phase="Initiation">
            <div class="lp-cv-name">Engagement Charter</div>
            <div class="lp-cv-desc">The founding document of the engagement, purpose, scope, team, authority and constraints in one place.</div>
          </div>

          <div class="lp-cv-card" data-phase="Initiation">
            <div class="lp-cv-name">Governance Framework</div>
            <div class="lp-cv-desc">Decision-making structure, escalation paths, meeting cadence and reporting lines across the engagement.</div>
          </div>

          <div class="lp-cv-card" data-phase="Planning">
            <div class="lp-cv-name">WBS & Schedule</div>
            <div class="lp-cv-desc">Every deliverable decomposed into work packages with a phased timeline, key milestones and sequencing in one workbook.</div>
          </div>

          <div class="lp-cv-card" data-phase="Planning">
            <div class="lp-cv-name">Resource Plan & RACI</div>
            <div class="lp-cv-desc">Roles, effort estimates and loading mapped against the schedule, with RACI accountability defined for every key activity.</div>
          </div>

          <div class="lp-cv-card" data-phase="Planning">
            <div class="lp-cv-name">Budget & Cost Baseline</div>
            <div class="lp-cv-desc">A structured cost estimate across phases, resource categories and delivery activities.</div>
          </div>

          <div class="lp-cv-card" data-phase="Planning">
            <div class="lp-cv-name">Risk Register</div>
            <div class="lp-cv-desc">Identified risks with likelihood, impact rating, owner and mitigation action for each.</div>
          </div>

          <div class="lp-cv-card" data-phase="Planning">
            <div class="lp-cv-name">Communications Plan</div>
            <div class="lp-cv-desc">What gets communicated, to whom, at what frequency and through which channel.</div>
          </div>

          <div class="lp-cv-card" data-phase="Planning">
            <div class="lp-cv-name">Quality Plan</div>
            <div class="lp-cv-desc">Review gates, quality standards and acceptance criteria for every key deliverable.</div>
          </div>

          <div class="lp-cv-card" data-phase="Planning">
            <div class="lp-cv-name">Change Control Log</div>
            <div class="lp-cv-desc">The log for requesting, assessing, approving and tracking scope changes throughout delivery.</div>
          </div>

          <div class="lp-cv-card lp-cv-gate" data-phase="Planning">
            <div class="lp-cv-name">PMO Playbook</div>
            <div class="lp-cv-desc">The complete operating manual for the engagement — every plan, process and change control policy in one document.</div>
          </div>

        </div>
      </div>
     <div style="height: 32px;"></div>
       <p id="lp-contact">For assistance contact <a href="mailto:george.prowse@au.pwc.com">george.prowse@au.pwc.com</a></p>
    </div>
  </div>
</div>

<!-- LOADING OVERLAY -->
<div class="loading-overlay" id="loadingOverlay">
  <div class="loading-spinner"></div>
  <div class="loading-text" id="loadingText">Loading data...</div>
</div>

<!-- HEADER -->
<div class="header">
  <div class="header-left">
    <span class="header-title" id="headerTitle"><svg style="height:28px;width:auto;vertical-align:middle;margin-right:8px;" viewBox="0 0 104 67" xmlns="http://www.w3.org/2000/svg"><defs><style>.cls-1{fill:#000;}.cls-2{fill:#fd5108;}</style></defs><path class="cls-1" d="M69.26,30.74c-2.53.41-3.83,2.28-3.83,5.57s1.73,5.53,4.37,5.53c1.23,0,2.35-.41,4.7-1.56v2.68c-2.82,1.29-4.48,1.69-6.76,1.69-2.46,0-4.19-.65-5.61-2.09-1.45-1.45-2.17-3.36-2.17-5.5,0-4.74,3.51-7.95,8.64-7.95,3.41,0,5.75,1.56,5.75,3.84,0,1.47-1.09,2.48-2.71,2.48-.83,0-1.51-.22-2.39-.72v-3.98ZM56.76,37.06c2.27-2.86,3.07-4.02,3.07-5.42s-1.11-2.53-2.6-2.53c-.91,0-1.74.43-2.14.88v5.83l-3.72,4.96v-11.31h-3.54l-5.88,9.75v-9.75h-2.03l-5.34,1.3v1.36l2.91.3v11.96h3.76l5.64-9.27v9.27h4.12l5.74-7.34ZM23.34,32.52c.87-.11,1.29-.15,1.7-.15,2.45,0,3.78,1.63,3.78,4.7,0,3.62-1.63,5.51-4.66,5.51-.25,0-.43,0-.83-.02v-10.04ZM23.34,44.25c.98.11,1.93.15,2.5.15,5.04,0,8.24-3.23,8.24-8.03,0-4.15-2.4-7.15-5.65-7.15-1.41,0-2.35.29-5.09,1.92v-2h-1.52l-5.86,1.78v1.43h2.43v16.73l-2.18.54v1.39h9.58v-1.39s-2.44-.54-2.44-.54v-4.84Z"/><path class="cls-2" d="M66.54,24.97h-15.98l2.72-4.51h15.98l-2.72,4.51ZM87.96,15.94h-15.98l-2.72,4.51h15.98l2.72-4.51Z"/></svg>Delivery Launchpad</span>
  </div>
  <span class="header-subtitle" id="headerSubtitle">Form</span>
</div>

<div class="page" id="formPage">

  <!-- ══ TOP BAR ══ -->
  <div class="fb-topbar">
    <div class="fb-topbar-left">
      <div class="fb-topbar-brand">
        <span class="fb-topbar-title">New Engagement Brief</span>
        <span class="fb-topbar-divider"></span>
        <span class="fb-topbar-sub" id="fb-current-section-label">Engagement Context</span>
      </div>
    </div>
    <div class="fb-topbar-right">
      <div class="brief-strength-wrap">
        <span class="brief-strength-label">Brief Strength</span>
        <div class="brief-strength-bar-bg"><div class="brief-strength-bar" id="briefStrengthBar"></div></div>
        <span class="brief-strength-value" id="briefStrengthLabel">—</span>
      </div>
      <button class="fb-btn-ghost" onclick="clearAllFormData()" style="color:#c00;border-color:#f5c0c0;" title="Clear all data and start a new engagement">New Engagement</button>
      <button class="fb-btn-ghost" onclick="loadExampleData()">Load Example</button>
      <button class="fb-btn-primary" onclick="startWorkflow()">Launch Workflow →</button>
    </div>
  </div>

  <!-- ══ STEPPER ══ -->
  <div class="fb-stepper" id="fbStepper">
    <div class="fb-step active" id="step-s1" onclick="fbGoToSection(1)">
      <div class="fb-step-num" id="stepnum-s1">1</div>
      <span class="fb-step-label">Engagement</span>
    </div>
    <div class="fb-step-line"></div>
    <div class="fb-step" id="step-s2" onclick="fbGoToSection(2)">
      <div class="fb-step-num" id="stepnum-s2">2</div>
      <span class="fb-step-label">Industry</span>
    </div>
    <div class="fb-step-line"></div>
    <div class="fb-step" id="step-s3" onclick="fbGoToSection(3)">
      <div class="fb-step-num" id="stepnum-s3">3</div>
      <span class="fb-step-label">Objectives</span>
    </div>
    <div class="fb-step-line"></div>
    <div class="fb-step" id="step-s4" onclick="fbGoToSection(4)">
      <div class="fb-step-num" id="stepnum-s4">4</div>
      <span class="fb-step-label">Services</span>
    </div>
    <div class="fb-step-line"></div>
    <div class="fb-step" id="step-s5" onclick="fbGoToSection(5)">
      <div class="fb-step-num" id="stepnum-s5">5</div>
      <span class="fb-step-label">Technology</span>
    </div>
    <div class="fb-step-line"></div>
    <div class="fb-step" id="step-s6" onclick="fbGoToSection(6)">
      <div class="fb-step-num" id="stepnum-s6">6</div>
      <span class="fb-step-label">Partners</span>
    </div>
    <div class="fb-step-line"></div>
    <div class="fb-step" id="step-s7" onclick="fbGoToSection(7)">
      <div class="fb-step-num" id="stepnum-s7">7</div>
      <span class="fb-step-label">Regulatory</span>
    </div>
    <div class="fb-step-line"></div>
    <div class="fb-step" id="step-s8" onclick="fbGoToSection(8)">
      <div class="fb-step-num" id="stepnum-s8">8</div>
      <span class="fb-step-label">Risk</span>
    </div>
  </div>

  <!-- ══ SECTION PANELS ══ -->
  <div class="fb-panels" id="fbPanels">

    <!-- ── S1: ENGAGEMENT CONTEXT ── -->
    <div class="fb-panel active" id="fb-s1">
      <div class="fb-panel-inner">
        <div class="fb-panel-heading">
          <h2 class="fb-panel-title">Engagement Context</h2>
          <p class="fb-panel-desc">Core details used across all 19 prompts. Fields marked * are required to launch.</p>
        </div>
        <div class="fb-form-grid">
          <div class="fb-field fb-required" id="field-clientName">
            <label class="fb-label">Client Name <span class="fb-req">*</span></label>
            <input type="text" id="clientName" placeholder="e.g. Acme Corporation" oninput="fbFieldChange('s1')">
            <div class="fb-field-error" id="err-clientName"></div>
          </div>
          <div class="fb-field fb-required" id="field-engagementName">
            <label class="fb-label">Engagement Name <span class="fb-req">*</span></label>
            <input type="text" id="engagementName" placeholder="e.g. Finance Transformation" oninput="fbFieldChange('s1')">
            <div class="fb-field-error" id="err-engagementName"></div>
          </div>
          <div class="fb-field">
            <label class="fb-label">Engagement Lead</label>
            <input type="text" id="engagementLead" placeholder="Lead partner or manager name" oninput="fbFieldChange('s1')">
          </div>
          <div class="fb-field">
            <label class="fb-label">Delivery Methodology</label>
            <select id="deliveryMethodology" onchange="fbFieldChange('s1')">
              <option value="">Select methodology...</option>
              <option>Agile</option><option>Waterfall</option><option>Hybrid</option>
              <option>SAFe</option><option>PRINCE2</option><option>PMI/PMBOK</option>
              <option>Design Thinking</option><option>Lean</option>
            </select>
          </div>
          <div class="fb-field">
            <label class="fb-label">Start Date</label>
            <input type="date" id="startDate" onchange="fbFieldChange('s1')">
          </div>
          <div class="fb-field">
            <label class="fb-label">End Date</label>
            <input type="date" id="endDate" onchange="fbFieldChange('s1')">
          </div>
          <div class="fb-field">
            <label class="fb-label">Fee Structure</label>
            <select id="feeStructure" onchange="fbFieldChange('s1')">
              <option value="">Select fee structure...</option>
              <option>Fixed Fee</option><option>Time &amp; Materials</option>
              <option>Retainer</option><option>Value-Based</option>
              <option>Capped T&amp;M</option><option>Milestone-Based</option>
            </select>
          </div>
          <div class="fb-field">
            <label class="fb-label">Total Budget</label>
            <input type="text" id="totalBudget" placeholder="e.g. $2.4M" oninput="fbFieldChange('s1')">
          </div>
        </div>
        <div class="fb-field fb-field-full">
          <label class="fb-label">Engagement Description</label>
          <textarea id="engagementDescription" rows="4" placeholder="Brief summary of what this engagement aims to achieve, the client's situation, and key expected outcomes..." oninput="fbFieldChange('s1')"></textarea>
        </div>
      </div>
    </div>

    <!-- ── S2: INDUSTRY ── -->
    <div class="fb-panel" id="fb-s2">
      <div class="fb-panel-inner">
        <div class="fb-panel-heading">
          <h2 class="fb-panel-title">Industry</h2>
          <p class="fb-panel-desc">Select your client's industry, sector, and sub-sector to tailor all 19 prompts.</p>
        </div>
        <div class="fb-cascade">
          <div class="fb-cascade-col" id="trail-industry">
            <div class="fb-cascade-label">Industry</div>
            <div class="fb-pill-grid" id="industryPills"></div>
          </div>
          <div class="fb-cascade-arrow">›</div>
          <div class="fb-cascade-col fb-cascade-dim" id="trail-sector">
            <div class="fb-cascade-label">Sector</div>
            <div class="fb-pill-grid" id="sectorPills"><span class="fb-cascade-placeholder">Select an industry first</span></div>
          </div>
          <div class="fb-cascade-arrow">›</div>
          <div class="fb-cascade-col fb-cascade-dim" id="trail-subsector">
            <div class="fb-cascade-label">Sub-sector</div>
            <div class="fb-pill-grid" id="subsectorPills"><span class="fb-cascade-placeholder">Select a sector first</span></div>
          </div>
        </div>
      </div>
    </div>

    <!-- ── S3: OBJECTIVES ── -->
    <div class="fb-panel" id="fb-s3">
      <div class="fb-panel-inner">
        <div class="fb-panel-heading">
          <h2 class="fb-panel-title">Objectives</h2>
          <p class="fb-panel-desc">Select the engagement objective type, then assign themes and specific objectives.</p>
        </div>
        <div class="fb-split">
          <div class="fb-split-left">
            <div class="fb-split-label">Objective Type</div>
            <div class="fb-tab-list" id="objTypeList"></div>
          </div>
          <div class="fb-split-right" id="objThemePanel">
            <div class="fb-panel-empty">Select an objective type on the left</div>
          </div>
        </div>
      </div>
    </div>

    <!-- ── S4: SERVICES ── -->
    <div class="fb-panel" id="fb-s4">
      <div class="fb-panel-inner">
        <div class="fb-panel-heading">
          <h2 class="fb-panel-title">Service Offerings</h2>
          <p class="fb-panel-desc">Select a service domain then pick the building blocks that apply to this engagement.</p>
        </div>
        <div class="fb-split">
          <div class="fb-split-left">
            <div class="fb-split-label">Domain</div>
            <div class="fb-tab-list" id="domainTabList"></div>
          </div>
          <div class="fb-split-right" id="domainBlockPanel">
            <div class="fb-panel-empty">Select a domain to browse building blocks</div>
          </div>
        </div>
      </div>
    </div>

    <!-- ── S5: TECHNOLOGY ── -->
    <div class="fb-panel" id="fb-s5">
      <div class="fb-panel-inner">
        <div class="fb-panel-heading">
          <h2 class="fb-panel-title">Technology Landscape</h2>
          <p class="fb-panel-desc">Select categories, sub-categories, and specific products or tools relevant to this engagement.</p>
        </div>
        <div class="fb-split">
          <div class="fb-split-left">
            <div class="fb-split-label">Category</div>
            <div class="fb-tab-list" id="techCatList"></div>
          </div>
          <div class="fb-split-right" id="techDetailPanel">
            <div class="fb-panel-empty">Select a technology category</div>
          </div>
        </div>
      </div>
    </div>

    <!-- ── S6: PARTNERS ── -->
    <div class="fb-panel" id="fb-s6">
      <div class="fb-panel-inner">
        <div class="fb-panel-heading">
          <h2 class="fb-panel-title">Alliance Partners</h2>
          <p class="fb-panel-desc">Select relevant alliance partners and the product families or tools involved.</p>
        </div>
        <div class="fb-split">
          <div class="fb-split-left">
            <div class="fb-split-label">Partner</div>
            <div class="fb-tab-list" id="partnerTabList"></div>
          </div>
          <div class="fb-split-right" id="partnerDetailPanel">
            <div class="fb-panel-empty">Select a partner to view product families</div>
          </div>
        </div>
      </div>
    </div>

    <!-- ── S7: REGULATORY ── -->
    <div class="fb-panel" id="fb-s7">
      <div class="fb-panel-inner">
        <div class="fb-panel-heading">
          <h2 class="fb-panel-title">Regulatory Profile</h2>
          <p class="fb-panel-desc">Select applicable regulators and their requirements to enrich compliance-related prompts.</p>
        </div>
        <div class="fb-split">
          <div class="fb-split-left">
            <div class="fb-split-label">Industry Group</div>
            <div class="fb-tab-list" id="regGroupList"></div>
          </div>
          <div class="fb-split-right" id="regDetailPanel">
            <div class="fb-panel-empty">Select an industry group to view regulators</div>
          </div>
        </div>
      </div>
    </div>

    <!-- ── S8: RISK ── -->
    <div class="fb-panel" id="fb-s8">
      <div class="fb-panel-inner">
        <div class="fb-panel-heading">
          <h2 class="fb-panel-title">Risk Profile</h2>
          <p class="fb-panel-desc">Select risk categories and specific risks to populate the Risk Register and other risk-aware prompts.</p>
        </div>
        <div class="fb-split">
          <div class="fb-split-left">
            <div class="fb-split-label">Industry Group</div>
            <div class="fb-tab-list" id="riskGroupList"></div>
          </div>
          <div class="fb-split-right" id="riskDetailPanel">
            <div class="fb-panel-empty">Select an industry group to view risk types</div>
          </div>
        </div>
      </div>
    </div>

  </div><!-- /fb-panels -->

  <!-- ══ FOOTER NAV ══ -->
  <div class="fb-footer">
    <button class="fb-foot-prev" id="fbPrevBtn" onclick="fbNav(-1)" disabled>← Previous</button>
    <div class="fb-foot-center">
      <span class="fb-foot-counter" id="fbStepCounter">1 of 8</span>
    </div>
    <button class="fb-foot-next" id="fbNextBtn" onclick="fbNav(1)">Next →</button>
  </div>

</div>

<div class="page" id="workflowPage">
  <div class="workflow-container">
    <div class="workflow-sidebar" id="workflowSidebarWrap">
      <!-- Sidebar overall progress summary -->
      <div class="sidebar-summary" id="sidebarSummary">
        <div class="sidebar-summary-title">Overall Progress</div>
        <div class="sidebar-summary-count" id="sidebarSummaryCount">0 of 20 steps</div>
        <div class="sidebar-summary-subtext" id="sidebarSummarySubtext">Get started below</div>
        <div class="sidebar-summary-bar-outer">
          <div class="sidebar-summary-bar-inner" id="sidebarSummaryBar" style="width:0%"></div>
        </div>
      </div>
      <div class="sidebar-phase-list">
        <div id="workflowSidebar"></div>
      </div>
    </div>
    <div class="workflow-main">
      <div class="workflow-header">
        <div style="display:flex; align-items:center; gap:16px;">
          <button class="btn btn-secondary" onclick="goBackToForm()" style="white-space:nowrap;">&#8592; Back</button>
          <div>
            <h2 id="workflowTitle">Engagement Workflow</h2>
            <p id="workflowSubtitle">Copy each prompt in sequence into your AI tool</p>
          </div>
        </div>
        <div style="display:flex;align-items:center;gap:14px;flex-shrink:0;">
          <button class="btn-bulk-export" id="bulkExportBtn" onclick="exportAllPrompts()">&#8681; Export All</button>
          <div class="progress-wrap">
            <div class="progress-label" id="progressText" aria-live="polite">0 of 20 steps complete</div>
            <div class="progress-breakdown" id="progressBreakdown"></div>
            <div class="progress-bar"><div class="progress-fill" id="progressFill" style="width:0%"></div></div>
          </div>
        </div>
      </div>
      <!-- CHANGE 5: Phase filter pill row -->
      <div class="phase-filter-bar">
        <div class="phase-filter-pills" id="phaseFilterPills">
          <span class="phase-filter-label">Filter:</span>
        </div>
      </div>
      <!-- CHANGE 12: Single dismissible tip banner -->
      <div class="workflow-tip-banner" id="workflowTipBanner">
        <span class="workflow-tip-icon">&#9432;</span>
        <span class="workflow-tip-text">Export saves a .txt backup if your session times out. Run each prompt with <strong>Code Interpreter enabled</strong> in your AI tool.</span>
        <button class="workflow-tip-dismiss" onclick="dismissWorkflowTip()" aria-label="Dismiss tip">&#x2715;</button>
      </div>
      <div id="promptCards"></div>
    </div>
  </div>
</div>

<script>
// ══════════════════════════════════════
// REBUILT FORM PAGE — STEPPER NAV
// ══════════════════════════════════════

var _fbCurrentSection = 1;
var FB_TOTAL_SECTIONS = 8;

var FB_SECTION_LABELS = {
  1: "Engagement Context",
  2: "Industry",
  3: "Objectives",
  4: "Service Offerings",
  5: "Technology Landscape",
  6: "Alliance Partners",
  7: "Regulatory Profile",
  8: "Risk Profile",
};

function fbGoToSection(n) {
  if (n < 1 || n > FB_TOTAL_SECTIONS) return;
  // Hide current
  var cur = document.getElementById("fb-s" + _fbCurrentSection);
  if (cur) cur.classList.remove("active");
  var curStep = document.getElementById("step-s" + _fbCurrentSection);
  if (curStep) curStep.classList.remove("active");
  // Show new
  _fbCurrentSection = n;
  var next = document.getElementById("fb-s" + n);
  if (next) next.classList.add("active");
  var nextStep = document.getElementById("step-s" + n);
  if (nextStep) nextStep.classList.add("active");
  // Update label
  var lbl = document.getElementById("fb-current-section-label");
  if (lbl) lbl.textContent = FB_SECTION_LABELS[n] || "";
  // Update counter
  var ctr = document.getElementById("fbStepCounter");
  if (ctr) ctr.textContent = n + " of " + FB_TOTAL_SECTIONS;
  // Update prev/next buttons
  var prev = document.getElementById("fbPrevBtn");
  var nxt = document.getElementById("fbNextBtn");
  if (prev) prev.disabled = n === 1;
  if (nxt) nxt.textContent = n === FB_TOTAL_SECTIONS ? "Done ✓" : "Next →";
  // Scroll panel to top
  if (next) next.scrollTop = 0;
  // Eval dots
  fbEvalDots();
}

function fbNav(dir) {
  fbGoToSection(_fbCurrentSection + dir);
}

// ── Init sections on load ──
function fbInitSections() {
  fbGoToSection(1);
}

// ── Stepper dot states ──
function fbUpdateDot(sectionId, state) {
  // sectionId is like 's1', 's2' ...
  var n = parseInt(sectionId.replace("s", ""));
  var stepEl = document.getElementById("step-s" + n);
  if (!stepEl) return;
  stepEl.classList.remove("done", "partial");
  if (state === "filled") stepEl.classList.add("done");
  else if (state === "partial") stepEl.classList.add("partial");
  // keep 'active' class for current
  if (n === _fbCurrentSection) stepEl.classList.add("active");
}

function fbEvalDots() {
  // S1
  var s1 = [
    "clientName",
    "engagementName",
    "engagementLead",
    "deliveryMethodology",
    "startDate",
    "endDate",
    "feeStructure",
    "totalBudget",
    "engagementDescription",
  ];
  var s1filled = s1.filter(function (id) {
    var el = document.getElementById(id);
    return el && (el.value || "").trim();
  }).length;
  fbUpdateDot(
    "s1",
    s1filled >= 4 ? "filled" : s1filled > 0 ? "partial" : "empty",
  );
  // S2
  var ind = document.getElementById("industryDrop"),
    sec = document.getElementById("sectorDrop");
  fbUpdateDot(
    "s2",
    sec && sec.value ? "filled" : ind && ind.value ? "partial" : "empty",
  );
  // S3
  var objSels = document.querySelectorAll("#fb-s3 select");
  var objFilled = Array.from(objSels).filter(function (s) {
    return s.value;
  }).length;
  fbUpdateDot(
    "s3",
    objFilled >= 3 ? "filled" : objFilled > 0 ? "partial" : "empty",
  );
  // S4
  var bbSel = document.querySelectorAll("#fb-s4 .fb-bb-item.selected").length;
  fbUpdateDot("s4", bbSel >= 3 ? "filled" : bbSel > 0 ? "partial" : "empty");
  // S5
  var techSel = document.querySelectorAll("#fb-s5 .fb-chip.selected").length;
  fbUpdateDot(
    "s5",
    techSel >= 2 ? "filled" : techSel > 0 ? "partial" : "empty",
  );
  // S6
  var partSel = document.querySelectorAll(
    "#fb-s6 .fb-chip.selected, #fb-s6 .fb-tab-item.has-data",
  ).length;
  fbUpdateDot(
    "s6",
    partSel >= 2 ? "filled" : partSel > 0 ? "partial" : "empty",
  );
  // S7
  var regSel = document.querySelectorAll(
    "#fb-s7 .fb-check-item.checked",
  ).length;
  fbUpdateDot("s7", regSel >= 2 ? "filled" : regSel > 0 ? "partial" : "empty");
  // S8
  var riskSel = document.querySelectorAll(
    "#fb-s8 .fb-check-item.checked",
  ).length;
  fbUpdateDot(
    "s8",
    riskSel >= 2 ? "filled" : riskSel > 0 ? "partial" : "empty",
  );
  // Brief strength
  if (typeof updateBriefStrength === "function") updateBriefStrength();
}

function fbFieldChange(sectionId) {
  fbEvalDots();
  clearTimeout(window._fbAutoSave);
  window._fbAutoSave = setTimeout(function () {
    try {
      var st = collectFormState();
      localStorage.setItem(DRAFT_KEY, JSON.stringify(st));
    } catch (e) {}
  }, 1200);
}

function fbFilterList(listId, query) {
  var q = (query || "").toLowerCase().trim();
  document
    .querySelectorAll("#" + listId + " .fb-tab-item")
    .forEach(function (item) {
      item.style.display =
        !q || item.textContent.toLowerCase().indexOf(q) !== -1 ? "" : "none";
    });
}

// ── fbToggleSection delegates to toggleSection (single toggle implementation) ──
function fbToggleSection(section) {
  if (typeof toggleSection === "function") toggleSection(section);
}

// ── APP STATE ──
let appData = {};
let completedSteps = new Set();
let formData = {};
// Globals initialised early to prevent read-before-set
var _autoSaveTimer = null;
var _pendingGateId = null;
var highlightedEl = null;
var guidancePanel = null;

// ── INLINED DATA (standalone mode) ──
const INLINED_DATA = {
  industries: {
    industries: [
      {
        industry: "Consumer Markets",
        sectors: [
          {
            sector: "Consumer",
            sub_sectors: [
              "Agriculture",
              "Farming of Animals",
              "Fishing, Hunting & Trapping",
              "Soap, Detergents, Perfume & Toilet Preparations Production",
              "Food, Confectionery, Tobacco, Animal Foods Production",
              "Drinks Production",
              "Textiles Production",
              "Leather & Leather Goods Production",
              "Footwear Manufacture & Design",
              "Clothing Manufacture & Design",
              "Household Goods Production",
              "Digital Consumer",
            ],
          },
          {
            sector: "Forest, Paper and Packaging",
            sub_sectors: [
              "Forestry",
              "Sawmilling & Preparation of Wood",
              "Manufacture of Wood Products",
              "Manufacture of Paper & Paper Products",
            ],
          },
          {
            sector: "Hospitality and Leisure",
            sub_sectors: ["Hotels & Catering", "Tourism", "Casinos & Gambling"],
          },
          {
            sector: "Retail",
            sub_sectors: [
              "Wholesale Distribution",
              "Agents Involved in the Sale of Goods",
              "Retail & Distribution",
              "Repair of Consumer Goods",
              "Digital Retail",
              "Personal Services",
              "Domestic Services",
              "Persons & Families",
            ],
          },
          {
            sector: "Transportation and Logistics",
            sub_sectors: [
              "Railways (excluding City Railways)",
              "City Railways",
              "Road Passenger & Goods Transport",
              "Other Land Transport including Pipeline",
              "Inland Water Transport",
              "Sea Transport & Shipping",
              "Air Transport",
              "Support Services to Transport including Airports & Seaports",
              "Logistics & Freight Forwarders including Warehousing",
              "Postal/Delivery Services",
            ],
          },
        ],
      },
      {
        industry: "Energy, Utilities and Resources",
        sectors: [
          {
            sector: "Chemicals",
            sub_sectors: [
              "Manufacture of Industrial Chemicals",
              "Manufacture of Petrochemicals",
              "Manufacture of Paint, Varnishes & Allied Products",
              "Manufacture of Agricultural Chemicals",
            ],
          },
          {
            sector: "Energy",
            sub_sectors: [
              "Upstream Exploration and Production of Petroleum",
              "Crude Petroleum and Natural Gas",
              "Extraction & Production of Gas",
              "Oilfield Services",
              "Petroleum Refining",
              "Wholesale Dealing in Petroleum",
              "Retail Distribution of Motor Fuel, Lubricating Oil & LPG",
              "Holding Companies of Oil & Gas Conglomerates",
            ],
          },
          {
            sector: "Metals and Mining",
            sub_sectors: [
              "Extraction & Briquetting of Solid Fuels",
              "Extraction & Preparation of Metalliferous Ores",
              "Production & Preliminary Processing of Metals & Steel",
              "Extraction of Minerals other than Metals",
            ],
          },
          {
            sector: "Power and Utilities",
            sub_sectors: [
              "Nuclear Fuels Industry",
              "Electricity Production, Wholesale, Transmission, Distribution & Retail",
              "Gas Wholesale, Transport & Storage, Distribution & Retail",
              "Production & Distribution of Steam, Hot Water & Compressed Air",
              "Water Supply, Collection, Purification & Distribution",
            ],
          },
        ],
      },
      {
        industry: "Financial Services",
        sectors: [
          {
            sector: "Asset and Wealth Management",
            sub_sectors: [
              "Asset/Wealth Management of CISs, Pension/Insurance/HNW Assets",
              "Traditional Collective Investment Schemes (Open/Closed)",
              "Hedge Fund Managers & Hedge Funds",
              "Real Estate Managers, Funds & Investment Portfolios",
              "Pension Funds & Retirement Plans",
              "Infrastructure Investments & Funds",
            ],
          },
          {
            sector: "Banking and Capital Markets",
            sub_sectors: [
              "Retail Banking",
              "Asset-based Finance, Leasing & Hire Purchase",
              "Mortgage, Building Societies, Savings & Loan Institutions",
              "Broker/Securities Dealers (Front-office)",
              "Settlements, Exchanges & Clearing Organisations",
              "Consumer Finance",
              "Non-Governmental Financial Regulators",
            ],
          },
          {
            sector: "Insurance",
            sub_sectors: [
              "Non-Life Insurance (including P&C)",
              "Life Insurance",
              "Composite Insurance",
              "Reinsurance",
              "Lloyds",
              "Insurance Broking & Other Activities",
            ],
          },
          { sector: "Private Equity", sub_sectors: ["Private Equity"] },
        ],
      },
      {
        industry: "Government and Public Services",
        sectors: [
          {
            sector: "Central, National, Federal Government",
            sub_sectors: [
              "Central/National/Federal Government Entities",
              "Central Government Owned Enterprises/Companies",
              "Agencies/Other Government Bodies",
              "Defence",
              "Education - National",
            ],
          },
          {
            sector: "G and PS - Other",
            sub_sectors: [
              "Religious, Charitable & Other Not-for-Profit Local Organisations",
              "Membership Organisations (Trade, Social, Political, etc.)",
            ],
          },
          {
            sector: "International Government Organisations",
            sub_sectors: ["International Government Organisations"],
          },
          {
            sector: "Regional, State, Local and City Government",
            sub_sectors: ["Regional/State/Local & City Government"],
          },
        ],
      },
      {
        industry: "Health Industries",
        sectors: [
          {
            sector: "Health Services",
            sub_sectors: ["Health Payers/Insurers", "Health Providers"],
          },
          {
            sector: "Pharma and Life Sciences",
            sub_sectors: ["Medical Devices & Diagnostics", "Biotech"],
          },
        ],
      },
      {
        industry: "Industrial Manufacturing and Automotive",
        sectors: [
          {
            sector: "Automotive",
            sub_sectors: [
              "Manufacture of Motor Vehicles",
              "Vehicle Retail/Parts Retail/Hire/Repair/Garages",
            ],
          },
          {
            sector: "Business Services",
            sub_sectors: [
              "Business Services other than Legal & Financial",
              "Legal Services",
              "Cleansing Services",
            ],
          },
          {
            sector: "Engineering and Construction",
            sub_sectors: [
              "Contractor/Construction",
              "Civil Engineering/Design Services",
              "Manufacture of Building Products",
            ],
          },
          {
            sector: "Manufacturing",
            sub_sectors: [
              "Man-made Fibres",
              "Manufacture of Metal Items excluding Engineering & Vehicles",
              "Mechanical Engineering",
              "Manufacture of Office Machinery",
              "Electrical Engineering",
              "Non-automotive Rubber & Plastic Products",
              "Other Manufacturing Industries",
              "Dealing in Scrap",
              "Holding Companies of Multi-sector Conglomerate Business",
            ],
          },
        ],
      },
      {
        industry: "PE, Real Assets and SIF",
        sectors: [
          { sector: "Private Equity", sub_sectors: ["Private Equity"] },
        ],
      },
      {
        industry: "Technology, Media and Telecommunications",
        sectors: [
          {
            sector: "Media and Entertainment",
            sub_sectors: [
              "Publishing",
              "Advertising & PR Agencies",
              "Filmed Entertainment",
              "Radio & Television Broadcasting",
              "Entertainment & Media Not Specified Elsewhere",
              "Sport & Live Events",
              "Recreational & Cultural Services Not Specified Elsewhere",
            ],
          },
          {
            sector: "Technology",
            sub_sectors: [
              "Computers & Networking",
              "Semiconductors",
              "Software & Internet",
              "Venture Capital Activities in Tech & Related Sectors",
            ],
          },
          { sector: "Telecommunications", sub_sectors: ["Telecommunications"] },
        ],
      },
    ],
  },
  workflow: {
    phases: [
      {
        phase_id: "P1",
        phase_name: "Initiation",
        prompts: [
          {
            prompt_id: "P1.1",
            prompt_name: "Engagement Intake",
            file: "engagement_intake.json",
            artifact: "Engagement Intake Summary",
            depends_on: null,
            sign_off_gate: false,
          },
          {
            prompt_id: "P1.2",
            prompt_name: "Stakeholder Analysis",
            file: "stakeholder_analysis.json",
            artifact: "Stakeholder Analysis Workbook",
            depends_on: ["P1.1"],
            sign_off_gate: false,
          },
          {
            prompt_id: "P1.3",
            prompt_name: "Scope, Objectives & Success Criteria",
            file: "scope_objectives.json",
            artifact: "Scope & Objectives Workbook",
            depends_on: ["P1.1"],
            sign_off_gate: false,
          },
          {
            prompt_id: "P1.4",
            prompt_name: "Engagement Charter",
            file: "engagement_charter.json",
            artifact: "Engagement Charter",
            depends_on: ["P1.1", "P1.2", "P1.3"],
            sign_off_gate: true,
          },
          {
            prompt_id: "P1.5",
            prompt_name: "Governance Framework",
            file: "governance_framework.json",
            artifact: "Governance Framework",
            depends_on: ["P1.4", "P1.2"],
            sign_off_gate: false,
          },
        ],
      },
      {
        phase_id: "P2",
        phase_name: "Planning",
        prompts: [
          {
            prompt_id: "P2.1",
            prompt_name: "WBS & Schedule",
            file: "wbs_schedule.json",
            artifact: "WBS & Project Schedule",
            depends_on: ["P1.3"],
            sign_off_gate: false,
          },
          {
            prompt_id: "P2.2",
            prompt_name: "Resource Plan & RACI",
            file: "resource_plan.json",
            artifact: "Resource & RACI Workbook",
            depends_on: ["P2.1", "P1.2"],
            sign_off_gate: false,
          },
          {
            prompt_id: "P2.3",
            prompt_name: "Budget & Cost Baseline",
            file: "budget_baseline.json",
            artifact: "Budget Baseline & Cost Tracker",
            depends_on: ["P2.2", "P1.4"],
            sign_off_gate: false,
          },
          {
            prompt_id: "P2.4",
            prompt_name: "Risk Register",
            file: "risk_register.json",
            artifact: "Risk Register",
            depends_on: ["P1.1", "P2.1"],
            sign_off_gate: false,
          },
          {
            prompt_id: "P2.5",
            prompt_name: "Communications Plan",
            file: "communications_plan.json",
            artifact: "Communications Workbook",
            depends_on: ["P1.2", "P1.5"],
            sign_off_gate: false,
          },
          {
            prompt_id: "P2.6",
            prompt_name: "Quality Plan",
            file: "quality_plan.json",
            artifact: "Quality Plan & Deliverable Review Schedule",
            depends_on: ["P2.1", "P2.2"],
            sign_off_gate: false,
          },
          {
            prompt_id: "P2.8",
            prompt_name: "PMO Playbook",
            file: "pmo_playbook.json",
            artifact: "PMO Playbook",
            depends_on: ["P2.1", "P2.2", "P2.3", "P2.4", "P2.5", "P2.6"],
            sign_off_gate: true,
          },
        ],
      },
    ],
  },
  objectives: {
    engagement_objectives: {
      field_type: "multi-select",
      objective_types: [
        {
          objective_type: "Business Problem",
          description: "What is broken or underperforming today",
          themes: [
            {
              theme: "Financial Performance",
              specific_objectives: [
                "N/A",
                "High operating costs",
                "Declining margins",
                "Inefficient capital allocation",
                "Poor financial reporting accuracy",
                "Lack of financial visibility and transparency",
                "Ineffective budgeting and forecasting",
                "High cost of finance function",
                "Revenue leakage",
                "Inefficient tax management",
                "Poor working capital management",
              ],
            },
            {
              theme: "Operational Performance",
              specific_objectives: [
                "N/A",
                "Inefficient or broken business processes",
                "High error rates and rework",
                "Poor productivity",
                "Lack of process standardisation",
                "Siloed operations across business units",
                "Ineffective supplier and vendor management",
                "Poor asset utilisation",
                "High cost of operations",
                "Lack of operational visibility",
                "Ineffective demand and capacity planning",
              ],
            },
            {
              theme: "Customer & Market",
              specific_objectives: [
                "N/A",
                "Poor customer experience",
                "High customer churn",
                "Declining market share",
                "Inability to acquire new customers",
                "Lack of customer insight and analytics",
                "Inconsistent customer service across channels",
                "Slow response to changing customer needs",
                "Ineffective pricing strategy",
                "Poor brand perception",
                "Weak digital customer engagement",
              ],
            },
            {
              theme: "Data & Information",
              specific_objectives: [
                "N/A",
                "Poor data quality",
                "Fragmented and siloed data",
                "Lack of trusted single source of truth",
                "Inability to access and use data effectively",
                "Inadequate data governance",
                "Lack of real-time reporting and insight",
                "Ineffective use of analytics",
                "Data duplication and inconsistency",
                "Lack of data literacy across the organisation",
                "Inability to leverage AI and advanced analytics",
              ],
            },
            {
              theme: "Technology & Systems",
              specific_objectives: [
                "N/A",
                "Ageing and legacy technology landscape",
                "Fragmented and poorly integrated systems",
                "High cost of IT operations and maintenance",
                "Inability to scale technology infrastructure",
                "Poor system performance and reliability",
                "Lack of digital capabilities",
                "Shadow IT and ungoverned technology use",
                "Poor cybersecurity posture",
                "Technology debt inhibiting innovation",
                "Lack of cloud adoption",
              ],
            },
            {
              theme: "People & Organisation",
              specific_objectives: [
                "N/A",
                "High employee turnover and attrition",
                "Low employee engagement and morale",
                "Skills gaps and capability shortfalls",
                "Ineffective organisational structure",
                "Poor leadership and management effectiveness",
                "Resistance to change",
                "Lack of innovation culture",
                "Ineffective performance management",
                "Poor workforce planning",
                "Unclear roles and responsibilities",
              ],
            },
            {
              theme: "Risk & Control",
              specific_objectives: [
                "N/A",
                "Weak internal control environment",
                "High exposure to operational risk",
                "Inadequate risk management frameworks",
                "Poor visibility of enterprise risk",
                "Ineffective audit and assurance processes",
                "Lack of business continuity and resilience planning",
                "Supply chain vulnerability",
                "Third party and vendor risk exposure",
                "Fraud and financial crime exposure",
                "Cybersecurity vulnerabilities",
              ],
            },
          ],
        },
        {
          objective_type: "Strategic Objective",
          description: "Where the client wants to get to",
          themes: [
            {
              theme: "Growth & Market Position",
              specific_objectives: [
                "N/A",
                "Enter new markets or geographies",
                "Launch new products or services",
                "Grow market share",
                "Develop new customer segments",
                "Build strategic partnerships and alliances",
                "Monetise data and digital assets",
                "Develop platform or ecosystem business model",
                "Improve pricing and revenue management",
                "Accelerate organic growth",
                "Drive inorganic growth through M&A",
              ],
            },
            {
              theme: "Business Transformation",
              specific_objectives: [
                "N/A",
                "Define and implement a new business strategy",
                "Transform the operating model",
                "Drive enterprise-wide digital transformation",
                "Consolidate and simplify the business",
                "Outsource or shared services non-core functions",
                "Restructure the organisation",
                "Build a data and AI-driven business",
                "Transform the customer experience",
                "Achieve operational excellence",
                "Build a sustainable and responsible business",
              ],
            },
            {
              theme: "Financial Strategy",
              specific_objectives: [
                "N/A",
                "Improve return on invested capital",
                "Optimise cost structure",
                "Improve cash flow and working capital",
                "Optimise tax position",
                "Prepare for IPO or capital markets transaction",
                "Drive shareholder value",
                "Achieve financial targets and KPIs",
                "Improve financial planning and analysis capability",
                "Optimise capital allocation",
                "Deliver cost reduction programme",
              ],
            },
            {
              theme: "Innovation & Differentiation",
              specific_objectives: [
                "N/A",
                "Build innovation capability and culture",
                "Develop and launch digital products and services",
                "Leverage AI and emerging technologies",
                "Create competitive differentiation through technology",
                "Build an agile and adaptive organisation",
                "Develop new business models",
                "Accelerate speed to market",
                "Build ecosystem and platform capabilities",
                "Harness IoT and connected technologies",
                "Drive sustainability through innovation",
              ],
            },
            {
              theme: "Sustainability & ESG",
              specific_objectives: [
                "N/A",
                "Define and implement ESG strategy",
                "Achieve net zero or carbon reduction targets",
                "Improve ESG reporting and disclosure",
                "Build sustainable supply chain",
                "Improve social impact and community engagement",
                "Strengthen corporate governance",
                "Meet investor ESG expectations",
                "Embed sustainability into products and services",
                "Reduce environmental footprint",
                "Build workforce diversity and inclusion",
              ],
            },
          ],
        },
        {
          objective_type: "Regulatory & Compliance Driver",
          description: "What the client is being required to do",
          themes: [
            {
              theme: "Financial Regulation",
              specific_objectives: [
                "N/A",
                "Comply with new or changing financial regulation",
                "Meet capital adequacy and liquidity requirements",
                "Strengthen financial crime compliance",
                "Improve AML and KYC processes",
                "Meet sanctions compliance requirements",
                "Comply with reporting and disclosure requirements",
                "Address regulatory findings or remediation",
                "Prepare for regulatory examination or audit",
                "Implement new accounting standards",
                "Manage tax compliance obligations",
              ],
            },
            {
              theme: "Data & Privacy Regulation",
              specific_objectives: [
                "N/A",
                "Comply with GDPR or equivalent data privacy regulation",
                "Implement data residency and sovereignty requirements",
                "Strengthen data protection controls",
                "Meet consent management requirements",
                "Address data breach or privacy incident",
                "Comply with sector-specific data regulations",
                "Implement privacy by design",
                "Meet cross-border data transfer requirements",
                "Strengthen data subject rights management",
                "Comply with AI regulation and ethics requirements",
              ],
            },
            {
              theme: "Operational & Industry Regulation",
              specific_objectives: [
                "N/A",
                "Comply with industry-specific operational regulation",
                "Meet health and safety regulatory requirements",
                "Comply with environmental regulation",
                "Meet product safety and quality standards",
                "Comply with trade and export control requirements",
                "Meet licensing and authorisation requirements",
                "Address operational resilience regulatory requirements",
                "Comply with third party and outsourcing regulation",
                "Meet consumer protection requirements",
                "Comply with competition and antitrust regulation",
              ],
            },
            {
              theme: "Cyber & Technology Regulation",
              specific_objectives: [
                "N/A",
                "Comply with cybersecurity regulation",
                "Meet critical national infrastructure protection requirements",
                "Comply with NIS2 or equivalent directive",
                "Meet DORA requirements",
                "Comply with cloud and technology regulation",
                "Address technology risk regulatory requirements",
                "Meet secure software development requirements",
                "Comply with AI governance regulation",
                "Meet digital operational resilience requirements",
                "Comply with telecommunications regulation",
              ],
            },
          ],
        },
        {
          objective_type: "Technology Driver",
          description:
            "What technology challenges or opportunities are driving the engagement",
          themes: [
            {
              theme: "Technology Modernisation",
              specific_objectives: [
                "N/A",
                "Replace or upgrade legacy ERP system",
                "Migrate to cloud infrastructure",
                "Modernise data platform and architecture",
                "Consolidate fragmented application landscape",
                "Decommission legacy systems",
                "Upgrade or replace CRM platform",
                "Modernise integration architecture",
                "Implement new HR technology platform",
                "Replace on-premise solutions with SaaS",
                "Modernise customer-facing digital platforms",
              ],
            },
            {
              theme: "Digital Enablement",
              specific_objectives: [
                "N/A",
                "Build digital products and channels",
                "Implement AI and machine learning capabilities",
                "Enable data-driven decision making",
                "Implement robotic process automation",
                "Build mobile and omnichannel capabilities",
                "Implement IoT and connected device capabilities",
                "Enable real-time analytics and reporting",
                "Build API and ecosystem integration capabilities",
                "Implement intelligent automation",
                "Enable personalisation at scale",
              ],
            },
            {
              theme: "Technology Risk & Security",
              specific_objectives: [
                "N/A",
                "Strengthen cybersecurity posture",
                "Implement zero trust security architecture",
                "Improve identity and access management",
                "Address technology vulnerabilities",
                "Improve disaster recovery and business continuity",
                "Strengthen cloud security",
                "Implement security operations centre",
                "Address third party technology risk",
                "Improve technology resilience",
                "Implement data loss prevention controls",
              ],
            },
            {
              theme: "Technology Efficiency",
              specific_objectives: [
                "N/A",
                "Reduce IT costs and total cost of ownership",
                "Optimise cloud spend",
                "Improve IT service delivery and performance",
                "Rationalise software licensing",
                "Improve DevOps and delivery capability",
                "Optimise IT vendor and contract management",
                "Improve IT governance and control",
                "Reduce technology complexity",
                "Improve IT service management processes",
                "Build internal technology capability",
              ],
            },
          ],
        },
        {
          objective_type: "People & Organisational Driver",
          description:
            "What workforce or structural challenges are driving the engagement",
          themes: [
            {
              theme: "Organisational Change",
              specific_objectives: [
                "N/A",
                "Implement a new organisational structure",
                "Manage a major business transformation programme",
                "Integrate organisations following a merger or acquisition",
                "Separate or carve out a business unit",
                "Transition to a new operating model",
                "Consolidate shared services or outsourcing",
                "Manage workforce restructuring or redundancy",
                "Drive culture change programme",
                "Improve change management capability",
                "Build organisational agility and adaptability",
              ],
            },
            {
              theme: "Workforce Capability",
              specific_objectives: [
                "N/A",
                "Address critical skills gaps",
                "Build digital and technology skills",
                "Develop leadership capability",
                "Upskill workforce for new ways of working",
                "Build data and analytics literacy",
                "Develop agile and product management capability",
                "Build customer experience capability",
                "Improve workforce planning and talent pipeline",
                "Develop change management capability",
                "Build innovation and entrepreneurial capability",
              ],
            },
            {
              theme: "Employee Experience & Engagement",
              specific_objectives: [
                "N/A",
                "Improve employee engagement and satisfaction",
                "Reduce employee turnover and attrition",
                "Improve diversity, equity and inclusion",
                "Enhance employee well-being and mental health",
                "Build a high performance culture",
                "Improve internal communication and collaboration",
                "Enhance recognition and reward programmes",
                "Build a culture of continuous learning",
                "Improve new employee onboarding experience",
                "Strengthen employee value proposition",
              ],
            },
            {
              theme: "Future of Work",
              specific_objectives: [
                "N/A",
                "Implement hybrid and flexible working models",
                "Redesign work for human and machine collaboration",
                "Build workforce resilience and adaptability",
                "Implement AI-augmented workforce models",
                "Redesign jobs and roles for the digital age",
                "Build gig and contingent workforce strategies",
                "Implement new workforce productivity tools",
                "Develop workforce sustainability strategy",
                "Build multigenerational workforce strategies",
                "Implement new performance management approaches",
              ],
            },
          ],
        },
      ],
    },
  },
  services: {
    domains: [
      {
        domain: "Strategy",
        building_blocks: [
          {
            building_block: "Value Case Development",
            description:
              "Supports clients in identifying, evaluating, and presenting the potential benefits of an investment or project against associated costs and risks. This involves understanding client business objectives, market dynamics, and competitive landscape, while conducting rigorous financial analysis and ensuring strategic alignment. Key activities include stakeholder management, return on investment modelling, regulatory compliance assessment, and identification of operational efficiency opportunities through managed services. Outputs include robust, data-driven business cases that clearly articulate the value proposition and pathway to success. The goal is to ensure strategic decisions are grounded in sound financial and business rationale, facilitating effective resource allocation and driving sustainable business growth.",
          },
          {
            building_block: "Performance Management, KPIs, Metrics",
            description:
              "Supports clients in developing and refining key performance indicators (KPIs) and metrics that align with their specific business goals. This involves assessing current performance measurement approaches, identifying gaps, and designing bespoke frameworks tailored to the client's operational context across multiple business functions. Key activities include KPI design, performance framework development, data analysis, and benchmarking against industry standards. Outputs include customised performance measurement frameworks, dashboards, and data-driven insights that enable informed decision-making. The goal is to help clients measure what matters, drive continuous improvement, and achieve sustainable and measurable business growth.",
          },
          {
            building_block: "Strategy & Op Model",
            description:
              "Assists clients in designing and implementing strategies that align with their business goals, and developing operating models that effectively execute those strategies. This involves conducting a comprehensive analysis of the client's industry, market dynamics, internal capabilities, and tax position to outline strategic priorities and identify growth opportunities. Key activities include operating model design, organisational structure optimisation, business process alignment, IT operating model development, and tax strategy integration. Outputs include a clearly defined strategic roadmap, target operating model, and an aligned IT and tax framework that supports the chosen strategic direction. The goal is to create a synergistic relationship between strategy and operations that facilitates sustained business growth, competitive advantage, and efficient tax management.",
          },
          {
            building_block: "Tax Strategy & Integration",
            description:
              "Assists clients in developing and implementing effective tax strategies that align with their broader business goals and operating model. This involves understanding the client's specific tax needs, analysing their current tax position, and identifying planning opportunities across domestic and cross-border operations. Key activities include tax structuring, mergers and acquisitions tax advisory, management of cross-border transactions, identification of tax incentives, and integration of tax strategy into the overall business framework. Outputs include customised tax strategies, risk management frameworks, and compliance roadmaps that optimise tax efficiency and minimise liabilities. The goal is to enhance the client's tax position, reduce financial and regulatory risk, and contribute to long-term financial sustainability.",
          },
          {
            building_block: "Deal Design & Integration",
            description:
              "Supports clients in structuring, designing, and executing mergers, acquisitions, divestitures, and other strategic transactions to maximise deal value. This involves assessing strategic fit, conducting due diligence, and designing integration or separation plans that align with the client's business objectives. Key activities include deal structuring, synergy identification, integration planning, regulatory and tax consideration, and post-deal value realisation tracking. Outputs include deal design frameworks, integration roadmaps, and governance structures that enable a smooth and effective transaction process. The goal is to help clients navigate the complexity of deals and integrations, minimise risk, and realise the full strategic and financial value of the transaction.",
          },
        ],
      },
      {
        domain: "Business, People & Organization",
        building_blocks: [
          {
            building_block: "Value and Benefit Realization",
            description:
              "Supports clients in identifying, tracking, and maximising the value and benefits derived from their investments, programmes, and operational activities. This involves aligning business objectives with operational capabilities, establishing benefit ownership, and conducting structured benefits tracking throughout the lifecycle of an initiative. Key activities include benefits mapping, KPI definition, realisation reporting, risk and compliance assessment, and identification of operational efficiency opportunities through managed services. Outputs include benefits realisation frameworks, tracking dashboards, and periodic realisation reports that provide transparency and accountability. The goal is to ensure clients achieve and sustain the full value of their investments while maintaining regulatory compliance and operational efficiency.",
          },
          {
            building_block: "Business Process with Industry Insights",
            description:
              "Supports clients in improving their business performance by applying industry-specific insights and process optimisation strategies tailored to their sector. This involves assessing current business processes, understanding the unique challenges and opportunities within the client's industry, and recommending improvements based on leading practices and sector benchmarks. Key activities include process mapping, gap analysis, process redesign, risk management, cybersecurity integration, and regulatory compliance strategy development. Outputs include process improvement roadmaps, redesigned workflows, and industry-specific guidance documents that enhance operational efficiency and customer value. The goal is to help clients optimise their operations, drive innovation, and achieve stronger business performance within the context of their industry.",
          },
          {
            building_block: "Capability Design & Development",
            description:
              "Supports clients in assessing, designing, and developing the organisational and technology capabilities required to achieve their strategic objectives. This involves conducting current state capability assessments, identifying gaps, and creating high-level target capability designs that span both business and technology domains. Key activities include capability mapping, gap analysis, capability acquisition strategy, and alignment with the Business Process and Organisational Design building blocks for detailed execution. Outputs include capability frameworks, target state designs, and capability development roadmaps that provide a clear path to building competitive advantage. The goal is to help clients align their organisational capabilities with strategic priorities, foster innovation, and enable agility in a rapidly evolving business environment.",
          },
          {
            building_block: "Business Readiness",
            description:
              "Supports organisations in assessing and building their readiness to adopt new strategies, processes, technologies, or regulatory changes prior to implementation. This involves evaluating the organisation's current state, identifying gaps and barriers to change, and developing targeted plans to ensure successful transition and adoption. Key activities include impact assessments, stakeholder analysis, change readiness assessments, communication planning, and coordination with the Change Management, Enablement and Adoption building block. Outputs include readiness assessment reports, gap analyses, and readiness improvement plans that provide a structured pathway to successful change. The goal is to help organisations proactively manage change, minimise resistance, and maximise the likelihood of achieving desired business outcomes.",
          },
          {
            building_block: "Enterprise Resilience",
            description:
              "Supports clients in planning for and building a resilient operational and technological environment capable of withstanding large-scale disruptive events. This involves assessing the client's current resilience posture across multiple domains and designing programmes that address vulnerabilities and strengthen organisational durability. Key activities include operational resilience planning, business continuity management, disaster recovery design, cyber resilience assessment, physical security planning, emergency planning, and supply chain resilience analysis. Outputs include enterprise resilience frameworks, business continuity plans, disaster recovery playbooks, and compliance monitoring programmes. The goal is to help clients anticipate, prepare for, respond to, and recover from events that threaten their ability to deliver critical business services.",
          },
          {
            building_block: "Organizational Design",
            description:
              "Supports clients in optimising their organisational structures to enhance efficiency, promote collaboration, and align with strategic objectives. This involves assessing the current organisational structure, evaluating the alignment of roles and responsibilities, and designing target state structures that support the delivery of the agreed operating model. Key activities include organisational assessment, design of reporting lines and governance structures, decision-making process redesign, outsourcing consideration, and tax-efficient organisational design. Outputs include organisational charts, governance frameworks, RACI matrices, and design recommendations that provide clarity and accountability across the organisation. The goal is to help clients create agile, adaptable organisations that drive innovation, increase productivity, and enable sustainable growth in a rapidly changing business environment.",
          },
          {
            building_block: "Employee Experience",
            description:
              "Supports clients in enhancing the employee experience and fostering a culture of innovation, engagement, and continuous development within their organisations. This involves assessing the current employee experience, identifying areas for improvement, and designing programmes that create a positive, inclusive, and productive work environment. Key activities include employee engagement strategy design, well-being programme development, talent development planning, performance management framework design, and implementation of technology-enabled learning and collaboration tools. Outputs include employee experience strategies, engagement programme designs, talent development frameworks, and innovation initiative roadmaps. The goal is to help clients build an environment where employees feel valued, motivated, and empowered, resulting in increased productivity, improved talent retention, and sustained business success.",
          },
          {
            building_block: "Change Management, Enablement and Adoption",
            description:
              "Supports clients in effectively managing organisational change and ensuring that individuals and teams are informed, engaged, and equipped to embrace new ways of working. This involves understanding the drivers and scope of change, identifying potential challenges, and developing comprehensive change management and communications plans. Key activities include change impact assessment, stakeholder engagement strategy, communication planning, resistance management, training programme design, and adoption tracking. Outputs include change management strategies, communication plans, training materials, and adoption metrics dashboards that provide a structured and measurable approach to change. The goal is to help clients navigate the complexities of change, minimise disruption, and achieve successful implementation with high levels of employee adoption and sustained behaviour change.",
          },
          {
            building_block: "Workforce Planning",
            description:
              "Supports clients in strategically planning, developing, and upskilling their workforce to meet current and future business needs. This involves assessing the current workforce capabilities, identifying skill gaps, and designing strategies to align talent with the organisation's goals and evolving operating model. Key activities include workforce demand and supply analysis, talent acquisition strategy, succession planning, training curriculum development, and performance management framework design. Outputs include workforce plans, skills gap analyses, talent development roadmaps, and upskilling programme designs that provide a structured approach to building organisational capability. The goal is to help clients build a resilient and adaptable workforce that drives employee engagement, retention, and productivity while fostering a culture of continuous learning and growth.",
          },
          {
            building_block: "GBS - Outsourcing",
            description:
              "Supports clients in selecting and transitioning to external service providers for functions identified as suitable for outsourcing following a strategic operating model decision. This involves assessing which services are most appropriate to procure externally, defining service requirements, and managing the provider selection and contracting process. Key activities include outsourcing candidate assessment, market analysis, provider selection, contract design, service level agreement definition, governance framework establishment, and transition management. Outputs include outsourcing strategies, provider shortlists, contracts, SLA frameworks, and transition plans that ensure a smooth and accountable handover of responsibilities. The goal is to help clients achieve cost efficiency, access specialist expertise, and focus internal resources on core strategic activities.",
          },
          {
            building_block: "GBS - Shared Services",
            description:
              "Supports clients in establishing and implementing shared services operating models to consolidate and centralise support functions within a captive organisational structure. This involves assessing which functions are suitable for centralisation, defining the scope and operating model of the shared service centre, and managing the transition of responsibilities. Key activities include shared services scoping, process standardisation, location strategy, technology enablement, governance design, change management, and transition planning. Outputs include shared services business cases, operating model designs, process migration plans, and governance frameworks that provide a structured foundation for the shared service centre. The goal is to help clients reduce operational costs, improve service quality and consistency, and free up business units to focus on value-adding activities.",
          },
          {
            building_block: "IT Service Management",
            description:
              "Supports clients in designing and optimising their IT service delivery models to align with business objectives, improve operational efficiency, and enhance end-user satisfaction. This involves evaluating the current IT service delivery model, identifying areas for improvement including cybersecurity, and designing a target model that leverages leading frameworks and emerging technologies. Key activities include IT service management framework design, ITIL-aligned process improvement, service catalogue design, service level agreement development, IT governance design, and vendor management optimisation. Outputs include IT service delivery models, governance frameworks, service catalogues, and SLA structures that provide a clear and scalable foundation for IT operations. The goal is to help clients establish a robust and scalable IT service delivery capability that optimises resource allocation, improves service quality, and enables digital transformation.",
          },
        ],
      },
      {
        domain: "Data & AI",
        building_blocks: [
          {
            building_block: "Data Privacy & Protection",
            description:
              "Supports clients in unlocking the value of their data assets in a secure, ethical, and compliant manner across global operations. This involves assessing the client's current data privacy posture, identifying risks associated with the handling of sensitive information, and designing frameworks that ensure compliance with applicable privacy regulations. Key activities include privacy impact assessments, data classification, consent management design, regulatory compliance analysis (including GDPR and other regional frameworks), and implementation of data protection controls. Outputs include data privacy frameworks, protection policies, compliance roadmaps, and risk registers that provide a structured and auditable approach to data governance. The goal is to help clients protect sensitive information, build trust with customers and regulators, and enable responsible and compliant use of data across the organisation.",
          },
          {
            building_block: "Data & Analytics Strategy and Governance",
            description:
              "Supports clients in developing comprehensive data and analytics strategies and implementing effective governance practices that enable data-driven decision-making across the organisation. This involves understanding the client's business objectives, evaluating their data assets and current governance maturity, and designing strategies to harness the full value of data and analytics. Key activities include data governance framework design, data quality management, data integration planning, analytics capability assessment, and compliance with data regulations. Outputs include data and analytics strategies, governance frameworks, data architecture blueprints, and analytics roadmaps that provide a clear and actionable path to data maturity. The goal is to help clients establish a robust and agile data and analytics ecosystem that fosters innovation, improves decision-making, and drives sustainable competitive advantage.",
          },
          {
            building_block: "Master Data Management",
            description:
              "Supports clients in establishing a centralised and consistent approach to managing their critical business data across multiple systems and platforms. This involves understanding the client's master data requirements, evaluating their existing data landscape, and designing strategies and processes to ensure accurate, reliable, and up-to-date master data. Key activities include data governance design, data stewardship role definition, data quality assessment, data synchronisation, data consolidation, and cross-platform master data alignment. Outputs include master data management frameworks, data stewardship models, data quality scorecards, and synchronisation architectures that provide a single, trusted view of critical business data. The goal is to help clients improve decision-making, reduce data redundancy and duplication, streamline processes, and enhance overall data quality and operational integrity.",
          },
          {
            building_block: "Business Intelligence & Analytics Consumption",
            description:
              "Supports clients in effectively consuming and utilising business intelligence and analytics solutions through the strategic implementation of data technologies and platforms. This involves understanding the client's business objectives, evaluating their existing data and analytics infrastructure, and designing strategies to enhance the accessibility and utilisation of insights. Key activities include analytics tool selection, data integration design, visualisation solution development, data architecture design, governance and compliance assessment, and privacy and security review. Outputs include analytics platforms, data integration solutions, visualisation dashboards, and compliance reporting structures that provide intuitive and reliable access to business insights. The goal is to help clients leverage data effectively to enable seamless access to information, enhance decision-making quality, and improve overall business performance.",
          },
          {
            building_block: "AI/ML Solutions",
            description:
              "Supports clients in leveraging artificial intelligence and machine learning technologies to develop innovative solutions that address business challenges and drive measurable outcomes. This involves understanding the client's specific needs, evaluating their data landscape, and designing and implementing AI/ML solutions that are fit for purpose and aligned with strategic goals. Key activities include opportunity identification, data availability and quality assessment, algorithm and model selection, data preprocessing, model development, training, validation, deployment, and integration into existing systems. Outputs include deployed AI/ML models, performance evaluation reports, integration architectures, and AI strategy roadmaps that provide a clear path to intelligent automation and insight generation. The goal is to help clients unlock the value of their data through AI and ML, enabling process automation, data-driven decision-making, enhanced cyber and operational risk management, and sustained competitive advantage.",
          },
          {
            building_block: "Data Engineering & Data Modernization",
            description:
              "Supports clients in building modern, scalable data platforms that underpin effective data management and advanced analytics across the enterprise. This involves designing and constructing cloud-based data infrastructure, developing robust data pipelines, and implementing automated data operations that support the full lifecycle of data from collection through to analysis. Key activities include cloud platform design, data pipeline development, scalable storage architecture, data operations automation, and integration with analytics and AI capabilities. Outputs include modern data platforms, data pipeline architectures, cloud infrastructure designs, and operational runbooks that provide a reliable and scalable foundation for enterprise data management. The goal is to help clients modernise their data environment, foster better decision-making, and enable seamless integration with advanced analytics and AI capabilities.",
          },
          {
            building_block: "Data Quality & Conversion",
            description:
              "Supports clients in elevating data quality and managing data conversion activities to ensure high data integrity across systems and throughout transformation programmes. This involves comprehensive data profiling, cleansing, and enrichment activities aligned to industry-leading data quality frameworks, as well as managing the transition of data from legacy systems to new platforms. Key activities include data profiling, cleansing, enrichment, audit trail implementation, regulatory compliance assessment, legacy data migration, and ongoing data quality monitoring. Outputs include data quality assessments, cleansed and enriched datasets, conversion plans, audit reports, and data quality scorecards that provide transparency and accountability throughout the data lifecycle. The goal is to ensure that data is accurate, consistent, and fit for purpose at go-live and beyond, supporting both immediate system transitions and long-term data quality standards across the organisation.",
          },
          {
            building_block: "Data Design",
            description:
              "Supports clients in developing a strategic and structured approach to managing and leveraging their data assets in alignment with business objectives. This involves assessing current data management practices, understanding business requirements, and designing data architectures, models, and governance frameworks that enable effective use of data across the organisation. Key activities include data requirements definition, data model design, governance framework implementation, data quality optimisation, cybersecurity and risk management integration, and regulatory compliance design. Outputs include data architecture blueprints, data models, governance frameworks, and compliance design documents that provide a clear and actionable foundation for enterprise data management. The goal is to ensure data is effectively structured, governed, and utilised to run business operations, deliver insights, support decision-making, and drive business performance.",
          },
          {
            building_block: "Information Governance",
            description:
              "Supports clients in governing their data assets throughout the full data lifecycle, from generation and protection through to disposal, in compliance with applicable regulations and business requirements. This involves understanding the client's data landscape, identifying the most valuable and sensitive data assets, and designing governance frameworks that ensure data is protected, managed, and retired appropriately. Key activities include data lifecycle mapping, regulatory compliance assessment, data classification, risk identification, digital platform enablement, and analytics-driven data discovery. Outputs include information governance frameworks, data lifecycle policies, compliance registers, and risk remediation plans that provide a structured and auditable approach to data stewardship. The goal is to help clients protect their most valuable data, optimise the management of unsecured or unreliable data, and maintain ongoing compliance with relevant data regulations.",
          },
        ],
      },
      {
        domain: "Solution",
        building_blocks: [
          {
            building_block: "Business Process & Technology Controls",
            description:
              "Supports clients in creating and implementing a robust business and technology control environment that prevents, mitigates, and manages regulatory and operational risks. This involves assessing the current control landscape, identifying control gaps and weaknesses, and designing an integrated control framework that spans both business processes and technology systems. Key activities include control environment assessment, risk identification, control design and implementation, technology control testing, and regulatory compliance alignment. Outputs include control frameworks, risk and control matrices, testing results, and remediation plans that provide a comprehensive and auditable approach to risk and control management. The goal is to help clients establish a resilient control environment that reduces exposure to operational and regulatory risk while supporting business performance and compliance objectives.",
          },
          {
            building_block:
              "Financial Crimes & Investigations (Internal & External)",
            description:
              "Supports clients in preventing, detecting, and investigating financial crimes including fraud, money laundering, and sanctions breaches, while ensuring compliance with applicable regulatory requirements. This involves assessing the client's current financial crime risk posture, designing compliance frameworks, and conducting investigations in support of regulatory, legal, and commercial matters. Key activities include Anti-Money Laundering (AML) programme design, Know Your Customer (KYC) framework implementation, sanctions compliance assessment, financial crime risk assessment, internal and external investigations, and litigation and M&A due diligence support. Outputs include compliance frameworks, investigation reports, due diligence findings, and remediation recommendations that provide clients and their legal counsel with clear and actionable intelligence. The goal is to help clients reduce financial crime risk, meet regulatory obligations, and respond effectively to instances of suspected criminal activity.",
          },
          {
            building_block: "Regulatory Risk & Compliance",
            description:
              "Supports clients in navigating their regulatory compliance and risk management obligations by developing a holistic and structured approach to identifying, assessing, and mitigating regulatory requirements. This involves understanding the client's regulatory environment, assessing their current compliance posture, and designing frameworks that embed compliance into business-as-usual operations. Key activities include regulatory landscape analysis, compliance gap assessment, risk identification and prioritisation, compliance framework design, regulatory change management, and readiness programme development. Outputs include regulatory compliance frameworks, risk registers, gap assessment reports, and compliance roadmaps that provide clients with a clear and structured path to regulatory readiness. The goal is to help clients proactively manage regulatory risk, maintain compliance across all applicable jurisdictions, and build a culture of accountability and governance.",
          },
          {
            building_block: "Hardware Product Design",
            description:
              "Supports clients in designing and developing physical hardware products from initial concept through to high-yield manufacturing readiness. This involves guiding clients through the full product development lifecycle including market research, product definition, design for excellence (DFX), technology research, and manufacturing qualification. Key activities include industrial design, mechanical and electrical engineering, audio and software engineering, regulatory compliance, prototyping, testing and validation, engineering validation testing (EVT), design validation testing (DVT), and production validation testing (PVT). Outputs include product definitions, design files, validated prototypes, compliance documentation, and manufacturing-ready specifications that provide a complete and manufacturable product design. The goal is to help clients bring innovative, high-quality physical products to market efficiently, with robust manufacturing processes that support high-yield production at scale.",
          },
          {
            building_block: "Identity & Access Management (IAM)",
            description:
              "Supports clients in governing and maturing their Identity and Access Management programmes to ensure secure and appropriate access to company data, systems, and equipment. This involves assessing the client's current IAM posture, identifying gaps and vulnerabilities, and designing and implementing solutions across the key IAM domains. Key activities include Identity Governance and Administration (IGA) design, Access Management (AM) implementation, Privileged Access Management (PAM) controls, Customer Identity and Access Management (CIAM) design, and ongoing programme governance. Outputs include IAM frameworks, access policies, governance models, and implementation roadmaps that provide a structured and scalable approach to identity and access control. The goal is to help clients reduce security risk, enforce least-privilege access principles, improve regulatory compliance, and deliver a seamless and secure identity experience for both employees and customers.",
          },
          {
            building_block: "Software Evaluation & Selection",
            description:
              "Supports clients in navigating the process of identifying and selecting the right software solution to meet their specific business needs and strategic objectives. This involves assessing the client's current state capabilities, defining future state requirements, and conducting a structured evaluation of available vendor solutions. Key activities include current state assessment, requirements definition, vendor market analysis, evaluation criteria development, demonstration facilitation, scoring and shortlisting, and adoption readiness planning. Outputs include requirements documentation, vendor assessment scorecards, recommendation reports, and selection roadmaps that provide clients with a clear and evidence-based basis for their software investment decision. The goal is to help clients make informed, objective software selection decisions that enhance business performance and support successful long-term adoption.",
          },
          {
            building_block: "Vendor Solution Configuration & Development",
            description:
              "Supports clients in implementing and configuring major enterprise software solutions tailored to their specific business requirements and operational context. This involves understanding the client's business processes, selecting the appropriate solution configuration approach, and managing the end-to-end implementation lifecycle. Key activities include solution design, system configuration, data migration, customisation, integration, testing, training, go-live support, and incorporation of risk, regulatory, and tax considerations. Primary solutions supported include Oracle, SAP, Salesforce, Microsoft Dynamics, Workday, Contract Lifecycle Management, Maximo, ESRI, Guidewire, Smart Energy Water, and Coupa. Outputs include configured and tested solutions, data migration plans, integration designs, training materials, and go-live readiness assessments that provide a fully operational and tailored business solution. The goal is to guide clients through the entire implementation journey, ensuring the chosen solution is aligned to their business needs and delivers the desired operational and strategic outcomes.",
          },
          {
            building_block: "Integration",
            description:
              "Supports clients in designing, implementing, and executing integration platforms and API solutions that enable seamless connectivity and data flow across systems and applications. This involves understanding the client's integration needs, evaluating available platforms, and providing end-to-end support for successful integration delivery. Key activities include integration strategy and roadmap development, platform selection and configuration, data mapping and transformation, API development and management, integration testing, and cybersecurity and compliance integration. Primary platforms supported include MuleSoft and Boomi. Outputs include integration architectures, API catalogues, platform configurations, and testing results that provide a reliable and scalable integration foundation. The goal is to help clients achieve seamless interoperability between their systems, reduce data silos, and enable efficient and secure data exchange across the enterprise.",
          },
          {
            building_block: "Solution Architecture",
            description:
              "Supports clients in designing optimal solution architectures for their technology initiatives that are scalable, secure, and aligned with business objectives. This involves understanding the client's requirements and technology landscape, evaluating options, and providing expert guidance on architecture design across both enterprise and solution levels. Key activities include enterprise architecture strategy, business architecture design, application architecture, data architecture, cloud architecture, DevOps architecture, process architecture, cyber risk management integration, and regulatory compliance consideration. Outputs include architecture blueprints, solution design documents, architecture decision records, and compliance frameworks that provide a clear and actionable technical foundation for delivery. The goal is to help clients design technology solutions that are robust, future-proof, and well-aligned to their strategic direction, while managing risk and ensuring regulatory compliance.",
          },
          {
            building_block: "User Experience",
            description:
              "Supports clients in designing products and services that deliver seamless, intuitive, and engaging experiences for their users. This involves understanding the client's target audience, conducting user research, and applying human-centred design principles to inform the design of interfaces and interactions. Key activities include user research, usability testing, persona development, journey mapping, wireframing, prototyping, and iterative design validation. Outputs include user research findings, journey maps, wireframes, interactive prototypes, and UX design specifications that provide a clear and validated blueprint for interface development. The goal is to help clients create products and services that meet user needs, drive customer satisfaction and loyalty, and deliver measurable improvements in engagement and business performance.",
          },
          {
            building_block: "Cloud & Infrastructure Engineering",
            description:
              "Supports clients in designing, implementing, and optimising their infrastructure and cloud environments to provide a secure, scalable, and resilient foundation for their technology operations. This involves assessing the client's current infrastructure landscape, identifying areas for improvement, and designing target state environments that meet business and technical requirements. Key activities include network architecture design, server and storage infrastructure design, cloud platform selection and configuration, infrastructure security design, performance optimisation, and ongoing infrastructure management. Outputs include infrastructure designs, cloud architecture blueprints, implementation plans, and operational runbooks that provide a robust and well-documented foundation for technology operations. The goal is to help clients establish a modern, efficient, and secure infrastructure environment that supports business agility, reduces operational risk, and enables digital transformation.",
          },
          {
            building_block: "Cloud Migration & Optimization",
            description:
              "Supports clients in planning and executing successful migrations to cloud environments and optimising their existing cloud deployments to maximise value and efficiency. This involves assessing the client's current application and infrastructure estate, defining a cloud migration strategy, and managing the end-to-end migration process using leading cloud technologies and best practices. Key activities include cloud readiness assessment, migration strategy development, workload prioritisation, migration execution, post-migration optimisation, cost management, and security and compliance validation. Outputs include cloud migration strategies, workload migration plans, optimisation recommendations, and post-migration performance reports that provide a clear and structured path to cloud adoption. The goal is to help clients realise the full benefits of cloud computing including improved agility, reduced infrastructure costs, enhanced resilience, and accelerated innovation.",
          },
          {
            building_block: "Custom Application Development",
            description:
              "Supports clients in designing, building, and deploying robust and scalable software applications tailored to their specific business needs and objectives. This involves managing the full application development lifecycle from requirements gathering through to deployment and ongoing support. Key activities include requirements gathering and analysis, product management, UX design, solution architecture, coding and development, testing and quality assurance, deployment and release management, and R&D tax credit eligibility assessment. Outputs include fully developed and tested applications, technical documentation, deployment packages, and support frameworks that provide clients with reliable and fit-for-purpose software solutions. The goal is to help clients deliver high-quality custom software that solves specific business problems, drives operational efficiency, promotes innovation, and where applicable, leverages available R&D tax incentives.",
          },
          {
            building_block: "Performance Optimization & SRE",
            description:
              "Supports clients in improving the performance, stability, and scalability of their software applications and systems through the application of performance engineering and site reliability engineering (SRE) practices. This involves assessing current system performance, identifying bottlenecks and reliability risks, and implementing targeted optimisation and reliability improvements. Key activities include performance profiling and benchmarking, bottleneck identification, optimisation implementation, SRE framework design, incident management, reliability monitoring, and ongoing SRE operational support. Outputs include performance assessment reports, optimisation recommendations, SRE frameworks, monitoring dashboards, and incident response playbooks that provide a structured and measurable approach to system reliability. The goal is to help clients achieve high-performing, resilient, and scalable systems that meet user expectations, reduce downtime, and support the reliable delivery of business-critical services.",
          },
          {
            building_block: "Security Integration",
            description:
              "Supports clients in embedding security controls into their enterprise applications and identity solutions to protect assets, maintain data confidentiality, ensure integrity, and meet compliance requirements. This involves assessing the current security posture of application and identity environments, identifying vulnerabilities and compliance gaps, and designing and implementing integrated security solutions. Key activities include security architecture design, application security controls implementation, identity solution security integration, compliance framework alignment, vulnerability assessment, and security testing. Outputs include security architecture designs, integrated security controls, compliance evidence packages, and remediation plans that provide a structured and verifiable approach to application and identity security. The goal is to help clients build a security-by-design culture across their application landscape, reducing the risk of data breaches, ensuring regulatory compliance, and maintaining the trust of customers and stakeholders.",
          },
          {
            building_block: "Cyber Security",
            description:
              "Supports clients in protecting their digital assets, systems, and data from the full spectrum of cyber threats through a comprehensive and proactive approach to cybersecurity. This involves assessing the client's current cyber risk posture, identifying vulnerabilities and threat vectors, and designing and implementing security measures that ensure the confidentiality, integrity, and availability of information assets. Key activities include cyber risk assessment, threat intelligence analysis, security architecture design, penetration testing, incident response planning, malware and ransomware protection, phishing mitigation, and ongoing security monitoring and support. Outputs include cyber risk assessments, security architectures, incident response playbooks, vulnerability reports, and security monitoring frameworks that provide a robust and comprehensive defence against cyber threats. The goal is to help clients reduce their cyber risk exposure, respond effectively to incidents, and build a resilient and compliant security posture that protects the organisation and its stakeholders.",
          },
        ],
      },
      {
        domain: "Operations",
        building_blocks: [
          {
            building_block: "Internal Audit & Monitoring of Internal Controls",
            description:
              "Supports clients in obtaining an independent and objective assessment of their processes, systems, data, and financial statements to identify and mitigate applicable risks. This involves planning and executing audit activities across a range of risk domains including financial reporting, cybersecurity, and operational risk, and providing actionable recommendations for improvement. Key activities include audit planning, risk-based scoping, process and control testing, financial statement review, cybersecurity audit, operational risk assessment, and findings reporting. Outputs include internal audit reports, control testing results, risk registers, and management action plans that provide clients with a clear and evidence-based view of their control environment. The goal is to help clients strengthen their internal control frameworks, improve governance and accountability, and reduce exposure to financial, operational, and regulatory risk.",
          },
          {
            building_block:
              "Operational Engineering (incl. Quality Engineering)",
            description:
              "Supports clients in enhancing product quality and customer satisfaction through scalable, efficient, and expert-led operational and quality engineering capabilities. This involves assessing current quality practices, implementing advanced quality engineering techniques, and flexibly scaling quality engineering capacity to meet changing business demands. Key activities include quality framework design, quality assurance process implementation, quality control testing, performance benchmarking, defect management, and capacity planning for quality engineering resources. Outputs include quality engineering frameworks, test plans, quality assessment reports, defect logs, and performance benchmarks that provide clients with a structured and measurable approach to quality management. The goal is to help clients consistently deliver high-quality software and products, reduce defect rates, improve customer satisfaction, and optimise the efficiency of their quality engineering operations.",
          },
          {
            building_block: "Technology Managed Service",
            description:
              "Supports clients in maintaining the ongoing availability, performance, and functionality of their enterprise business applications through expert-led managed service operations. This involves providing routine maintenance, updates, troubleshooting, and system optimisation services for major platforms including Oracle, SAP, Workday, Salesforce, Guidewire, Atlassian, and ServiceNow. Key activities include application maintenance, incident management, system updates and patching, performance monitoring, user support, and continuous improvement of application operations. Outputs include service performance reports, incident logs, system health dashboards, and improvement recommendations that provide clients with full visibility of their application landscape. The goal is to help clients offload application support and maintenance responsibilities, ensuring reliable and responsive technology operations that free internal teams to focus on core business activities.",
          },
          {
            building_block: "Risk & Regulatory Managed Services",
            description:
              "Supports clients in managing risk and regulatory obligations through specialist managed services that combine operational expertise, strategic thinking, and advanced technology solutions. This involves designing and operating efficient workflows that address the risk and regulatory components of client operations, including process automation, data management, and customer support functions. Key activities include regulatory process management, risk monitoring, compliance reporting, workflow automation, data management, and operational performance tracking. Outputs include managed service performance reports, compliance dashboards, process automation solutions, and risk and regulatory status updates that provide clients with ongoing assurance and operational efficiency. The goal is to help clients reduce the cost and complexity of managing risk and regulatory obligations while maintaining high standards of compliance, accuracy, and operational performance.",
          },
          {
            building_block: "Business Outcome Managed Services (BOMS)",
            description:
              "Supports clients in managing their legal, finance, and accounting operations through outcome-focused managed services that drive efficiency, reduce costs, and enhance productivity. This involves combining operational expertise, strategic thinking, and advanced technology solutions to deliver efficient and reliable support for business-critical functions. Key activities include legal operations support, finance and accounting process management, workflow automation, data management, process optimisation, and customer support operations. Outputs include managed service performance reports, process efficiency metrics, automation solutions, and operational improvement recommendations that provide clients with a clear view of outcomes delivered. The goal is to help clients achieve better business outcomes from their legal, finance, and accounting functions by leveraging specialist expertise and technology-enabled operations at scale.",
          },
        ],
      },
      {
        domain: "Enablement",
        building_blocks: [
          {
            building_block: "DevSecOps",
            description:
              "Supports clients in adopting a unified and integrated approach to software development, security, and operations that accelerates delivery while maintaining consistent security and operational standards. This involves assessing the client's current development and operations practices, identifying security and efficiency gaps, and designing and implementing a DevSecOps framework that embeds security throughout the delivery pipeline. Key activities include DevOps toolchain selection and configuration, security protocol automation, pipeline design, vulnerability management, release velocity optimisation, and security integration at the earliest stages of development. Outputs include DevSecOps frameworks, automated pipeline configurations, security assessment reports, and toolchain architectures that provide a secure, efficient, and repeatable path from development to deployment. The goal is to help clients reduce security vulnerabilities, accelerate release cycles, and maintain the agility and innovation speed required to remain competitive.",
          },
          {
            building_block: "Program Management",
            description:
              "Supports clients in planning, executing, and governing strategic programmes and projects through expert programme management and agile coaching capabilities. This involves providing leadership and guidance across both traditional project management methodologies and agile practices to ensure initiatives are delivered within scope, on time, and within budget. Key activities include programme planning, project governance, scope and schedule management, budget tracking, agile team formation, scrum facilitation, agile coaching, impediment resolution, and continuous improvement facilitation. Outputs include programme plans, governance frameworks, status reports, agile delivery artefacts, and coaching assessments that provide clients with clear visibility and control over their strategic initiatives. The goal is to help clients deliver their programmes successfully, foster a culture of continuous improvement and adaptability, and build internal delivery capability that sustains long-term organisational performance.",
          },
          {
            building_block: "Deployment & Deployment Support",
            description:
              "Supports clients in ensuring a smooth, controlled, and reliable transition from development to production for business and cloud solutions. This involves providing expertise in both manual and automated deployment methodologies and delivering post-deployment support to ensure stability, performance, and user adoption following release. Key activities include deployment strategy design, release management, automated and manual deployment execution, infrastructure configuration, post-deployment troubleshooting, performance monitoring, and user training. Outputs include deployment plans, release packages, post-deployment monitoring dashboards, and support documentation that provide clients with a structured and well-governed approach to solution release. The goal is to help clients minimise deployment risk and disruption, maximise system stability and performance, and ensure that newly deployed solutions are fully adopted and delivering value as quickly as possible.",
          },
          {
            building_block: "Quality Management",
            description:
              "Supports clients and delivery teams in embedding a systematic and structured approach to quality across all phases of a project or programme to increase the likelihood of success and reduce quality-related risks. This involves designing and implementing quality management activities that are tailored to the specific context of the engagement and aligned with PwC's governance and delivery standards. Key activities include quality planning, quality assurance, quality control, quality review facilitation, Quality Partner or Quality Review Partner (QRP) engagement, and quality reporting at delivery, territory, and network levels. Outputs include quality management plans, assurance review reports, control testing results, and quality performance dashboards that provide a comprehensive and layered view of quality across the programme. The goal is to help clients and delivery teams consistently deliver high-quality outcomes for the Firm, clients, and people, while proactively managing quality risks that could otherwise prevent the realisation of planned programme benefits.",
          },
        ],
      },
    ],
  },
  technologies: {
    technology_and_tools: {
      field_type: "multi-select",
      categories: [
        {
          category: "ERP & Business Applications",
          sub_categories: [
            {
              sub_category: "Core ERP",
              options: [
                "SAP S/4HANA",
                "SAP ECC",
                "Oracle Fusion Cloud ERP",
                "Oracle EBS",
                "Microsoft Dynamics 365 Finance & Operations",
                "Infor CloudSuite",
                "Unit4 ERP",
                "Epicor ERP",
                "IFS Cloud",
                "Sage X3",
              ],
            },
            {
              sub_category: "ERP Platform & Extension",
              options: [
                "SAP BTP",
                "SAP Fiori",
                "Oracle Cloud Platform",
                "Microsoft Power Platform",
              ],
            },
            {
              sub_category: "Finance & Accounting",
              options: [
                "BlackLine",
                "HighRadius",
                "Trintech",
                "Kyriba",
                "OneStream",
                "Anaplan",
                "Adaptive Insights",
                "Board",
                "IBM TM1",
                "Longview",
                "Hyperion",
              ],
            },
            {
              sub_category: "Planning & Budgeting",
              options: [
                "Anaplan",
                "Adaptive Insights",
                "OneStream",
                "Oracle EPM Cloud",
                "SAP BPC",
                "Board",
                "Planful",
              ],
            },
          ],
        },
        {
          category: "CRM & Customer Engagement",
          sub_categories: [
            {
              sub_category: "CRM Platforms",
              options: [
                "Salesforce Sales Cloud",
                "Salesforce Service Cloud",
                "Microsoft Dynamics 365 CRM",
                "HubSpot CRM",
                "Pegasystems CRM",
                "Zendesk Sell",
                "SugarCRM",
              ],
            },
            {
              sub_category: "Marketing Automation",
              options: [
                "Salesforce Marketing Cloud",
                "Adobe Experience Cloud",
                "HubSpot Marketing",
                "Marketo",
                "Eloqua",
                "Pardot",
                "Braze",
              ],
            },
            {
              sub_category: "Customer Service & Contact Centre",
              options: [
                "Salesforce Service Cloud",
                "Zendesk",
                "ServiceNow CSM",
                "Genesys",
                "NICE CXone",
                "Pegasystems Customer Service",
                "Freshdesk",
              ],
            },
            {
              sub_category: "Customer Experience & Feedback",
              options: [
                "Qualtrics",
                "Medallia",
                "Hotjar",
                "UserTesting",
                "Sprinklr",
                "Confirmit",
              ],
            },
            {
              sub_category: "eCommerce",
              options: [
                "Salesforce Commerce Cloud",
                "SAP Commerce Cloud",
                "Adobe Commerce (Magento)",
                "Shopify Plus",
                "BigCommerce",
                "Commercetools",
              ],
            },
          ],
        },
        {
          category: "Data & Analytics",
          sub_categories: [
            {
              sub_category: "Data Warehousing & Lakehouse",
              options: [
                "Snowflake",
                "Databricks",
                "Microsoft Azure Synapse",
                "Google BigQuery",
                "AWS Redshift",
                "Teradata",
                "IBM Db2 Warehouse",
              ],
            },
            {
              sub_category: "Business Intelligence & Visualisation",
              options: [
                "Microsoft Power BI",
                "Tableau",
                "Qlik Sense",
                "Looker",
                "SAP Analytics Cloud",
                "MicroStrategy",
                "TIBCO Spotfire",
                "Sisense",
              ],
            },
            {
              sub_category: "Advanced & Predictive Analytics",
              options: ["SAS", "Alteryx", "KNIME", "RapidMiner", "MATLAB"],
            },
            {
              sub_category: "Data Governance & Cataloguing",
              options: [
                "Collibra",
                "Alation",
                "Informatica Axon",
                "IBM Watson Knowledge Catalog",
                "Microsoft Purview",
                "Atlan",
                "Alex Solutions",
              ],
            },
            {
              sub_category: "Master Data Management",
              options: [
                "Informatica MDM",
                "SAP MDG",
                "IBM InfoSphere MDM",
                "Stibo Systems STEP",
                "Reltio",
                "Semarchy",
                "Profisee",
                "Ataccama",
              ],
            },
            {
              sub_category: "Data Quality",
              options: [
                "Informatica Data Quality",
                "Talend Data Quality",
                "IBM InfoSphere QualityStage",
                "Ataccama ONE",
                "Experian Data Quality",
                "SAS Data Quality",
              ],
            },
            {
              sub_category: "Data Integration & ETL",
              options: [
                "Informatica PowerCenter",
                "Talend",
                "IBM DataStage",
                "Microsoft Azure Data Factory",
                "AWS Glue",
                "Google Cloud Dataflow",
                "Fivetran",
                "dbt",
              ],
            },
          ],
        },
        {
          category: "Artificial Intelligence & Machine Learning",
          sub_categories: [
            {
              sub_category: "AI & ML Platforms",
              options: [
                "Microsoft Azure AI",
                "Google Vertex AI",
                "AWS SageMaker",
                "IBM Watson Studio",
                "DataRobot",
                "H2O.ai",
                "Dataiku",
                "C3.ai",
                "Palantir AIP",
              ],
            },
            {
              sub_category: "Generative AI & Large Language Models",
              options: [
                "Microsoft Azure OpenAI",
                "OpenAI GPT",
                "Google Gemini",
                "AWS Bedrock",
                "Anthropic Claude",
                "Cohere",
                "Mistral AI",
              ],
            },
            {
              sub_category: "AI-Powered Automation",
              options: [
                "UiPath AI",
                "Automation Anywhere AI",
                "Microsoft Copilot",
                "Salesforce Einstein",
                "ServiceNow AI",
                "IBM Watson Orchestrate",
              ],
            },
            {
              sub_category: "Computer Vision & NLP",
              options: [
                "Google Cloud Vision",
                "AWS Rekognition",
                "Microsoft Azure Cognitive Services",
                "ABBYY",
                "Nuance",
                "OpenCV",
              ],
            },
          ],
        },
        {
          category: "Cloud Platforms",
          sub_categories: [
            {
              sub_category: "Hyperscale Cloud",
              options: [
                "Microsoft Azure",
                "Amazon Web Services (AWS)",
                "Google Cloud Platform (GCP)",
                "IBM Cloud",
                "Oracle Cloud Infrastructure",
                "Alibaba Cloud",
              ],
            },
            {
              sub_category: "Cloud Management & FinOps",
              options: [
                "CloudHealth by VMware",
                "Apptio Cloudability",
                "AWS Cost Explorer",
                "Azure Cost Management",
                "Spot.io",
                "Flexera",
              ],
            },
            {
              sub_category: "Containerisation & Orchestration",
              options: [
                "Kubernetes",
                "Docker",
                "Red Hat OpenShift",
                "Rancher",
                "VMware Tanzu",
              ],
            },
            {
              sub_category: "Serverless & PaaS",
              options: [
                "AWS Lambda",
                "Azure Functions",
                "Google Cloud Functions",
                "Heroku",
                "Salesforce Platform",
              ],
            },
          ],
        },
        {
          category: "Integration & Middleware",
          sub_categories: [
            {
              sub_category: "Integration Platforms",
              options: [
                "MuleSoft Anypoint",
                "Boomi AtomSphere",
                "Microsoft Azure Integration Services",
                "IBM App Connect",
                "Software AG webMethods",
                "TIBCO BusinessWorks",
                "Axway Amplify",
                "SnapLogic",
              ],
            },
            {
              sub_category: "API Management",
              options: [
                "MuleSoft API Manager",
                "Apigee",
                "AWS API Gateway",
                "Azure API Management",
                "Kong",
                "WSO2",
              ],
            },
            {
              sub_category: "Messaging & Event Streaming",
              options: [
                "Apache Kafka",
                "IBM MQ",
                "RabbitMQ",
                "AWS SQS",
                "Azure Service Bus",
                "Solace",
              ],
            },
            {
              sub_category: "Workflow & Process Automation",
              options: [
                "Workato",
                "Microsoft Power Automate",
                "Zapier Enterprise",
                "Nintex",
                "K2",
              ],
            },
          ],
        },
        {
          category: "Cybersecurity",
          sub_categories: [
            {
              sub_category: "Security Information & Event Management (SIEM)",
              options: [
                "Microsoft Sentinel",
                "Splunk Enterprise Security",
                "IBM QRadar",
                "LogRhythm",
                "Exabeam",
                "Elastic Security",
              ],
            },
            {
              sub_category: "Endpoint & Network Security",
              options: [
                "CrowdStrike Falcon",
                "Palo Alto Networks",
                "Fortinet",
                "Check Point",
                "Darktrace",
                "Carbon Black",
                "SentinelOne",
                "Symantec",
              ],
            },
            {
              sub_category: "Data Loss Prevention & Protection",
              options: [
                "Varonis",
                "Digital Guardian",
                "Microsoft Purview Information Protection",
                "Forcepoint DLP",
                "Symantec DLP",
              ],
            },
            {
              sub_category: "Vulnerability Management",
              options: [
                "Tenable",
                "Qualys",
                "Rapid7 InsightVM",
                "Veracode",
                "Checkmarx",
                "Snyk",
              ],
            },
            {
              sub_category: "Zero Trust & Network Access",
              options: [
                "Zscaler",
                "Akamai",
                "Cloudflare",
                "Cisco Duo",
                "Illumio",
                "Netskope",
              ],
            },
            {
              sub_category: "Security Orchestration & Response (SOAR)",
              options: [
                "Palo Alto XSOAR",
                "Splunk SOAR",
                "IBM Resilient",
                "ServiceNow Security Operations",
                "Swimlane",
              ],
            },
          ],
        },
        {
          category: "Identity & Access Management",
          sub_categories: [
            {
              sub_category: "Identity Governance & Administration",
              options: [
                "SailPoint IdentityNow",
                "Saviynt",
                "One Identity",
                "IBM Security Identity Manager",
                "Omada",
              ],
            },
            {
              sub_category: "Access Management & SSO",
              options: [
                "Okta",
                "Microsoft Entra ID",
                "Ping Identity",
                "ForgeRock",
                "Auth0",
                "CyberArk Identity",
              ],
            },
            {
              sub_category: "Privileged Access Management",
              options: [
                "CyberArk PAM",
                "BeyondTrust",
                "Thycotic",
                "Delinea",
                "HashiCorp Vault",
              ],
            },
            {
              sub_category: "Customer Identity & Access Management",
              options: [
                "Okta Customer Identity",
                "ForgeRock CIAM",
                "Ping Identity CIAM",
                "Auth0",
                "Gigya (SAP Customer Data Cloud)",
              ],
            },
          ],
        },
        {
          category: "IT Service Management",
          sub_categories: [
            {
              sub_category: "ITSM Platforms",
              options: [
                "ServiceNow ITSM",
                "Jira Service Management",
                "BMC Helix",
                "Ivanti Service Manager",
                "Freshservice",
                "Micro Focus SMAX",
              ],
            },
            {
              sub_category: "IT Operations Management",
              options: [
                "ServiceNow ITOM",
                "BMC TrueSight",
                "Dynatrace",
                "Datadog",
                "New Relic",
                "AppDynamics",
                "Moogsoft",
              ],
            },
            {
              sub_category: "Configuration Management",
              options: [
                "ServiceNow CMDB",
                "BMC Atrium CMDB",
                "Device42",
                "Freshservice CMDB",
              ],
            },
          ],
        },
        {
          category: "DevOps & Application Development",
          sub_categories: [
            {
              sub_category: "Source Control & Collaboration",
              options: ["GitHub", "GitLab", "Azure DevOps", "Bitbucket"],
            },
            {
              sub_category: "CI/CD & Pipeline",
              options: [
                "Jenkins",
                "CircleCI",
                "Azure DevOps Pipelines",
                "GitHub Actions",
                "GitLab CI/CD",
                "ArgoCD",
                "Harness",
              ],
            },
            {
              sub_category: "Infrastructure as Code",
              options: [
                "HashiCorp Terraform",
                "Ansible",
                "Chef",
                "Puppet",
                "AWS CloudFormation",
                "Pulumi",
              ],
            },
            {
              sub_category: "Code Quality & Security",
              options: [
                "SonarQube",
                "Veracode",
                "Checkmarx",
                "Snyk",
                "Black Duck",
              ],
            },
            {
              sub_category: "Low Code & No Code Development",
              options: [
                "Microsoft Power Apps",
                "Salesforce Lightning",
                "OutSystems",
                "Mendix",
                "Appian",
                "ServiceNow App Engine",
              ],
            },
          ],
        },
        {
          category: "Infrastructure & Networking",
          sub_categories: [
            {
              sub_category: "Networking",
              options: [
                "Cisco",
                "Juniper Networks",
                "Aruba Networks",
                "F5",
                "Palo Alto Networks",
              ],
            },
            {
              sub_category: "Virtualisation & Compute",
              options: [
                "VMware vSphere",
                "Nutanix",
                "Microsoft Hyper-V",
                "Citrix",
                "HPE",
                "Dell Technologies",
              ],
            },
            {
              sub_category: "Storage",
              options: [
                "NetApp",
                "Dell EMC",
                "IBM Storage",
                "Pure Storage",
                "HPE Storage",
              ],
            },
            {
              sub_category: "Monitoring & Observability",
              options: [
                "Datadog",
                "Dynatrace",
                "New Relic",
                "AppDynamics",
                "Nagios",
                "Zabbix",
                "Grafana",
              ],
            },
          ],
        },
        {
          category: "HR Technology",
          sub_categories: [
            {
              sub_category: "Core HR & Payroll",
              options: [
                "Workday HCM",
                "SAP SuccessFactors",
                "Oracle HCM Cloud",
                "ADP Workforce Now",
                "Ceridian Dayforce",
                "Bamboo HR",
              ],
            },
            {
              sub_category: "Talent Acquisition",
              options: [
                "Workday Recruiting",
                "SAP SuccessFactors Recruiting",
                "Oracle Taleo",
                "Greenhouse",
                "Lever",
                "iCIMS",
              ],
            },
            {
              sub_category: "Learning & Development",
              options: [
                "Cornerstone OnDemand",
                "SAP SuccessFactors Learning",
                "Workday Learning",
                "Degreed",
                "LinkedIn Learning",
                "Docebo",
              ],
            },
            {
              sub_category: "Workforce Management",
              options: [
                "Kronos (UKG)",
                "Workday Workforce Management",
                "SAP Time & Attendance",
                "Reflexis",
                "Deputy",
              ],
            },
          ],
        },
        {
          category: "Supply Chain & Procurement",
          sub_categories: [
            {
              sub_category: "Procurement & Sourcing",
              options: [
                "SAP Ariba",
                "Coupa",
                "Jaggaer",
                "Ivalua",
                "GEP SMART",
                "Basware",
                "Zycus",
              ],
            },
            {
              sub_category: "Supply Chain Planning",
              options: [
                "Blue Yonder",
                "Kinaxis RapidResponse",
                "o9 Solutions",
                "Oracle SCM Cloud",
                "SAP IBP",
                "Infor Nexus",
              ],
            },
            {
              sub_category: "Warehouse & Inventory Management",
              options: [
                "Manhattan Associates WMS",
                "SAP Extended Warehouse Management",
                "Oracle WMS Cloud",
                "Blue Yonder WMS",
                "Infor WMS",
              ],
            },
            {
              sub_category: "Transport & Logistics Management",
              options: [
                "Manhattan Associates TMS",
                "Oracle TMS",
                "Blue Yonder TMS",
                "SAP TM",
                "MercuryGate",
              ],
            },
          ],
        },
        {
          category: "Asset & Field Service Management",
          sub_categories: [
            {
              sub_category: "Enterprise Asset Management",
              options: [
                "IBM Maximo",
                "SAP PM / EAM",
                "Infor EAM",
                "IFS Ultimo",
                "Hexagon EAM",
                "Fiix",
                "UpKeep",
              ],
            },
            {
              sub_category: "Field Service Management",
              options: [
                "Salesforce Field Service",
                "ServiceNow FSM",
                "Microsoft Dynamics 365 Field Service",
                "IFS Field Service Management",
                "ClickSoftware",
                "ServiceMax",
              ],
            },
            {
              sub_category: "GIS & Spatial Analytics",
              options: [
                "ESRI ArcGIS",
                "Google Maps Platform",
                "Hexagon Geospatial",
                "Trimble",
              ],
            },
          ],
        },
        {
          category: "Industry-Specific Technologies",
          sub_categories: [
            {
              sub_category: "Insurance",
              options: [
                "Guidewire PolicyCenter",
                "Guidewire ClaimCenter",
                "Guidewire BillingCenter",
                "Duck Creek Policy",
                "Duck Creek Claims",
                "Majesco",
                "OneShield",
              ],
            },
            {
              sub_category: "Banking & Capital Markets",
              options: [
                "Temenos T24",
                "Finastra Fusion",
                "Murex",
                "Calypso",
                "Finacle",
                "TCS BaNCS",
                "Mambu",
              ],
            },
            {
              sub_category: "Healthcare",
              options: [
                "Epic Systems",
                "Cerner",
                "Meditech",
                "Allscripts",
                "athenahealth",
                "InterSystems HealthShare",
              ],
            },
            {
              sub_category: "Life Sciences",
              options: [
                "Veeva Vault",
                "Veeva CRM",
                "IQVIA",
                "Oracle Life Sciences",
                "Medidata",
              ],
            },
            {
              sub_category: "Utilities & Energy",
              options: [
                "Smart Energy Water",
                "Oracle Utilities",
                "SAP IS-Utilities",
                "OSIsoft PI",
                "Aveva",
                "Itron",
              ],
            },
            {
              sub_category: "Industrial & Manufacturing",
              options: [
                "PTC ThingWorx",
                "Siemens MindSphere",
                "GE Digital Predix",
                "Rockwell Automation",
                "Bentley Systems",
                "Aveva MES",
              ],
            },
            {
              sub_category: "Real Estate & Facilities",
              options: [
                "Yardi",
                "MRI Software",
                "CoStar",
                "Planon",
                "IBM TRIRIGA",
              ],
            },
            {
              sub_category: "Public Sector",
              options: [
                "Salesforce Government Cloud",
                "Microsoft Azure Government",
                "Tyler Technologies",
                "Oracle Public Sector",
                "Unison",
              ],
            },
          ],
        },
        {
          category: "Collaboration & Productivity",
          sub_categories: [
            {
              sub_category: "Productivity Suites",
              options: ["Microsoft 365", "Google Workspace", "Zoho Workplace"],
            },
            {
              sub_category: "Collaboration & Messaging",
              options: [
                "Microsoft Teams",
                "Slack",
                "Zoom",
                "Webex",
                "Google Meet",
              ],
            },
            {
              sub_category: "Content & Document Management",
              options: [
                "Microsoft SharePoint",
                "Box",
                "Dropbox Business",
                "OpenText",
                "Laserfiche",
                "M-Files",
              ],
            },
            {
              sub_category: "Project & Portfolio Management",
              options: [
                "Microsoft Project",
                "Smartsheet",
                "Monday.com",
                "Planview",
                "Clarity PPM",
                "Workfront",
                "Asana",
                "Wrike",
              ],
            },
          ],
        },
        {
          category: "Contract & Legal Technology",
          sub_categories: [
            {
              sub_category: "Contract Lifecycle Management",
              options: [
                "Icertis",
                "Ironclad",
                "Agiloft",
                "DocuSign CLM",
                "ContractPodAi",
                "Conga CLM",
              ],
            },
            {
              sub_category: "Legal Operations & Matter Management",
              options: [
                "Wolters Kluwer ELM",
                "TeamConnect",
                "SimpleLegal",
                "Mitratech",
                "Legal Tracker",
              ],
            },
            {
              sub_category: "eDiscovery & Investigations",
              options: ["Relativity", "Nuix", "Everlaw", "Logikcull", "Disco"],
            },
            {
              sub_category: "Digital Signatures & Agreements",
              options: ["DocuSign", "Adobe Sign", "HelloSign", "OneSpan"],
            },
          ],
        },
        {
          category: "Robotic Process Automation",
          sub_categories: [
            {
              sub_category: "RPA Platforms",
              options: [
                "UiPath",
                "Automation Anywhere",
                "Blue Prism",
                "Microsoft Power Automate Desktop",
                "NICE RPA",
                "Pegasystems RPA",
              ],
            },
            {
              sub_category: "Intelligent Document Processing",
              options: [
                "ABBYY FlexiCapture",
                "Kofax",
                "UiPath Document Understanding",
                "Automation Anywhere IQ Bot",
                "IBM Datacap",
              ],
            },
          ],
        },
        {
          category: "Testing & Quality Assurance",
          sub_categories: [
            {
              sub_category: "Test Management",
              options: [
                "Micro Focus ALM",
                "TestRail",
                "Zephyr",
                "Xray",
                "qTest",
              ],
            },
            {
              sub_category: "Test Automation",
              options: [
                "Selenium",
                "Tricentis Tosca",
                "Appium",
                "Cypress",
                "Playwright",
                "Sauce Labs",
              ],
            },
            {
              sub_category: "Performance & Load Testing",
              options: [
                "LoadRunner",
                "Apache JMeter",
                "Gatling",
                "BlazeMeter",
                "NeoLoad",
              ],
            },
            {
              sub_category: "API Testing",
              options: ["Postman", "SoapUI", "REST Assured", "Karate"],
            },
          ],
        },
        {
          category: "Process & Design",
          sub_categories: [
            {
              sub_category: "Process Mapping & Modelling",
              options: [
                "Signavio",
                "ARIS",
                "iGrafx",
                "Lucidchart",
                "Microsoft Visio",
                "Miro",
              ],
            },
            {
              sub_category: "Process Mining",
              options: [
                "Celonis",
                "UiPath Process Mining",
                "ABBYY Timeline",
                "IBM Process Mining",
                "SAP Signavio Process Intelligence",
              ],
            },
            {
              sub_category: "UX & Product Design",
              options: [
                "Figma",
                "Adobe XD",
                "InVision",
                "Sketch",
                "Maze",
                "Axure",
              ],
            },
            {
              sub_category: "Enterprise Architecture",
              options: [
                "LeanIX",
                "Ardoq",
                "Alfabet",
                "MEGA HOPEX",
                "Sparx Systems Enterprise Architect",
                "Bizzdesign",
              ],
            },
          ],
        },
      ],
    },
  },
  partners: {
    alliance_partners: {
      field_type: "multi-select",
      partners: [
        {
          partner: "Adobe",
          product_families: [
            {
              product_family: "Experience Cloud",
              products: [
                "Adobe Experience Manager",
                "Adobe Experience Platform",
                "Adobe Analytics",
                "Adobe Target",
                "Adobe Campaign",
                "Adobe Audience Manager",
                "Adobe Customer Journey Analytics",
              ],
            },
            {
              product_family: "Commerce",
              products: ["Adobe Commerce (Magento)", "Adobe Commerce Cloud"],
            },
            {
              product_family: "Creative & Document",
              products: [
                "Adobe Creative Cloud",
                "Adobe Document Cloud",
                "Adobe Acrobat Sign",
                "Adobe Workfront",
              ],
            },
            {
              product_family: "Data & AI",
              products: [
                "Adobe Sensei (AI)",
                "Adobe Real-Time CDP",
                "Adobe Journey Optimizer",
              ],
            },
          ],
        },
        {
          partner: "AWS",
          product_families: [
            {
              product_family: "Compute & Infrastructure",
              products: [
                "Amazon EC2",
                "Amazon ECS",
                "Amazon EKS",
                "AWS Lambda",
                "AWS Outposts",
                "AWS Elastic Beanstalk",
              ],
            },
            {
              product_family: "Storage & Database",
              products: [
                "Amazon S3",
                "Amazon RDS",
                "Amazon DynamoDB",
                "Amazon Redshift",
                "Amazon Aurora",
                "AWS Backup",
              ],
            },
            {
              product_family: "Data & Analytics",
              products: [
                "AWS Glue",
                "Amazon Athena",
                "Amazon EMR",
                "Amazon Kinesis",
                "AWS Lake Formation",
                "Amazon QuickSight",
              ],
            },
            {
              product_family: "AI & Machine Learning",
              products: [
                "Amazon SageMaker",
                "AWS Bedrock",
                "Amazon Rekognition",
                "Amazon Comprehend",
                "Amazon Lex",
                "AWS Trainium",
              ],
            },
            {
              product_family: "Security & Identity",
              products: [
                "AWS IAM",
                "AWS Security Hub",
                "Amazon GuardDuty",
                "AWS Shield",
                "AWS WAF",
                "Amazon Macie",
              ],
            },
            {
              product_family: "Networking & Integration",
              products: [
                "Amazon VPC",
                "AWS Direct Connect",
                "Amazon API Gateway",
                "AWS Transit Gateway",
                "Amazon CloudFront",
                "AWS App Mesh",
              ],
            },
            {
              product_family: "DevOps & Developer Tools",
              products: [
                "AWS CodePipeline",
                "AWS CodeBuild",
                "AWS CodeDeploy",
                "AWS CloudFormation",
                "AWS CDK",
                "Amazon CodeCatalyst",
              ],
            },
          ],
        },
        {
          partner: "Google",
          product_families: [
            {
              product_family: "Cloud Infrastructure",
              products: [
                "Google Compute Engine",
                "Google Kubernetes Engine",
                "Google Cloud Run",
                "Google Cloud Functions",
                "Google Cloud VMware Engine",
              ],
            },
            {
              product_family: "Data & Analytics",
              products: [
                "Google BigQuery",
                "Google Cloud Dataflow",
                "Google Cloud Dataproc",
                "Google Looker",
                "Google Cloud Pub/Sub",
                "Google Cloud Composer",
              ],
            },
            {
              product_family: "AI & Machine Learning",
              products: [
                "Google Vertex AI",
                "Google Gemini",
                "Google Cloud Natural Language API",
                "Google Cloud Vision API",
                "Google Cloud Speech-to-Text",
                "Google Cloud AutoML",
              ],
            },
            {
              product_family: "Security",
              products: [
                "Google Chronicle",
                "Google Security Command Center",
                "Google Cloud Armor",
                "Google BeyondCorp Enterprise",
                "Google Mandiant",
              ],
            },
            {
              product_family: "Workspace & Productivity",
              products: [
                "Google Workspace",
                "Google Meet",
                "Google Drive",
                "Google Sites",
                "Google AppSheet",
              ],
            },
            {
              product_family: "Networking",
              products: [
                "Google Cloud CDN",
                "Google Cloud Load Balancing",
                "Google Cloud Interconnect",
                "Google Cloud DNS",
                "Google Network Intelligence Centre",
              ],
            },
          ],
        },
        {
          partner: "Guidewire",
          product_families: [
            {
              product_family: "Core Insurance",
              products: [
                "Guidewire PolicyCenter",
                "Guidewire ClaimCenter",
                "Guidewire BillingCenter",
              ],
            },
            {
              product_family: "Digital & Engagement",
              products: [
                "Guidewire CustomerEngage",
                "Guidewire ProducerEngage",
                "Guidewire ServiceRepEngage",
                "Guidewire VendorEngage",
              ],
            },
            {
              product_family: "Data & Analytics",
              products: [
                "Guidewire DataHub",
                "Guidewire InfoCenter",
                "Guidewire Explore",
                "Guidewire Predict",
                "Guidewire Compare",
              ],
            },
            {
              product_family: "Cloud Platform",
              products: [
                "Guidewire Cloud Platform",
                "Guidewire Marketplace",
                "Guidewire Integration Framework",
                "Guidewire Cloud APIs",
              ],
            },
          ],
        },
        {
          partner: "Microsoft",
          product_families: [
            {
              product_family: "Azure Cloud",
              products: [
                "Azure Virtual Machines",
                "Azure Kubernetes Service",
                "Azure App Service",
                "Azure Functions",
                "Azure Virtual Desktop",
                "Azure Arc",
              ],
            },
            {
              product_family: "Data & Analytics",
              products: [
                "Azure Synapse Analytics",
                "Azure Data Factory",
                "Azure Databricks",
                "Microsoft Fabric",
                "Azure Stream Analytics",
                "Microsoft Power BI",
              ],
            },
            {
              product_family: "AI & Machine Learning",
              products: [
                "Azure OpenAI Service",
                "Azure Machine Learning",
                "Azure Cognitive Services",
                "Microsoft Copilot",
                "Azure Bot Service",
                "Azure Applied AI Services",
              ],
            },
            {
              product_family: "Business Applications",
              products: [
                "Microsoft Dynamics 365 Finance",
                "Microsoft Dynamics 365 Supply Chain",
                "Microsoft Dynamics 365 Sales",
                "Microsoft Dynamics 365 Customer Service",
                "Microsoft Dynamics 365 Field Service",
                "Microsoft Dynamics 365 Human Resources",
              ],
            },
            {
              product_family: "Productivity & Collaboration",
              products: [
                "Microsoft 365",
                "Microsoft Teams",
                "Microsoft SharePoint",
                "Microsoft Viva",
                "Microsoft Power Platform",
                "Microsoft Power Apps",
                "Microsoft Power Automate",
              ],
            },
            {
              product_family: "Security & Identity",
              products: [
                "Microsoft Sentinel",
                "Microsoft Defender",
                "Microsoft Entra ID",
                "Microsoft Purview",
                "Microsoft Intune",
                "Microsoft Priva",
              ],
            },
            {
              product_family: "DevOps & Development",
              products: [
                "Azure DevOps",
                "GitHub",
                "Azure API Management",
                "Azure Integration Services",
                "Visual Studio",
                "Microsoft Dev Box",
              ],
            },
          ],
        },
        {
          partner: "Oracle",
          product_families: [
            {
              product_family: "Cloud Infrastructure",
              products: [
                "Oracle Cloud Infrastructure (OCI)",
                "Oracle Autonomous Database",
                "Oracle Cloud VMware Solution",
                "Oracle Kubernetes Engine",
                "Oracle Cloud Functions",
              ],
            },
            {
              product_family: "ERP & Finance",
              products: [
                "Oracle Fusion Cloud ERP",
                "Oracle Fusion Cloud EPM",
                "Oracle Fusion Cloud SCM",
                "Oracle EBS",
                "Oracle Fusion Cloud Procurement",
                "Oracle Fusion Cloud Project Management",
              ],
            },
            {
              product_family: "HCM",
              products: [
                "Oracle Fusion Cloud HCM",
                "Oracle Taleo",
                "Oracle Fusion Cloud Workforce Management",
                "Oracle Fusion Cloud Payroll",
                "Oracle Learning Management",
              ],
            },
            {
              product_family: "CX & Sales",
              products: [
                "Oracle Fusion Cloud CX",
                "Oracle Sales",
                "Oracle Service",
                "Oracle Marketing",
                "Oracle Commerce",
                "Oracle CPQ",
              ],
            },
            {
              product_family: "Data & Analytics",
              products: [
                "Oracle Analytics Cloud",
                "Oracle Data Integrator",
                "Oracle GoldenGate",
                "Oracle Big Data Service",
                "Oracle Essbase",
              ],
            },
            {
              product_family: "Industry Solutions",
              products: [
                "Oracle Utilities",
                "Oracle Health (Cerner)",
                "Oracle Financial Services",
                "Oracle Hospitality",
                "Oracle Construction and Engineering",
              ],
            },
          ],
        },
        {
          partner: "Salesforce",
          product_families: [
            {
              product_family: "Sales & Service",
              products: [
                "Sales Cloud",
                "Service Cloud",
                "Field Service",
                "Revenue Cloud",
                "Salesforce CPQ",
              ],
            },
            {
              product_family: "Marketing & Commerce",
              products: [
                "Marketing Cloud",
                "Marketing Cloud Account Engagement (Pardot)",
                "Commerce Cloud",
                "Loyalty Management",
                "Referral Marketing",
              ],
            },
            {
              product_family: "Data & AI",
              products: [
                "Salesforce Data Cloud",
                "Einstein AI",
                "Einstein Analytics",
                "Tableau",
                "MuleSoft",
              ],
            },
            {
              product_family: "Platform & Development",
              products: [
                "Salesforce Platform",
                "Heroku",
                "Salesforce Flow",
                "Apex & Visualforce",
                "Lightning Web Components",
              ],
            },
            {
              product_family: "Industry Clouds",
              products: [
                "Financial Services Cloud",
                "Health Cloud",
                "Manufacturing Cloud",
                "Consumer Goods Cloud",
                "Energy & Utilities Cloud",
                "Government Cloud",
                "Nonprofit Cloud",
                "Education Cloud",
              ],
            },
            {
              product_family: "Collaboration & Productivity",
              products: ["Slack", "Salesforce Anywhere", "Quip"],
            },
          ],
        },
        {
          partner: "SAP",
          product_families: [
            {
              product_family: "ERP & Finance",
              products: [
                "SAP S/4HANA Cloud",
                "SAP S/4HANA On-premise",
                "SAP ECC",
                "SAP Central Finance",
                "SAP Group Reporting",
                "SAP Cash Management",
              ],
            },
            {
              product_family: "Supply Chain",
              products: [
                "SAP Integrated Business Planning (IBP)",
                "SAP Extended Warehouse Management",
                "SAP Transportation Management",
                "SAP Manufacturing Execution",
                "SAP Asset Management",
                "SAP Ariba",
              ],
            },
            {
              product_family: "Human Experience Management",
              products: [
                "SAP SuccessFactors Employee Central",
                "SAP SuccessFactors Recruiting",
                "SAP SuccessFactors Learning",
                "SAP SuccessFactors Performance & Goals",
                "SAP SuccessFactors Compensation",
                "SAP SuccessFactors Workforce Analytics",
              ],
            },
            {
              product_family: "Customer Experience",
              products: [
                "SAP Sales Cloud",
                "SAP Service Cloud",
                "SAP Commerce Cloud",
                "SAP Marketing Cloud",
                "SAP Customer Data Platform",
              ],
            },
            {
              product_family: "Data & Analytics",
              products: [
                "SAP Analytics Cloud",
                "SAP BW/4HANA",
                "SAP Datasphere",
                "SAP HANA Cloud",
                "SAP Business Objects",
              ],
            },
            {
              product_family: "Platform & Integration",
              products: [
                "SAP Business Technology Platform (BTP)",
                "SAP Integration Suite",
                "SAP Extension Suite",
                "SAP Build",
                "SAP Signavio",
              ],
            },
            {
              product_family: "Industry Solutions",
              products: [
                "SAP for Banking",
                "SAP for Insurance",
                "SAP for Utilities",
                "SAP for Healthcare",
                "SAP for Public Sector",
                "SAP for Retail",
                "SAP for Oil & Gas",
              ],
            },
          ],
        },
        {
          partner: "Workday",
          product_families: [
            {
              product_family: "Human Capital Management",
              products: [
                "Workday Human Resource Management",
                "Workday Payroll",
                "Workday Time Tracking",
                "Workday Absence Management",
                "Workday Benefits Administration",
                "Workday Compensation",
              ],
            },
            {
              product_family: "Talent Management",
              products: [
                "Workday Recruiting",
                "Workday Learning",
                "Workday Performance Management",
                "Workday Succession Planning",
                "Workday Career & Development",
                "Workday Skills Cloud",
              ],
            },
            {
              product_family: "Finance",
              products: [
                "Workday Financial Management",
                "Workday Accounting Centre",
                "Workday Revenue Management",
                "Workday Expenses",
                "Workday Procurement",
                "Workday Projects",
              ],
            },
            {
              product_family: "Planning & Analytics",
              products: [
                "Workday Adaptive Planning",
                "Workday People Analytics",
                "Workday Prism Analytics",
                "Workday Financial Planning",
                "Workday Workforce Planning",
              ],
            },
            {
              product_family: "Platform & Integration",
              products: [
                "Workday Platform",
                "Workday Extend",
                "Workday Integration Cloud",
                "Workday Studio",
                "Workday AI and ML",
              ],
            },
          ],
        },
      ],
    },
  },
  regulatory: {
    regulatory_profile: {
      field_type: "multi-select",
      description:
        "The regulatory bodies and frameworks applicable to this client and engagement",
      industry_groups: [
        {
          industry_group: "All Industries",
          regulators: [
            {
              regulator: "ATO",
              requirements: [
                "Income Tax Compliance",
                "GST Compliance",
                "Fringe Benefits Tax Compliance",
                "Transfer Pricing Requirements",
                "Thin Capitalisation Rules",
                "R&D Tax Incentive Compliance",
                "Diverted Profits Tax",
                "Reportable Tax Position Schedule",
                "Top 100 Tax Performance Programme",
                "Top 1000 Tax Performance Programme",
                "Payroll Tax Compliance",
                "Superannuation Guarantee Compliance",
              ],
            },
            {
              regulator: "OAIC",
              requirements: [
                "Privacy Act 1988",
                "Australian Privacy Principles (APPs)",
                "Notifiable Data Breaches Scheme",
                "Freedom of Information Act",
                "Cross-border Data Transfer Requirements",
                "Children's Online Privacy",
              ],
            },
            {
              regulator: "ACCC",
              requirements: [
                "Competition and Consumer Act 2010",
                "Australian Consumer Law",
                "Merger Review Requirements",
                "Unfair Contract Terms",
                "Product Safety Standards",
                "Misleading and Deceptive Conduct",
              ],
            },
            {
              regulator: "Safe Work Australia",
              requirements: [
                "Work Health and Safety Act 2011",
                "WHS Regulations",
                "Codes of Practice",
                "Incident Notification Requirements",
                "Hazardous Chemicals Requirements",
                "Psychosocial Hazards Requirements",
              ],
            },
            {
              regulator: "Fair Work Commission",
              requirements: [
                "Fair Work Act 2009",
                "Modern Awards Compliance",
                "Enterprise Agreement Requirements",
                "Unfair Dismissal Requirements",
                "General Protections",
                "Right of Entry Requirements",
              ],
            },
            {
              regulator: "WGEA",
              requirements: [
                "Workplace Gender Equality Act Compliance",
                "Gender Pay Gap Reporting",
                "Employer of Choice Citation",
                "Action Plan Requirements",
              ],
            },
            {
              regulator: "Department of Home Affairs",
              requirements: [
                "Modern Slavery Act 2018",
                "Foreign Investment Review Board (FIRB)",
                "Export Controls",
                "Customs Act 1901",
              ],
            },
            {
              regulator: "ASX",
              requirements: [
                "ASX Listing Rules",
                "Continuous Disclosure Obligations",
                "Corporate Governance Principles and Recommendations",
                "Related Party Transaction Requirements",
                "Capital Raising Requirements",
                "Financial Reporting Requirements",
                "Shareholder Approval Requirements",
              ],
            },
            {
              regulator: "ASIC Sustainability Reporting",
              requirements: [
                "Australian Sustainability Reporting Standards (ASRS)",
                "Climate-related Financial Disclosure Requirements",
                "TCFD Alignment",
                "Greenwashing Compliance",
                "ESG Ratings Disclosure",
              ],
            },
            {
              regulator: "Clean Energy Regulator",
              requirements: [
                "National Greenhouse and Energy Reporting (NGER)",
                "Safeguard Mechanism",
                "Australian Carbon Credit Units (ACCUs)",
                "Renewable Energy Target",
                "Carbon Credits Carbon Farming Initiative",
              ],
            },
            {
              regulator: "International Frameworks",
              requirements: [
                "ISO 27001 Information Security",
                "ISO 31000 Risk Management",
                "NIST Cybersecurity Framework",
                "SOC 2 Type II",
                "PCI DSS",
                "GRI Sustainability Standards",
                "SASB Standards",
                "UN Sustainable Development Goals",
                "IFRS Accounting Standards",
                "FATF Recommendations",
              ],
            },
          ],
        },
        {
          industry_group: "Financial Services",
          regulators: [
            {
              regulator: "APRA",
              requirements: [
                "CPS 220 Risk Management",
                "CPS 230 Operational Risk Management",
                "CPS 234 Information Security",
                "CPS 510 Governance",
                "CPS 520 Fit and Proper",
                "APS 110 Capital Adequacy",
                "APS 330 Public Disclosure",
                "LPS 220 Risk Management",
                "SPS 220 Risk Management",
                "SPS 515 Strategic Planning and Member Outcomes",
                "SPS 530 Investment Governance",
                "HPS 310 Audit and Related Matters",
              ],
            },
            {
              regulator: "ASIC",
              requirements: [
                "Financial Services Licensing",
                "Market Integrity Rules",
                "Reportable Situations Regime",
                "Design and Distribution Obligations (DDO)",
                "Product Intervention Powers",
                "Financial Adviser Standards",
                "Responsible Lending Obligations",
                "Internal Dispute Resolution Requirements",
                "Breach Reporting Requirements",
                "Hawking Prohibition",
                "Anti-Hawking Provisions",
              ],
            },
            {
              regulator: "AUSTRAC",
              requirements: [
                "AML/CTF Programme Requirements",
                "Know Your Customer (KYC) Requirements",
                "Transaction Monitoring Requirements",
                "Suspicious Matter Reporting",
                "Threshold Transaction Reporting",
                "International Funds Transfer Reporting",
                "Correspondent Banking Requirements",
                "Digital Currency Exchange Registration",
                "AML/CTF Risk Assessment Requirements",
              ],
            },
            {
              regulator: "Reserve Bank of Australia",
              requirements: [
                "Payments System Regulation",
                "Card Scheme Rules",
                "Retail Payment Activity Reporting",
                "Foreign Exchange Settlement Risk",
                "Financial Stability Standards",
              ],
            },
            {
              regulator: "OAIC - Financial Services",
              requirements: [
                "Consumer Data Right (CDR) - Banking",
                "Open Banking Data Sharing Requirements",
                "Credit Reporting Privacy Code",
                "Financial Services Privacy Requirements",
              ],
            },
            {
              regulator: "Financial Accountability Regime",
              requirements: [
                "Accountable Person Requirements",
                "Accountability Obligations",
                "Key Personnel Requirements",
                "Deferred Remuneration Requirements",
                "Notification and Registration Requirements",
              ],
            },
          ],
        },
        {
          industry_group: "Health & Life Sciences",
          regulators: [
            {
              regulator: "TGA",
              requirements: [
                "Therapeutic Goods Act Compliance",
                "Medical Device Registration",
                "Clinical Trial Requirements",
                "Advertising Requirements",
                "Manufacturing Licence Requirements",
                "Pharmacovigilance Requirements",
                "Prescription Medicine Approval",
                "Over-the-Counter Medicine Requirements",
                "Biologicals Regulation",
                "In Vitro Diagnostic Requirements",
              ],
            },
            {
              regulator: "AHPRA",
              requirements: [
                "Health Practitioner Registration Requirements",
                "Mandatory Notification Requirements",
                "Advertising Guidelines",
                "Continuing Professional Development Requirements",
                "Criminal History Requirements",
                "Student Registration Requirements",
              ],
            },
            {
              regulator: "Aged Care Quality and Safety Commission",
              requirements: [
                "Aged Care Quality Standards",
                "Star Ratings Requirements",
                "Serious Incident Response Scheme",
                "Financial Reporting Requirements",
                "Governance Requirements",
                "Worker Screening Requirements",
              ],
            },
            {
              regulator: "NDIS Quality and Safeguards Commission",
              requirements: [
                "NDIS Practice Standards",
                "Worker Screening Requirements",
                "Incident Management Requirements",
                "Behaviour Support Requirements",
                "Registration Requirements",
                "Audit Requirements",
              ],
            },
            {
              regulator: "Department of Health and Aged Care",
              requirements: [
                "Medicare Compliance",
                "Private Health Insurance Act Compliance",
                "Hospital Licensing Requirements",
                "Pharmaceutical Benefits Scheme Compliance",
                "My Health Record Requirements",
                "National Health Reform Agreement",
              ],
            },
            {
              regulator: "OAIC - Health",
              requirements: [
                "My Health Records Act 2012",
                "Health Records Privacy Requirements",
                "Healthcare Identifiers Act Compliance",
                "Clinical Data Sharing Requirements",
              ],
            },
          ],
        },
        {
          industry_group: "Energy & Utilities",
          regulators: [
            {
              regulator: "AER",
              requirements: [
                "National Electricity Rules",
                "National Gas Rules",
                "Network Pricing Requirements",
                "Reliability Standards",
                "Ring Fencing Guidelines",
                "Regulatory Investment Test Requirements",
                "Retailer Authorisation Requirements",
                "Energy Retail Law Compliance",
                "Metering Provider Requirements",
                "Default Market Offer Requirements",
              ],
            },
            {
              regulator: "AEMO",
              requirements: [
                "National Electricity Market Requirements",
                "Gas Market Requirements",
                "System Security Requirements",
                "Market Participant Obligations",
                "Metering Requirements",
                "Wholesale Demand Response Requirements",
                "Power of Choice Requirements",
                "Five Minute Settlement Requirements",
                "Integrated System Plan Compliance",
              ],
            },
            {
              regulator: "AEMC",
              requirements: [
                "Rule Change Process Requirements",
                "Review and Assessment Obligations",
                "Market Development Requirements",
                "Consumer Protections",
                "Network Regulation Requirements",
              ],
            },
            {
              regulator: "Clean Energy Regulator - Energy",
              requirements: [
                "Large-scale Renewable Energy Target",
                "Small-scale Renewable Energy Scheme",
                "National Greenhouse and Energy Reporting",
                "Safeguard Mechanism",
                "Australian Carbon Credit Units",
              ],
            },
            {
              regulator: "Department of Home Affairs - Critical Infrastructure",
              requirements: [
                "Security of Critical Infrastructure Act 2018",
                "Critical Infrastructure Risk Management Programme",
                "System of National Significance Requirements",
                "Positive Security Obligations",
                "Government Assistance Measures",
              ],
            },
            {
              regulator: "OAIC - Energy",
              requirements: [
                "Consumer Data Right (CDR) - Energy",
                "Energy Data Sharing Requirements",
                "Smart Meter Data Privacy Requirements",
              ],
            },
          ],
        },
        {
          industry_group: "Government & Public Sector",
          regulators: [
            {
              regulator: "Department of Finance",
              requirements: [
                "Public Governance Performance and Accountability Act (PGPA)",
                "Commonwealth Procurement Rules",
                "Commonwealth Grants Rules and Guidelines",
                "Resource Management Framework",
                "Annual Performance Statements Requirements",
                "Corporate Plan Requirements",
              ],
            },
            {
              regulator: "ANAO",
              requirements: [
                "Performance Audit Requirements",
                "Financial Statement Audit Requirements",
                "Assurance Review Requirements",
                "Better Practice Guide Compliance",
                "Parliamentary Committee Requirements",
              ],
            },
            {
              regulator: "ASD / ACSC",
              requirements: [
                "Australian Government Information Security Manual (ISM)",
                "Protective Security Policy Framework (PSPF)",
                "Essential Eight Maturity Model",
                "Cyber Threat Intelligence Requirements",
                "Incident Reporting Requirements",
                "Security Assessment and Authorisation",
              ],
            },
            {
              regulator: "Digital Transformation Agency",
              requirements: [
                "Digital Service Standard",
                "Whole of Government ICT Policies",
                "Data Sharing and Release Act Compliance",
                "Hosting Certification Framework",
                "Cloud Policy Compliance",
                "Australian Government Architecture Requirements",
              ],
            },
            {
              regulator: "OAIC - Government",
              requirements: [
                "Freedom of Information Act 1982",
                "Archives Act 1983",
                "Government Privacy Requirements",
                "Data Matching Programme Requirements",
                "Tax File Number Guidelines",
              ],
            },
            {
              regulator: "Australian Public Service Commission",
              requirements: [
                "Public Service Act 1999",
                "APS Values and Code of Conduct",
                "Workforce Planning Requirements",
                "Senior Executive Service Requirements",
                "Capability Framework Requirements",
              ],
            },
          ],
        },
        {
          industry_group: "Technology, Media & Telecommunications",
          regulators: [
            {
              regulator: "ACMA",
              requirements: [
                "Telecommunications Act 1997",
                "Broadcasting Services Act 1992",
                "Spam Act 2003",
                "Do Not Call Register Act 2006",
                "Radiocommunications Act 1992",
                "Online Safety Act 2021",
                "Network Reliability Framework",
                "Telecommunications Consumer Protections Code",
              ],
            },
            {
              regulator: "ACCC - Digital",
              requirements: [
                "Digital Platform Services Inquiry",
                "News Media Bargaining Code",
                "Digital Advertising Services Inquiry",
                "App Marketplace Inquiry",
                "Search Engine Requirements",
                "Social Media Platform Requirements",
              ],
            },
            {
              regulator: "eSafety Commissioner",
              requirements: [
                "Online Safety Act 2021",
                "Basic Online Safety Expectations",
                "Cyber Abuse Requirements",
                "Image-based Abuse Requirements",
                "Online Content Scheme",
                "Safety by Design Requirements",
              ],
            },
            {
              regulator: "ASD / ACSC - Technology",
              requirements: [
                "Critical Infrastructure Protection",
                "Telecommunications Security Requirements",
                "Vendor Security Assessment Requirements",
                "Software Security Requirements",
                "Cloud Security Requirements",
              ],
            },
            {
              regulator: "OAIC - Technology",
              requirements: [
                "Privacy Act Digital Platform Requirements",
                "Data Broker Requirements",
                "Direct Marketing Requirements",
                "Automated Decision Making Requirements",
                "AI Governance Requirements",
              ],
            },
          ],
        },
        {
          industry_group: "Consumer & Retail",
          regulators: [
            {
              regulator: "ACCC - Consumer",
              requirements: [
                "Australian Consumer Law",
                "Product Safety Standards",
                "Country of Origin Labelling",
                "Unit Pricing Code",
                "Franchising Code of Conduct",
                "Horticulture Code of Conduct",
                "Grocery Code of Conduct",
                "Fuel and Energy Code",
              ],
            },
            {
              regulator: "Food Standards Australia New Zealand",
              requirements: [
                "Australia New Zealand Food Standards Code",
                "Food Labelling Requirements",
                "Food Safety Standards",
                "Novel Food Requirements",
                "Nutrition and Health Claims",
              ],
            },
            {
              regulator: "Department of Agriculture",
              requirements: [
                "Biosecurity Act 2015",
                "Agricultural and Veterinary Chemicals",
                "Export Requirements",
                "Import Requirements",
                "Organic Certification Requirements",
                "Country of Origin Requirements",
              ],
            },
            {
              regulator: "ABCB",
              requirements: [
                "National Construction Code",
                "Building Product Safety Requirements",
                "Energy Efficiency Requirements",
                "Accessibility Requirements",
                "Fire Safety Requirements",
              ],
            },
          ],
        },
        {
          industry_group: "Industrial & Manufacturing",
          regulators: [
            {
              regulator: "Safe Work Australia - Industrial",
              requirements: [
                "Major Hazard Facilities Regulations",
                "Dangerous Goods Requirements",
                "Plant and Equipment Requirements",
                "Noise and Vibration Requirements",
                "Asbestos Management Requirements",
                "Mine Safety Requirements",
              ],
            },
            {
              regulator: "Department of Environment",
              requirements: [
                "Environment Protection and Biodiversity Conservation Act",
                "National Environment Protection Measures",
                "Product Stewardship Act",
                "Hazardous Waste Act",
                "Ozone Protection Requirements",
                "Illegal Logging Prohibition Act",
              ],
            },
            {
              regulator: "NHVR",
              requirements: [
                "Heavy Vehicle National Law",
                "Mass and Dimension Requirements",
                "Fatigue Management Requirements",
                "Vehicle Standards Requirements",
                "Accreditation Scheme Requirements",
                "Chain of Responsibility Requirements",
              ],
            },
            {
              regulator: "CASA",
              requirements: [
                "Civil Aviation Safety Regulations",
                "Aircraft Maintenance Requirements",
                "Pilot Licensing Requirements",
                "Air Operator Certificate Requirements",
                "Drone and RPAS Requirements",
                "Dangerous Goods Air Transport Requirements",
              ],
            },
            {
              regulator: "AMSA",
              requirements: [
                "Marine Safety National Law",
                "Vessel Registration Requirements",
                "Seafarer Certification Requirements",
                "Marine Pollution Requirements",
                "Maritime Security Requirements",
                "Port State Control Requirements",
              ],
            },
          ],
        },
      ],
    },
  },
  risk: {
    risk_profile: {
      field_type: "multi-select",
      description:
        "The risk categories and specific risks most relevant to this client and engagement",
      risk_rating_options: ["High", "Medium", "Low"],
      risk_maturity_options: [
        "Initial",
        "Developing",
        "Defined",
        "Managed",
        "Optimising",
      ],
      industry_groups: [
        {
          industry_group: "All Industries",
          risk_types: [
            {
              risk_type: "Strategic Risk",
              specific_risks: [
                "Business model disruption",
                "Failure to execute strategy",
                "Mergers and acquisitions risk",
                "Reputational risk",
                "Geopolitical risk",
                "Market and competitive risk",
                "Stakeholder and investor relations risk",
                "Concentration risk",
                "Joint venture and partnership risk",
                "Board and governance effectiveness",
              ],
            },
            {
              risk_type: "Financial Risk",
              specific_risks: [
                "Liquidity and funding risk",
                "Credit and counterparty risk",
                "Market and interest rate risk",
                "Foreign exchange risk",
                "Financial reporting risk",
                "Tax risk",
                "Fraud and financial crime risk",
                "Insurance and liability risk",
                "Revenue leakage risk",
                "Capital adequacy risk",
              ],
            },
            {
              risk_type: "Operational Risk",
              specific_risks: [
                "Business process failure",
                "Third party and supplier risk",
                "Business continuity risk",
                "Project and programme delivery risk",
                "Change management risk",
                "Health and safety risk",
                "Asset and infrastructure risk",
                "Quality and product risk",
                "Natural disaster and climate risk",
                "Outsourcing and offshoring risk",
              ],
            },
            {
              risk_type: "Technology & Cyber Risk",
              specific_risks: [
                "Ransomware and malware risk",
                "Data breach risk",
                "Legacy system risk",
                "Cloud migration risk",
                "Third party technology risk",
                "System availability and resilience risk",
                "AI and machine learning risk",
                "IoT and connected device risk",
                "Identity and access management risk",
                "Technology concentration risk",
              ],
            },
            {
              risk_type: "People Risk",
              specific_risks: [
                "Key person dependency",
                "Talent attraction and retention",
                "Workforce capability and skills gaps",
                "Industrial relations risk",
                "Workplace culture and conduct risk",
                "Employee misconduct and fraud",
                "Workforce health and wellbeing",
                "Contractor and contingent workforce risk",
                "Succession planning risk",
                "Diversity and inclusion risk",
              ],
            },
            {
              risk_type: "Legal & Compliance Risk",
              specific_risks: [
                "Contract and commercial risk",
                "Intellectual property risk",
                "Litigation and dispute risk",
                "Regulatory breach risk",
                "Whistleblower risk",
                "Conflict of interest risk",
                "Bribery and corruption risk",
                "Trade and sanctions compliance risk",
                "Consumer protection risk",
                "Privacy and data breach risk",
              ],
            },
            {
              risk_type: "ESG & Sustainability Risk",
              specific_risks: [
                "Climate transition risk",
                "Physical climate risk",
                "Stranded asset risk",
                "Water scarcity risk",
                "Biodiversity and land use risk",
                "Supply chain sustainability risk",
                "Social licence to operate risk",
                "Greenwashing risk",
                "ESG reporting and disclosure risk",
                "Stakeholder activism risk",
              ],
            },
          ],
        },
        {
          industry_group: "Financial Services",
          risk_types: [
            {
              risk_type: "Prudential Risk",
              specific_risks: [
                "Capital adequacy risk",
                "Liquidity coverage ratio risk",
                "Net stable funding ratio risk",
                "Credit concentration risk",
                "Large exposures risk",
                "Pillar 2 supervisory review risk",
                "Stress testing risk",
                "Recovery and resolution planning risk",
                "Contagion risk",
                "Systemic risk",
              ],
            },
            {
              risk_type: "Financial Crime Risk",
              specific_risks: [
                "Money laundering risk",
                "Terrorism financing risk",
                "Sanctions breach risk",
                "Bribery and corruption risk",
                "Market manipulation risk",
                "Insider trading risk",
                "Tax evasion facilitation risk",
                "Proliferation financing risk",
                "Fraud risk",
                "Cybercrime risk",
              ],
            },
            {
              risk_type: "Conduct & Consumer Risk",
              specific_risks: [
                "Mis-selling risk",
                "Product suitability risk",
                "Conflicts of interest risk",
                "Remuneration and incentive risk",
                "Vulnerable customer risk",
                "Complaints handling risk",
                "Unfair contract terms risk",
                "Responsible lending risk",
                "Superannuation member outcomes risk",
                "Insurance claims handling risk",
              ],
            },
          ],
        },
        {
          industry_group: "Health & Life Sciences",
          risk_types: [
            {
              risk_type: "Clinical & Patient Risk",
              specific_risks: [
                "Patient safety risk",
                "Clinical governance risk",
                "Medication error risk",
                "Adverse event risk",
                "Infection control risk",
                "Clinical trial risk",
                "Medical device failure risk",
                "Diagnostic error risk",
                "Treatment outcome risk",
                "Consent and autonomy risk",
              ],
            },
            {
              risk_type: "Regulatory & Quality Risk",
              specific_risks: [
                "TGA compliance risk",
                "AHPRA registration risk",
                "Aged care quality standards risk",
                "NDIS compliance risk",
                "Medicare compliance risk",
                "Clinical coding risk",
                "Accreditation risk",
                "Pharmacovigilance risk",
                "Product recall risk",
                "Supply chain quality risk",
              ],
            },
          ],
        },
        {
          industry_group: "Energy & Utilities",
          risk_types: [
            {
              risk_type: "Energy Market Risk",
              specific_risks: [
                "Wholesale energy price risk",
                "Retail margin risk",
                "Network revenue risk",
                "Renewable energy certificate risk",
                "Carbon price risk",
                "Fuel supply risk",
                "Demand forecasting risk",
                "Interconnector risk",
                "Ancillary services risk",
                "Hedging and derivative risk",
              ],
            },
            {
              risk_type: "Infrastructure & Operational Risk",
              specific_risks: [
                "Asset failure and outage risk",
                "Network reliability risk",
                "Critical infrastructure protection risk",
                "Natural disaster risk",
                "Bushfire risk",
                "Flood risk",
                "Cyber attack on operational technology risk",
                "SCADA and control system risk",
                "Aging infrastructure risk",
                "New technology integration risk",
              ],
            },
          ],
        },
        {
          industry_group: "Government & Public Sector",
          risk_types: [
            {
              risk_type: "Public Accountability Risk",
              specific_risks: [
                "Parliamentary scrutiny risk",
                "Freedom of information risk",
                "Audit finding risk",
                "Ministerial direction risk",
                "Public interest disclosure risk",
                "Procurement compliance risk",
                "Grant administration risk",
                "Programme delivery risk",
                "Policy implementation risk",
                "Inter-agency coordination risk",
              ],
            },
            {
              risk_type: "National Security Risk",
              specific_risks: [
                "Foreign interference risk",
                "Critical infrastructure attack risk",
                "Espionage risk",
                "Classified information risk",
                "Security clearance risk",
                "Supply chain national security risk",
                "Foreign investment risk",
                "Cyber espionage risk",
                "Insider threat risk",
                "Disinformation risk",
              ],
            },
          ],
        },
        {
          industry_group: "Technology, Media & Telecommunications",
          risk_types: [
            {
              risk_type: "Digital Platform Risk",
              specific_risks: [
                "Platform liability risk",
                "Content moderation risk",
                "Algorithmic bias risk",
                "Data monetisation risk",
                "Digital advertising risk",
                "Platform dependency risk",
                "App store risk",
                "Digital rights management risk",
                "Online safety risk",
                "Deepfake and synthetic media risk",
              ],
            },
            {
              risk_type: "Telecommunications Risk",
              specific_risks: [
                "Network outage risk",
                "Spectrum risk",
                "Roaming and interconnection risk",
                "Infrastructure sharing risk",
                "5G deployment risk",
                "NBN dependency risk",
                "Critical communications risk",
                "Emergency services network risk",
                "Telecommunications security risk",
                "Foreign equipment vendor risk",
              ],
            },
          ],
        },
        {
          industry_group: "Consumer & Retail",
          risk_types: [
            {
              risk_type: "Supply Chain Risk",
              specific_risks: [
                "Supplier concentration risk",
                "Offshore manufacturing risk",
                "Logistics and freight risk",
                "Inventory management risk",
                "Raw material price risk",
                "Food safety and contamination risk",
                "Product recall risk",
                "Counterfeiting and grey market risk",
                "Ethical sourcing risk",
                "Modern slavery in supply chain risk",
              ],
            },
            {
              risk_type: "Consumer & Brand Risk",
              specific_risks: [
                "Brand and reputational risk",
                "Consumer sentiment risk",
                "Social media risk",
                "Product liability risk",
                "Customer data breach risk",
                "Loyalty programme risk",
                "Pricing and promotional risk",
                "Channel conflict risk",
                "Franchise risk",
                "Retail crime and loss prevention risk",
              ],
            },
          ],
        },
        {
          industry_group: "Industrial & Manufacturing",
          risk_types: [
            {
              risk_type: "Industrial Safety Risk",
              specific_risks: [
                "Major hazard facility risk",
                "Dangerous goods risk",
                "Industrial accident risk",
                "Mine safety risk",
                "Contractor safety risk",
                "Equipment and machinery risk",
                "Noise and vibration risk",
                "Hazardous substance exposure risk",
                "Fatigue management risk",
                "Emergency response risk",
              ],
            },
            {
              risk_type: "Environmental Risk",
              specific_risks: [
                "Environmental contamination risk",
                "Waste management risk",
                "Emissions and pollution risk",
                "Water usage and discharge risk",
                "Biodiversity impact risk",
                "Site rehabilitation risk",
                "Environmental licence breach risk",
                "Climate physical risk to assets",
                "Carbon and emissions liability risk",
                "Community environmental impact risk",
              ],
            },
          ],
        },
      ],
    },
  },
};

const INLINED_PROMPTS = {
  "engagement_intake.json": {
    prompt_id: "P1.1",
    prompt_name: "Engagement Intake",
    artifact: "P1_1_CANONICAL_HANDOFF",
    instruction:
      `**Role & purpose** – Normalise the engagement brief data and create a canonical JSON handoff for downstream prompts. Do not call the code interpreter.

<context>
  Global style and data standards. Use Arial headings (sizes 18/16/14/11 pt) and 11 pt body text at 1.5 spacing. Table headers use PwC orange (#FD5108) with white text, grey horizontal lines and no vertical borders. Unknown values should be marked "TBC". Use ISO 8601 dates. Canonical keys use snake_case; labels use Title Case; data types include string, date, integer, decimal and boolean. Units: person_days (1=8h); working_days; currency with two decimals (AUD); percentages as decimals. Enumerations: delivery_methodology ∈ {Waterfall, Agile, Hybrid}; fee_structure ∈ {Fixed_Price, Time_and_Materials, Capped_T_and_M}; engagement_complexity ∈ {Low, Medium, High, Very_High}; organisation_type ∈ {PwC, Client, Joint, Alliance_Partner, Third_Party, Regulator, Vendor, Other}; yes_no ∈ {Yes, No}.
</context>
<engagement_data>{{ENGAGEMENT_DATA}}</engagement_data>
<instructions>
1. Read and apply the style and data standards from the <context>.
2. Parse the JSON in <engagement_data>. Trim strings, convert fields to canonical keys. Set optional fields to null if absent; mark unknown required fields as "TBC".
3. Do not validate client_name or engagement_name; those are provided in the form.
4. Build a canonical JSON object with: client_name, engagement_name, engagement_code, engagement_lead, industry, sector, sub_sector, delivery_methodology, fee_structure, start_date, end_date, total_budget, engagement_description, scope_summary, objectives (list), roles and decision rights, commercial_terms and open_items (empty list if none).
5. Output the JSON as \`P1_1_CANONICAL_HANDOFF\`; do not call python.
</instructions>`
  },

  "stakeholder_analysis.json": {
    prompt_id: "P1.2",
    prompt_name: "Stakeholder Analysis",
    artifact: "P1_2_STAKEHOLDER_REGISTER",
    instruction:
      `**Role & purpose** – Generate a stakeholder register and summary based on the canonical engagement context. Use Python to create an Excel workbook and a canonical JSON handoff.

<context>
  Enumerations: stakeholder_type ∈ {Sponsor, Decision_Maker, Project_Owner, Programme_Manager, SME, End_User, Approver, Informed_Only, Other}; organisation_type ∈ {PwC, Client, Joint, Alliance_Partner, Third_Party, Regulator, Vendor, Other}; engagement_role ∈ {Sponsor, Decision_Maker, Project_Owner, Programme_Manager, SME, End_User, Approver, Informed_Only, Other}; influence_level, interest_level ∈ {High, Medium, Low}; engagement_strategy ∈ {Manage_Closely, Keep_Satisfied, Keep_Informed, Monitor}; preferred_channel ∈ {Email, Phone, Video_Conference, In_Person, Instant_Message}; communication_cadence ∈ {Daily, Weekly, Fortnightly, Monthly, Quarterly, As_Needed}; yes_no ∈ {Yes, No}. Derive influence_level: score ≥4 → High; 3 → Medium; ≤2 → Low. Derive engagement_strategy: High influence + High interest = Manage_Closely; High influence + Medium/Low interest = Keep_Satisfied; Medium/Low influence + High interest = Keep_Informed; otherwise = Monitor. Use ISO 8601 dates. Table style: header row orange with white text; grey horizontal lines; no vertical borders.
</context>
<instructions>
1. Load \`P1_1_CANONICAL_HANDOFF\`. If client_name or engagement_name is missing, output \`P1_2_VALIDATION_ERRORS\` JSON and stop.
2. Identify stakeholders from the brief: include client sponsor, engagement lead, key decision makers, project owner, programme manager and any additional roles specified. If the brief is sparse, infer standard PwC engagement roles appropriate to the engagement size and complexity. Depth floors: small engagements (<6 months) = 15–20 stakeholders; medium (6–12 months) = 20–25; large (12+ months) = 25+. Ensure representation across all four engagement_strategy quadrants. Generate the stakeholder data as a Python list of dictionaries within the code call rather than reasoning through each one individually before the code block. Deduplicate by full_name; if PwC and client stakeholders share a name, append the organisation suffix. Do not fabricate individual names — use role-based placeholders (e.g. "Client Programme Manager") where names are not provided.
3. For each stakeholder, collect: stakeholder_id (SH-001…), full_name, organisation_name, organisation_type, role_title, engagement_role, influence_score (1–5), interest_score (1–5), preferred_channel (default Email), communication_cadence (default Weekly), sensitivity (Yes/No — default No), contact_email, contact_phone, notes and source.
4. Compute influence_level and interest_level from scores using the derivation rules in <context>. Assign engagement_strategy using the mapping. Determine quadrant by combining levels (e.g., High influence + High interest → Manage_Closely).
5. Build an Excel workbook (\`P1_2_Stakeholder_Register.xlsx\`) with three sheets:
   **Stakeholder_Register** — columns as listed in step 3 plus influence_level, interest_level, quadrant, engagement_strategy, workstream and last_confirmed_date. Apply dropdown data validation on: organisation_type, engagement_role, preferred_channel, communication_cadence, sensitivity. Apply conditional formatting: Manage_Closely rows highlighted orange; sensitivity=Yes rows with bold left border.
   **Stakeholder_Summary** — count tables by stakeholder_type and engagement_strategy; a 3×3 influence–interest matrix with stakeholder counts per cell and colour-coded fills (high-influence/high-interest in orange, low/low in light grey).
   **Change_Log** — record_id, field_changed, old_value, new_value, date, updated_by. Pre-populate one instructional placeholder row.
6. Apply consistent formatting across all sheets: freeze header row on each sheet; enable auto-filters; set column widths to fit content (minimum 14 characters); set tab colours (orange for Stakeholder_Register, grey for Change_Log). Use the table style from <context>.
7. Use a single code interpreter call with pandas and openpyxl to create the workbook.
8. Prepare \`P1_2_CANONICAL_HANDOFF\` JSON summarising the stakeholder register (list of stakeholder objects with all fields) and include a link to the generated workbook.
9. Output only the JSON handoff and the workbook download link.
</instructions>`
  },

  "scope_objectives.json": {
    prompt_id: "P1.3",
    prompt_name: "Scope, Objectives & Success Criteria",
    artifact: "P1_3_SCOPE_OBJECTIVES",
    instruction:
      `**Role & purpose** – Translate the engagement objectives and scope into structured registers, define success criteria and generate a workbook and a canonical handoff.

<context>
  Enumerations: scope_type ∈ {Inclusion, Exclusion, Assumption, Constraint}; objective_type ∈ {Business, Technical, Compliance, Regulatory, Risk, Other}; priority ∈ {Critical, High, Medium, Low}; confidence_level ∈ {High, Medium, Low, TBC}; yes_no ∈ {Yes, No}. Unknown fields should be marked "TBC". Use ISO 8601 dates. Table style as per global standards.
</context>
<instructions>
1. Load \`P1_1_CANONICAL_HANDOFF\` and \`P1_2_CANONICAL_HANDOFF\`. If client_name or engagement_name is missing, output \`P1_3_VALIDATION_ERRORS\` JSON and stop. Extract scope statements, objectives and success criteria from the brief and stakeholder analysis.
2. Draft a boundary statement (2–3 sentences) summarising what is in scope and out of scope, citing key inclusions and exclusions.
3. Build a **Scope_Register** with columns: record_id (INC-001/EXC-001/ASM-001/CON-001 by type), scope_type, title, description, category, source, confidence_level, owner_organisation_type, owner_role, status (Proposed, Confirmed, Deferred), date_confirmed, notes, linked_objective_ids and linked_stakeholder_ids. Aim for a minimum of 3 inclusions, 2 exclusions and 2 assumptions. If fewer exist in the brief, add "Scope boundaries based on current brief — to be confirmed in workshop" as an assumption with confidence_level Low. Apply dropdown validation on scope_type, confidence_level and status. Apply conditional formatting: confidence_level=Low rows highlighted amber; status=Deferred rows greyed out.
4. Build an **Objectives_and_Success_Criteria** sheet combining objectives with their measurable success criteria: objective_id (OBJ-001…), objective_name, objective_type, priority, owner_role, owner_organisation_type, status, related_scope_ids, criterion_id (SC-001…), criterion_description, metric, target_value, measure_method, confidence_level, due_date, criterion_status. Each objective may have multiple rows (one per criterion); repeat the objective fields on each row for easy filtering. Apply dropdown validation on objective_type, priority, confidence_level and status.
5. Apply consistent formatting to all sheets: freeze header rows; enable auto-filters; set column widths to fit content (minimum 14 characters); set tab colours (orange for data sheets). Use the table style from <context>.
6. Use a single code interpreter call with pandas and openpyxl to assemble the workbook (\`P1_3_Scope_Objectives.xlsx\`).
7. Compose \`P1_3_CANONICAL_HANDOFF\` JSON containing: boundary_statement, inclusions[], exclusions[], assumptions[], constraints[], objectives[], success_criteria[], open_items[] and validation field.
8. Output only the JSON handoff and a link to the workbook.
</instructions>`
  },

  "engagement_charter.json": {
    prompt_id: "P1.4",
    prompt_name: "Engagement Charter",
    artifact: "Engagement Charter",
    instruction:
      `**Role & purpose** – Consolidate the engagement context, stakeholder analysis and scope registers into a formal Engagement Charter that will serve as the initiation stage gate.

<context>
  Enumerations and definitions: priority ∈ {Critical, High, Medium, Low}; decision_type ∈ {Scope_Change, Budget_Change, Schedule_Change, Deliverable_Signoff, Risk_Acceptance, Issue_Escalation, Commercial_Change}; owner_org ∈ {PwC, Client, Joint, Third_Party, TBC}; status ∈ {Draft, Proposed, Approved, Rejected, Deferred}; yes_no ∈ {Yes, No, TBC}. Date fields use ISO 8601 (YYYY MM DD). Use the global style rules (Arial headings, 11 pt body text, orange table headers, grey horizontal rules, no vertical borders). Example table:
  Client Name | Engagement Name | Engagement Code | Delivery Methodology | Fee Structure | Total Budget | Start Date | End Date | Primary Workstreams
  ACME Corp | Project Phoenix | ENG 001 | Agile | Time_and_Materials | AUD 1.2M | 2026 03 01 | 2026 10 31 | Core Build, Integration, Testing
</context>
<instructions>
1. Extract and normalise data from the canonical handoffs: \`P1_1_CANONICAL_HANDOFF\`, \`P1_2_CANONICAL_HANDOFF\` and \`P1_3_CANONICAL_HANDOFF\`. If client_name or engagement_name is missing, or zero objectives exist, output \`P1_4_VALIDATION_ERRORS\` JSON listing the missing fields and stop. Apply canonical field names and enumerations; unknown values become "TBC".
2. Draft the charter narrative: write a concise purpose and introduction describing the engagement and the role of the charter; summarise the engagement overview in a table (see example).
3. Derive and populate tables for objectives, success criteria and KPIs using the priority and owner role enumerations.
4. Summarise the scope: include the boundary statement; list top inclusions and exclusions; summarise assumptions, constraints and dependencies; ensure each item is traced back to \`P1_3\`.
5. Describe the delivery approach: reference the delivery methodology and identify primary workstreams; if unknown, insert 'TBC' and create an open item.
6. Build team and role tables: list PwC and Client roles with names (or placeholders), responsibilities and owner_org.
7. Create a decision rights table using decision_type enumerations and map Accountable, Consulted and Informed roles based on stakeholder responsibilities.
8. Summarise commercial terms (billing frequency, invoicing contact, PO reference, payment terms, currency, GST treatment); unknown values are flagged as 'Proposed – to be confirmed'.
9. Provide a brief risk, compliance and quality statement referencing the need for detailed registers (to be generated later).
10. Outline the change control policy and note that formal change requests will be managed through the governance framework defined in \`P1.5\`.
11. List all open items from upstream handoffs and any new items introduced in this step; assign each to an owner role with a priority.
12. Create a sign off table for key roles (Client Sponsor, Project Owner, PwC Engagement Lead, Engagement Manager, Account Leader) with signature and date placeholders.
13. Use a single code interpreter call with python-docx to generate a Word document with the sections above. Apply the style guidelines: Arial headings (L1–4 at 18/16/14/11 pt), 11 pt body text at 1.5 spacing, orange header rows with white text for tables, grey horizontal rules and no vertical borders. Include the confidentiality footer on every page.
14. Assemble \`P1_4_CANONICAL_HANDOFF\` JSON containing \`engagement_identifiers\`, \`engagement_context\`, \`scope_summary\`, \`objectives_refs\`, \`roles\`, \`decision_rights_summary\`, \`commercial_terms\`, \`open_items[]\` and \`validation\`, plus a link to the generated document.
15. After the code call, output the JSON handoff and a closing sentence indicating that the charter has been generated.
</instructions>`
  },

  "governance_framework.json": {
    prompt_id: "P1.5",
    prompt_name: "Governance Framework",
    artifact: "Governance Framework",
    instruction:
      `**Role & purpose** – Define the governance framework that will govern the engagement, including governance bodies, decision matrix, escalation paths, reporting cadence and meeting schedules.

<context>
  Enumerations: governance_body_type ∈ {Steering_Committee, Project_Board, Working_Group, PMO, Stakeholder_Forum, Other}; meeting_type ∈ {Kickoff, Steering_Committee, Working_Group, Workshop, Weekly_Status, Fortnightly_Status, Monthly_Report, Quarterly_Review, Other}; frequency ∈ {Weekly, Fortnightly, Monthly, Quarterly, As_Needed}; decision_scope ∈ {Scope_Change, Budget_Change, Schedule_Change, Deliverable_Signoff, Risk_Acceptance, Issue_Escalation, Commercial_Change}; escalation_level ∈ {Project_Manager, Programme_Manager, Steering_Committee, Board, Executive}. Use the global style rules; tables follow the orange header/grey horizontal rule style. Example table: Governance Body | Purpose | Chair Role | Member Roles | Frequency | Quorum | Decision Scope; Steering Committee | Provide strategic direction and approve major changes | Client Sponsor | PwC Engagement Lead; Client Project Owner; PwC Programme Manager | Monthly | 60% of members | Scope, Budget, Schedule.
</context>
<instructions>
1. Consolidate inputs from \`P1_1_CANONICAL_HANDOFF\`, \`P1_2_CANONICAL_HANDOFF\`, \`P1_3_CANONICAL_HANDOFF\` and \`P1_4_CANONICAL_HANDOFF\`. If client_name or engagement_name is missing, output \`P1_5_VALIDATION_ERRORS\` JSON and stop.
2. Determine engagement size: Small (<6 months, 1–2 workstreams), Medium (6–12 months, 2–4 workstreams) or Large (12+ months, 4+ workstreams). If size cannot be determined, default to Medium.
3. Propose governance bodies based on size: Small = Steering Committee + Delivery Working Group; Medium = add PMO/Reporting Forum; Large = add Workstream Lead Forums. Always propose at least two governance bodies. For each body define: body_name, purpose, chair_role, member_roles, frequency, quorum, decision_scope (one or more from the enumeration) and delegated_authority. Membership must be role-based (not named individuals unless explicitly known from upstream).
4. Build a **Governance_Bodies** sheet with the columns from step 3. Below the governance bodies table (separated by a bold section header row "Escalation Ladder"), add an escalation ladder table: escalation_trigger (e.g., schedule variance >10%, budget variance >5%), escalation_level, responsible_role, target_resolution_time. Apply dropdown validation on frequency and decision_scope in the bodies table.
5. Build a **Reporting_Cadence** sheet: report_type, audience, frequency, owner_role, approval_role, delivery_format, due_date. Include at minimum: Status Report, Risk Report, Budget Report, Milestone Report, Steering Deck. Apply dropdown validation on frequency and delivery_format.
6. Build a **Meeting_Schedule** sheet: meeting_id, governance_body, meeting_type, frequency, day_of_week, time, chair_role, attendee_roles, status (Planned, Completed, Cancelled, TBC). Set day_of_week and time to "TBC" rather than fabricating specific days or times. Apply dropdown validation on meeting_type, frequency and status.
7. Build a **Decision_Action_Log** sheet as a headers-only template: record_id, record_type (Decision/Action), date, title, description, source_body, owner_role, due_date, status, decision_outcome (if Decision), notes. Pre-populate one instructional placeholder row. Apply dropdown validation on record_type and status.
8. Build a **RACI_Matrix** sheet for key governance activities (change approval, risk review, milestone signoff, status reporting, budget review, escalation management): list activities as rows and roles as columns, with R/A/C/I assignments. Ensure each activity has exactly one A (Accountable).
9. Apply consistent formatting to all sheets: freeze header rows; enable auto-filters; set column widths to fit content (minimum 14 characters); set tab colours (orange for Governance_Bodies and Meeting_Schedule, grey for Decision_Action_Log); use the table style from <context>.
10. Use a single code interpreter call with pandas and openpyxl to create \`P1_5_Governance_Framework.xlsx\` with all five sheets.
11. Produce \`P1_5_CANONICAL_HANDOFF\` summarising governance bodies, escalation ladder, reporting cadence and a link to the workbook.
12. Output only the JSON handoff and a sentence confirming the governance framework has been created.
</instructions>`
  },

  "wbs_schedule.json": {
    prompt_id: "P2.1",
    prompt_name: "WBS & Schedule",
    artifact: "WBS & Project Schedule",
    instruction:
      `**Role & purpose** – Build a hierarchical Work Breakdown Structure (WBS) and project schedule from scope items and objectives. Produce a multi sheet WBS & Schedule workbook and a canonical handoff.

<context>
  Enumerations: element_type ∈ {Engagement, Phase, Workstream, Deliverable, Work_Package}; owner_organisation_type ∈ {PwC, Client, Joint, Third_Party}; priority ∈ {Critical, High, Medium, Low}; milestone_type ∈ {Phase_Gate, Deliverable_Signoff, Client_Approval, Regulatory_Submission, Go_Live, Review_Point, Steering_Committee, Sprint_Review, Other}; task_status ∈ {Not_Started, In_Progress, Complete, On_Hold, Cancelled, Blocked}; yes_no ∈ {Yes, No}. Working days are Monday–Friday; person days assume 8 hours/day; use ISO 8601 dates. Table style per global guidelines.
</context>
<instructions>
1. Load \`P1_3_CANONICAL_HANDOFF\`, \`P1_4_CANONICAL_HANDOFF\` and \`P1_5_CANONICAL_HANDOFF\`. If scope items or objectives are missing, output \`P2_1_VALIDATION_ERRORS\` JSON and stop. Create a top-level WBS element for the engagement and define phases, workstreams, deliverables and work packages. Use the element_type enumeration and assign wbs_level accordingly (Engagement=1, Phase=2, Workstream=3, Deliverable/Work_Package=4).
2. For each deliverable or work package, set estimated_effort_days and estimated_duration_days based on scope items and objectives; assign owner_organisation_type and responsible_role; set priority; identify predecessor_wbs_ids where tasks are sequential. When effort or duration is unknown, use reasonable defaults based on element_type and mark confidence as TBC in the notes.
3. Build a **WBS_Dictionary** sheet with columns: wbs_id, element_name, parent_wbs_id, wbs_level, element_type, owner_organisation_type, responsible_role, estimated_effort_days, estimated_duration_days, predecessor_wbs_ids, priority, task_status. Apply dropdown validation on element_type, owner_organisation_type, priority and task_status.
4. Create a **Deliverable_Register** sheet: deliverable_id, deliverable_name, workstream, owner_organisation_type, responsible_role, estimated_effort_days, planned_start_date, planned_end_date, acceptance_criteria, sign_off_required (Yes/No), sign_off_authority, scope_objective_trace, status. Apply dropdown validation on owner_organisation_type, sign_off_required and status.
5. Create a **Milestone_Plan** sheet: milestone_id, milestone_name, phase_or_workstream, milestone_type, planned_date, actual_date, variance_days (formula: if actual_date is blank return blank, else actual − planned), status, owner_role, signoff_required (Yes/No), signoff_status. Apply dropdown validation on milestone_type, status and signoff_status. Apply conditional formatting: overdue milestones (actual_date past planned_date) highlighted red; signoff_status=Pending highlighted amber.
6. Create a **Schedule** sheet with task-level detail: task_id, wbs_id, task_name, wbs_level, workstream, owner_role, planned_start_date, planned_end_date, duration_days, predecessor_task_ids, task_status, percent_complete, is_milestone (Yes/No), is_critical_path (Yes/No), sprint, notes. Calculate start and end dates based on predecessors and working days. To identify the critical path, flag the longest sequential chain of predecessors as is_critical_path=Yes — do not implement a full CPM algorithm; simply identify the longest path by summing durations along predecessor chains. Apply conditional formatting: critical path tasks in bold; Blocked or On_Hold tasks highlighted red.
7. Create a **KPI_Summary** sheet with explicit columns: dimension (Phase/Workstream/Overall), dimension_name, planned_start, planned_end, actual_start, actual_end, planned_effort_days, actual_effort_days, percent_complete, status. Populate one row per workstream, one per phase and one overall summary row.
8. Create a **Change_Log** sheet: change_id, change_type, reason, affected_wbs_id, date, author_role, approved_by, notes. Pre-populate one instructional placeholder row.
9. Apply consistent formatting to all sheets: freeze header rows; enable auto-filters; set column widths to fit content (minimum 14 characters); set tab colours (orange for WBS_Dictionary and Schedule, grey for Change_Log). Use the table style from <context>.
10. Use a single code interpreter call with pandas and openpyxl to assemble \`P2_1_WBS_Schedule.xlsx\` with all six sheets.
11. Build \`P2_1_CANONICAL_HANDOFF\` JSON capturing the WBS hierarchy, deliverables, milestones, schedule summary and a link to the workbook.
12. Output only the JSON and workbook link.
</instructions>`
  },

  "resource_plan.json": {
    prompt_id: "P2.2",
    prompt_name: "Resource Plan & RACI",
    artifact: "P2_2_RESOURCE_PLAN",
    instruction:
      `**Role & purpose** – Build a resource plan to allocate roles to work packages and produce a workbook and canonical handoff.

<context>
  Enumerations: seniority_level ∈ {Partner, Director, Senior_Manager, Manager, Senior_Associate, Associate, Analyst, Specialist, Other}; organisation_type ∈ {PwC, Client, Joint, Alliance_Partner, Third_Party, Regulator, Vendor, Other}; location ∈ {Onshore, Offshore, Near_Shore, Client_Site, Remote}; confirmed_status ∈ {Confirmed, Proposed, TBC}; raci_code ∈ {R, A, C, I}; yes_no ∈ {Yes, No}. Working days Monday–Friday; person days = 8 hours; use ISO 8601 dates.
</context>
<instructions>
1. Load \`P2_1_CANONICAL_HANDOFF\` along with \`P1_4_CANONICAL_HANDOFF\` and \`P1_2_CANONICAL_HANDOFF\`. If WBS or schedule data is missing, output \`P2_2_VALIDATION_ERRORS\` JSON and stop. Determine resource requirements by mapping each work package to the responsible role and estimated effort_days.
2. For each role, derive seniority_level, organisation_type and location based on the engagement context and stakeholder register. Use these inference rules when upstream data is sparse: engagement leadership roles → Partner/Director/Senior_Manager; PMO/Engagement Manager → Manager/Senior_Manager; workstream leads → Manager/Senior_Manager; delivery team → Associate/Senior_Associate/Analyst; specialist roles → Specialist. When names are unknown, leave full_name blank and set confirmed_status to TBC. Mark all inferred roles with "Inferred" in the notes column.
3. Ensure minimum resource coverage based on engagement size: small (<6 months) = 6–10 roles; medium (6–12 months) = 10–18 roles; large (12+ months) = 18+ roles. At minimum always include: Engagement Partner/Lead, Engagement Manager, one Workstream Lead per workstream, appropriate delivery staff, Client Sponsor, Client Project Owner.
4. Build a **Resource_Register** sheet with columns: resource_id (RES-001…), full_name, role_title, seniority_level, organisation_type, primary_workstream, secondary_workstream, location, start_date, end_date, total_effort_days, estimated_duration_days, fte_allocation (formula: IFERROR(effort/duration, 0)), availability_percent, daily_rate, confirmed_status, security_clearance_required (Yes/No), notes. Apply dropdown data validation on: seniority_level, organisation_type, location, confirmed_status, security_clearance_required. Apply conditional formatting: confirmed_status=TBC rows highlighted amber; fte_allocation>1.0 highlighted red.
5. Apply consistent formatting: freeze header row; enable auto-filters; set column widths to fit content (minimum 14 characters); set tab colour orange. Use the table style from <context>.
6. Use a single code interpreter call with pandas and openpyxl to create \`P2_2_Resource_Plan.xlsx\` with the Resource_Register sheet.
7. Prepare \`P2_2_CANONICAL_HANDOFF\` JSON summarising resource requirements (roles list, total effort, seniority breakdown) and a link to the workbook.
8. Output only the JSON and the workbook link.
</instructions>`
  },

  "budget_baseline.json": {
    prompt_id: "P2.3",
    prompt_name: "Budget & Cost Baseline",
    artifact: "P2_3_BUDGET_BASELINE",
    instruction:
      `**Role & purpose** – Create a detailed budget baseline and cost tracking structure, including invoice schedule and earned value metrics, based on the resource plan and schedule.

<context>
  Enumerations: cost_type ∈ {Labour_PwC, Labour_Client, Labour_Alliance_Partner, Labour_Third_Party, Travel_and_Accommodation, Technology_and_Software, Training, Printing_and_Production, Contingency, Other}; confidence_level ∈ {High, Medium, Low, TBC}; reimbursable ∈ {Yes, No}; fixed_or_variable ∈ {Fixed, Variable}; invoice_status ∈ {Draft, Sent, Paid, Cancelled, Overdue}; yes_no ∈ {Yes, No}. Use AUD currency; ISO 8601 dates; person_days as defined earlier.
</context>
<instructions>
1. Load \`P2_1_CANONICAL_HANDOFF\` and \`P2_2_CANONICAL_HANDOFF\`. If resource data or schedule data is missing, output \`P2_3_VALIDATION_ERRORS\` JSON and stop. For each resource, compute baseline cost = total_effort_days × daily_rate. Categorise costs by phase_or_workstream and cost_type.
2. Build a **Budget_Baseline** sheet: budget_line_id (BL-001…), cost_item_description, phase_or_workstream, cost_type, resource_role, seniority_level, effort_days, daily_rate, baseline_amount (formula: effort × rate), confidence_level, reimbursable, fixed_or_variable, notes. Include a totals row at the bottom. Apply dropdown validation on cost_type, confidence_level, reimbursable and fixed_or_variable. Apply conditional formatting: confidence_level=Low highlighted amber; Contingency rows highlighted light blue.
3. Build a **Cost_Tracker** sheet to record actual costs by period: record_id, date, description, resource_role, cost_type, planned_amount, actual_amount, variance_amount (formula: actual − planned), variance_percent (formula: IFERROR(variance/planned, 0)), status. Pre-populate one instructional placeholder row. Apply conditional formatting: negative variance highlighted green; positive variance >10% highlighted red.
4. Build a **Monthly_Profile** sheet summarising planned and actual costs per month: month, planned_labour_cost, planned_non_labour_cost, actual_labour_cost, actual_non_labour_cost, cumulative_planned, cumulative_actual, cost_variance, variance_percent, status. Populate the planned columns from the baseline data; leave actual columns as zero for initial baseline. Apply conditional formatting: variance_percent >10% highlighted red.
5. Build an **Invoice_Schedule** sheet: invoice_id (INV-001…), description, billing_period_or_milestone, invoice_type (Progress, Milestone, Retainer, Final), planned_invoice_date, amount_excl_gst, gst_amount (formula: amount × 0.10), total_amount (formula: excl + gst), invoice_status, invoice_number, date_sent, date_paid, outstanding_days, notes. Apply dropdown validation on invoice_type and invoice_status. Apply conditional formatting: invoice_status=Overdue highlighted red.
6. Build an **Earned_Value_Metrics** sheet: period_start, period_end, planned_value (PV), earned_value (EV), actual_cost (AC), schedule_variance (SV = EV − PV), cost_variance (CV = EV − AC), SPI (IFERROR(EV/PV, 0)), CPI (IFERROR(EV/AC, 0)), EAC (IFERROR(total_budget / CPI, 0)), VAC (total_budget − EAC), TCPI (IFERROR((total_budget − EV)/(total_budget − AC), 0)). Wrap all division formulas in IFERROR to handle blank or zero denominators. Pre-populate the first period with baseline values; subsequent periods left blank for tracking. Apply conditional formatting: SPI or CPI <1.0 highlighted red; >1.0 highlighted green.
7. Apply consistent formatting to all sheets: freeze header rows; enable auto-filters; set column widths to fit content (minimum 14 characters); set tab colours (orange for Budget_Baseline and Monthly_Profile, grey for Cost_Tracker). Use the table style from <context>.
8. Use a single code interpreter call with pandas and openpyxl to assemble \`P2_3_Budget_Baseline.xlsx\` with these sheets.
9. Create \`P2_3_CANONICAL_HANDOFF\` JSON summarising baseline totals, cost categories, invoice schedule and a link to the workbook.
10. Output only the JSON and workbook link.
</instructions>`
  },

  "risk_register.json": {
    prompt_id: "P2.4",
    prompt_name: "Risk Register",
    artifact: "P2_4_RISK_REGISTER",
    instruction:
      `**Role & purpose** – Develop a comprehensive risk register with heat map visualisation.

<context>
  Enumerations: risk_category ∈ {Strategic, Financial, Operational, Schedule, Resource, Technology, Regulatory_and_Compliance, Stakeholder, Scope, Quality, Third_Party, Cyber_and_Security, People, Environmental_and_ESG, Other}; likelihood_level ∈ {High=3, Medium=2, Low=1}; impact_level ∈ {High=3, Medium=2, Low=1}; risk_rating mapping: 9=Critical, 6=High, 3–4=Medium, 1–2=Low; risk_response_strategy ∈ {Avoid, Mitigate, Transfer, Accept}; risk_status ∈ {Open, Mitigated, Accepted, Closed, Transferred, Eventuated}; yes_no ∈ {Yes, No}. Unknown values become "TBC".
</context>
<instructions>
1. Load \`P1_3_CANONICAL_HANDOFF\`, \`P1_4_CANONICAL_HANDOFF\` and other available upstream handoffs. If client_name or engagement_name is missing, output \`P2_4_VALIDATION_ERRORS\` JSON and stop. Identify potential risks from: scope assumptions and constraints, regulatory obligations, schedule pressure, resource gaps, technology complexity and stakeholder sensitivities.
2. Generate a comprehensive risk set. Extract risks explicitly stated in upstream handoffs (mark source: Upstream). Then infer realistic risks based on engagement context — industry, methodology, complexity, regulatory profile (mark source: Inferred). Minimum risk count: small engagements (<6 months) = 10–15 risks; medium (6–12 months) = 15–25; large (12+ months) = 25+. Do not produce a skeleton register with only 3–5 generic risks.
3. For each risk, collect: risk_id (RSK-001…), title, risk_category, description (written as: cause → event → effect), source, owner_role, owner_organisation_type, likelihood_level, impact_level, risk_score (formula: likelihood × impact), risk_rating (9=Critical, 6=High, 3–4=Medium, 1–2=Low), risk_response_strategy, mitigation_actions (specific and actionable, not generic), contingency_plan, residual_likelihood_level, residual_impact_level, residual_score, residual_rating, risk_status (default Open), escalation_required (Yes for Critical risks), next_review_date, restricted_distribution (Yes/No), date_raised, raised_by, notes.
4. Set next_review_date based on rating: Critical = +7 days; High = +14 days; Medium = +28 days; Low = +56 days from the current date.
5. Build a **Risk_Register** sheet with all columns from step 3; compute risk_score and risk_rating via formulas. Apply dropdown validation on: risk_category, likelihood_level, impact_level, risk_response_strategy, risk_status, escalation_required, restricted_distribution. Apply conditional formatting: Critical rows with red fill (#D32F2F); High rows with orange fill (#FF9800); Medium rows with amber fill (#FFC107); Low rows with green fill (#4CAF50). Overdue next_review_date highlighted with red text.
6. Build a **Heat_Map** sheet as a visual matrix (not a flat table). Build a fixed 4×4 range: row 1 contains a blank cell then impact labels (High, Medium, Low) in columns B–D; column A rows 2–4 contains likelihood labels (High, Medium, Low). Populate each intersection cell with a COUNTIFS formula counting risks from the Risk_Register sheet matching that likelihood and impact combination. Apply colour fills to each cell based on the resulting score: 9=#D32F2F, 6=#FF9800, 3–4=#FFC107, 1–2=#4CAF50. Below the inherent grid, add a second identically structured 3×3 grid for residual ratings using residual_likelihood and residual_impact.
7. Apply consistent formatting: freeze header rows; enable auto-filters; set column widths to fit content (minimum 14 characters); set tab colours (orange for Risk_Register, grey for Heat_Map). Use the table style from <context>.
8. Use a single code interpreter call with pandas and openpyxl to produce \`P2_4_Risk_Register.xlsx\` with these sheets.
9. Prepare \`P2_4_CANONICAL_HANDOFF\` JSON summarising: total risk count, counts by rating (Critical/High/Medium/Low), top 5 risks by score, and a link to the workbook.
10. Output only the JSON and workbook link.
</instructions>`
  },

  "communications_plan.json": {
    prompt_id: "P2.5",
    prompt_name: "Communications Plan",
    artifact: "P2_5_COMMUNICATIONS_PLAN",
    instruction:
      `**Role & purpose** – Establish a communications plan specifying how and when information will be shared with different stakeholders, and produce a structured workbook and canonical handoff.

<context>
  Enumerations: communication_type ∈ {Report, Meeting, Workshop, Training, Update, Newsletter, Ad_Hoc, Other}; frequency ∈ {Daily, Weekly, Fortnightly, Monthly, Quarterly, Annually, As_Needed}; preferred_channel ∈ {Email, Phone, Video_Conference, In_Person, Instant_Message}; audience_type ∈ {Sponsor, Steering_Committee, Team, Stakeholders, Regulators, Vendors, Clients, Public, Other}; sensitivity_level ∈ {Public, Internal, Confidential, Secret}; yes_no ∈ {Yes, No}. Table style as per global guidelines.
</context>
<instructions>
1. Load \`P1_2_CANONICAL_HANDOFF\` and \`P1_5_CANONICAL_HANDOFF\`. If stakeholder data or governance bodies are missing, output \`P2_5_VALIDATION_ERRORS\` JSON and stop. Group stakeholders into audience groups based on organisation_type and engagement_role.
2. Derive communication activities from the governance framework: each governance body meeting implies preparation, agenda distribution and minutes distribution. Additionally, create communications for: weekly team status update, steering committee pack, working group stand-ups, RAID review forum, and deliverable sign-off notifications. If the governance cadence is sparse, infer standard communications for the engagement type and flag as source: Inferred.
3. Build an **Audience_Groups** sheet: audience_name, audience_type, stakeholder_type, engagement_strategy, key_communication_needs, preferred_channel, sensitivity_level. Include at minimum groups for: Executive Sponsors, Steering Committee, Delivery Team, Broader Stakeholders, and External/Regulatory (if applicable). Apply dropdown validation on audience_type, engagement_strategy, preferred_channel and sensitivity_level.
4. Build a **Communications_Matrix** sheet: comm_id (COM-001…), communication_title, communication_type, purpose, primary_audience_group, engagement_strategy, frequency, channel, format (PDF, Slide, Email, Dashboard), owner_role, approver_role, next_due_date, last_sent_date, status (Planned, Prepared, Sent, Overdue, Cancelled), sensitive (Yes/No), approval_required (Yes/No), linked_governance_body, phase_or_workstream, notes. Apply dropdown validation on communication_type, frequency, channel, status, sensitive and approval_required. Apply conditional formatting: status=Overdue highlighted red; sensitive=Yes rows with bold left border; next_due_date in past highlighted amber.
5. Build a **Message_Library** sheet: template_id (TPL-001…), template_name, communication_type, audience_group, purpose, key_messages (concise bullets), tone (Formal, Semi-formal, Informal, Urgent, Sensitive), status (Draft, Approved, Deprecated), approved_by, last_updated, notes. Populate templates for the key communications identified in the matrix (e.g., Status Report Template, Steering Committee Pack Template, Escalation Notice Template). Apply dropdown validation on communication_type, tone and status.
6. Apply consistent formatting to all sheets: freeze header rows; enable auto-filters; set column widths to fit content (minimum 14 characters); set tab colours (orange for Communications_Matrix, grey for Message_Library). Use the table style from <context>.
7. Use a single code interpreter call with pandas and openpyxl to generate \`P2_5_Communications_Plan.xlsx\` with these sheets.
8. Output \`P2_5_CANONICAL_HANDOFF\` JSON summarising audience groups, communications count by type and frequency, and a link to the workbook.
</instructions>`
  },

  "quality_plan.json": {
    prompt_id: "P2.6",
    prompt_name: "Quality Plan",
    artifact: "P2_6_QUALITY_PLAN",
    instruction:
      `**Role & purpose** – Define the quality assurance and control plan, including review schedules and quality gates, and produce a workbook and canonical handoff.

<context>
  Enumerations: deliverable_type ∈ {Charter, Governance_Framework, WBS_Schedule, Resource_Plan, Budget_Baseline, Risk_Register, Communications_Plan, Quality_Plan, PMO_Playbook, Other}; review_status ∈ {Not_Yet_Due, Pending_Review, Passed, Failed, Blocked, Waived}; criteria_met ∈ {All_Met, Partially_Met, Not_Met}; yes_no ∈ {Yes, No}. Unknown fields default to "TBC".
</context>
<instructions>
1. Load \`P2_1_CANONICAL_HANDOFF\`, \`P2_2_CANONICAL_HANDOFF\` and \`P1_5_CANONICAL_HANDOFF\`. If deliverable data is missing, output \`P2_6_VALIDATION_ERRORS\` JSON and stop. Compile the list of deliverables and determine who will author, review and approve each one.
2. Apply default review turnaround standards (use these unless upstream specifies otherwise; record as assumptions): internal peer review = 3 business days; internal QA review = 3 business days; client review = 5 business days; approval = 2 business days. Use these to calculate review_due_date and approval_due_date from the deliverable planned_end_date working backwards. To subtract business days, use a simple loop that skips Saturdays and Sundays, or use numpy.busday_offset if available.
3. Build a **Review_Schedule** sheet with columns: deliverable_id, deliverable_name, phase_or_workstream, deliverable_type, author_role, peer_reviewer_role, internal_qa_reviewer_role, client_reviewer_role, approver_role, review_due_date, client_review_due_date, approval_due_date, review_status, signoff_required (Yes/No), signoff_status, linked_gate_id, notes. Populate reviewer roles from the resource plan where known; set to "TBC" where unknown and add an open item. Apply dropdown validation on deliverable_type, review_status, signoff_required and signoff_status. Apply conditional formatting: review_status=Failed or Blocked highlighted red; signoff_status=Overdue highlighted amber.
4. Build a **Quality_Gates** sheet: gate_id (QG-001…), gate_name, phase_boundary, gate_description, criteria (what must be true to pass), approver_role, target_date, actual_date, gate_status, criteria_met, outstanding_criteria, waiver_reason, waiver_approved_by, notes. Create one gate per phase boundary or major milestone from the schedule. Apply dropdown validation on gate_status and criteria_met. Apply conditional formatting: gate_status=Failed highlighted red; criteria_met=Not_Met highlighted amber.
5. Apply consistent formatting to all sheets: freeze header rows; enable auto-filters; set column widths to fit content (minimum 14 characters); set tab colours (orange for Review_Schedule, grey for Quality_Gates). Use the table style from <context>.
6. Use a single code interpreter call with pandas and openpyxl to assemble \`P2_6_Quality_Plan.xlsx\` with the Review_Schedule and Quality_Gates sheets.
7. Prepare \`P2_6_CANONICAL_HANDOFF\` JSON summarising review turnaround standards, deliverable count, quality gate count, and a link to the workbook.
8. Output only the JSON and workbook link.
</instructions>`
  },

  "pmo_playbook.json": {
    prompt_id: "P2.8",
    prompt_name: "PMO Playbook",
    artifact: "P2_8_PMO_PLAYBOOK",
    instruction:
      `**Role & purpose** – Consolidate all prior handoffs and deliverables into a master PMO Playbook comprising a PowerPoint presentation and a Master Tracker workbook.

<context>
  Use the global style rules for PowerPoint: 16:9 slides; title slides with orange background and white text; content slides with white background, orange accents and Arial headings; limit to five bullet points per slide; use tables formatted with orange headers and grey horizontal lines; embed charts generated in code where appropriate. Use the colours from SS 1 for RAG indicators (Green, Amber, Red, Blue, Grey). The Master Tracker workbook should follow Excel styling guidelines.
</context>
<instructions>
1. Load all canonical handoffs from \`P1_1\` through \`P2_6\`. If any critical handoff is missing (P1_1 client/engagement identifiers or P2_1 schedule), note the gap on a "Data Gaps" slide rather than stopping entirely. Extract key summaries from each upstream handoff: engagement overview, stakeholder matrix, scope and objectives, charter highlights, governance bodies, WBS hierarchy and schedule milestones, resource summary, budget baseline, risk heat map and key risks, communications plan, and quality gates and review status.
2. Use Python to create a PowerPoint presentation (\`P2_8_PMO_Playbook.pptx\`) using python-pptx. Apply 16:9 slide format throughout. Limit to 5 bullet points per slide and 6 table rows per slide (split across slides if more rows are needed). Add "PwC Private and Confidential" footer on every slide. Structure the slides as follows:
   **Slide 1 — Title:** "PMO Playbook" | client name | engagement name | date | version v1.0 | Draft.
   **Slide 2 — Executive Summary:** Key metrics table (budget, duration, team size, risk count) | overall status narrative (2–3 sentences) | top 3 priorities.
   **Slide 3 — Engagement Overview:** Methodology | dates | budget | fee structure | primary workstreams | engagement description summary.
   **Slide 4 — Stakeholder Matrix:** Influence–interest summary table showing stakeholder counts per quadrant | key stakeholders listed by name and role.
   **Slide 5 — Scope & Objectives:** Boundary statement | top inclusions and exclusions table (max 6 rows) | objectives count by type.
   **Slide 6 — Charter Highlights:** Key decisions table | commercial terms summary | delivery approach.
   **Slide 7 — Governance Framework:** Governance bodies table (body | purpose | chair | frequency) | escalation path summary.
   **Slide 8 — WBS & Schedule Summary:** Phase summary table | key milestones table (milestone | date | status) | critical path narrative.
   **Slide 9 — Resource Plan:** Allocation summary table (role | seniority | org | effort | FTE) | seniority breakdown | team size by workstream.
   **Slide 10 — Budget Baseline:** Cost breakdown table by phase/workstream | total baseline | contingency allocation | fee structure summary.
   **Slide 11 — Risk Summary:** Risk count by rating (Critical/High/Medium/Low) | heat map table (3×3 with counts and colour fills) | top 5 risks table (risk | rating | owner | mitigation).
   **Slide 12 — Communications Plan:** Audience groups summary | key communications table (title | audience | frequency | channel) | reporting cadence.
   **Slide 13 — Quality Plan:** Review schedule summary (deliverables count by status) | quality gates table (gate | target date | status).
   **Slide 14 — Next Steps & Open Items:** Consolidated open items table (item | owner | priority | due date) from all upstream handoffs | immediate next actions.
   Add additional slides only if content warrants it (e.g., a separate slide per workstream if there are 4+ workstreams). Do not exceed 25 slides total.
3. Style every slide consistently: title slide uses orange (#FD5108) background with white text; content slides use white background with orange accent headings; tables use orange header rows with white text and grey horizontal lines; use Arial font with PowerPoint heading styles throughout. Add presenter notes to each content slide summarising the key talking points.
4. Use a single code interpreter call with python-pptx to create the presentation file.
5. Output the download link for the PPTX and a brief closing message confirming the playbook has been generated.
</instructions>`
  }
};
function toggleFreeText(btn, dropdownId, freeTextId) {
  const dropdown = document.getElementById(dropdownId);
  const freeText = document.getElementById(freeTextId);
  const isDropdown =
    freeText.style.display === "none" || freeText.style.display === "";
  if (isDropdown) {
    dropdown.style.display = "none";
    freeText.style.display = "block";
    btn.textContent = "Use dropdown";
  } else {
    dropdown.style.display = "block";
    freeText.style.display = "none";
    btn.textContent = "Enter manually";
  }
}
function toggleBtn(dropId, freeId) {
  return `<button class="btn-toggle-input" onclick="toggleFreeText(this,'${dropId}','${freeId}')">Enter manually</button>`;
}
function toggleCheckCascadeById(cascadeId, gridId) {
  const cascade = document.getElementById(cascadeId);
  if (!cascade) return;
  cascade.classList.remove("visible");
  const cci = cascade.parentElement;
  if (cci) {
    const chip = cci.querySelector(".check-item");
    if (chip) chip.classList.remove("selected");
  }
  if (typeof updateBriefStrength === "function") updateBriefStrength();
}
function toggleCheckCascade(el, cascadeId) {
  el.classList.toggle("selected");
  const cb = el.querySelector('input[type="checkbox"]');
  if (cb) cb.checked = el.classList.contains("selected");
  const cascade = document.getElementById(cascadeId);
  if (cascade)
    cascade.classList.toggle("visible", el.classList.contains("selected"));
}
function toggleCheckOnly(el) {
  el.classList.toggle("selected");
  const cb = el.querySelector('input[type="checkbox"]');
  if (cb) cb.checked = el.classList.contains("selected");
}
function getVal(dropId, freeId) {
  const drop = document.getElementById(dropId);
  const free = document.getElementById(freeId);
  if (!drop || !free) return "";
  return free.style.display === "block" ? free.value : drop.value;
}

function showError(msg) {
  var de = document.getElementById("dataError");
  if (de) de.textContent = msg;
  if (typeof showToast === "function") showToast(msg, "error", 6000);
}

// ── LOAD ALL DATA (standalone: uses inlined data) ──
var _dataLoadError = false;
function loadAllData() {
  try {
    Object.entries(INLINED_DATA).forEach(([key, val]) => (appData[key] = val));
    // Validate required data sections are present
    var required = ["industries", "objectives", "services", "technologies", "partners", "regulatory", "risk", "workflow"];
    var missing = required.filter(function(k) { return !appData[k]; });
    if (missing.length > 0) {
      _dataLoadError = true;
      showError("Incomplete data — missing: " + missing.join(", ") + ". Some features may not work.");
      return;
    }
  } catch (e) {
    _dataLoadError = true;
    showError("Failed to load application data. Please refresh the page.");
    return;
  }
  _dataLoadError = false;
  var _de = document.getElementById("dataError");
  if (_de) _de.innerHTML = "";
  renderAll();
  ["clientName", "engagementName"].forEach(function (fieldId) {
    const field = document.getElementById(fieldId);
    if (!field) return;
    field.addEventListener("input", function () {
      if ((field.value || "").trim()) {
        setFieldError(fieldId, "");
      }
    });
  });
  setTimeout(function () {
    initAutoSave();
    checkForDraft();
    updateAllSectionDots();
    if (typeof updateBriefStrength === "function") updateBriefStrength();
  }, 500);
}

// ── RENDER ALL SECTIONS ──

// ════════════════════════════════════════
// FORM BUILDER — NEW RENDER FUNCTIONS
// ════════════════════════════════════════

// ── Scroll to section & update active nav ──

// ── Highlight active nav on scroll ──

// ── Nav dot + section dot update ──

// ── Shared tab/pill helpers ──
function setActiveTab(containerId, el) {
  document.querySelectorAll("#" + containerId + " .fb-tab-item").forEach(function (t) {
    t.classList.remove("active");
  });
  el.classList.add("active");
}
function setActivePill(containerId, el) {
  document.querySelectorAll("#" + containerId + " .fb-pill").forEach(function (p) {
    p.classList.remove("selected");
  });
  el.classList.add("selected");
}
function updateTabDot(tab, hasVal) {
  tab.classList.toggle("has-data", hasVal);
  tab.querySelector(".fb-tab-dot").style.background = hasVal ? "#22c55e" : "";
}

// ── Utility: convert arbitrary text to a safe, lowercase, hyphenated ID ──
// Many parts of the form builder need to generate stable element IDs from
// user provided strings (e.g. objective types, domain names, categories).
// The original code called `slugify()` but never defined it, leading to
// ReferenceError at runtime.  This implementation converts a string to
// lowercase, replaces any sequence of non alphanumeric characters with a single
// hyphen and trims leading/trailing hyphens.  Example: "Business Problem"
// becomes "business-problem".
function slugify(text) {
  return (text || "")
    .toString()
    .trim()
    .toLowerCase()
    .replace(/[^a-z0-9]+/g, "-")
    .replace(/^-+|-+$/g, "");
}

// ════ S2: INDUSTRY ════
function renderIndustry() {
  var data = appData.industries.industries;
  var pills = document.getElementById("industryPills");
  if (!pills) return;
  pills.innerHTML = data
    .map(function (ind) {
      return (
        '<span class="fb-pill" onclick="fbSelectIndustry(this,\'' +
        ind.industry.replace(/'/g, "\\'") +
        "')\">" +
        ind.industry +
        "</span>"
      );
    })
    .join("");
  // keep hidden drops for compileForm() compatibility
  var drop = document.getElementById("industryDrop");
  if (!drop) {
    var h = document.createElement("div");
    h.style.display = "none";
    h.innerHTML =
      '<select id="industryDrop"></select><select id="sectorDrop"></select><select id="subsectorDrop"></select>';
    document.getElementById("fb-s2").appendChild(h);
  }
  data.forEach(function (ind) {
    var opt = document.createElement("option");
    opt.value = ind.industry;
    opt.textContent = ind.industry;
    document.getElementById("industryDrop").appendChild(opt);
  });
}

function fbSelectIndustry(el, val) {
  setActivePill("industryPills", el);
  document.getElementById("industryDrop").value = val;
  // Populate sectors
  var ind = appData.industries.industries.find(function (i) {
    return i.industry === val;
  });
  var sp = document.getElementById("sectorPills");
  sp.innerHTML = ind.sectors
    .map(function (s) {
      return (
        '<span class="fb-pill" onclick="fbSelectSector(this,\'' +
        s.sector.replace(/'/g, "\\'") +
        "')\">" +
        s.sector +
        "</span>"
      );
    })
    .join("");
  document.getElementById("sectorDrop").innerHTML =
    '<option value="">Select sector...</option>' +
    ind.sectors
      .map(function (s) {
        return '<option value="' + s.sector + '">' + s.sector + "</option>";
      })
      .join("");
  document.getElementById("trail-sector").classList.add("ready");
  document.getElementById("trail-sector").classList.remove("fb-trail-dimmed");
  document.getElementById("subsectorPills").innerHTML =
    '<span class="fb-trail-placeholder">Select a sector first</span>';
  document.getElementById("trail-subsector").classList.remove("ready");
  document.getElementById("trail-subsector").classList.add("fb-trail-dimmed");
  fbFieldChange("s2");
}

function fbSelectSector(el, val) {
  setActivePill("sectorPills", el);
  document.getElementById("sectorDrop").value = val;
  var indVal = document.getElementById("industryDrop").value;
  var ind = appData.industries.industries.find(function (i) {
    return i.industry === indVal;
  });
  var sec =
    ind &&
    ind.sectors.find(function (s) {
      return s.sector === val;
    });
  var ssp = document.getElementById("subsectorPills");
  if (sec) {
    ssp.innerHTML = sec.sub_sectors
      .map(function (sub) {
        return (
          '<span class="fb-pill" onclick="fbSelectSubsector(this,\'' +
          sub.replace(/'/g, "\\'") +
          "')\">" +
          sub +
          "</span>"
        );
      })
      .join("");
    document.getElementById("subsectorDrop").innerHTML =
      '<option value="">Select sub-sector...</option>' +
      sec.sub_sectors
        .map(function (sub) {
          return '<option value="' + sub + '">' + sub + "</option>";
        })
        .join("");
    document.getElementById("trail-subsector").classList.add("ready");
    document
      .getElementById("trail-subsector")
      .classList.remove("fb-trail-dimmed");
  }
  fbFieldChange("s2");
}

function fbSelectSubsector(el, val) {
  setActivePill("subsectorPills", el);
  document.getElementById("subsectorDrop").value = val;
  fbFieldChange("s2");
}

// ════ S3: OBJECTIVES ════
function renderObjectives() {
  var data = appData.objectives.engagement_objectives.objective_types;
  var list = document.getElementById("objTypeList");
  if (!list) return;
  list.innerHTML = data
    .map(function (ot, i) {
      return (
        '<div class="fb-tab-item" onclick="fbSelectObjType(this,\'' +
        ot.objective_type.replace(/'/g, "\\'") +
        "')\">" +
        ot.objective_type +
        '<span class="fb-tab-dot"></span></div>'
      );
    })
    .join("");
}

function fbSelectObjType(el, typeName) {
  _fssSaveObj();
  setActiveTab("objTypeList", el);
  var data = appData.objectives.engagement_objectives.objective_types;
  var objType = data.find(function (o) {
    return o.objective_type === typeName;
  });
  if (!objType) return;
  var panel = document.getElementById("objThemePanel");
  var typeId = slugify(typeName);
  var rows = objType.themes
    .map(function (theme) {
      var tid = typeId + "-" + slugify(theme.theme);
      var opts =
        '<option value="">Select if applicable\u2026</option>' +
        theme.specific_objectives
          .filter(function (o) {
            return o && o !== "N/A";
          })
          .map(function (o) {
            return '<option value="' + o + '">' + o + "</option>";
          })
          .join("");
      return (
        '<div class="fb-theme-row">' +
        '<span class="fb-theme-name">' +
        theme.theme +
        "</span>" +
        '<div style="position:relative;">' +
        '<select id="obj-drop-' +
        tid +
        '" onchange="fbObjChange(\'' +
        typeId +
        "')\">" +
        opts +
        "</select>" +
        '<input type="text" id="obj-free-' +
        tid +
        '" style="display:none;" placeholder="Enter ' +
        theme.theme +
        ' objective...">' +
        "</div>" +
        '<button class="fb-manual-btn" onclick="fbToggleManual(\'obj-drop-' +
        tid +
        "','obj-free-" +
        tid +
        "',this)\">Manual</button>" +
        "</div>"
      );
    })
    .join("");
  panel.innerHTML =
    '<div class="fb-section-hint">Select a specific objective for each relevant theme</div>' +
    '<div class="fb-theme-table">' +
    rows +
    "</div>" +
    '<div class="fb-obj-context">' +
    '<div class="fb-label" style="margin-bottom:6px;">Additional Context</div>' +
    '<textarea id="obj-context-' +
    typeId +
    '" style="width:100%;padding:8px;border:1px solid var(--borderColor);border-radius:3px;font-size:13px;font-family:system-ui;min-height:64px;" placeholder="Any additional context for ' +
    typeName +
    '..." onchange="fbFieldChange(\'s3\')"></textarea>' +
    "</div>";
  _fssApplyObj(typeId);
}

function fbObjChange(typeId) {
  fbFieldChange("s3");
  fbEvalObjDot(typeId);
}
function fbEvalObjDot(typeId) {
  var tab = document.querySelector("#objTypeList .fb-tab-item.active");
  if (!tab) return;
  var filled = document.querySelectorAll('[id^="obj-drop-' + typeId + '"]');
  var hasVal = Array.from(filled).some(function (s) {
    return s.value;
  });
  updateTabDot(tab, hasVal);
  fbEvalDots();
}

function fbToggleManual(dropId, freeId, btn) {
  var drop = document.getElementById(dropId);
  var free = document.getElementById(freeId);
  if (!drop || !free) return;
  var isManual = free.style.display !== "none";
  drop.style.display = isManual ? "" : "none";
  free.style.display = isManual ? "none" : "";
  btn.textContent = isManual ? "Manual" : "Select";
}

// ════ S4: SERVICES ════
function renderServices() {
  var data = appData.services.domains;
  var list = document.getElementById("domainTabList");
  if (!list) return;
  list.innerHTML = data
    .map(function (d) {
      return (
        '<div class="fb-tab-item" onclick="fbSelectDomain(this,\'' +
        d.domain.replace(/'/g, "\\'") +
        "')\">" +
        d.domain +
        '<span class="fb-tab-dot"></span></div>'
      );
    })
    .join("");
}

function fbSelectDomain(el, domainName) {
  _fssSaveServices();
  setActiveTab("domainTabList", el);
  var data = appData.services.domains;
  var domain = data.find(function (d) {
    return d.domain === domainName;
  });
  if (!domain) return;
  var domId = slugify(domainName);
  var panel = document.getElementById("domainBlockPanel");
  var blocks = domain.building_blocks
    .map(function (bb) {
      var bbId = "bb-" + domId + "-" + slugify(bb.building_block);
      var descId = "bb-desc-" + bbId;
      var editId = "bb-edit-" + bbId;
      var shortDesc =
        bb.description.substring(0, 120) +
        (bb.description.length > 120 ? "…" : "");
      return (
        '<div class="fb-bb-item" id="' +
        bbId +
        '">' +
        "<div class=\"fb-bb-check\" onclick=\"fbToggleBB(this.closest('.fb-bb-item'),'" +
        domId +
        "')\">✓</div>" +
        '<div style="flex:1;min-width:0;">' +
        '<div style="display:flex;align-items:flex-start;gap:8px;">' +
        '<div class="fb-bb-name" style="flex:1;cursor:pointer;" onclick="fbToggleBB(this.closest(\'.fb-bb-item\'),\'' +
        domId +
        "')\">" +
        bb.building_block +
        "</div>" +
        '<button class="fb-bb-edit-btn" onclick="fbBBToggleEdit(\'' +
        descId +
        "','" +
        editId +
        '\',this)" id="' +
        editId +
        '">Edit</button>' +
        "</div>" +
        '<div class="fb-bb-desc fb-bb-tooltip" data-tip="' +
        bb.description.replace(/"/g, "&quot;") +
        '" id="' +
        descId +
        '-short" style="cursor:pointer;" onclick="fbToggleBB(this.closest(\'.fb-bb-item\'),\'' +
        domId +
        "')\">" +
        shortDesc +
        "</div>" +
        '<textarea class="fb-bb-desc-textarea" id="' +
        descId +
        '" style="display:none;" onchange="fbFieldChange(\'s4\')" placeholder="Edit description...">' +
        bb.description +
        "</textarea>" +
        "</div>" +
        "</div>"
      );
    })
    .join("");
  panel.innerHTML =
    '<div class="fb-bb-grid">' +
    blocks +
    "</div>" +
    '<div style="margin-top:14px;">' +
    '<div class="fb-label" style="margin-bottom:6px;">Additional Notes</div>' +
    '<textarea id="svc-notes-' +
    domId +
    '" style="width:100%;padding:8px;border:1px solid var(--borderColor);border-radius:3px;font-size:13px;font-family:system-ui;min-height:60px;" placeholder="Additional context for ' +
    domainName +
    '..." onchange="fbFieldChange(\'s4\')"></textarea>' +
    "</div>";
  _fssApplyServices(domId);
}

function fbBBToggleEdit(descId, editBtnId, btn) {
  var shortEl = document.getElementById(descId + "-short");
  var editEl = document.getElementById(descId);
  if (!shortEl || !editEl) return;
  var isEditing = editEl.style.display !== "none";
  if (isEditing) {
    shortEl.setAttribute("data-tip", editEl.value);
    var short =
      editEl.value.substring(0, 120) + (editEl.value.length > 120 ? "…" : "");
    shortEl.textContent = short;
    shortEl.style.display = "";
    editEl.style.display = "none";
    btn.textContent = "Edit";
  } else {
    shortEl.style.display = "none";
    editEl.style.display = "";
    editEl.focus();
    btn.textContent = "Done";
  }
}

function fbToggleBB(el, domId) {
  el.classList.toggle("selected");
  var tab = document.querySelector("#domainTabList .fb-tab-item.active");
  if (tab) {
    var hasAny =
      document.querySelectorAll("#domainBlockPanel .fb-bb-item.selected")
        .length > 0;
    updateTabDot(tab, hasAny);
  }
  fbEvalDots();
}

// ════ S5: TECHNOLOGY ════
function renderTechnologies() {
  var data = appData.technologies.technology_and_tools.categories;
  var list = document.getElementById("techCatList");
  if (!list) return;
  list.innerHTML = data
    .map(function (cat) {
      return (
        '<div class="fb-tab-item" onclick="fbSelectTechCat(this,\'' +
        cat.category.replace(/'/g, "\\'") +
        "')\">" +
        cat.category +
        '<span class="fb-tab-dot"></span></div>'
      );
    })
    .join("");
}

function fbSelectTechCat(el, catName) {
  _fssSaveTech();
  setActiveTab("techCatList", el);
  var data = appData.technologies.technology_and_tools.categories;
  var cat = data.find(function (c) {
    return c.category === catName;
  });
  if (!cat) return;
  var catId = slugify(catName);
  var panel = document.getElementById("techDetailPanel");
  var subChips = cat.sub_categories
    .map(function (sub) {
      var subId = catId + "-" + slugify(sub.sub_category);
      return (
        '<span class="fb-chip" id="sub-' +
        subId +
        '" onclick="fbToggleTechSub(this,\'' +
        catId +
        "','" +
        sub.sub_category.replace(/'/g, "\\'") +
        "')\">" +
        sub.sub_category +
        "</span>"
      );
    })
    .join("");
  panel.innerHTML =
    '<div class="fb-detail-label">Sub-categories</div>' +
    '<div class="fb-chip-grid" id="tech-subs-' +
    catId +
    '">' +
    subChips +
    "</div>" +
    '<div id="tech-prods-' +
    catId +
    '"></div>' +
    '<div style="margin-top:14px;">' +
    '<div class="fb-label" style="margin-bottom:6px;">Additional Notes</div>' +
    '<textarea id="tech-notes-' +
    catId +
    '" style="width:100%;padding:8px;border:1px solid var(--borderColor);border-radius:3px;font-size:13px;font-family:system-ui;min-height:60px;" placeholder="Additional context..." onchange="fbFieldChange(\'s5\')"></textarea>' +
    "</div>";
  _fssApplyTech(slugify(catName));
}

function fbToggleTechSub(el, catId, subName) {
  el.classList.toggle("selected");
  var cat = appData.technologies.technology_and_tools.categories.find(
    function (c) {
      return slugify(c.category) === catId;
    },
  );
  var sub =
    cat &&
    cat.sub_categories.find(function (s) {
      return s.sub_category === subName;
    });
  var prodsDiv = document.getElementById("tech-prods-" + catId);
  // Rebuild all products for all selected subs
  if (prodsDiv && cat) {
    var selectedSubs = Array.from(
      document.querySelectorAll("#tech-subs-" + catId + " .fb-chip.selected"),
    ).map(function (c) {
      return c.textContent.trim();
    });
    if (selectedSubs.length === 0) {
      prodsDiv.innerHTML = "";
      return;
    }
    var html =
      '<div class="fb-detail-label">Products</div><div class="fb-chip-grid" id="tech-prod-chips-' +
      catId +
      '">';
    selectedSubs.forEach(function (sn) {
      var s = cat.sub_categories.find(function (x) {
        return x.sub_category === sn;
      });
      if (s && (s.products || s.options))
        (s.products || s.options).forEach(function (p) {
          html +=
            '<span class="fb-chip" onclick="this.classList.toggle(\'selected\');fbEvalDots();">' +
            p +
            "</span>";
        });
    });
    html += "</div>";
    prodsDiv.innerHTML = html;
  }
  // Update tab dot
  var tab = document.querySelector("#techCatList .fb-tab-item.active");
  if (tab) {
    var hasSel =
      document.querySelectorAll("#tech-subs-" + catId + " .fb-chip.selected")
        .length > 0;
    updateTabDot(tab, hasSel);
  }
  fbEvalDots();
}

// ════ S6: PARTNERS ════
function renderPartners() {
  var data = appData.partners.alliance_partners.partners;
  var list = document.getElementById("partnerTabList");
  if (!list) return;
  list.innerHTML = data
    .map(function (p) {
      return (
        '<div class="fb-tab-item" onclick="fbSelectPartner(this,\'' +
        p.partner.replace(/'/g, "\\'") +
        "')\">" +
        p.partner +
        '<span class="fb-tab-dot"></span></div>'
      );
    })
    .join("");
}

function fbSelectPartner(el, partnerName) {
  _fssSavePartners();
  setActiveTab("partnerTabList", el);
  var data = appData.partners.alliance_partners.partners;
  var partner = data.find(function (p) {
    return p.partner === partnerName;
  });
  if (!partner) return;
  var pid = slugify(partnerName);
  var panel = document.getElementById("partnerDetailPanel");
  var famChips = partner.product_families
    .map(function (fam) {
      return (
        '<span class="fb-chip" onclick="fbTogglePartnerFam(this,\'' +
        pid +
        "','" +
        fam.product_family.replace(/'/g, "\\'") +
        "')\">" +
        fam.product_family +
        "</span>"
      );
    })
    .join("");
  panel.innerHTML =
    '<div class="fb-detail-label">Product Families</div>' +
    '<div class="fb-chip-grid" id="partner-fams-' +
    pid +
    '">' +
    famChips +
    "</div>" +
    '<div id="partner-prods-' +
    pid +
    '"></div>' +
    '<div style="margin-top:14px;">' +
    '<div class="fb-label" style="margin-bottom:6px;">Additional Notes</div>' +
    '<textarea id="partner-notes-' +
    pid +
    '" style="width:100%;padding:8px;border:1px solid var(--borderColor);border-radius:3px;font-size:13px;font-family:system-ui;min-height:60px;" placeholder="Additional context for ' +
    partnerName +
    '..." onchange="fbFieldChange(\'s6\')"></textarea>' +
    "</div>";
  _fssApplyPartners(pid);
}

function fbTogglePartnerFam(el, pid, famName) {
  el.classList.toggle("selected");
  var partner = appData.partners.alliance_partners.partners.find(function (p) {
    return slugify(p.partner) === pid;
  });
  var prodsDiv = document.getElementById("partner-prods-" + pid);
  if (prodsDiv && partner) {
    var selFams = Array.from(
      document.querySelectorAll("#partner-fams-" + pid + " .fb-chip.selected"),
    ).map(function (c) {
      return c.textContent.trim();
    });
    if (selFams.length === 0) {
      prodsDiv.innerHTML = "";
    } else {
      var html =
        '<div class="fb-detail-label">Products</div><div class="fb-chip-grid">';
      selFams.forEach(function (fn) {
        var fam = partner.product_families.find(function (f) {
          return f.product_family === fn;
        });
        if (fam && fam.products)
          fam.products.forEach(function (p) {
            html +=
              '<span class="fb-chip" onclick="this.classList.toggle(\'selected\');fbEvalDots();">' +
              p +
              "</span>";
          });
      });
      html += "</div>";
      prodsDiv.innerHTML = html;
    }
  }
  var tab = document.querySelector("#partnerTabList .fb-tab-item.active");
  if (tab) {
    var hasSel =
      document.querySelectorAll("#partner-fams-" + pid + " .fb-chip.selected")
        .length > 0;
    updateTabDot(tab, hasSel);
  }
  fbEvalDots();
}

// ════ S7: REGULATORY ════
function renderRegulatory() {
  var data = appData.regulatory.regulatory_profile.industry_groups;
  var list = document.getElementById("regGroupList");
  if (!list) return;
  list.innerHTML = data
    .map(function (g) {
      return (
        '<div class="fb-tab-item" onclick="fbSelectRegGroup(this,\'' +
        g.industry_group.replace(/'/g, "\\'") +
        "')\">" +
        g.industry_group +
        '<span class="fb-tab-dot"></span></div>'
      );
    })
    .join("");
}

function fbSelectRegGroup(el, groupName) {
  _fssSaveReg();
  setActiveTab("regGroupList", el);
  var data = appData.regulatory.regulatory_profile.industry_groups;
  var group = data.find(function (g) {
    return g.industry_group === groupName;
  });
  if (!group) return;
  var gid = slugify(groupName);
  var panel = document.getElementById("regDetailPanel");
  var items = group.regulators
    .map(function (reg) {
      var rid = gid + "-" + slugify(reg.regulator);
      var reqChips = reg.requirements
        .map(function (r) {
          return (
            '<span class="fb-chip" style="font-size:11px;" onclick="this.classList.toggle(\'selected\');fbEvalDots();">' +
            r +
            "</span>"
          );
        })
        .join("");
      return (
        '<div class="fb-check-group">' +
        '<div class="fb-check-item" onclick="fbToggleCheckItem(this,\'' +
        rid +
        "','req-wrap-','regGroupList','regDetailPanel')\">" +
        '<div class="fb-check-box">✓</div>' +
        '<span class="fb-check-name">' +
        reg.regulator +
        "</span>" +
        '<span class="fb-check-expand">▾ Requirements</span>' +
        "</div>" +
        '<div class="fb-check-reqs" id="req-wrap-' +
        rid +
        '" style="display:none;">' +
        '<div class="fb-chip-grid">' +
        reqChips +
        "</div>" +
        "</div>" +
        "</div>"
      );
    })
    .join("");
  panel.innerHTML =
    '<div class="fb-section-hint">Select applicable regulators and their requirements</div>' +
    items;
  _fssApplyReg(gid);
}

function fbToggleCheckItem(el, itemId, wrapPrefix, groupListId, detailPanelId) {
  el.classList.toggle("checked");
  el.classList.toggle("open", el.classList.contains("checked"));
  var wrap = document.getElementById(wrapPrefix + itemId);
  if (wrap) wrap.style.display = el.classList.contains("checked") ? "" : "none";
  var tab = document.querySelector("#" + groupListId + " .fb-tab-item.active");
  if (tab) {
    var hasSel =
      document.querySelectorAll("#" + detailPanelId + " .fb-check-item.checked")
        .length > 0;
    updateTabDot(tab, hasSel);
  }
  fbEvalDots();
}

// ════ S8: RISK ════
function renderRisk() {
  var data = appData.risk.risk_profile.industry_groups;
  var list = document.getElementById("riskGroupList");
  if (!list) return;
  list.innerHTML = data
    .map(function (g) {
      return (
        '<div class="fb-tab-item" onclick="fbSelectRiskGroup(this,\'' +
        g.industry_group.replace(/'/g, "\\'") +
        "')\">" +
        g.industry_group +
        '<span class="fb-tab-dot"></span></div>'
      );
    })
    .join("");
}

function fbSelectRiskGroup(el, groupName) {
  _fssSaveRisk();
  setActiveTab("riskGroupList", el);
  var data = appData.risk.risk_profile.industry_groups;
  var group = data.find(function (g) {
    return g.industry_group === groupName;
  });
  if (!group) return;
  var gid = slugify(groupName);
  var panel = document.getElementById("riskDetailPanel");
  var items = group.risk_types
    .map(function (rt) {
      var rtid = gid + "-" + slugify(rt.risk_type);
      var chips = rt.specific_risks
        .map(function (r) {
          return (
            '<span class="fb-chip" style="font-size:11px;" onclick="this.classList.toggle(\'selected\');fbEvalDots();">' +
            r +
            "</span>"
          );
        })
        .join("");
      return (
        '<div class="fb-check-group">' +
        '<div class="fb-check-item" onclick="fbToggleCheckItem(this,\'' +
        rtid +
        "','risk-wrap-','riskGroupList','riskDetailPanel')\">" +
        '<div class="fb-check-box">✓</div>' +
        '<span class="fb-check-name">' +
        rt.risk_type +
        "</span>" +
        '<span class="fb-check-expand">▾ Specific Risks</span>' +
        "</div>" +
        '<div class="fb-check-reqs" id="risk-wrap-' +
        rtid +
        '" style="display:none;">' +
        '<div class="fb-chip-grid">' +
        chips +
        "</div>" +
        "</div>" +
        "</div>"
      );
    })
    .join("");
  panel.innerHTML =
    '<div class="fb-section-hint">Select applicable risk types and specific risks</div>' +
    items;
  _fssApplyRisk(gid);
}

// ════ renderAll override ════
function renderAll() {
  renderIndustry();
  renderObjectives();
  renderServices();
  renderTechnologies();
  renderPartners();
  renderRegulatory();
  renderRisk();
  fbInitSections();
  setTimeout(fbEvalDots, 100);
}

function toggleRiskSpecifics(rtid, show) {
  const wrap = document.getElementById("risk-chips-" + rtid);
  if (wrap) wrap.style.display = show ? "flex" : "none";
}

function onRiskChange(gid, riskVal) {
  const specGrid = document.getElementById(`risk-spec-${gid}`);
  const cascade = document.getElementById(`risk-spec-cascade-${gid}`);
  if (!riskVal) {
    cascade.classList.remove("visible");
    return;
  }
  const group = appData.risk.risk_profile.industry_groups.find(
    (g) => slugify(g.industry_group) === gid,
  );
  if (!group) return;
  const rt = group.risk_types.find((r) => r.risk_type === riskVal);
  if (!rt) return;
  specGrid.innerHTML = rt.specific_risks
    .map(
      (r) =>
        `<div class="check-item" onclick="toggleCheckOnly(this)">${r}</div>`,
    )
    .join("");
  cascade.classList.add("visible");
}

// ── WORKFLOW ──
function setFieldError(fieldId, message) {
  var input = document.getElementById(fieldId);
  if (!input) return;
  // Support both old .field and new .fb-field wrappers
  var field = input.closest
    ? input.closest(".fb-field") || input.closest(".field")
    : null;
  var hasError = Boolean(message);
  if (field) field.classList.toggle("has-error", hasError);
  // New form error element
  var errEl = document.getElementById("err-" + fieldId);
  if (errEl) {
    errEl.textContent = message || "";
    errEl.style.display = hasError ? "block" : "none";
  }
  // Legacy error element
  var legacyErr = document.getElementById(fieldId + "Error");
  if (legacyErr) {
    legacyErr.textContent = message || "";
    legacyErr.style.display = hasError ? "block" : "none";
  }
}

function validateRequiredFields() {
  const required = [
    { id: "clientName", name: "Client name" },
    { id: "engagementName", name: "Engagement name" },
  ];
  let firstInvalid = null;
  let hasErrors = false;

  required.forEach(function (field) {
    const el = document.getElementById(field.id);
    const value = el && el.value ? el.value.trim() : "";
    if (!value) {
      hasErrors = true;
      if (!firstInvalid) firstInvalid = el;
      setFieldError(field.id, `${field.name} is required.`);
    } else {
      setFieldError(field.id, "");
    }
  });

  if (firstInvalid && typeof firstInvalid.focus === "function") {
    firstInvalid.focus();
  }

  if (hasErrors) {
    showToast(
      "Please complete all required fields before starting the workflow.",
      "error",
    );
  }
  return !hasErrors;
}

// #03 — count sections with meaningful data
function countFilledSections(data) {
  let count = 0;
  const ctx = data.engagement_context || {};
  if (ctx.industry || ctx.engagement_description || ctx.delivery_methodology)
    count++;
  if (
    (data.objectives || []).some(
      (o) => o.themes && o.themes.some((t) => t.specific_objective),
    )
  )
    count++;
  if (
    (data.service_offerings || []).some(
      (s) => s.building_blocks && s.building_blocks.length > 0,
    )
  )
    count++;
  if (
    (data.technology || []).some(
      (t) => t.sub_categories && t.sub_categories.length > 0,
    )
  )
    count++;
  if ((data.alliance_partners || []).length > 0) count++;
  if ((data.regulatory_profile || []).length > 0) count++;
  if ((data.risk_profile || []).length > 0) count++;
  return count;
}

function startWorkflow() {
  if (!appData || Object.keys(appData).length === 0) {
    showToast("Data is still loading — please wait a moment.", "warning");
    return;
  }
  if (!validateRequiredFields()) {
    return;
  }
  formData = compileForm();
  const filled = countFilledSections(formData);
  if (filled < 3) {
    openSparseBriefModal(filled);
    return; // modal will call confirmLaunchWorkflow() if user proceeds
  }
  openReviewPanel();
}
function confirmLaunchWorkflow() {
  closeReviewPanelDirect();
  completedSteps = new Set();
  doShowWorkflow({ skipResume: true });
}
function goBackToForm() {
  document.getElementById("formPage").classList.add("active");
  document.getElementById("workflowPage").classList.remove("active");
  document.getElementById("headerSubtitle").textContent = "Form";
}
// Consolidated workflow display: handles resume check + page transition
function doShowWorkflow(opts) {
  opts = opts || {};
  // If there is existing progress and we're not bypassing resume, offer resume vs restart
  if (!opts.skipResume && completedSteps && completedSteps.size > 0) {
    document.getElementById("resumeStepCount").textContent =
      completedSteps.size;
    document.getElementById("resumeModal").classList.add("visible");
    return;
  }
  document.getElementById("formPage").classList.remove("active");
  document.getElementById("workflowPage").classList.add("active");
  document.getElementById("headerSubtitle").textContent = "Workflow";
  var ec = (formData && formData.engagement_context) || {};
  document.getElementById("workflowTitle").textContent =
    (ec.client_name || "") + " \u2014 " + (ec.engagement_name || "");
  renderWorkflow();
  buildPhaseFilterPills();
  try {
    var tipDismissed = localStorage.getItem("pwc_workflow_tip_dismissed");
    var tipBanner = document.getElementById("workflowTipBanner");
    if (tipBanner) tipBanner.style.display = tipDismissed ? "none" : "";
  } catch (e) {}
  const mainPanel = document.querySelector(".workflow-main");
  if (mainPanel) mainPanel.scrollTop = 0;
  setTimeout(function () {
    if (mainPanel) mainPanel.scrollTop = 0;
  }, 300);
  setTimeout(function () {
    if (mainPanel) mainPanel.scrollTop = 0;
  }, 700);
  if (guidedMode && guidancePanel) {
    const firstWorkflowStep = guidanceSteps.findIndex(
      (s) => s.target === "promptCards",
    );
    if (firstWorkflowStep >= 0) {
      currentStep = firstWorkflowStep;
      setTimeout(function () {
        showGuidanceStep(currentStep);
      }, 500);
    }
  }
}
// Legacy alias
function showWorkflow() { doShowWorkflow(); }

// ── RENDER WORKFLOW ──
function renderWorkflow() {
  const sidebar = document.getElementById("workflowSidebar");
  const cards = document.getElementById("promptCards");
  const workflow = appData.workflow;
  let sidebarHTML = "",
    cardsHTML = "";
  let totalSteps = 0;
  let phaseIndex = 0;

  workflow.phases.forEach((phase) => {
    phaseIndex++;
    const phaseStepCountForBadge = phase.prompts.length;
    sidebarHTML += `<div class="sidebar-phase"><div class="sidebar-phase-label"><span>Phase ${phaseIndex} &mdash; ${phase.phase_name}</span><span class="sidebar-phase-count-badge" id="sidebar-phase-badge-${phase.phase_id}">0/${phaseStepCountForBadge}</span></div>`;

    const phaseStepCount = phase.prompts.length;
    cardsHTML += `
        <div class="phase-divider" id="phase-divider-${phase.phase_id}" data-phase-id="${phase.phase_id}">
          <div class="phase-divider-left">
            <span class="phase-divider-number">Phase ${phaseIndex}</span>
            <span class="phase-divider-name">${phase.phase_name}</span>
          </div>
          <div class="phase-divider-right">
            <span class="phase-divider-count" id="phase-count-${phase.phase_id}">0 / ${phaseStepCount} complete</span>
            <div class="phase-divider-bar-outer"><div class="phase-divider-bar-inner" id="phase-bar-${phase.phase_id}" style="width:0%"></div></div>
          </div>
        </div>`;

    phase.prompts.forEach((prompt, idx) => {
      totalSteps++;
      const isFirst = phase.phase_id === "P1" && idx === 0;
      const status = isFirst ? "active" : "locked";

      const depsList =
        prompt.depends_on && prompt.depends_on.length
          ? prompt.depends_on.join(", ")
          : null;
      const depTooltip = depsList
        ? `Requires ${depsList} to be completed first.`
        : "";

      sidebarHTML += `
          <div class="sidebar-item ${status}" id="sidebar-${prompt.prompt_id}"
            role="button" tabindex="0"
            aria-label="Go to ${prompt.prompt_name}"
            onclick="scrollToCard('${prompt.prompt_id}')"
            onkeydown="if(event.key==='Enter'||event.key===' '){scrollToCard('${prompt.prompt_id}');}">
            <div class="step-dot">${prompt.prompt_id.replace("P", "")}</div>
            ${prompt.prompt_name}
          </div>`;

      const depsHTML = prompt.depends_on
        ? prompt.depends_on
            .map((d) => `<span class="dep-tag">${d}</span>`)
            .join(" ")
        : '<span class="dep-tag">None - first step</span>';

      cardsHTML += `
          <div class="prompt-card ${isFirst ? "active-card" : "locked-card"}" id="card-${prompt.prompt_id}" data-phase="${phase.phase_id}">
            <div class="prompt-card-header" onclick="toggleCard('${prompt.prompt_id}')"
              role="button" tabindex="0" aria-expanded="false" id="header-${prompt.prompt_id}"
              onkeydown="if(event.key==='Enter'||event.key===' '){toggleCard('${prompt.prompt_id}');}">
              <div class="prompt-card-header-left">
                <span class="prompt-id">${prompt.prompt_id}</span>
                <div>
                  <div class="prompt-name">${prompt.prompt_name}</div>
                  ${!isFirst && depTooltip ? `<div class="dep-sublabel">${depTooltip}</div>` : ""}
                </div>
              </div>
              <span class="status-badge ${isFirst ? "badge-ready" : "badge-locked"}" id="badge-${prompt.prompt_id}">
                ${isFirst ? "Ready" : "Locked"}
              </span>
            </div>
            <div class="prompt-card-body" id="body-${prompt.prompt_id}">
              <div class="meta-row">
                <span class="meta-label">Uses:</span>
                ${depsHTML}<span class="meta-label">Produces:</span>
                <span class="artifact-tag">${prompt.artifact}</span>
              </div>
              ${prompt.sign_off_gate ? `<div class="stage-gate">⚠ Stage Gate — sign-off required before proceeding</div>` : ""}
              <div class="prompt-box-header">
                <span class="prompt-box-label">Prompt:</span>
                <button class="btn-expand-prompt" id="expand-btn-${prompt.prompt_id}" onclick="toggleExpandPrompt('${prompt.prompt_id}')" aria-label="Expand prompt text">&#x26F6; Expand</button>
              </div>
              <div class="prompt-text-box" id="prompt-text-${prompt.prompt_id}"></div>
              <div class="prompt-actions">
                <div class="prompt-actions-left">
                  <button class="btn-copy" id="copy-btn-${prompt.prompt_id}" onclick="copyPrompt('${prompt.prompt_id}')" aria-label="Copy prompt to clipboard">Copy Prompt</button>
                  <button class="btn-export btn-secondary-action" id="export-btn-${prompt.prompt_id}" onclick="exportPrompt('${prompt.prompt_id}')" aria-label="Export prompt as text file">Export</button>
                  <button class="btn-edit-prompt" id="edit-btn-${prompt.prompt_id}" onclick="togglePromptEdit('${prompt.prompt_id}')">Edit</button>
                </div>
                <div class="prompt-actions-divider"></div>
                <div class="prompt-actions-right">
                  <button class="btn-mark-done" id="done-btn-${prompt.prompt_id}" onclick="markDone('${prompt.prompt_id}')">✓ Mark Complete</button>
                  <button class="btn-reopen" id="reopen-btn-${prompt.prompt_id}" onclick="reopenStep('${prompt.prompt_id}')">↩ Reopen</button>
                </div>
              </div>
            </div>
          </div>`;
    });
    sidebarHTML += `</div>`;
  });

  sidebar.innerHTML = sidebarHTML;
  cards.innerHTML = cardsHTML;
  document.getElementById("card-P1.1").classList.add("open");
  document.getElementById("header-P1.1") &&
    document
      .getElementById("header-P1.1")
      .setAttribute("aria-expanded", "true");
  setTimeout(function () {
    const mainPanel = document.querySelector(".workflow-main");
    if (mainPanel) mainPanel.scrollTop = 0;
  }, 600);
  document.getElementById("progressText").textContent =
    `0 of ${totalSteps} steps complete`;
  // Update sidebar summary initial state
  var sidebarCount = document.getElementById("sidebarSummaryCount");
  if (sidebarCount) sidebarCount.textContent = "0 of " + totalSteps + " steps";
  // Restore completed steps visual state (moved here so all callers get it)
  if (completedSteps && completedSteps.size > 0) {
    completedSteps.forEach(function (id) {
      var card = document.getElementById("card-" + id);
      var badge = document.getElementById("badge-" + id);
      var si = document.getElementById("sidebar-" + id);
      if (card) {
        card.classList.remove("active-card", "locked-card");
        card.classList.add("completed-card");
      }
      if (badge) {
        badge.textContent = "Complete";
        badge.className = "status-badge badge-done";
      }
      if (si) {
        si.classList.remove("active", "locked");
        si.classList.add("completed");
      }
    });
    unlockNextSteps();
  }
  updatePhaseProgress();
  updateSidebarPhaseBadges();
  updateProgress();
  loadAllPrompts(workflow);
}

// ── LOAD PROMPTS FROM INLINED DATA ──
function loadAllPrompts(workflow) {
  for (const phase of workflow.phases) {
    for (const prompt of phase.prompts) {
      const el = document.getElementById(`prompt-text-${prompt.prompt_id}`);
      if (!el) continue;
      const json = INLINED_PROMPTS[prompt.file];
      if (!json) {
        el.textContent = `[Prompt not found: ${prompt.file}]`;
        el.style.color = "#f87171";
        continue;
      }
      const text = buildPromptText(prompt, json, formData);
      el.textContent = text;
    }
  }
}

// ── BUILD PROMPT TEXT ──
// P1.1 injects global standards + full engagement data to establish session context.
// All subsequent prompts (P1.2 onwards) receive instruction only — they reference
// the engagement data already established in session history via P1.1.
//
// AUDIT (engagement context exclusion — P1.2+):
// Confirmed: for any pid !== "P1.1", this function returns `instruction` verbatim
// without injecting any engagement context data block, regardless of whether
// {{PROMPT_DATA}} or any other placeholder is present. The engagement context
// (formData: engagement_context, industry, objectives, service_offerings, etc.)
// is never injected into P1.2+ prompts here.
//
// AUDIT (P1.2–P2.8 instruction strings):
// Confirmed: no instruction string for P1.2–P2.8 contains:
//   (a) a hardcoded engagement context JSON block (keys: engagement_context,
//       industry, objectives, service_offerings, etc. at the top level), or
//   (b) an instruction asking Claude to output/echo such a JSON block.
// All engagement_context references in P1.2+ instructions are either:
//   — sub-keys within legitimate Px_CANONICAL_HANDOFF output schemas, or
//   — prose field references used for inference guidance (not JSON output specs).

function buildPromptText(prompt, promptJson, data) {
  const instruction =
    promptJson.instruction || "[Instruction not found in prompt file]";
  const pid = prompt.prompt_id || "";

  // P1.1 — inject global standards + FULL engagement data
  if (pid === "P1.1") {
    // Guard against undefined/null in data before serialising
    var safeData = data || {};
    const briefJson = JSON.stringify(safeData, null, 2);
    var gs = typeof GLOBAL_STANDARDS !== "undefined" ? GLOBAL_STANDARDS : {};
    return instruction
      .replace("{{SS_1}}", gs.SS1 || "")
      .replace("{{DD_1}}", gs.DD1 || "")
      .replace("{{WE_1}}", gs.WE1 || "")
      .replace("{{ENGAGEMENT_DATA}}", briefJson);
  }

  // All other prompts — instruction only.
  return instruction;
}

// ── WORKFLOW CONTROLS ──
function toggleCard(id) {
  const card = document.getElementById(`card-${id}`);
  if (!card) return;
  // Locked cards can only be toggled if they have been overridden via sidebar navigation
  if (card.classList.contains("locked-card") && !card.classList.contains("sidebar-override")) return;
  card.classList.toggle("open");
  const headerEl = document.getElementById("header-" + id);
  if (headerEl)
    headerEl.setAttribute(
      "aria-expanded",
      card.classList.contains("open") ? "true" : "false",
    );
}
function scrollToCard(id) {
  const card = document.getElementById(`card-${id}`);
  if (!card) return;
  card.classList.add("open");
  // If the card is locked, add a sidebar-override so it becomes interactive
  if (card.classList.contains("locked-card")) {
    card.classList.add("sidebar-override");
  }
  // Update header aria state
  const headerEl = document.getElementById("header-" + id);
  if (headerEl) headerEl.setAttribute("aria-expanded", "true");
  setTimeout(function () {
    const mainPanel = document.querySelector(".workflow-main");
    const cardTop =
      card.getBoundingClientRect().top -
      mainPanel.getBoundingClientRect().top +
      mainPanel.scrollTop -
      120;
    mainPanel.scrollTo({ top: cardTop, behavior: "smooth" });
  }, 50);
}
function copyPrompt(id) {
  const text = document.getElementById(`prompt-text-${id}`).textContent;
  navigator.clipboard.writeText(text).then(() => {
    const btn = document.getElementById(`copy-btn-${id}`);
    btn.textContent = "✓ Copied!";
    btn.classList.add("copied");
    setTimeout(() => {
      btn.innerHTML = "Copy Prompt";
      btn.classList.remove("copied");
    }, 2000);
  });
}
function exportPrompt(id) {
  const text = document.getElementById(`prompt-text-${id}`).textContent;
  const blob = new Blob([text], { type: "text/plain" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  const clientSlug = (
    (document.getElementById("clientName") || {}).value || "Client"
  )
    .replace(/[^a-zA-Z0-9]/g, "_")
    .replace(/_+/g, "_")
    .replace(/^_|_$/g, "");
  const engSlug = (
    (document.getElementById("engagementName") || {}).value || "Engagement"
  )
    .replace(/[^a-zA-Z0-9]/g, "_")
    .replace(/_+/g, "_")
    .replace(/^_|_$/g, "");
  const promptNames = {};
  (appData.workflow || { phases: [] }).phases.forEach((ph) =>
    ph.prompts.forEach((p) => {
      promptNames[p.prompt_id] = p.prompt_name
        .replace(/[^a-zA-Z0-9]/g, "_")
        .replace(/_+/g, "_");
    }),
  );
  const pName = promptNames[id] || id;
  a.download = `${clientSlug}_${engSlug}_${id}_${pName}.txt`;
  document.body.appendChild(a);
  a.click();
  setTimeout(function () {
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
  }, 1000);
  const btn = document.getElementById(`export-btn-${id}`);
  if (btn) {
    btn.textContent = "✓ Exported!";
    setTimeout(() => {
      btn.innerHTML = "Export";
    }, 2000);
  }
}
function markDone(id) {
  let isGate = false;
  if (appData && appData.workflow) {
    appData.workflow.phases.forEach(function (ph) {
      ph.prompts.forEach(function (p) {
        if (p.prompt_id === id && p.sign_off_gate) isGate = true;
      });
    });
  }
  if (isGate) {
    _pendingGateId = id;
    document.getElementById("gateModalTitle").textContent =
      "Stage Gate Sign-Off";
    // reset checkboxes
    document
      .querySelectorAll("#gateModalChecklist input[type=checkbox]")
      .forEach(function (cb) {
        cb.checked = false;
      });
    checkGateReady();
    document.getElementById("gateModal").classList.add("visible");
    return;
  }
  doMarkDone(id);
}
function doMarkDone(id) {
  completedSteps.add(id);
  const card = document.getElementById("card-" + id);
  const badge = document.getElementById("badge-" + id);
  const sidebarItem = document.getElementById("sidebar-" + id);
  const headerEl = document.getElementById("header-" + id);
  if (card) {
    card.classList.remove("active-card");
    card.classList.add("completed-card");
    card.classList.remove("open");
  }
  if (badge) {
    badge.textContent = "Complete";
    badge.className = "status-badge badge-done";
  }
  if (sidebarItem) {
    sidebarItem.classList.remove("active");
    sidebarItem.classList.add("completed");
    sidebarItem.setAttribute("tabindex", "0");
  }
  if (headerEl) headerEl.setAttribute("aria-expanded", "false");
  unlockNextSteps();
  updateProgress();
  // Save progress to localStorage
  try {
    localStorage.setItem(
      "pwc_launchpad_progress",
      JSON.stringify(Array.from(completedSteps)),
    );
  } catch (e) {}
  const allCards = document.querySelectorAll(".prompt-card");
  for (var i = 0; i < allCards.length; i++) {
    var c = allCards[i];
    if (
      c.classList.contains("active-card") &&
      !c.classList.contains("completed-card")
    ) {
      c.classList.add("open");
      var nextCard = c;
      var nextSidebar = document.getElementById(
        "sidebar-" + nextCard.id.replace("card-", ""),
      );
      if (nextSidebar) nextSidebar.setAttribute("tabindex", "0");
      setTimeout(
        (function (card) {
          return function () {
            var mainPanel = document.querySelector(".workflow-main");
            var cardTop =
              card.getBoundingClientRect().top -
              mainPanel.getBoundingClientRect().top +
              mainPanel.scrollTop -
              120;
            mainPanel.scrollTo({ top: cardTop, behavior: "smooth" });
            // Pulse highlight
            setTimeout(function () {
              card.classList.add("card-pulse");
              setTimeout(function () {
                card.classList.remove("card-pulse");
              }, 1200);
            }, 400);
          };
        })(c),
        50,
      );
      break;
    }
  }
}
function unlockNextSteps() {
  appData.workflow.phases.forEach((phase) => {
    phase.prompts.forEach((prompt) => {
      if (!prompt.depends_on) return;
      const allDepsDone = prompt.depends_on.every((dep) =>
        completedSteps.has(dep),
      );
      if (allDepsDone) {
        const card = document.getElementById(`card-${prompt.prompt_id}`);
        const badge = document.getElementById(`badge-${prompt.prompt_id}`);
        const sidebarItem = document.getElementById(
          `sidebar-${prompt.prompt_id}`,
        );
        const headerEl = document.getElementById(`header-${prompt.prompt_id}`);
        // Remove dep-sublabel once unlocked
        const depSub = card && card.querySelector(".dep-sublabel");
        if (card && card.classList.contains("locked-card")) {
          card.classList.remove("locked-card");
          card.classList.add("active-card");
          if (depSub) depSub.style.display = "none";
          if (badge) {
            badge.textContent = "Ready";
            badge.className = "status-badge badge-ready";
          }
          if (sidebarItem) {
            sidebarItem.classList.remove("locked");
            sidebarItem.classList.add("active");
            sidebarItem.setAttribute("tabindex", "0");
          }
          if (headerEl) {
            headerEl.setAttribute("tabindex", "0");
          }
        }
      }
    });
  });
}
function updateProgress() {
  const total = appData.workflow.phases.reduce(
    (sum, p) => sum + p.prompts.length,
    0,
  );
  const done = completedSteps.size;
  const pct = Math.round((done / total) * 100);
  document.getElementById("progressFill").style.width = `${pct}%`;
  document.getElementById("progressText").textContent =
    `${done} of ${total} steps complete`;
  // Per-phase breakdown text
  const phaseBreakdown = appData.workflow.phases
    .map((p) => {
      const pDone = p.prompts.filter((pr) =>
        completedSteps.has(pr.prompt_id),
      ).length;
      return `${p.phase_name}: ${pDone}/${p.prompts.length}`;
    })
    .join(" · ");
  const pbEl = document.getElementById("progressBreakdown");
  if (pbEl) pbEl.textContent = phaseBreakdown;
  // Update sidebar summary bar
  var sidebarBar = document.getElementById("sidebarSummaryBar");
  var sidebarCount = document.getElementById("sidebarSummaryCount");
  var sidebarSubtext = document.getElementById("sidebarSummarySubtext");
  if (sidebarBar) sidebarBar.style.width = pct + "%";
  if (sidebarCount) sidebarCount.textContent = done + " of " + total + " steps";
  if (sidebarSubtext) {
    if (done === 0) sidebarSubtext.textContent = "Get started below";
    else if (done === total) sidebarSubtext.textContent = "All steps complete!";
    else sidebarSubtext.textContent = pct + "% complete";
  }
  updatePhaseProgress();
  updateSidebarPhaseBadges();
}

function updateSidebarPhaseBadges() {
  if (!appData || !appData.workflow) return;
  appData.workflow.phases.forEach(function (phase) {
    var total = phase.prompts.length;
    var done = phase.prompts.filter(function (p) {
      return completedSteps.has(p.prompt_id);
    }).length;
    var badge = document.getElementById("sidebar-phase-badge-" + phase.phase_id);
    if (!badge) return;
    badge.textContent = done + "/" + total;
    if (done === total) {
      badge.classList.add("phase-all-done");
    } else {
      badge.classList.remove("phase-all-done");
    }
  });
}

function updatePhaseProgress() {
  if (!appData || !appData.workflow) return;
  appData.workflow.phases.forEach((phase) => {
    const total = phase.prompts.length;
    const done = phase.prompts.filter((p) =>
      completedSteps.has(p.prompt_id),
    ).length;
    const pct = total > 0 ? Math.round((done / total) * 100) : 0;
    const countEl = document.getElementById("phase-count-" + phase.phase_id);
    const barEl = document.getElementById("phase-bar-" + phase.phase_id);
    if (countEl) countEl.textContent = done + " / " + total + " complete";
    if (barEl) barEl.style.width = pct + "%";
  });
}

// ── FORM COMPILATION ──

function buildPhaseFilterPills() {
  var container = document.getElementById("phaseFilterPills");
  if (!container || !appData || !appData.workflow) return;
  var html =
    '<span class="phase-filter-label">Filter:</span><button class="phase-filter-pill active" data-phase="all" onclick="filterByPhase(&quot;all&quot;)" tabindex="0">All</button>';
  appData.workflow.phases.forEach(function (p) {
    html +=
      '<button class="phase-filter-pill" data-phase="' +
      p.phase_id +
      '" onclick="filterByPhase(&quot;' +
      p.phase_id +
      '&quot;)" tabindex="0">' +
      p.phase_name +
      "</button>";
  });
  container.innerHTML = html;
}

function dismissWorkflowTip() {
  var tip = document.getElementById("workflowTipBanner");
  if (tip) {
    tip.style.display = "none";
    try {
      localStorage.setItem("pwc_workflow_tip_dismissed", "1");
    } catch (e) {}
  }
}

function filterByPhase(phaseId) {
  // Update pill active state
  document.querySelectorAll(".phase-filter-pill").forEach(function (p) {
    p.classList.toggle("active", p.getAttribute("data-phase") === phaseId);
  });
  const allCards = document.querySelectorAll(".prompt-card");
  const allDividers = document.querySelectorAll(".phase-divider");
  if (phaseId === "all") {
    allCards.forEach(function (c) {
      c.style.display = "";
    });
    allDividers.forEach(function (d) {
      d.style.display = "";
    });
    return;
  }
  allCards.forEach(function (c) {
    c.style.display = c.getAttribute("data-phase") === phaseId ? "" : "none";
  });
  allDividers.forEach(function (d) {
    d.style.display = d.getAttribute("data-phase-id") === phaseId ? "" : "none";
  });
  // Scroll to the phase divider
  var divider = document.getElementById("phase-divider-" + phaseId);
  if (divider) {
    var mainPanel = document.querySelector(".workflow-main");
    var top =
      divider.getBoundingClientRect().top -
      mainPanel.getBoundingClientRect().top +
      mainPanel.scrollTop -
      8;
    mainPanel.scrollTo({ top: top, behavior: "smooth" });
  }
}

function compileForm() {
  return {
    engagement_context: {
      client_name: (document.getElementById("clientName") || {}).value || "",
      engagement_name:
        (document.getElementById("engagementName") || {}).value || "",
      engagement_lead:
        (document.getElementById("engagementLead") || {}).value || "",
      start_date: (document.getElementById("startDate") || {}).value || "",
      end_date: (document.getElementById("endDate") || {}).value || "",
      delivery_methodology:
        (document.getElementById("deliveryMethodology") || {}).value || "",
      fee_structure:
        (document.getElementById("feeStructure") || {}).value || "",
      total_budget: (document.getElementById("totalBudget") || {}).value || "",
      engagement_description:
        (document.getElementById("engagementDescription") || {}).value || "",
    },
    industry: {
      industry: (document.getElementById("industryDrop") || {}).value || "",
      sector: (document.getElementById("sectorDrop") || {}).value || "",
      sub_sector: (document.getElementById("subsectorDrop") || {}).value || "",
    },
    objectives: compileObjectives(),
    service_offerings: compileServices(),
    technology: compileTech(),
    alliance_partners: compilePartners(),
    regulatory_profile: compileReg(),
    risk_profile: compileRisk(),
  };
}

function compileObjectives() {
  var result = [];
  if (!appData.objectives) return result;
  appData.objectives.engagement_objectives.objective_types.forEach(
    function (objType) {
      var typeId = slugify(objType.objective_type);
      var themes = [];
      objType.themes.forEach(function (theme) {
        var themeId = typeId + "-" + slugify(theme.theme);
        var drop = document.getElementById("obj-drop-" + themeId);
        var free = document.getElementById("obj-free-" + themeId);
        var val = "";
        if (free && free.style.display !== "none")
          val = (free.value || "").trim();
        else if (drop) val = drop.value;
        if (val) themes.push({ theme: theme.theme, specific_objective: val });
      });
      var ctx = document.getElementById("obj-context-" + typeId);
      if (themes.length > 0 || (ctx && ctx.value)) {
        result.push({
          objective_type: objType.objective_type,
          themes: themes,
          context: ctx ? ctx.value : "",
        });
      }
    },
  );
  return result;
}

function compileServices() {
  var result = [];
  if (!appData.services) return result;
  appData.services.domains.forEach(function (domain) {
    var domId = slugify(domain.domain);
    var selected = [];
    domain.building_blocks.forEach(function (bb) {
      var bbId = "bb-" + domId + "-" + slugify(bb.building_block);
      var el = document.getElementById(bbId);
      if (el && el.classList.contains("selected")) {
        selected.push({
          building_block: bb.building_block,
          description: bb.description,
        });
      }
    });
    var notes = document.getElementById("svc-notes-" + domId);
    if (selected.length > 0 || (notes && notes.value)) {
      result.push({
        domain: domain.domain,
        building_blocks: selected,
        notes: notes ? notes.value : "",
      });
    }
  });
  return result;
}

function compileTech() {
  var result = [];
  if (!appData.technologies) return result;
  appData.technologies.technology_and_tools.categories.forEach(function (cat) {
    var catId = slugify(cat.category);
    var subChips = document.querySelectorAll(
      "#tech-subs-" + catId + " .fb-chip.selected",
    );
    if (subChips.length === 0) return;
    var subCats = Array.from(subChips).map(function (c) {
      return c.textContent.trim();
    });
    var prodChips = document.querySelectorAll(
      "#tech-prod-chips-" + catId + " .fb-chip.selected",
    );
    var products = Array.from(prodChips).map(function (c) {
      return c.textContent.trim();
    });
    var notes = document.getElementById("tech-notes-" + catId);
    result.push({
      category: cat.category,
      sub_categories: subCats,
      products: products,
      notes: notes ? notes.value : "",
    });
  });
  return result;
}

function compilePartners() {
  var result = [];
  if (!appData.partners) return result;
  appData.partners.alliance_partners.partners.forEach(function (partner) {
    var pid = slugify(partner.partner);
    var famChips = document.querySelectorAll(
      "#partner-fams-" + pid + " .fb-chip.selected",
    );
    if (famChips.length === 0) return;
    var families = Array.from(famChips).map(function (c) {
      return c.textContent.trim();
    });
    var prodChips = document.querySelectorAll(
      "#partner-prods-" + pid + " .fb-chip.selected",
    );
    var products = Array.from(prodChips).map(function (c) {
      return c.textContent.trim();
    });
    var notes = document.getElementById("partner-notes-" + pid);
    result.push({
      partner: partner.partner,
      product_families: families,
      products: products,
      notes: notes ? notes.value : "",
    });
  });
  return result;
}

function compileReg() {
  var result = [];
  var checked = document.querySelectorAll(
    "#regDetailPanel .fb-check-item.checked",
  );
  checked.forEach(function (el) {
    var name = el.querySelector(".fb-check-name");
    if (!name) return;
    var regName = name.textContent.trim();
    var reqDiv = el.nextElementSibling;
    var reqs = [];
    if (reqDiv) {
      reqDiv.querySelectorAll(".fb-chip.selected").forEach(function (c) {
        reqs.push(c.textContent.trim());
      });
    }
    result.push({ regulator: regName, requirements: reqs });
  });
  return result;
}

function compileRisk() {
  var result = [];
  var checked = document.querySelectorAll(
    "#riskDetailPanel .fb-check-item.checked",
  );
  checked.forEach(function (el) {
    var name = el.querySelector(".fb-check-name");
    if (!name) return;
    var riskType = name.textContent.trim();
    var riskDiv = el.nextElementSibling;
    var risks = [];
    if (riskDiv) {
      riskDiv.querySelectorAll(".fb-chip.selected").forEach(function (c) {
        risks.push(c.textContent.trim());
      });
    }
    result.push({ risk_type: riskType, specific_risks: risks });
  });
  return result;
}

// ── GUIDED EXPERIENCE ──
const guidanceSteps = [
  {
    target: "formPage",
    title: "Welcome to the Engagement Brief",
    text: "This form captures everything the AI needs to generate your full planning suite. Work through each section carefully - the more detail you provide, the better your planning documents will be.",
    example: null,
    position: "center",
  },
  {
    target: "clientName",
    title: "Client Name",
    text: "Enter the full legal name of the client organisation. This will appear on the cover of every document generated and in all engagement records.",
    example:
      "e.g. Commonwealth Bank of Australia, Department of Health, Telstra Corporation Limited",
    position: "below",
  },
  {
    target: "engagementName",
    title: "Engagement Name",
    text: "Give this engagement a clear, descriptive name that reflects what you are doing and for whom. Avoid internal codes - use a name that means something to the client.",
    example:
      "e.g. Finance Transformation Program, SAP S/4HANA Implementation, Operating Model Redesign",
    position: "below",
  },
  {
    target: "startDate",
    title: "Estimated Dates",
    text: "Enter the expected start and end date for the engagement. If not yet confirmed use your best estimate - it can be updated in the planning documents later.",
    example: null,
    position: "below",
  },
  {
    target: "s2",
    title: "Industry",
    text: "Select the client's industry, sector and sub-sector. This drives industry-specific content across all planning documents, regulatory requirements, risk profiles, stakeholder norms and more.",
    example:
      "e.g. Financial Services → Banking and Capital Markets → Retail Banking",
    position: "below",
    openSection: "s2",
  },
  {
    target: "s3",
    title: "Engagement Objectives",
    text: "Select all objective types that apply to this engagement then drill down to the specific objectives within each type. The more precisely you define the objectives the sharper the planning outputs will be.",
    example:
      "e.g. Business Problem → Technology & Systems → Ageing legacy technology",
    position: "below",
    openSection: "s3",
  },
  {
    target: "s4",
    title: "Service Offerings",
    text: "Select the PwC domains and building blocks that will be delivered in this engagement. When you select a building block its description will appear, you can edit this to reflect how it applies specifically to this client.",
    example: "e.g. Data & AI → Data Engineering & Data Modernization",
    position: "below",
    openSection: "s4",
  },
  {
    target: "s5",
    title: "Technology & Tools",
    text: "Select the technologies already in use or being implemented at the client. This gives the AI the context to tailor technical planning documents and identify technology-specific risks.",
    example: "e.g. ERP & Business Applications → Core ERP → SAP S/4HANA",
    position: "below",
    openSection: "s5",
  },
  {
    target: "s6",
    title: "Alliance Partners",
    text: "Select any alliance partners whose products are involved in this engagement. This helps the AI identify partner-specific workstreams, risks and governance considerations.",
    example: "e.g. SAP → ERP & Finance → SAP S/4HANA Cloud",
    position: "below",
    openSection: "s6",
  },
  {
    target: "s7",
    title: "Regulatory Profile",
    text: "Select the regulatory bodies and specific requirements applicable to this engagement. This drives the compliance content across the Risk Register, Scope Statement and Engagement Charter.",
    example: "e.g. Financial Services → APRA → CPS 234 Information Security",
    position: "below",
    openSection: "s7",
  },
  {
    target: "s8",
    title: "Risk Profile",
    text: "Select the risk categories and specific risks most relevant to this engagement. The more risks you identify here the more comprehensive your Risk Register will be from day one.",
    example:
      "e.g. All Industries → Technology & Cyber Risk → Legacy system risk",
    position: "below",
    openSection: "s8",
  },
  {
    target: "formPage",
    title: "How to Fill In Each Field",
    text: "For every field in the form you have three options: pick a value from the dropdown or multi-select grid, click <strong>Enter manually</strong> to type your own custom answer, or simply leave the field blank if it is not relevant. All three are valid.",
    example:
      'Tip: Dropdowns give you structured options, but "Enter manually" lets you say exactly what you mean.',
    position: "center",
    highlightToggleBtn: true,
  },
  {
    target: "formPage",
    title: 'Using "Enter Manually"',
    text: "Clicking <strong>Enter manually</strong> on any field replaces the dropdown with a free-text box so you can write your own value. This is useful when the pre-built options do not quite fit your engagement. Click it again to switch back to the dropdown.",
    example:
      "e.g. Type a bespoke service description, a niche regulator name, or a specific risk that is not in the list.",
    position: "center",
    highlightToggleBtn: true,
  },
  {
    target: "formPage",
    title: "Leaving Fields Blank",
    text: "You do not need to fill in every field. If a section is not relevant to your engagement, leave it blank, the AI will simply omit that context from the prompts it generates. Focus on the sections that matter most.",
    example:
      "Tip: A focused brief with accurate detail in fewer sections will produce better outputs than a partially-filled form across all sections.",
    position: "center",
  },
  {
    target: "formPage",
    title: "Ready to Go - Head to the Workflow",
    text: "Your Engagement Brief is complete. Click <strong>Start Workflow →</strong> at the top of this page to move to the Workflow tab and begin generating your planning suite.",
    example:
      "Tip: Keep this browser tab open throughout the workflow, each prompt references the outputs from previous steps.",
    position: "center",
    goToWorkflow: true,
  },
  {
    target: "promptCards",
    title: "Welcome to Your Workflow",
    text: "Each card is a planning step in sequence. Steps are <strong>locked</strong> until their pre-cursor prompts have been completed, this is intentional. Each prompt builds directly on the outputs of the ones before it, so the order matters.",
    example:
      "Tip: You will see steps unlock automatically as you mark earlier ones complete.",
    position: "side",
  },
  {
    target: "card-P1.1",
    title: "Start with P1.1",
    text: "P1.1 is already unlocked and ready to run. Click <strong>Copy Prompt</strong> to copy the full prompt text, then paste it into your AI tool. Once the AI has finished and you have reviewed the output, click <strong>Mark Complete</strong> to unlock the next step.",
    example: null,
    position: "side",
  },
  {
    target: "card-P1.1",
    title: "Enable Code Interpreter",
    text: "Before running any prompt, make sure <strong>Code Interpreter</strong> (or the equivalent tool in your AI platform) is enabled. The prompts rely on it to process structured data correctly. Without it, outputs may be incomplete or incorrectly formatted.",
    example:
      'In ChatGPT: open a new chat → click the "+" or tools icon → enable Code Interpreter. In other tools, look for "Advanced Data Analysis" or a similar setting.',
    position: "side",
  },
  {
    target: "card-P1.1",
    title: "Copy or Export Each Prompt",
    text: "Use <strong>Copy Prompt</strong> to paste the prompt directly into your AI tool. Use <strong>Export Prompt</strong> to save it as a .txt file. Exporting is recommended, it ensures you do not lose your context if your browser refreshes or your session times out.",
    example:
      "Tip: Export each prompt before you run it so you always have a local backup of your full engagement context.",
    position: "side",
  },
];

let currentStep = 0;

function initGuidedExperience() {
  guidedMode = true;
  currentStep = 0;

  if (!guidancePanel) {
    guidancePanel = document.createElement("div");
    guidancePanel.className = "guidance-panel";
    guidancePanel.id = "guidancePanel";
    document.body.appendChild(guidancePanel);
  }

  showGuidanceStep(currentStep);
}

function showGuidanceStep(index) {
  if (index < 0 || index >= guidanceSteps.length) return;

  const step = guidanceSteps[index];

  if (highlightedEl) {
    highlightedEl.classList.remove("guidance-highlight");
    highlightedEl = null;
  }

  if (step.openSection) {
    const section = document.getElementById(step.openSection);
    if (section && !section.classList.contains("open")) {
      section.classList.add("open");
    }
  }

  const targetEl = document.getElementById(step.target);
  const isFirst = index === 0;
  const isLast = index === guidanceSteps.length - 1;

  // Determine next-button label: if this step triggers workflow transition, label it accordingly
  const isGoToWorkflow = !!step.goToWorkflow;
  let nextLabel = isLast
    ? "Finish"
    : isGoToWorkflow
      ? "Go to Workflow"
      : "Next";

  guidancePanel.innerHTML = `
    <div class="guidance-panel-header">
      <span class="guidance-panel-title">Guided Experience</span>
      <span class="guidance-panel-counter">Step ${index + 1} of ${guidanceSteps.length}</span>
    </div>
    <div class="guidance-panel-body">
      <div class="guidance-panel-step-title">${step.title}</div>
      <p class="guidance-panel-text">${step.text}</p>
      ${step.example ? `<div class="guidance-panel-example">${step.example}</div>` : ""}
    </div>
    <div class="guidance-panel-footer">
      <button class="guidance-panel-skip" onclick="skipGuidance()">Skip Guidance</button>
      <div class="guidance-panel-actions">
        ${!isFirst ? `<button class="btn-guidance-back" onclick="prevGuidanceStep()">Back</button>` : ""}
        <button class="btn-guidance-next" onclick="nextGuidanceStep()">
          ${nextLabel}
        </button>
      </div>
    </div>
  `;

  guidancePanel.classList.add("visible");

  // Highlight the target element if it exists
  if (targetEl) {
    targetEl.classList.add("guidance-highlight");
    highlightedEl = targetEl;
    // Only scroll on the form page — on the workflow page the panel is fixed and no scroll is needed
    if (document.getElementById("formPage").classList.contains("active")) {
      targetEl.scrollIntoView({ behavior: "smooth", block: "center" });
    }
  }

  // Highlight a visible "Enter manually" toggle button for the how-to-fill steps
  if (step.highlightToggleBtn) {
    const toggleBtns = document.querySelectorAll(".btn-toggle-input");
    let firstVisible = null;
    for (const btn of toggleBtns) {
      const rect = btn.getBoundingClientRect();
      if (rect.width > 0 && rect.height > 0) {
        firstVisible = btn;
        break;
      }
    }
    if (firstVisible) {
      firstVisible.classList.add("guidance-highlight");
      highlightedEl = firstVisible;
      firstVisible.scrollIntoView({ behavior: "smooth", block: "center" });
    }
  }
}

function nextGuidanceStep() {
  const step = guidanceSteps[currentStep];
  // If this step is the "go to workflow" transition, fire it first
  if (step && step.goToWorkflow) {
    startWorkflow();
    currentStep++;
    // Give the workflow a moment to render before showing the next guidance card
    setTimeout(function () {
      showGuidanceStep(currentStep);
    }, 400);
    return;
  }
  if (currentStep < guidanceSteps.length - 1) {
    currentStep++;
    showGuidanceStep(currentStep);
  } else {
    skipGuidance();
  }
}

function prevGuidanceStep() {
  if (currentStep > 0) {
    currentStep--;
    showGuidanceStep(currentStep);
  }
}

function skipGuidance() {
  if (guidancePanel) {
    guidancePanel.classList.remove("visible");
  }
  if (highlightedEl) {
    highlightedEl.classList.remove("guidance-highlight");
    highlightedEl = null;
  }
  guidedMode = false;
}

// ═══════════════════════════════════════════════════════
// ═══════════════════════════════════════════════════════

const DRAFT_KEY = "pwc_launchpad_draft";

// ── Collect all saveable field values ──
function collectFormState() {
  // Flush current active panel selections into _formSelState before serialising
  _fssSaveObj();
  _fssSaveServices();
  _fssSaveTech();
  _fssSavePartners();
  _fssSaveReg();
  _fssSaveRisk();
  // Capture industry from hidden selects into selState
  _formSelState.industry = {
    industry:  (document.getElementById("industryDrop")  || {}).value || "",
    sector:    (document.getElementById("sectorDrop")    || {}).value || "",
    subsector: (document.getElementById("subsectorDrop") || {}).value || "",
  };
  var ids = [
    "clientName",
    "engagementName",
    "engagementLead",
    "startDate",
    "endDate",
    "deliveryMethodology",
    "feeStructure",
    "totalBudget",
    "engagementDescription",
  ];
  var state = { _ts: new Date().toISOString(), fields: {}, selState: null };
  ids.forEach(function (id) {
    var el = document.getElementById(id);
    if (el) state.fields[id] = el.value;
  });
  try { state.selState = JSON.parse(JSON.stringify(_formSelState)); } catch(e) {}
  return state;
}

// ── Restore saved state into form fields ──
function applyFormState(state) {
  if (!state) return;
  Object.entries(state.fields || {}).forEach(([id, val]) => {
    const el = document.getElementById(id);
    if (el) el.value = val;
  });
  Object.entries(state.selects || {}).forEach(([id, val]) => {
    const el = document.getElementById(id);
    if (el && val) el.value = val;
  });
  if (!state.selState) return;
  _formSelState = state.selState;

  // Restore industry cascade via direct function calls (no click simulation)
  var ind = _formSelState.industry || {};
  if (ind.industry) {
    var indPill = Array.from(document.querySelectorAll("#industryPills .fb-pill"))
      .find(function(p) { return p.textContent.trim() === ind.industry; });
    if (indPill) {
      fbSelectIndustry(indPill, ind.industry);
      if (ind.sector) {
        var secPill = Array.from(document.querySelectorAll("#sectorPills .fb-pill"))
          .find(function(p) { return p.textContent.trim() === ind.sector; });
        if (secPill) {
          fbSelectSector(secPill, ind.sector);
          if (ind.subsector) {
            var subPill = Array.from(document.querySelectorAll("#subsectorPills .fb-pill"))
              .find(function(p) { return p.textContent.trim() === ind.subsector; });
            if (subPill) fbSelectSubsector(subPill, ind.subsector);
          }
        }
      }
    }
  }

  // Update left-side tab dots for sections with saved selections
  setTimeout(function() {
    var dotSections = [
      { state: _formSelState.services, listId: "domainTabList", hasKey: function(s) { return Object.keys(s.bbs || {}).length > 0; } },
      { state: _formSelState.tech,     listId: "techCatList",   hasKey: function(s) { return (s.subs || []).length > 0; } },
      { state: _formSelState.partners, listId: "partnerTabList", hasKey: function(s) { return (s.families || []).length > 0; } },
      { state: _formSelState.reg,      listId: "regGroupList",  hasKey: function(s) { return (s.checked || []).length > 0; } },
      { state: _formSelState.risk,     listId: "riskGroupList", hasKey: function(s) { return (s.checked || []).length > 0; } },
    ];
    dotSections.forEach(function(ds) {
      if (!ds.state) return;
      // Build slug-to-element map once per section to avoid querySelectorAll in inner loop
      var tabEls = document.querySelectorAll("#" + ds.listId + " .fb-tab-item");
      var slugMap = {};
      tabEls.forEach(function(t) { slugMap[slugify(t.textContent.trim())] = t; });
      Object.keys(ds.state).forEach(function(key) {
        if (!ds.hasKey(ds.state[key])) return;
        var t = slugMap[key];
        if (t) {
          t.classList.add("has-data");
          var dot = t.querySelector(".fb-tab-dot"); if (dot) dot.style.background = "#22c55e";
        }
      });
    });
    // Objectives tab dots
    if (_formSelState.obj) {
      var objTabEls = document.querySelectorAll("#objTypeList .fb-tab-item");
      var objSlugMap = {};
      objTabEls.forEach(function(t) { objSlugMap[slugify(t.textContent.trim())] = t; });
      Object.keys(_formSelState.obj).forEach(function(typeId) {
        var saved = _formSelState.obj[typeId];
        if (saved && Object.values(saved.drops || {}).some(function(v) { return v; })) {
          var t = objSlugMap[typeId];
          if (t) {
            t.classList.add("has-data");
            var dot = t.querySelector(".fb-tab-dot"); if (dot) dot.style.background = "#22c55e";
          }
        }
      });
    }
    fbEvalDots();
    if (typeof updateBriefStrength === "function") updateBriefStrength();
  }, 400);
}

// ── Auto-save on any input/change inside the form ──
var _autoSaveInitialised = false;
function initAutoSave() {
  if (_autoSaveInitialised) return;
  const formEl = document.getElementById("formPage");
  if (!formEl) return;
  _autoSaveInitialised = true;
  formEl.addEventListener("input", debounceAutoSave);
  formEl.addEventListener("change", debounceAutoSave);
  // also hook clicks (for button-style selectors)
  formEl.addEventListener("click", debounceAutoSave);
}

function debounceAutoSave() {
  clearTimeout(_autoSaveTimer);
  _autoSaveTimer = setTimeout(function () {
    try {
      const state = collectFormState();
      localStorage.setItem(DRAFT_KEY, JSON.stringify(state));
    } catch (e) {
      // Only show the "storage full" error if localStorage quota is actually exceeded.
      // Different browsers signal quota errors differently:
      // - name === "QuotaExceededError" is standard,
      // - code === 22 is Safari/Firefox legacy,
      // - name === "NS_ERROR_DOM_QUOTA_REACHED" is Firefox.
      if (
        e &&
        (e.name === "QuotaExceededError" ||
          e.name === "NS_ERROR_DOM_QUOTA_REACHED" ||
          e.code === 22 ||
          e.number === -2147024882)
      ) {
        showToast("Draft could not be saved \u2014 storage full.", "error");
      }
      // For all other errors (e.g., undefined functions), fail silently to avoid misleading messages.
    }
    updateAllSectionDots();
    if (typeof updateBriefStrength === "function") updateBriefStrength();
  }, 600);
}

// ── Check for draft on page load ──
function checkForDraft() {
  try {
    var raw = localStorage.getItem(DRAFT_KEY);
    if (!raw) return;
    var state = JSON.parse(raw);
    if (!state || !state._ts) return;
    var hasData = Object.keys(state.fields || {}).some(function (k) {
      return state.fields[k] && state.fields[k].trim();
    });
    if (!hasData && state.selState) {
      var selKeys = ["industry", "obj", "services", "tech", "partners", "reg", "risk"];
      hasData = selKeys.some(function (k) {
        var section = state.selState[k];
        return section && typeof section === "object" && Object.keys(section).length > 0;
      });
    }
    if (!hasData) return;
    var ts = new Date(state._ts);
    var formatted =
      ts.toLocaleDateString("en-AU", {
        day: "numeric",
        month: "short",
        year: "numeric",
      }) +
      " at " +
      ts.toLocaleTimeString("en-AU", { hour: "2-digit", minute: "2-digit" });
    var dtEl = document.getElementById("draftTimestamp");
    if (dtEl) dtEl.textContent = formatted;
    var banner = document.getElementById("draftBanner");
    if (banner) banner.classList.add("visible");
  } catch (e) {}
}

function restoreDraft() {
  try {
    var raw = localStorage.getItem(DRAFT_KEY);
    if (!raw) return;
    var state = JSON.parse(raw);
    applyFormState(state);
    var banner = document.getElementById("draftBanner");
    if (banner) banner.classList.remove("visible");
    fbEvalDots();
    if (typeof updateBriefStrength === "function") updateBriefStrength();
    showToast("Draft restored.", "success");
  } catch (e) {}
}

function dismissDraft() {
  localStorage.removeItem(DRAFT_KEY);
  localStorage.removeItem("pwc_launchpad_progress");
  document.getElementById("draftBanner").classList.remove("visible");
}

// ── Section selection state — persists across tab switches and is included in drafts ──
var _formSelState = { industry: {}, obj: {}, services: {}, tech: {}, partners: {}, reg: {}, risk: {} };

function _fssSaveObj() {
  _fssSaveSection("objTypeList", "obj", function(typeId, tab) {
    var typeName = tab.textContent.trim();
    var drops = {}, frees = {};
    document.querySelectorAll('[id^="obj-drop-' + typeId + '"]').forEach(function(el) { drops[el.id] = el.value; });
    document.querySelectorAll('[id^="obj-free-' + typeId + '"]').forEach(function(el) { if (el.value) frees[el.id] = { val: el.value, isManual: el.style.display !== "none" }; });
    var ctx = document.getElementById("obj-context-" + typeId);
    return { typeName: typeName, drops: drops, frees: frees, context: ctx ? ctx.value : "" };
  });
}
function _fssApplyObj(typeId) {
  var saved = _formSelState.obj && _formSelState.obj[typeId];
  if (!saved) return;
  Object.keys(saved.drops || {}).forEach(function(id) { var el = document.getElementById(id); if (el) el.value = saved.drops[id]; });
  Object.keys(saved.frees || {}).forEach(function(id) {
    var entry = saved.frees[id];
    var el = document.getElementById(id); if (!el || !entry.val) return;
    el.value = entry.val;
    if (entry.isManual) {
      el.style.display = "";
      var drop = document.getElementById(id.replace("obj-free-", "obj-drop-"));
      if (drop) drop.style.display = "none";
    }
  });
  var ctx = document.getElementById("obj-context-" + typeId); if (ctx && saved.context) ctx.value = saved.context;
  fbEvalObjDot(typeId);
}

// ── Shared _fssSave helper: reads active tab + runs section-specific collector ──
function _fssSaveSection(tabListId, stateKey, collectFn) {
  var tab = document.querySelector("#" + tabListId + " .fb-tab-item.active");
  if (!tab) return;
  var id = slugify(tab.textContent.trim());
  if (!_formSelState[stateKey]) _formSelState[stateKey] = {};
  _formSelState[stateKey][id] = collectFn(id, tab);
}

function _fssSaveServices() {
  _fssSaveSection("domainTabList", "services", function(domId) {
    var bbs = {};
    document.querySelectorAll("#domainBlockPanel .fb-bb-item.selected").forEach(function(el) { bbs[el.id] = true; });
    var notes = document.getElementById("svc-notes-" + domId);
    return { bbs: bbs, notes: notes ? notes.value : "" };
  });
}
function _fssApplyServices(domId) {
  var saved = _formSelState.services && _formSelState.services[domId];
  if (!saved) return;
  Object.keys(saved.bbs || {}).forEach(function(bbId) {
    var el = document.getElementById(bbId);
    if (el && !el.classList.contains("selected")) el.classList.add("selected");
  });
  var notes = document.getElementById("svc-notes-" + domId);
  if (notes && saved.notes) notes.value = saved.notes;
  var tab = document.querySelector("#domainTabList .fb-tab-item.active");
  if (tab) {
    var hasAny = document.querySelectorAll("#domainBlockPanel .fb-bb-item.selected").length > 0;
    updateTabDot(tab, hasAny);
  }
}

function _fssSaveTech() {
  _fssSaveSection("techCatList", "tech", function(catId) {
    var subs = Array.from(document.querySelectorAll("#tech-subs-" + catId + " .fb-chip.selected")).map(function(c) { return c.textContent.trim(); });
    var prods = Array.from(document.querySelectorAll("#tech-prod-chips-" + catId + " .fb-chip.selected")).map(function(c) { return c.textContent.trim(); });
    var notes = document.getElementById("tech-notes-" + catId);
    return { subs: subs, prods: prods, notes: notes ? notes.value : "" };
  });
}
function _fssApplyTech(catId) {
  var saved = _formSelState.tech && _formSelState.tech[catId];
  if (!saved || !(saved.subs || []).length) return;
  (saved.subs || []).forEach(function(subText) {
    document.querySelectorAll("#tech-subs-" + catId + " .fb-chip").forEach(function(c) {
      if (c.textContent.trim() === subText && !c.classList.contains("selected")) c.classList.add("selected");
    });
  });
  var cat = appData.technologies && appData.technologies.technology_and_tools.categories.find(function(c) { return slugify(c.category) === catId; });
  var prodsDiv = document.getElementById("tech-prods-" + catId);
  if (cat && prodsDiv) {
    var html = '<div class="fb-detail-label">Products</div><div class="fb-chip-grid" id="tech-prod-chips-' + catId + '">';
    (saved.subs || []).forEach(function(sn) {
      var s = cat.sub_categories.find(function(x) { return x.sub_category === sn; });
      if (s && (s.products || s.options)) (s.products || s.options).forEach(function(p) {
        var sel = (saved.prods || []).indexOf(p) >= 0 ? " selected" : "";
        html += '<span class="fb-chip' + sel + '" onclick="this.classList.toggle(\'selected\');fbEvalDots();">' + p + "</span>";
      });
    });
    html += "</div>";
    prodsDiv.innerHTML = html;
  }
  var notes = document.getElementById("tech-notes-" + catId);
  if (notes && saved.notes) notes.value = saved.notes;
  var tab = document.querySelector("#techCatList .fb-tab-item.active");
  if (tab) { tab.classList.add("has-data"); tab.querySelector(".fb-tab-dot").style.background = "#22c55e"; }
}

function _fssSavePartners() {
  _fssSaveSection("partnerTabList", "partners", function(pid) {
    var families = Array.from(document.querySelectorAll("#partner-fams-" + pid + " .fb-chip.selected")).map(function(c) { return c.textContent.trim(); });
    var prods = Array.from(document.querySelectorAll("#partner-prods-" + pid + " .fb-chip.selected")).map(function(c) { return c.textContent.trim(); });
    var notes = document.getElementById("partner-notes-" + pid);
    return { families: families, prods: prods, notes: notes ? notes.value : "" };
  });
}
function _fssApplyPartners(pid) {
  var saved = _formSelState.partners && _formSelState.partners[pid];
  if (!saved || !(saved.families || []).length) return;
  (saved.families || []).forEach(function(famText) {
    document.querySelectorAll("#partner-fams-" + pid + " .fb-chip").forEach(function(c) {
      if (c.textContent.trim() === famText && !c.classList.contains("selected")) c.classList.add("selected");
    });
  });
  var partner = appData.partners && appData.partners.alliance_partners.partners.find(function(p) { return slugify(p.partner) === pid; });
  var prodsDiv = document.getElementById("partner-prods-" + pid);
  if (partner && prodsDiv) {
    var html = '<div class="fb-detail-label">Products</div><div class="fb-chip-grid">';
    (saved.families || []).forEach(function(fn) {
      var fam = partner.product_families.find(function(f) { return f.product_family === fn; });
      if (fam && fam.products) fam.products.forEach(function(p) {
        var sel = (saved.prods || []).indexOf(p) >= 0 ? " selected" : "";
        html += '<span class="fb-chip' + sel + '" onclick="this.classList.toggle(\'selected\');fbEvalDots();">' + p + "</span>";
      });
    });
    html += "</div>";
    prodsDiv.innerHTML = html;
  }
  var notes = document.getElementById("partner-notes-" + pid);
  if (notes && saved.notes) notes.value = saved.notes;
  var tab = document.querySelector("#partnerTabList .fb-tab-item.active");
  if (tab) { tab.classList.add("has-data"); tab.querySelector(".fb-tab-dot").style.background = "#22c55e"; }
}

function _fssSaveReg() {
  _fssSaveSection("regGroupList", "reg", function(gid) {
    var checked = [], reqs = {};
    document.querySelectorAll("#regDetailPanel .fb-check-item.checked").forEach(function(el) {
      var name = el.querySelector(".fb-check-name"); if (!name) return;
      var regName = name.textContent.trim(); checked.push(regName);
      var reqDiv = el.nextElementSibling;
      if (reqDiv) reqs[regName] = Array.from(reqDiv.querySelectorAll(".fb-chip.selected")).map(function(c) { return c.textContent.trim(); });
    });
    return { checked: checked, reqs: reqs };
  });
}
function _fssApplyReg(gid) {
  var saved = _formSelState.reg && _formSelState.reg[gid];
  if (!saved || !(saved.checked || []).length) return;
  (saved.checked || []).forEach(function(regName) {
    document.querySelectorAll("#regDetailPanel .fb-check-item").forEach(function(el) {
      var nameEl = el.querySelector(".fb-check-name");
      if (nameEl && nameEl.textContent.trim() === regName && !el.classList.contains("checked")) {
        var rid = gid + "-" + slugify(regName);
        fbToggleCheckItem(el, rid, "req-wrap-", "regGroupList", "regDetailPanel");
        var reqReqs = (saved.reqs && saved.reqs[regName]) || [];
        var wrap = document.getElementById("req-wrap-" + rid);
        if (wrap) reqReqs.forEach(function(reqText) {
          wrap.querySelectorAll(".fb-chip").forEach(function(c) { if (c.textContent.trim() === reqText) c.classList.add("selected"); });
        });
      }
    });
  });
}

function _fssSaveRisk() {
  _fssSaveSection("riskGroupList", "risk", function(gid) {
    var checked = [], risks = {};
    document.querySelectorAll("#riskDetailPanel .fb-check-item.checked").forEach(function(el) {
      var name = el.querySelector(".fb-check-name"); if (!name) return;
      var riskType = name.textContent.trim(); checked.push(riskType);
      var riskDiv = el.nextElementSibling;
      if (riskDiv) risks[riskType] = Array.from(riskDiv.querySelectorAll(".fb-chip.selected")).map(function(c) { return c.textContent.trim(); });
    });
    return { checked: checked, risks: risks };
  });
}
function _fssApplyRisk(gid) {
  var saved = _formSelState.risk && _formSelState.risk[gid];
  if (!saved || !(saved.checked || []).length) return;
  (saved.checked || []).forEach(function(riskType) {
    document.querySelectorAll("#riskDetailPanel .fb-check-item").forEach(function(el) {
      var nameEl = el.querySelector(".fb-check-name");
      if (nameEl && nameEl.textContent.trim() === riskType && !el.classList.contains("checked")) {
        var rtid = gid + "-" + slugify(riskType);
        fbToggleCheckItem(el, rtid, "risk-wrap-", "riskGroupList", "riskDetailPanel");
        var riskRisks = (saved.risks && saved.risks[riskType]) || [];
        var wrap = document.getElementById("risk-wrap-" + rtid);
        if (wrap) riskRisks.forEach(function(riskText) {
          wrap.querySelectorAll(".fb-chip").forEach(function(c) { if (c.textContent.trim() === riskText) c.classList.add("selected"); });
        });
      }
    });
  });
}

function clearAllFormData() {
  // Show confirmation modal instead of native confirm()
  var modal = document.getElementById("clearFormModal");
  if (modal) {
    modal.classList.add("visible");
    return;
  }
  // Fallback: build and show modal dynamically using gateModal pattern
  modal = document.createElement("div");
  modal.id = "clearFormModal";
  modal.innerHTML =
    '<div id="clearFormModalBox">' +
      '<div class="gate-modal-header">' +
        '<span class="gate-modal-icon">&#9888;</span>' +
        '<span class="gate-modal-title">New Engagement</span>' +
      '</div>' +
      '<div class="gate-modal-body">' +
        '<p>Start a new engagement? This will clear all current data and cannot be undone.</p>' +
      '</div>' +
      '<div class="gate-modal-footer">' +
        '<button class="btn-gate-cancel" onclick="closeClearFormModal()">Cancel</button>' +
        '<button class="btn-gate-confirm" onclick="confirmClearAllFormData()">Clear &amp; Start New</button>' +
      '</div>' +
    '</div>';
  document.body.appendChild(modal);
  modal.classList.add("visible");
}
function closeClearFormModal() {
  var modal = document.getElementById("clearFormModal");
  if (modal) modal.classList.remove("visible");
}
function confirmClearAllFormData() {
  closeClearFormModal();
  // Reset S1 text fields
  ["clientName","engagementName","engagementLead","startDate","endDate","deliveryMethodology","feeStructure","totalBudget","engagementDescription"].forEach(function(id) {
    var el = document.getElementById(id); if (el) el.value = "";
  });
  // Reset S2 industry cascade — re-render from data
  ["industryDrop","sectorDrop","subsectorDrop"].forEach(function(id) { var el = document.getElementById(id); if (el) el.value = ""; });
  document.querySelectorAll("#industryPills .fb-pill").forEach(function(p) { p.classList.remove("selected"); });
  var sp = document.getElementById("sectorPills"); if (sp) sp.innerHTML = '<span class="fb-cascade-placeholder">Select an industry first</span>';
  var ssp = document.getElementById("subsectorPills"); if (ssp) ssp.innerHTML = '<span class="fb-cascade-placeholder">Select a sector first</span>';
  var ts = document.getElementById("trail-sector"); if (ts) { ts.classList.remove("ready"); ts.classList.add("fb-cascade-dim"); }
  var tss = document.getElementById("trail-subsector"); if (tss) { tss.classList.remove("ready"); tss.classList.add("fb-cascade-dim"); }
  // Reset selection state and detail panels
  _formSelState = { industry: {}, obj: {}, services: {}, tech: {}, partners: {}, reg: {}, risk: {} };
  ["domainBlockPanel","techDetailPanel","partnerDetailPanel","regDetailPanel","riskDetailPanel","objThemePanel"].forEach(function(id) {
    var el = document.getElementById(id);
    if (el) el.innerHTML = '<div class="fb-panel-empty">Select an option on the left</div>';
  });
  document.querySelectorAll(".fb-tab-item").forEach(function(t) {
    t.classList.remove("active","has-data");
    var dot = t.querySelector(".fb-tab-dot"); if (dot) dot.style.background = "";
  });
  try { localStorage.removeItem(DRAFT_KEY); localStorage.removeItem("pwc_launchpad_progress"); } catch(e) {}
  var banner = document.getElementById("draftBanner"); if (banner) banner.classList.remove("visible");
  ["clientName","engagementName"].forEach(function(id) { if (typeof setFieldError === "function") setFieldError(id, ""); });
  fbEvalDots();
  if (typeof updateBriefStrength === "function") updateBriefStrength();
  fbGoToSection(1);
  showToast("Ready for a new engagement brief.", "success");
}

// ── Section completion dot logic ──
function getSectionCompleteness(sid) {
  // Try new fb-section first, fall back to old section
  var el = document.getElementById("fb-" + sid) || document.getElementById(sid);
  if (!el) return "empty";
  var selCount = el.querySelectorAll(
    ".fb-pill.selected,.fb-chip.selected,.fb-bb-item.selected,.fb-check-item.checked,.fb-tab-item.has-data,.selected",
  ).length;
  var inputCount = Array.from(
    el.querySelectorAll("input[type=text],input[type=date],textarea,select"),
  ).filter(function (i) {
    return (i.value || "").trim();
  }).length;
  var total = selCount + inputCount;
  if (total === 0) return "empty";
  if (total >= 3) return "filled";
  return "partial";
}

function updateSectionDot() {
  // Individual section dot update is a no-op; use updateAllSectionDots instead
}

function updateAllSectionDots() {
  if (typeof fbEvalDots === "function") fbEvalDots();
}

// ═══════════════════════════════════════════
// ═══════════════════════════════════════════

function openReviewPanel() {
  formData = compileForm();
  renderReviewPanel();
  document.getElementById("reviewOverlay").classList.add("visible");
}
function onReviewOverlayClick(e) {
  if (e && e.target !== document.getElementById("reviewOverlay")) return;
  closeReviewPanelDirect();
}
function closeReviewPanelDirect() {
  document.getElementById("reviewOverlay").classList.remove("visible");
}

function checkBriefCompleteness() {
  const issues = [];
  if (!((document.getElementById("deliveryMethodology") || {}).value || ""))
    issues.push(
      "Delivery Methodology not selected — affects Planning and Charter prompts",
    );
  if (!((document.getElementById("feeStructure") || {}).value || ""))
    issues.push(
      "Fee Structure not selected — affects Budget and Charter prompts",
    );
  if (!((document.getElementById("engagementDescription") || {}).value || ""))
    issues.push(
      "Engagement Description is empty — improves quality of all documents",
    );
  if (!((document.getElementById("industryDrop") || {}).value || ""))
    issues.push(
      "Industry not selected — industry-specific content will be generic",
    );
  const fd = formData || {};
  const objs = (fd.objectives || []).filter(function (o) {
    return o.themes && o.themes.length > 0;
  });
  if (!objs.length)
    issues.push(
      "No Engagement Objectives selected — planning outputs will be generic",
    );
  const svcs = (fd.service_offerings || []).filter(function (s) {
    return s.building_blocks && s.building_blocks.length > 0;
  });
  if (!svcs.length)
    issues.push(
      "No Service Offerings selected — building-block context will be missing",
    );
  if (!(fd.regulatory_profile && fd.regulatory_profile.length > 0))
    issues.push(
      "No Regulatory Profile selected — compliance content will be generic",
    );
  if (!(fd.risk_profile && fd.risk_profile.length > 0))
    issues.push("No Risk Profile selected — Risk Register will be generic");
  return issues;
}

function nullIfBlank(v) {
  return v && String(v).trim() ? v : null;
}
function escHtml(str) {
  if (!str) return "";
  return String(str).replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;");
}

function renderReviewPanel() {
  const d = formData || {};
  const ec = d.engagement_context || {};
  const issues = checkBriefCompleteness();
  let h = "";

  // Context
  // Context
  h +=
    '<div class="review-section"><div class="review-section-title">Engagement Context</div>';
  h +=
    '<div class="review-edit-hint">Click any value to edit it directly.</div>';
  var ecFieldMap = [
    ["Client Name", "clientName", ec.client_name, "input"],
    ["Engagement Name", "engagementName", ec.engagement_name, "input"],
    ["Engagement Lead", "engagementLead", ec.engagement_lead, "input"],
    ["Start Date", "startDate", ec.start_date, "input"],
    ["End Date", "endDate", ec.end_date, "input"],
    ["Methodology", "deliveryMethodology", ec.delivery_methodology, "input"],
    ["Fee Structure", "feeStructure", ec.fee_structure, "input"],
    ["Budget", "totalBudget", ec.total_budget, "input"],
    [
      "Description",
      "engagementDescription",
      ec.engagement_description,
      "textarea",
    ],
  ];
  ecFieldMap.forEach(function (row) {
    var label = row[0],
      fieldId = row[1],
      val = row[2],
      type = row[3];
    var display = nullIfBlank(val) ? escHtml(val) : "\u2014";
    var cls = nullIfBlank(val) ? "review-val" : "review-val missing";
    h +=
      '<div class="review-row">' +
      '<span class="review-key">' +
      escHtml(label) +
      "</span>" +
      '<span class="' +
      cls +
      '" onclick="rvStartEdit(this,\'' +
      fieldId +
      "','" +
      type +
      '\')" title="Click to edit">' +
      display +
      "</span>" +
      "</div>";
  });
  h += "</div>";

  // Industry
  const ind = d.industry || {};
  h +=
    '<div class="review-section"><div class="review-section-title">Industry</div>';
  [
    ["Industry", ind.industry],
    ["Sector", ind.sector],
    ["Sub-sector", ind.sub_sector],
  ].forEach(function (row) {
    const display = nullIfBlank(row[1]) ? escHtml(row[1]) : "\u2014";
    const cls = nullIfBlank(row[1]) ? "review-val" : "review-val missing";
    h +=
      '<div class="review-row"><span class="review-key">' +
      escHtml(row[0]) +
      '</span><span class="' +
      cls +
      '">' +
      display +
      "</span></div>";
  });
  h += "</div>";

  // Objectives
  const objs = (d.objectives || []).filter(function (o) {
    return o.themes && o.themes.length > 0;
  });
  h +=
    '<div class="review-section"><div class="review-section-title">Objectives (' +
    objs.length +
    " type" +
    (objs.length !== 1 ? "s" : "") +
    ")</div>";
  if (!objs.length) {
    h +=
      '<div class="review-row"><span class="review-val missing">None selected</span></div>';
  } else {
    objs.forEach(function (obj) {
      obj.themes.forEach(function (t) {
        h +=
          '<div class="review-list-item"><strong>' +
          escHtml(obj.objective_type) +
          "</strong> \u203A " +
          escHtml(t.theme) +
          ": " +
          escHtml(t.specific_objective) +
          "</div>";
      });
    });
  }
  h += "</div>";

  // Services
  const svcs = (d.service_offerings || []).filter(function (s) {
    return s.building_blocks && s.building_blocks.length > 0;
  });
  const bbCount = svcs.reduce(function (a, s) {
    return a + s.building_blocks.length;
  }, 0);
  h +=
    '<div class="review-section"><div class="review-section-title">Service Offerings (' +
    bbCount +
    " building block" +
    (bbCount !== 1 ? "s" : "") +
    ")</div>";
  if (!bbCount) {
    h +=
      '<div class="review-row"><span class="review-val missing">None selected</span></div>';
  } else {
    svcs.forEach(function (s) {
      s.building_blocks.forEach(function (bb) {
        h +=
          '<div class="review-list-item"><strong>' +
          escHtml(s.domain) +
          "</strong> \u203A " +
          escHtml(bb.building_block) +
          "</div>";
      });
    });
  }
  h += "</div>";

  // Tech
  const techs = (d.technology || []).filter(function (t) {
    return t.sub_categories && t.sub_categories.length > 0;
  });
  const techCount = techs.reduce(function (a, t) {
    return a + (t.sub_categories || []).length;
  }, 0);
  h +=
    '<div class="review-section"><div class="review-section-title">Technology & Tools (' +
    techCount +
    " item" +
    (techCount !== 1 ? "s" : "") +
    ")</div>";
  if (!techCount) {
    h +=
      '<div class="review-row"><span class="review-val missing">None selected</span></div>';
  } else {
    techs.slice(0, 5).forEach(function (t) {
      h +=
        '<div class="review-list-item"><strong>' +
        escHtml(t.category) +
        "</strong>: " +
        (t.sub_categories || []).slice(0, 3).map(escHtml).join(", ") +
        "</div>";
    });
  }
  h += "</div>";

  // Regulatory
  const regs = (d.regulatory_profile || []).filter(function (r) {
    return r.regulator;
  });
  const regCount = regs.length;
  h +=
    '<div class="review-section"><div class="review-section-title">Regulatory Profile (' +
    regCount +
    " item" +
    (regCount !== 1 ? "s" : "") +
    ")</div>";
  if (!regCount) {
    h +=
      '<div class="review-row"><span class="review-val missing">None selected</span></div>';
  } else {
    regs.slice(0, 4).forEach(function (r) {
      var reqStr = (r.requirements || []).slice(0, 3).map(escHtml).join(", ");
      h +=
        '<div class="review-list-item"><strong>' +
        escHtml(r.regulator || "") +
        "</strong>" +
        (reqStr ? ": " + reqStr : "") +
        "</div>";
    });
  }
  h += "</div>";

  // Risks
  const risks = (d.risk_profile || []).filter(function (r) {
    return r.risk_type;
  });
  const riskCount = risks.length;
  h +=
    '<div class="review-section"><div class="review-section-title">Risk Profile (' +
    riskCount +
    " risk" +
    (riskCount !== 1 ? "s" : "") +
    ")</div>";
  if (!riskCount) {
    h +=
      '<div class="review-row"><span class="review-val missing">None selected</span></div>';
  } else {
    risks.slice(0, 4).forEach(function (r) {
      var riskStr = (r.specific_risks || []).slice(0, 3).map(escHtml).join(", ");
      h +=
        '<div class="review-list-item"><strong>' +
        escHtml(r.risk_type || "") +
        "</strong>" +
        (riskStr ? ": " + riskStr : "") +
        "</div>";
    });
  }
  h += "</div>";

  // Warnings
  if (issues.length) {
    h +=
      '<div class="review-callout"><strong>⚠ Missing data — some outputs may be generic:</strong><ul style="margin:6px 0 0 16px;">';
    issues.forEach(function (i) {
      h += '<li style="margin-bottom:3px;">' + i + "</li>";
    });
    h += "</ul></div>";
  }
  document.getElementById("reviewPanel-body").innerHTML = h;
}

// ── Load Example Data ──
function rvStartEdit(spanEl, fieldId, type) {
  if (spanEl.classList.contains("editing")) return;
  spanEl.classList.add("editing");
  var currentVal =
    (document.getElementById(fieldId) || {}).value || spanEl.textContent.trim();
  if (currentVal === "—") currentVal = "";
  var input;
  if (type === "textarea") {
    input = document.createElement("textarea");
    input.rows = 4;
  } else {
    input = document.createElement("input");
    input.type = "text";
  }
  input.className = "review-val-input";
  input.value = currentVal;
  spanEl.textContent = "";
  spanEl.appendChild(input);
  input.focus();
  function commit() {
    var newVal = input.value.trim();
    var liveField = document.getElementById(fieldId);
    if (liveField) {
      liveField.value = newVal;
      liveField.dispatchEvent(new Event("input"));
      liveField.dispatchEvent(new Event("change"));
    }
    formData = compileForm();
    spanEl.classList.remove("editing");
    spanEl.textContent = newVal || "—";
    if (!newVal) spanEl.classList.add("missing");
    else spanEl.classList.remove("missing");
  }
  input.addEventListener("blur", commit);
  input.addEventListener("keydown", function (e) {
    if (e.key === "Enter" && type !== "textarea") {
      e.preventDefault();
      commit();
    }
    if (e.key === "Escape") {
      input.removeEventListener("blur", commit);
      spanEl.classList.remove("editing");
      spanEl.textContent = currentVal || "—";
    }
  });
}

// ── Load Example Data ──
function loadExampleData() {
  if (!appData || !appData.industries) {
    showToast("Data is still loading \u2014 please wait a moment.", "warning");
    return;
  }
  var sv = function (id, v) {
    var e = document.getElementById(id);
    if (e) e.value = v;
  };
  // S1 fields
  sv("clientName", "Commonwealth Bank of Australia");
  sv("engagementName", "Core Banking Modernisation Program");
  sv("engagementLead", "Sarah Chen");
  sv("startDate", "2025-07-01");
  sv("endDate", "2026-12-31");
  sv("deliveryMethodology", "Hybrid");
  sv("feeStructure", "Time & Materials");
  sv("totalBudget", "$12,500,000");
  sv(
    "engagementDescription",
    "End-to-end modernisation of core banking platform, migrating from legacy on-premise infrastructure to cloud-native architecture on AWS. Encompasses data migration, API integration, regulatory compliance uplift, and change management across 8 business units.",
  );

  // S2: industry cascade — use direct API calls
  var indPill = Array.from(
    document.querySelectorAll("#industryPills .fb-pill"),
  ).find(function (p) { return p.textContent.trim() === "Financial Services"; });
  if (indPill) fbSelectIndustry(indPill, "Financial Services");
  var secPill = Array.from(
    document.querySelectorAll("#sectorPills .fb-pill"),
  ).find(function (p) { return p.textContent.trim() === "Banking and Capital Markets"; });
  if (secPill) fbSelectSector(secPill, "Banking and Capital Markets");
  var subPill = Array.from(
    document.querySelectorAll("#subsectorPills .fb-pill"),
  ).find(function (p) { return p.textContent.trim() === "Retail Banking"; });
  if (subPill) fbSelectSubsector(subPill, "Retail Banking");
  _formSelState.industry = { industry: "Financial Services", sector: "Banking and Capital Markets", subsector: "Retail Banking" };

  // S3: objectives — write state directly
  _formSelState.obj = _formSelState.obj || {};
  _formSelState.obj["business-problem"] = {
    typeName: "Business Problem",
    drops: {
      "obj-drop-business-problem-operational-performance": "Siloed operations across business units",
      "obj-drop-business-problem-data-information": "Fragmented and siloed data",
      "obj-drop-business-problem-technology-systems": "Ageing and legacy technology landscape"
    },
    frees: {},
    context: ""
  };
  // Render the objective type tab as active and apply saved state
  var objTab = Array.from(
    document.querySelectorAll("#objTypeList .fb-tab-item"),
  ).find(function (t) { return t.textContent.trim().indexOf("Business Problem") === 0; });
  if (objTab) {
    objTab.click();
    sv("obj-drop-business-problem-operational-performance", "Siloed operations across business units");
    sv("obj-drop-business-problem-data-information", "Fragmented and siloed data");
    sv("obj-drop-business-problem-technology-systems", "Ageing and legacy technology landscape");
    if (typeof fbObjChange === "function") fbObjChange("business-problem");
  }

  // S4: services — write state directly
  _formSelState.services = _formSelState.services || {};
  var domTab = Array.from(
    document.querySelectorAll("#domainTabList .fb-tab-item"),
  ).find(function (t) { return t.textContent.trim() === "Data & AI"; });
  if (domTab) {
    domTab.click();
    var bbChecks = document.querySelectorAll("#domainBlockPanel .fb-bb-item .fb-bb-check");
    bbChecks.forEach(function (check, i) { if (i < 3) check.click(); });
    _fssSaveServices();
  }

  // S5: technology — write state directly
  _formSelState.tech = _formSelState.tech || {};
  var techTab = Array.from(
    document.querySelectorAll("#techCatList .fb-tab-item"),
  ).find(function (t) { return t.textContent.trim().indexOf("Data & Analytics") === 0; });
  if (techTab) {
    techTab.click();
    document.querySelectorAll("#techDetailPanel .fb-chip").forEach(function (chip, i) { if (i < 2) chip.click(); });
    _fssSaveTech();
  }

  // S6: partners — write state directly
  _formSelState.partners = _formSelState.partners || {};
  var partTab = Array.from(
    document.querySelectorAll("#partnerTabList .fb-tab-item"),
  ).find(function (t) { return t.textContent.trim() === "AWS"; });
  if (partTab) {
    partTab.click();
    document.querySelectorAll("#partnerDetailPanel .fb-chip").forEach(function (chip, i) { if (i < 2) chip.click(); });
    _fssSavePartners();
  }

  // S7: regulatory — write state directly
  _formSelState.reg = _formSelState.reg || {};
  var regTab = Array.from(
    document.querySelectorAll("#regGroupList .fb-tab-item"),
  ).find(function (t) { return t.textContent.trim() === "Financial Services"; });
  if (regTab) {
    regTab.click();
    document.querySelectorAll("#regDetailPanel .fb-check-item").forEach(function (item, i) { if (i < 2) item.click(); });
    _fssSaveReg();
  }

  // S8: risk — write state directly
  _formSelState.risk = _formSelState.risk || {};
  var riskTab = Array.from(
    document.querySelectorAll("#riskGroupList .fb-tab-item"),
  ).find(function (t) { return t.textContent.trim() === "Financial Services"; });
  if (riskTab) {
    riskTab.click();
    document.querySelectorAll("#riskDetailPanel .fb-check-item").forEach(function (item, i) { if (i < 2) item.click(); });
    _fssSaveRisk();
  }

  // Final: update dots and strength in one pass
  fbEvalDots();
  if (typeof updateBriefStrength === "function") updateBriefStrength();
  try {
    var st = collectFormState();
    localStorage.setItem(DRAFT_KEY, JSON.stringify(st));
  } catch (e) {}
  showToast("Example data loaded.", "success");
}

// Document-level change/click listeners removed — form-level listeners
// from initAutoSave already call updateBriefStrength via debounceAutoSave.


function reopenStep(id) {
  completedSteps.delete(id);
  var card = document.getElementById("card-" + id);
  var badge = document.getElementById("badge-" + id);
  var sidebar = document.getElementById("sidebar-" + id);
  var headerEl = document.getElementById("header-" + id);
  if (card) {
    card.classList.remove("completed-card");
    card.classList.add("active-card");
    card.classList.add("open");
  }
  if (badge) {
    badge.textContent = "Ready";
    badge.className = "status-badge badge-ready";
  }
  if (sidebar) {
    sidebar.classList.remove("completed");
    sidebar.classList.add("active");
    sidebar.setAttribute("tabindex", "0");
  }
  if (headerEl) {
    headerEl.setAttribute("aria-expanded", "true");
  }
  // Re-lock any steps that depended on this one and are not yet done
  if (appData && appData.workflow) {
    appData.workflow.phases.forEach(function (ph) {
      ph.prompts.forEach(function (p) {
        if (!p.depends_on || !p.depends_on.includes(id)) return;
        if (completedSteps.has(p.prompt_id)) return; // already done, leave it
        var dc = document.getElementById("card-" + p.prompt_id);
        var db = document.getElementById("badge-" + p.prompt_id);
        var ds = document.getElementById("sidebar-" + p.prompt_id);
        var dh = document.getElementById("header-" + p.prompt_id);
        if (
          dc &&
          dc.classList.contains("active-card") &&
          !dc.classList.contains("completed-card")
        ) {
          dc.classList.remove("active-card");
          dc.classList.add("locked-card");
          if (db) {
            db.textContent = "Locked";
            db.className = "status-badge badge-locked";
          }
          if (ds) {
            ds.classList.remove("active");
            ds.classList.add("locked");
            ds.setAttribute("tabindex", "0");
          }
          if (dh) {
            dh.setAttribute("tabindex", "-1");
          }
        }
      });
    });
  }
  updateProgress();
  try {
    localStorage.setItem(
      "pwc_launchpad_progress",
      JSON.stringify(Array.from(completedSteps)),
    );
  } catch (e) {}
}

// Gate modal
function checkGateReady() {
  var allChecked = Array.from(
    document.querySelectorAll("#gateModalChecklist input[type=checkbox]")
  ).every(function (b) { return b.checked; });
  var btn = document.getElementById("gateConfirmBtn");
  if (btn) {
    btn.classList.toggle("ready", allChecked);
  }
}
function closeGateModal() {
  document.getElementById("gateModal").classList.remove("visible");
  _pendingGateId = null;
}
function confirmGateDone() {
  document.getElementById("gateModal").classList.remove("visible");
  if (_pendingGateId) {
    doMarkDone(_pendingGateId);
    _pendingGateId = null;
  }
}

// Sparse brief warning modal (#03)
function openSparseBriefModal(filledCount) {
  const msg = document.getElementById("sparseBriefMsg");
  if (msg)
    msg.textContent = `Only ${filledCount} of 7 sections have meaningful data. Sparse briefs produce generic AI output. Consider completing more sections for better results.`;
  document.getElementById("sparseBriefModal").classList.add("visible");
}
function closeSparseBriefModal() {
  document.getElementById("sparseBriefModal").classList.remove("visible");
}
function proceedSparse() {
  closeSparseBriefModal();
  openReviewPanel();
}

// Resume modal
function restartWorkflow() {
  document.getElementById("resumeModal").classList.remove("visible");
  completedSteps = new Set();
  doShowWorkflow({ skipResume: true });
}
function continueWorkflow() {
  document.getElementById("resumeModal").classList.remove("visible");
  // State restoration now handled inside renderWorkflow
  doShowWorkflow({ skipResume: true });
}

// Inline prompt editing (#12)
function togglePromptEdit(id) {
  var box = document.getElementById("prompt-text-" + id);
  var btn = document.getElementById("edit-btn-" + id);
  if (!box || !btn) return;
  var editing = box.getAttribute("contenteditable") === "true";
  if (!editing) {
    // Store original text for reset
    box.setAttribute("data-original", box.textContent);
    box.setAttribute("contenteditable", "true");
    btn.textContent = "Reset";
    btn.classList.add("active");
    box.focus();
  } else {
    // Reset to original
    var orig = box.getAttribute("data-original");
    if (orig) box.textContent = orig;
    box.setAttribute("contenteditable", "false");
    btn.textContent = "Edit";
    btn.classList.remove("active");
  }
}

// ════════════════════════════════════
// ════════════════════════════════════

// ── Toast notifications ──
function toggleExpandPrompt(id) {
  var box = document.getElementById("prompt-text-" + id);
  var btn = document.getElementById("expand-btn-" + id);
  if (!box || !btn) return;
  var expanded = box.classList.contains("prompt-text-expanded");
  if (expanded) {
    box.classList.remove("prompt-text-expanded");
    btn.innerHTML = "&#x26F6; Expand";
    btn.setAttribute("aria-label", "Expand prompt text");
  } else {
    box.classList.add("prompt-text-expanded");
    btn.innerHTML = "&#x26F4; Collapse";
    btn.setAttribute("aria-label", "Collapse prompt text");
  }
}

function showToast(msg, type, duration) {
  type = type || "info";
  duration = duration || 3000;
  var icons = { info: "ℹ", success: "✓", warning: "⚠", error: "✕" };
  var container = document.getElementById("toastContainer");
  if (!container) return;
  var t = document.createElement("div");
  t.className = "toast toast-" + type;
  t.innerHTML =
    '<span class="toast-icon">' +
    (icons[type] || "ℹ") +
    "</span>" +
    '<span class="toast-msg">' +
    msg +
    "</span>" +
    '<span class="toast-close" onclick="this.parentElement.remove()">×</span>';
  t.onclick = function (e) {
    if (!e.target.classList.contains("toast-close")) t.remove();
  };
  container.appendChild(t);
  setTimeout(function () {
    if (t.parentElement) t.remove();
  }, duration);
}

// ── Section scoring helpers for nav pills (0=empty, 1=partial, 2=complete) ──
function scoreSectionS1() {
  var fields = ["clientName","engagementName","engagementLead","deliveryMethodology",
    "startDate","endDate","feeStructure","totalBudget","engagementDescription"];
  var filled = fields.filter(function(id) {
    var el = document.getElementById(id);
    return el && (el.value || "").trim();
  }).length;
  return filled >= 4 ? 2 : filled > 0 ? 1 : 0;
}
function scoreSectionS2() {
  var ind = document.getElementById("industryDrop");
  var sec = document.getElementById("sectorDrop");
  return sec && sec.value ? 2 : ind && ind.value ? 1 : 0;
}
function scoreSectionGrid(gridId) {
  var grid = document.getElementById(gridId);
  if (!grid) return 0;
  var sel = grid.querySelectorAll(".check-item.selected, .fb-chip.selected, .fb-bb-item.selected, .fb-check-item.checked, .fb-pill.selected").length;
  return sel >= 2 ? 2 : sel > 0 ? 1 : 0;
}

// ── Nav pill colour update ──
function updateNavPills() {
  var map = {
    s1: scoreSectionS1,
    s2: scoreSectionS2,
    s3: function () {
      return scoreSectionGrid("objectiveTypeGrid");
    },
    s4: function () {
      return scoreSectionGrid("domainGrid");
    },
    s5: function () {
      return scoreSectionGrid("techCategoryGrid");
    },
    s6: function () {
      return scoreSectionGrid("partnerGrid");
    },
    s7: function () {
      return scoreSectionGrid("regulatoryIndustryGrid");
    },
    s8: function () {
      return scoreSectionGrid("riskIndustryGrid");
    },
  };
  Object.keys(map).forEach(function (sid) {
    var pill = document.getElementById("pill-" + sid);
    if (!pill) return;
    var score = map[sid]();
    pill.classList.remove("pill-partial", "pill-complete");
    if (score === 2) pill.classList.add("pill-complete");
    else if (score === 1) pill.classList.add("pill-partial");
  });
}

// ── Grid filter ──
function filterGrid(gridId, query) {
  var grid = document.getElementById(gridId);
  if (!grid) return;
  var q = query.toLowerCase().trim();
  grid.querySelectorAll(".cci").forEach(function (cci) {
    var chip = cci.querySelector(":scope > .check-item");
    if (!chip) return;
    var match = !q || chip.textContent.toLowerCase().indexOf(q) !== -1;
    chip.style.display = match ? "" : "none";
    var cascade = cci.querySelector(":scope > .cascade-block");
    if (cascade && !match) cascade.classList.remove("visible");
  });
  grid.querySelectorAll(".check-item").forEach(function (item) {
    if (item.closest && item.closest(".cci")) return;
    item.style.display =
      !q || item.textContent.toLowerCase().indexOf(q) !== -1 ? "" : "none";
  });
}

// ── Building block tooltip ──
function showBBTooltip(e, desc) {
  e.stopPropagation();
  var tip = document.getElementById("bbTooltip");
  if (!tip) return;
  var clean = desc || "";
  tip.textContent = clean;
  tip.classList.add("visible");
  var x = e.clientX + 12,
    y = e.clientY + 12;
  if (x + 290 > window.innerWidth) x = e.clientX - 292;
  if (y + 120 > window.innerHeight) y = e.clientY - 124;
  tip.style.left = x + "px";
  tip.style.top = y + "px";
  var hide = function () {
    tip.classList.remove("visible");
    document.removeEventListener("click", hide);
  };
  setTimeout(function () {
    document.addEventListener("click", hide);
  }, 50);
}

// ── Bulk export all prompts ──
function exportAllPrompts() {
  var btn = document.getElementById("bulkExportBtn");
  var workflow = appData && appData.workflow;
  if (!workflow) {
    showToast("Workflow not loaded yet.", "warning");
    return;
  }
  var lines = [];
  var clientSlug = (
    (document.getElementById("clientName") || {}).value || "Client"
  )
    .replace(/[^a-zA-Z0-9]/g, "_")
    .replace(/_+/g, "_")
    .replace(/^_|_$/g, "");
  var engSlug = (
    (document.getElementById("engagementName") || {}).value || "Engagement"
  )
    .replace(/[^a-zA-Z0-9]/g, "_")
    .replace(/_+/g, "_")
    .replace(/^_|_$/g, "");
  var divider = "=".repeat(80);
  workflow.phases.forEach(function (phase) {
    lines.push(divider);
    lines.push("PHASE: " + phase.phase_name.toUpperCase());
    lines.push(divider);
    lines.push("");
    phase.prompts.forEach(function (prompt) {
      var el = document.getElementById("prompt-text-" + prompt.prompt_id);
      var text = el ? el.textContent : "[Prompt not available]";
      lines.push(
        "--- " + prompt.prompt_id + " | " + prompt.prompt_name + " ---",
      );
      lines.push("Produces: " + prompt.artifact);
      lines.push("");
      lines.push(text);
      lines.push("");
    });
  });
  var full = lines.join("\n");
  var blob = new Blob([full], { type: "text/plain" });
  var url = URL.createObjectURL(blob);
  var a = document.createElement("a");
  a.href = url;
  a.download = clientSlug + "_" + engSlug + "_AllPrompts.txt";
  document.body.appendChild(a);
  a.click();
  setTimeout(function () {
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
  }, 1000);
  if (btn) {
    btn.textContent = "✓ Exported!";
    btn.classList.add("exported");
    setTimeout(function () {
      btn.innerHTML = "⬇ Export All";
      btn.classList.remove("exported");
    }, 2500);
  }
  showToast("All prompts exported successfully.", "success");
}

// Also update pills on load
document.addEventListener("DOMContentLoaded", function () {
  loadAllData();
  setTimeout(updateNavPills, 800);
});

// ─── LANDING PAGE ───
let guidedMode = true;

function toggleGuidedMode() {
  guidedMode = !guidedMode;
  var track = document.getElementById("guided-toggle");
  if (track) track.setAttribute("aria-checked", guidedMode ? "true" : "false");
}

function launchSelected() {
  if (guidedMode) {
    showFormPage();
    setTimeout(initGuidedExperience, 300);
  } else {
    showFormPage();
  }
}

function showFormPage() {
  document.getElementById("landingPage").classList.remove("active");
  document.getElementById("formPage").classList.add("active");
  if (
    typeof loadAllData === "function" &&
    typeof appData !== "undefined" &&
    !appData.industries
  ) {
    loadAllData();
  }
  if (typeof updateHeader === "function") updateHeader();
  if (!guidedMode && !document.querySelector(".guidance-toggle")) {
    var t = document.createElement("button");
    t.className = "guidance-toggle";
    t.textContent = "▶ Start Guidance";
    t.onclick = initGuidedExperience;
    var fr = document.querySelector(".footer-right");
    if (fr) fr.prepend(t);
  }
}

// ── Conveyor autoplay ──
(function () {
  var cardWidth = 212; // 200px card + 12px gap
  var speed = 2800; // ms per step - increase to slow down

  function init() {
    var conveyor = document.getElementById("lp-conveyor");
    if (!conveyor) return;

    // Clone all original cards 10 times so the conveyor runs for a very long time
    var origCards = Array.from(conveyor.querySelectorAll(".lp-cv-card"));
    var n = origCards.length;
    for (var r = 0; r < 10; r++) {
      origCards.forEach(function (c) {
        var clone = c.cloneNode(true);
        clone.setAttribute("aria-hidden", "true");
        conveyor.appendChild(clone);
      });
    }

    var cur = 0;
    var totalCards = n * 11; // originals + 10 clones
    var paused = false;

    function centerOffset() {
      // How much to shift so the active card sits in the middle of the viewport
      return Math.round(window.innerWidth / 2 - cardWidth / 2);
    }

    function activate(i, animate) {
      // Highlight the matching card in the original set
      origCards.forEach(function (c, j) {
        c.classList.toggle("lp-cv-active", j === i % n);
      });
      conveyor.style.transition =
        animate === false ? "none" : "transform 0.6s cubic-bezier(0.4,0,0.2,1)";
      // Offset so active card is centered in viewport
      var shift = centerOffset() - i * cardWidth;
      conveyor.style.transform = "translateX(" + shift + "px)";
    }

    // Start immediately - no delay
    activate(0, false);

    // Pause on hover over the conveyor area
    conveyor.addEventListener("mouseenter", function () {
      paused = true;
    });
    conveyor.addEventListener("mouseleave", function () {
      paused = false;
    });

    // Step immediately after a tiny delay so first move is instant, then keep interval
    setTimeout(function () {
      cur = 1;
      activate(cur);
      setInterval(function () {
        if (paused) return;
        cur++;
        if (cur >= totalCards) {
          activate(0, false);
          cur = 0;
        } else {
          activate(cur);
        }
      }, speed);
    }, speed);
  }

  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", init);
  } else {
    init();
  }
})();
</script>

  <!-- ── CHUNK 1: Draft restore banner ── -->
  <div id="draftBanner">
    <span id="draftBannerMsg">📋 You have a saved draft from <strong id="draftTimestamp"></strong>. Would you like to restore it?</span>
    <div class="draft-banner-actions">
      <button class="btn-draft-restore" onclick="restoreDraft()">Restore Draft</button>
      <button class="btn-draft-dismiss" onclick="dismissDraft()">Discard</button>
    </div>
  </div>


  <!-- CHUNK 2: Review overlay -->
  <div id="reviewOverlay" onclick="onReviewOverlayClick(event)">
    <div id="reviewPanel">
      <div id="reviewPanel-header">
        <div><h3>Review Your Brief</h3><p>This is the data that will be sent to every AI prompt.</p></div>
        <button class="review-close-btn" onclick="closeReviewPanelDirect()">&times;</button>
      </div>
      <div id="reviewPanel-body"></div>
      <div id="reviewPanel-footer">
        <button class="btn-review-back" onclick="closeReviewPanelDirect()">Back to Form</button>
        <button class="btn-review-launch" onclick="confirmLaunchWorkflow()">Launch Workflow &rarr;</button>
      </div>
    </div>
  </div>


  <!-- CHUNK 3: Stage Gate Modal -->
  <div id="gateModal">
    <div id="gateModalBox">
      <div class="gate-modal-header">
        <span class="gate-modal-icon">&#9888;</span>
        <span class="gate-modal-title" id="gateModalTitle">Stage Gate Sign-Off</span>
      </div>
      <div class="gate-modal-body">
        <p>This is a <strong>stage gate</strong>. Before marking this step complete, confirm the artifact has been reviewed and approved by the appropriate stakeholders.</p>
        <ul class="gate-modal-checklist" id="gateModalChecklist">
          <li><input type="checkbox" onchange="checkGateReady()"> The artifact has been reviewed by the engagement lead</li>
          <li><input type="checkbox" onchange="checkGateReady()"> The client or internal approver has signed off</li>
          <li><input type="checkbox" onchange="checkGateReady()"> Any open issues have been logged in the Issues &amp; Dependency Log</li>
        </ul>
      </div>
      <div class="gate-modal-footer">
        <button class="btn-gate-cancel" onclick="closeGateModal()">Cancel</button>
        <button class="btn-gate-confirm" id="gateConfirmBtn" onclick="confirmGateDone()">Confirm Sign-Off &amp; Complete</button>
      </div>
    </div>
  </div>

  <!-- CHUNK 3: Resume/Restart Modal -->
  <div id="resumeModal">
    <div id="resumeModalBox">
      <div class="resume-modal-header">&#128196; Resume existing workflow?</div>
      <div class="resume-modal-body" id="resumeModalBody">
        You have <strong id="resumeStepCount">0</strong> completed step(s) from a previous session.<br><br>
        Would you like to <strong>continue</strong> where you left off, or <strong>restart</strong> the workflow from the beginning?
      </div>
      <div class="resume-modal-footer">
        <button class="btn-resume-restart" onclick="restartWorkflow()">Restart</button>
        <button class="btn-resume-continue" onclick="continueWorkflow()">Continue</button>
      </div>
    </div>
  </div>



  <!-- #03 Sparse Brief Warning Modal -->
  <div id="sparseBriefModal">
    <div id="sparseBriefModalBox">
      <div class="gate-modal-header">
        <span class="gate-modal-icon">&#9888;</span>
        <span class="gate-modal-title">Brief looks sparse</span>
      </div>
      <div class="gate-modal-body">
        <p id="sparseBriefMsg">Only a few sections have meaningful data. Sparse briefs produce generic AI output.</p>
        <p style="margin-top:10px;font-size:12px;color:var(--secondaryText);">You can go back and fill in more sections, or proceed with what you have.</p>
      </div>
      <div class="gate-modal-footer">
        <button class="btn-gate-cancel" onclick="closeSparseBriefModal()">&#8592; Go back &amp; improve</button>
        <button class="btn-gate-confirm" onclick="proceedSparse()">Proceed anyway</button>
      </div>
    </div>
  </div>

  <div id="toastContainer"></div>
  <div id="bbTooltip"></div>
</body>
</html>
