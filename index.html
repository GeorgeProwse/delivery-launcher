<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PwC Delivery Launchpad</title>
  <link rel="icon" href="data:,">
<style>
*,
*::before,
*::after {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}
:root {
  --orange500: #fd5108;
  --orange300: #ffaa72;
  --orange100: #ffe8d4;
  --black: #000000;
  --white: #ffffff;
  --grey100: #eeeff1;
  --grey200: #dfe3e6;
  --grey300: #cbd1d6;
  --grey400: #b5bcc4;
  --grey500: #a1a8b3;
  --success: #22c55e;
  --successBg: #dcfce7;
  --warning: #eab308;
  --warningBg: #fef3c7;
  --bgColor: #eeeff1;
  --cardBg: #ffffff;
  --textColor: #000000;
  --secondaryText: #a1a8b3;
  --borderColor: #dfe3e6;
  --surfaceColor: #eeeff1;
}

@keyframes fadeIn {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}
@keyframes slideDown {
  from {
    opacity: 0;
    transform: translateY(-10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

body {
  font-family: system-ui, sans-serif;
  background-color: var(--bgColor);
  color: var(--textColor);
  font-size: 14px;
  line-height: 1.6;
}

/* HEADER */
.header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 10px 24px;
  background: var(--cardBg);
  border-bottom: 1px solid var(--borderColor);
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  z-index: 200;
}
.header-left {
  display: flex;
  align-items: center;
  gap: 16px;
}
.header-divider {
  width: 1px;
  height: 24px;
  background: var(--borderColor);
}
.header-title {
  font-size: 16px;
  font-weight: 600;
  color: var(--textColor);
}
.header-subtitle {
  font-size: 13px;
  color: var(--secondaryText);
  font-weight: 400;
}

/* ─── LANDING PAGE ─── */

#landingPage.active ~ .header {
  display: none !important;
}

#lp-wrap {
  height: 100vh;
  background: #f4f4f6;
  display: flex;
  flex-direction: column;
  position: relative;
}

/* subtle dot grid */
#lp-grid {
  display: none;
}

/* ── TOP NAV BAR ── */
#lp-nav {
  position: relative;
  z-index: 10;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 20px 64px;
}

#lp-nav-brand {
  font-size: 13px;
  font-weight: 700;
  color: #111;
  letter-spacing: -0.01em;
}

#lp-nav-badge {
  font-size: 10px;
  font-weight: 600;
  letter-spacing: 0.1em;
  text-transform: uppercase;
  color: #e8530e;
  background: rgba(232, 83, 14, 0.08);
  padding: 4px 10px;
  border-radius: 100px;
}

/* ── HERO ── */
#lp-hero {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  text-align: center;
  padding: 16px 64px 24px 64px;
  position: relative;
  z-index: 1;
}

#lp-contact {
  position: absolute;
  bottom: 12px;
  left: 64px;
  font-size: 11px;
  color: #bbbbbb;
  text-align: left;
}
#lp-contact a {
  color: #aaaaaa;
  text-decoration: none;
}
#lp-contact a:hover {
  color: #e8530e;
}

#lp-title {
  font-size: 56px;
  font-weight: 600;
  color: #111;
  line-height: 1.1;
  letter-spacing: -0.01em;
  font-family: Georgia, serif !important;
  margin: 0 0 16px;
}

#lp-title em {
  font-style: normal;
  color: #e8530e;
}

#lp-sub {
  font-size: 15px;
  color: #666;
  line-height: 1.75;
  margin: 0 0 28px;
  max-width: 520px;
  text-align: center;
}

/* ── CTA ROW ── */
#lp-cta-row {
  display: flex;
  align-items: center;
  gap: 10px;
  flex-wrap: wrap;
}

.lp-chip {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 9px 18px;
  font-size: 12px;
  font-weight: 500;
  font-family: system-ui, sans-serif;
  border-radius: 100px;
  border: 1.5px solid #dcdcdc;
  background: #fff;
  color: #777;
  cursor: pointer;
  transition: all 150ms ease;
  outline: none;
  letter-spacing: -0.01em;
}
.lp-chip:hover {
  border-color: #e8530e;
  color: #e8530e;
  background: #fff5f0;
}
.lp-chip-active {
  border-color: #e8530e !important;
  background: #e8530e !important;
  color: #fff !important;
  font-weight: 600;
}
.lp-chip-active .lp-chip-dot {
  background: rgba(255, 255, 255, 0.6) !important;
}
.lp-chip-dot {
  width: 5px;
  height: 5px;
  border-radius: 50%;
  background: #ccc;
  flex-shrink: 0;
  transition: background 150ms ease;
}

#lp-start-btn {
  padding: 10px 32px;
  font-size: 16px;
  font-weight: 700;
  background: #fd5108;
  color: #fff;
  border: none;
  cursor: pointer;
  font-family: system-ui, sans-serif;
  letter-spacing: -0.01em;
  transition: background 150ms ease, box-shadow 150ms ease;
  border-radius: 100px;
  outline: none;
  box-shadow: 0 2px 12px rgba(253, 81, 8, 0.35);
}
#lp-start-btn:hover {
  background: #c94000;
  box-shadow: 0 4px 18px rgba(253, 81, 8, 0.45);
}
#lp-start-btn:focus {
  outline: 2px solid #fd5108;
  outline-offset: 3px;
}

/* ══════════════════════════════════════
   CONVEYOR CHAIN
══════════════════════════════════════ */
#lp-chain-wrap {
  position: relative;
  z-index: 1;
  padding: 0 0 28px;
  flex: 0 0 auto;
  display: flex;
  flex-direction: column;
  justify-content: flex-end;
  margin-bottom: 120px;
}
#lp-chain-label {
  font-size: 10px;
  font-weight: 600;
  letter-spacing: 0.1em;
  text-transform: uppercase;
  color: #bbbbbb;
  padding: 0 64px 12px;
}
#lp-conveyor-outer {
  position: relative;
  overflow: hidden;
  padding: 24px 0 8px;
}
#lp-conveyor-outer::before,
#lp-conveyor-outer::after {
  content: "";
  position: absolute;
  top: 0;
  bottom: 0;
  width: 120px;
  z-index: 2;
  pointer-events: none;
}
#lp-conveyor-outer::before {
  left: 0;
  background: linear-gradient(to right, #f4f4f6, transparent);
}
#lp-conveyor-outer::after {
  right: 0;
  background: linear-gradient(to left, #f4f4f6, transparent);
}
#lp-conveyor-track {
  position: absolute;
  top: 24px;
  left: 0;
  right: 0;
  height: 1px;
  background: #e0e0e0;
  z-index: 0;
}
#lp-conveyor {
  display: flex;
  gap: 0;
  padding: 0 64px;
  transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  z-index: 1;
}
.lp-cv-card {
  flex: 0 0 200px;
  background: transparent;
  border: none;
  padding: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 0;
  transition: all 0.35s ease;
  opacity: 0.45;
  cursor: default;
  position: relative;
}
.lp-cv-card.lp-cv-active {
  opacity: 1;
}
/* Node dot on the line */
.lp-cv-card::before {
  content: "";
  width: 10px;
  height: 10px;
  border-radius: 50%;
  background: #d0d0d0;
  border: 2px solid #d0d0d0;
  flex-shrink: 0;
  transition:
    background 0.35s ease,
    border-color 0.35s ease,
    transform 0.35s ease;
  margin-bottom: 10px;
}
.lp-cv-card.lp-cv-active::before {
  background: #e8530e;
  border-color: #e8530e;
  transform: scale(1.4);
}
.lp-cv-id {
  display: none;
}
.lp-cv-name {
  font-size: 12px;
  font-weight: 600;
  color: #bbbbbb;
  line-height: 1.3;
  text-align: center;
  padding: 0 8px;
  transition: color 0.35s ease;
}
.lp-cv-card.lp-cv-active .lp-cv-name {
  color: #111;
}
.lp-cv-artifact {
  display: none;
}
.lp-cv-desc {
  font-size: 11px;
  color: #cccccc;
  line-height: 1.5;
  text-align: center;
  padding: 4px 8px 0;
  transition: color 0.35s ease;
}
.lp-cv-card.lp-cv-active .lp-cv-desc {
  color: #888;
}
.lp-cv-gate-badge {
  display: none;
}

.page {
  display: none;
}
.page.active {
  display: block;
  animation: fadeIn 0.2s ease;
}

/* LOADING */
.loading-overlay {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(255, 255, 255, 0.85);
  z-index: 500;
  align-items: center;
  justify-content: center;
  flex-direction: column;
  gap: 16px;
}
.loading-overlay.visible {
  display: flex;
}
.loading-spinner {
  width: 40px;
  height: 40px;
  border: 3px solid var(--grey200);
  border-top-color: var(--orange500);
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
}
@keyframes spin {
  to {
    transform: rotate(360deg);
  }
}
.loading-text {
  font-size: 14px;
  color: var(--secondaryText);
}

/* ── FORM ── */

/* Typography system - applied globally */
*,
*::before,
*::after {
  font-family: system-ui, sans-serif;
}
#lp-title,
#lp-title em {
  font-family: Georgia, serif !important;
}
h1 {
  font-size: 32px;
  font-weight: 600;
  line-height: 1.25;
  margin: 0;
}
h2 {
  font-size: 24px;
  font-weight: 600;
  line-height: 1.3;
  margin: 0;
}
h3 {
  font-size: 18px;
  font-weight: 600;
  line-height: 1.35;
  margin: 0;
}
h4 {
  font-size: 16px;
  font-weight: 600;
  line-height: 1.4;
  margin: 0;
}
p,
body {
  font-size: 14px;
  font-weight: 400;
  line-height: 1.6;
}

.form-container {
  max-width: 860px;
  margin: 0 auto;
  padding: 0 24px 60px;
}
/* form intro row: title + start button */
.form-intro {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 16px;
  position: sticky;
  top: 0;
  z-index: 150;
  background: var(--bgColor);
  padding: 16px 24px;
  margin: 0 -24px 16px -24px;
  border-bottom: 1px solid var(--borderColor);
}
.form-intro-text h2 {
  font-size: 24px;
  font-weight: 600;
  margin-bottom: 4px;
}
.form-intro-text p {
  font-size: 13px;
  color: var(--secondaryText);
  line-height: 1.5;
}

/* nav pills */
.nav-pills {
  display: flex;
  gap: 4px;
  flex-wrap: wrap;
  margin-bottom: 14px;
}
.nav-pill {
  padding: 4px 12px;
  font-size: 11px;
  font-weight: 500;
  cursor: pointer;
  border: 1px solid var(--borderColor);
  background: var(--cardBg);
  color: var(--secondaryText);
  border-radius: 100px;
  transition: all 140ms ease;
}
.nav-pill:hover {
  background: var(--orange100);
  border-color: var(--orange500);
  color: var(--orange500);
}

/* sections */
.section {
  background: var(--cardBg);
  margin-bottom: 2px;
  border: 1px solid var(--borderColor);
  overflow: hidden;
}
.section-header {
  padding: 11px 18px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  cursor: pointer;
  border-left: 3px solid var(--orange500);
  transition: background-color 140ms ease;
  user-select: none;
}
.section-header:hover {
  background: var(--grey100);
}
.section-header-left {
  display: flex;
  align-items: center;
  gap: 12px;
}
.section-number {
  width: 20px;
  height: 20px;
  border-radius: 50%;
  background: var(--orange500);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 10px;
  font-weight: 700;
  color: #fff;
  flex-shrink: 0;
}
.section-title {
  font-size: 14px;
  font-weight: 600;
}
.section-subtitle {
  font-size: 11px;
  font-weight: 400;
  color: var(--secondaryText);
  margin-top: 1px;
}
.chevron {
  font-size: 11px;
  color: var(--grey400);
  transition: transform 180ms ease;
}
.section.open .chevron {
  transform: rotate(180deg);
}
.section-body {
  display: none;
  padding: 14px 18px;
  border-top: 1px solid var(--borderColor);
}
.section.open .section-body {
  display: block;
  animation: slideDown 160ms ease;
}

/* fields */
.field-group {
  display: flex;
  flex-direction: column;
  gap: 12px;
}
.field-row {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
}
.field-row.single {
  grid-template-columns: 1fr;
}
.field-row.triple {
  grid-template-columns: 1fr 1fr 1fr;
}
.field {
  display: flex;
  flex-direction: column;
}
.field-label-row {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 5px;
}
label.field-label {
  font-size: 11px;
  font-weight: 500;
  color: #666;
  text-transform: uppercase;
  letter-spacing: 0.05em;
}
label.field-label .required {
  color: var(--orange500);
  margin-left: 2px;
}
.field-label.error-label {
  color: #c62828;
}
.field-hint {
  font-size: 11px;
  font-weight: 400;
  color: var(--secondaryText);
  margin: 2px 0 6px;
  line-height: 1.4;
}
.field-error {
  display: none;
  margin-top: 6px;
  font-size: 11px;
  color: #c62828;
}
.field.has-error .field-error {
  display: block;
}

input[type="text"],
input[type="date"],
select,
textarea {
  width: 100%;
  padding: 7px 10px;
  border: 1px solid var(--borderColor);
  border-radius: 3px;
  font-size: 13px;
  font-weight: 400;
  font-family: system-ui, sans-serif;
  color: var(--textColor);
  background: var(--white);
  transition: border-color 140ms ease;
  appearance: none;
  -webkit-appearance: none;
  box-sizing: border-box;
}
input::placeholder,
textarea::placeholder {
  color: var(--grey400);
}
input:focus,
select:focus,
textarea:focus {
  outline: none;
  border-color: var(--orange500);
  box-shadow: 0 0 0 2px rgba(253, 81, 8, 0.07);
}
.field.has-error input[type="text"],
.field.has-error input[type="date"],
.field.has-error select,
.field.has-error textarea {
  border-color: #c62828;
  box-shadow: 0 0 0 2px rgba(198, 40, 40, 0.08);
}
select {
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='10' viewBox='0 0 10 10'%3E%3Cpath fill='%23B5BCC4' d='M5 7L0 2h10z'/%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 10px center;
  padding-right: 28px;
  cursor: pointer;
}
select:disabled {
  background: var(--grey100);
  color: var(--grey400);
  cursor: not-allowed;
}
textarea {
  resize: vertical;
  min-height: 72px;
}

.btn-toggle-input {
  font-size: 11px;
  font-weight: 500;
  color: var(--orange500);
  background: transparent;
  border: none;
  padding: 0;
  cursor: pointer;
  transition: opacity 140ms ease;
}
.btn-toggle-input:hover {
  opacity: 0.65;
}

/* ── THEME ROW — horizontal layout for objective/theme fields ── */
.theme-row {
  display: grid;
  grid-template-columns: 200px 1fr auto;
  align-items: center;
  gap: 10px;
  padding: 6px 0;
  border-bottom: 1px solid var(--grey100);
}
.theme-row:last-child {
  border-bottom: none;
}
.theme-row-label {
  font-size: 11px;
  font-weight: 600;
  color: var(--textColor);
  text-transform: uppercase;
  letter-spacing: 0.04em;
  line-height: 1.3;
  padding-right: 8px;
}
.theme-row select,
.theme-row input[type="text"] {
  width: 100%;
  margin: 0;
}
.theme-row .btn-toggle-input {
  white-space: nowrap;
  font-size: 11px;
  padding: 4px 8px;
  border: 1px solid var(--orange300);
  border-radius: 3px;
  color: var(--orange500);
  background: transparent;
}
.theme-row .btn-toggle-input:hover {
  background: var(--orange100);
}
.theme-rows-container {
  border: 1px solid var(--borderColor);
  border-radius: 4px;
  overflow: hidden;
  background: var(--white);
  margin-top: 8px;
}
.theme-rows-container .theme-row {
  padding: 8px 12px;
}
.theme-rows-container .theme-row:nth-child(even) {
  background: var(--grey100);
}

/* ── CHIPS (multi-select) ── */
.multi-select-grid {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
  margin-top: 6px;
}
.check-item {
  display: inline-flex;
  align-items: center;
  padding: 4px 11px;
  border: 1.5px solid var(--borderColor);
  border-radius: 100px;
  cursor: pointer;
  transition: all 130ms ease;
  font-size: 12px;
  font-weight: 500;
  font-family: system-ui, sans-serif;
  background: var(--white);
  color: #555;
  user-select: none;
  white-space: nowrap;
  line-height: 1.5;
}
.check-item:hover {
  border-color: var(--orange500);
  color: var(--orange500);
  background: var(--orange100);
}
.check-item.selected {
  border-color: var(--orange500);
  background: var(--orange500);
  color: #fff;
  font-weight: 600;
}
.check-item input[type="checkbox"] {
  display: none;
}

/* cascade blocks */
.cascade-block {
  display: none;
  margin-top: 8px;
  padding: 10px 12px;
  background: var(--surfaceColor);
  border-left: 2px solid var(--orange500);
  animation: slideDown 160ms ease;
}
.cascade-block.visible {
  display: block;
}
.cascade-block.level-3 {
  border-left-color: var(--orange300);
  margin-left: 10px;
  margin-top: 6px;
}
/* ── CHIP-CASCADE INTERLEAVE: .cci wrappers sit inside flex chip containers ── */
.chip-cascade-wrap {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
  align-items: flex-start;
}
.chip-cascade-wrap .grid-search {
  flex: 0 0 100%;
  margin-bottom: 2px;
}
/* transparent wrapper — chip + cascade both live in the parent flex flow */
.cci {
  display: contents;
}
/* cascade panel: hidden by default; full-width row when visible */
.cci > .cascade-block {
  display: none !important;
  flex: 0 0 100%;
  margin: 2px 0 6px;
  box-sizing: border-box;
}
.cci > .cascade-block.visible {
  display: block !important;
}
/* labelled header strip inside each cascade panel */
.cascade-chip-header {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 10px;
  padding-bottom: 8px;
  border-bottom: 1px solid var(--borderColor);
}
.cascade-chip-label {
  font-size: 11px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.06em;
  color: var(--orange500);
}
.cascade-chip-close {
  margin-left: auto;
  background: none;
  border: none;
  cursor: pointer;
  font-size: 16px;
  line-height: 1;
  color: var(--secondaryText);
  padding: 0 4px;
}
.cascade-chip-close:hover {
  color: var(--orange500);
}

.cascade-block .field-group {
  gap: 8px;
}
.section-divider {
  border: none;
  border-top: 1px solid var(--borderColor);
  margin: 12px 0;
}

.form-footer {
  position: sticky;
  bottom: 0;
  z-index: 150;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 10px 24px;
  background: var(--cardBg);
  border-top: 1px solid var(--borderColor);
}
.footer-left {
  display: flex;
  align-items: center;
  gap: 8px;
}
.footer-right {
  display: flex;
  align-items: center;
  gap: 8px;
}

/* ── START WORKFLOW BUTTON (top right of form, no footer bar) ── */
.btn-start-workflow {
  flex-shrink: 0;
  padding: 8px 18px;
  font-size: 13px;
  font-weight: 600;
  font-family: system-ui, sans-serif;
  background: var(--orange500);
  color: #fff;
  border: none;
  cursor: pointer;
  border-radius: 2px;
  transition: background 140ms ease;
  white-space: nowrap;
}
.btn-start-workflow:hover {
  background: #d44000;
}

/* shared btn */
.btn {
  padding: 8px 18px;
  font-size: 13px;
  font-weight: 600;
  font-family: system-ui, sans-serif;
  cursor: pointer;
  transition: all 140ms ease;
  border: none;
  border-radius: 2px;
}
.btn-primary {
  background: var(--orange500);
  color: #fff;
}
.btn-primary:hover {
  background: #d44000;
}
.btn-secondary {
  background: transparent;
  color: var(--textColor);
  border: 1px solid var(--borderColor);
}
.btn-secondary:hover {
  background: var(--grey100);
}

/* workflow layout */
.workflow-container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 0;
  display: grid;
  grid-template-columns: 260px 1fr;
  gap: 0;
  align-items: stretch;
  height: 100%;
}
.workflow-main {
  min-width: 0;
  overflow-y: auto;
  height: 100%;
}
.workflow-sidebar {
  overflow-y: auto;
  height: 100%;
  background: var(--cardBg);
  border-right: 1px solid var(--borderColor);
  display: flex;
  flex-direction: column;
  box-shadow: 2px 0 8px rgba(0, 0, 0, 0.04);
}
/* Sidebar overall progress summary */
.sidebar-summary {
  padding: 14px 14px 12px;
  border-bottom: 1px solid var(--borderColor);
  background: var(--cardBg);
  flex-shrink: 0;
}
.sidebar-summary-title {
  font-size: 10px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.08em;
  color: var(--secondaryText);
  margin-bottom: 6px;
}
.sidebar-summary-count {
  font-size: 15px;
  font-weight: 700;
  color: var(--textColor);
  margin-bottom: 6px;
  line-height: 1.2;
}
.sidebar-summary-subtext {
  font-size: 11px;
  color: var(--secondaryText);
  margin-bottom: 8px;
}
.sidebar-summary-bar-outer {
  height: 6px;
  background: var(--grey200);
  border-radius: 3px;
  overflow: hidden;
}
.sidebar-summary-bar-inner {
  height: 100%;
  background: var(--orange500);
  border-radius: 3px;
  transition: width 0.3s ease;
  width: 0%;
}
.sidebar-phase-list {
  flex: 1;
  overflow-y: auto;
  padding-top: 4px;
}
.sidebar-header {
  background: var(--orange500);
  padding: 10px 14px;
  color: #fff;
  font-size: 11px;
  font-weight: 500;
  text-transform: uppercase;
  letter-spacing: 0.06em;
}
.sidebar-phase {
  border-bottom: 1px solid var(--borderColor);
}
.sidebar-phase-label {
  padding: 8px 14px 6px;
  font-size: 10px;
  font-weight: 700;
  color: var(--secondaryText);
  text-transform: uppercase;
  letter-spacing: 0.08em;
  background: var(--surfaceColor);
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 6px;
}
.sidebar-phase-count-badge {
  font-size: 10px;
  font-weight: 600;
  color: var(--grey400);
  background: var(--grey200);
  padding: 1px 7px;
  border-radius: 100px;
  white-space: nowrap;
  text-transform: none;
  letter-spacing: 0;
}
.sidebar-phase-count-badge.phase-all-done {
  background: var(--successBg);
  color: var(--success);
}
/* CHANGE 10: keyboard-focusable sidebar items */
.sidebar-item {
  padding: 8px 14px 8px 16px;
  font-size: 12px;
  font-weight: 400;
  color: var(--textColor);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 9px;
  transition: all 120ms ease;
  border-left: 3px solid transparent;
  line-height: 1.3;
}
.sidebar-item:hover {
  background: var(--orange100);
  color: var(--orange500);
}
.sidebar-item:focus {
  outline: 2px solid var(--orange500);
  outline-offset: -2px;
  background: var(--orange100);
  color: var(--orange500);
}
.sidebar-item.active {
  background: var(--orange100);
  color: var(--orange500);
  border-left-color: var(--orange500);
  font-weight: 600;
}
.sidebar-item.completed {
  color: var(--success);
}
.sidebar-item.locked {
  color: var(--grey400);
  cursor: pointer;
}

.step-dot {
  width: 20px;
  height: 20px;
  border-radius: 50%;
  background-color: var(--grey200);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 9px;
  font-weight: 700;
  color: var(--grey500);
  flex-shrink: 0;
  border: 1.5px solid var(--grey300);
}
.sidebar-item.active .step-dot {
  background-color: var(--orange500);
  color: var(--white);
  border-color: var(--orange500);
}
.sidebar-item.completed .step-dot {
  background-color: var(--success);
  color: var(--white);
  border-color: var(--success);
}
.sidebar-item.locked .step-dot {
  border-color: var(--grey200);
}

.workflow-header {
  background: var(--cardBg);
  border-bottom: 1px solid var(--borderColor);
  padding: 16px 24px;
  margin-bottom: 0;
  display: flex;
  align-items: center;
  justify-content: space-between;
  position: sticky;
  top: 0;
  z-index: 150;
  box-shadow: 0 1px 4px rgba(0, 0, 0, 0.06);
}
.workflow-header h2 {
  font-size: 17px;
  font-weight: 700;
  margin-bottom: 3px;
  letter-spacing: -0.01em;
}
.workflow-header p {
  font-size: 12px;
  color: var(--secondaryText);
}
.progress-wrap {
  text-align: right;
}
.workflow-header-actions {
  display: flex;
  align-items: center;
  gap: 16px;
  flex-shrink: 0;
}
.form-progress-wrap {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 8px 24px 8px;
}
.form-progress-label {
  font-size: 12px;
  color: var(--secondaryText);
  white-space: nowrap;
}
.form-sticky-bar {
  background: var(--bgColor);
  border-bottom: 1px solid var(--borderColor);
  padding-bottom: 6px;
  flex-shrink: 0;
}
.progress-label {
  font-size: 12px;
  font-weight: 600;
  color: var(--textColor);
  margin-bottom: 2px;
}
/* CHANGE 6: per-phase breakdown text */
.progress-breakdown {
  font-size: 11px;
  color: var(--secondaryText);
  margin-bottom: 5px;
  opacity: 0.8;
}
.progress-bar {
  width: 180px;
  height: 7px;
  background-color: var(--grey200);
  border-radius: 4px;
  overflow: hidden;
}
.progress-fill {
  height: 100%;
  background-color: var(--orange500);
  border-radius: 4px;
  transition: width 0.3s ease;
}

/* CHANGE 5: Phase filter pill bar */
.phase-filter-bar {
  background: var(--cardBg);
  border-bottom: 1px solid var(--borderColor);
  padding: 10px 24px;
  position: sticky;
  top: 65px;
  z-index: 140;
}
.phase-filter-pills {
  display: flex;
  gap: 6px;
  flex-wrap: wrap;
  align-items: center;
}
.phase-filter-label {
  font-size: 11px;
  font-weight: 600;
  color: var(--secondaryText);
  text-transform: uppercase;
  letter-spacing: 0.06em;
  margin-right: 2px;
  white-space: nowrap;
}
.phase-filter-pill {
  padding: 5px 14px;
  font-size: 12px;
  font-weight: 500;
  border: 1.5px solid var(--borderColor);
  border-radius: 100px;
  background: var(--cardBg);
  color: var(--secondaryText);
  cursor: pointer;
  transition: all 120ms ease;
  font-family: system-ui, sans-serif;
}
.phase-filter-pill:hover {
  border-color: var(--orange300);
  color: var(--orange500);
  background: var(--orange100);
}
.phase-filter-pill:focus {
  outline: 2px solid var(--orange500);
  outline-offset: 2px;
}
.phase-filter-pill.active {
  background: var(--orange500);
  border-color: var(--orange500);
  color: #fff;
  font-weight: 600;
  box-shadow: 0 2px 8px rgba(253, 81, 8, 0.28);
}

/* CHANGE 12: Single workflow tip banner */
.workflow-tip-banner {
  display: flex;
  align-items: center;
  gap: 10px;
  background: #eff6ff;
  border-bottom: 1px solid #bfdbfe;
  padding: 9px 24px;
  font-size: 12px;
  color: #1e40af;
}
.workflow-tip-icon {
  font-size: 14px;
  flex-shrink: 0;
  color: #3b82f6;
}
.workflow-tip-text {
  flex: 1;
  line-height: 1.5;
}
.workflow-tip-dismiss {
  background: none;
  border: none;
  cursor: pointer;
  color: #93c5fd;
  font-size: 14px;
  padding: 2px 6px;
  border-radius: 2px;
  transition: color 120ms;
  font-family: system-ui, sans-serif;
}
.workflow-tip-dismiss:hover {
  color: #1e40af;
}

/* CHANGE 1: Phase divider banners in main card area */
.phase-divider {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 12px 18px;
  margin: 20px 0 10px 0;
  background: var(--cardBg);
  border: 1px solid var(--borderColor);
  border-left: 4px solid var(--orange500);
  border-radius: 6px;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
}
.phase-divider:first-child {
  margin-top: 0;
}
.phase-divider-left {
  display: flex;
  align-items: center;
  gap: 12px;
}
.phase-divider-number {
  font-size: 10px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.08em;
  color: var(--orange500);
  background: var(--orange100);
  padding: 3px 10px;
  border-radius: 100px;
}
.phase-divider-name {
  font-size: 14px;
  font-weight: 700;
  color: var(--textColor);
  letter-spacing: -0.01em;
}
.phase-divider-right {
  display: flex;
  align-items: center;
  gap: 12px;
  flex-shrink: 0;
}
.phase-divider-count {
  font-size: 11px;
  font-weight: 500;
  color: var(--secondaryText);
  white-space: nowrap;
}
.phase-divider-bar-outer {
  width: 90px;
  height: 6px;
  background: var(--grey200);
  border-radius: 3px;
  overflow: hidden;
}
.phase-divider-bar-inner {
  height: 100%;
  background: var(--orange500);
  border-radius: 3px;
  transition: width 0.3s ease;
}

/* CHANGE 3: padding on promptCards container */
#promptCards {
  padding: 16px 24px 40px;
}

.prompt-card {
  background: var(--cardBg);
  border: 1px solid var(--borderColor);
  margin-bottom: 10px;
  overflow: hidden;
  border-left: 4px solid var(--grey200);
  border-radius: 6px;
  box-shadow: 0 1px 4px rgba(0, 0, 0, 0.06);
  transition:
    border-color 200ms ease,
    box-shadow 200ms ease;
}
.prompt-card:hover {
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
}
.prompt-card.active-card {
  border-left-color: var(--orange500);
  box-shadow: 0 2px 8px rgba(253, 81, 8, 0.1);
}
.prompt-card.completed-card {
  border-left-color: var(--success);
  box-shadow: 0 2px 8px rgba(34, 197, 94, 0.08);
}
.prompt-card.locked-card {
  opacity: 0.45;
  pointer-events: none;
  box-shadow: none;
}
/* When navigated to via sidebar, locked card becomes fully accessible */
.prompt-card.locked-card.sidebar-override {
  opacity: 1;
  pointer-events: auto;
  border-left-color: var(--grey300);
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
}

/* CHANGE 4: orange pulse animation on newly unlocked card */
@keyframes cardPulse {
  0% {
    box-shadow: 0 0 0 0 rgba(253, 81, 8, 0);
  }
  30% {
    box-shadow: 0 0 0 6px rgba(253, 81, 8, 0.25);
  }
  70% {
    box-shadow: 0 0 0 10px rgba(253, 81, 8, 0.1);
  }
  100% {
    box-shadow: 0 0 0 0 rgba(253, 81, 8, 0);
  }
}
.prompt-card.card-pulse {
  animation: cardPulse 1.2s ease;
}

/* CHANGE 10: focusable card headers */
.prompt-card-header {
  padding: 14px 18px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  cursor: pointer;
  user-select: none;
  transition: background-color 200ms ease;
  gap: 12px;
}
.prompt-card-header:hover {
  background-color: var(--surfaceColor);
}
.prompt-card-header:focus {
  outline: 2px solid var(--orange500);
  outline-offset: -2px;
}
.prompt-card-header-left {
  display: flex;
  align-items: center;
  gap: 12px;
  min-width: 0;
}
.prompt-card-header-right {
  display: flex;
  align-items: center;
  gap: 10px;
  flex-shrink: 0;
}

.prompt-id {
  font-size: 10px;
  font-weight: 700;
  color: var(--orange500);
  background-color: var(--orange100);
  padding: 3px 10px;
  border-radius: 100px;
  white-space: nowrap;
  letter-spacing: 0.04em;
  flex-shrink: 0;
}
.prompt-card.completed-card .prompt-id {
  color: var(--success);
  background-color: var(--successBg);
  border: 1px solid rgba(34, 197, 94, 0.2);
}
.prompt-card.locked-card .prompt-id {
  color: var(--grey400);
  background-color: var(--surfaceColor);
}

.prompt-name {
  font-size: 14px;
  font-weight: 600;
  letter-spacing: -0.01em;
  line-height: 1.3;
}
.prompt-meta {
  font-size: 12px;
  color: var(--secondaryText);
  margin-top: 2px;
  line-height: 1.4;
}

/* CHANGE 8: dependency sub-label on locked cards */
.dep-sublabel {
  font-size: 11px;
  color: var(--secondaryText);
  margin-top: 2px;
  font-style: italic;
  line-height: 1.4;
}

.status-badge {
  font-size: 11px;
  padding: 4px 12px;
  font-weight: 600;
  border-radius: 100px;
  white-space: nowrap;
  flex-shrink: 0;
}
.badge-ready {
  background-color: var(--orange100);
  color: var(--orange500);
  border: 1px solid rgba(253, 81, 8, 0.15);
}
.badge-done {
  background-color: var(--successBg);
  color: var(--success);
  border: 1px solid rgba(34, 197, 94, 0.2);
}
.badge-locked {
  background-color: var(--surfaceColor);
  color: var(--secondaryText);
  border: 1px solid var(--borderColor);
}

.prompt-card-body {
  display: none;
  padding: 0 20px 20px;
  border-top: 1px solid var(--borderColor);
}
.prompt-card.open .prompt-card-body {
  display: block;
  animation: slideDown 200ms ease;
}

.meta-row {
  display: flex;
  align-items: flex-start;
  gap: 8px;
  margin-top: 12px;
  flex-wrap: wrap;
}
.meta-label {
  font-size: 11px;
  font-weight: 500;
  color: var(--secondaryText);
  text-transform: uppercase;
  letter-spacing: 0.4px;
  white-space: nowrap;
  margin-top: 3px;
}
.dep-tag {
  font-size: 12px;
  padding: 2px 10px;
  background-color: var(--surfaceColor);
  color: var(--secondaryText);
}
.artifact-tag {
  font-size: 12px;
  padding: 3px 10px;
  background-color: #dbeafe;
  color: #3b82f6;
  border: 1px solid #bfdbfe;
}

.prompt-box-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-top: 16px;
  margin-bottom: 6px;
}
.prompt-box-label {
  font-size: 11px;
  font-weight: 500;
  color: var(--secondaryText);
  text-transform: uppercase;
  letter-spacing: 0.4px;
}

/* CHANGE 2: expand/collapse button for prompt text box */
.btn-expand-prompt {
  font-size: 11px;
  font-weight: 500;
  color: var(--secondaryText);
  background: transparent;
  border: 1px solid var(--borderColor);
  border-radius: 6px;
  padding: 4px 10px;
  cursor: pointer;
  transition: all 120ms ease;
  font-family: system-ui, sans-serif;
}
.btn-expand-prompt:hover {
  border-color: var(--orange300);
  color: var(--orange500);
  background: var(--orange100);
}

/* CHANGE 2: prompt text box default smaller, expandable */
.prompt-text-box {
  background-color: #1a1b2e;
  color: #d4d8e8;
  border-radius: 6px;
  padding: 10px 12px;
  font-size: 12px;
  font-family: "Courier New", monospace;
  line-height: 1.6;
  white-space: pre-wrap;
  word-break: break-word;
  max-height: 100px;
  overflow-y: auto;
  border: 1px solid #2a2b3d;
  transition: max-height 300ms ease;
  scrollbar-width: thin;
  scrollbar-color: #3a3b5e #1a1b2e;
}
.prompt-text-box::-webkit-scrollbar {
  width: 5px;
}
.prompt-text-box::-webkit-scrollbar-track {
  background: #1a1b2e;
}
.prompt-text-box::-webkit-scrollbar-thumb {
  background: #3a3b5e;
  border-radius: 3px;
}
.prompt-text-box.prompt-text-expanded {
  max-height: 480px;
}

/* CHANGE 11: Prompt action buttons — clearer hierarchy */
.prompt-actions {
  display: flex;
  gap: 0;
  margin-top: 12px;
  align-items: center;
  flex-wrap: wrap;
}
.prompt-actions-left {
  display: flex;
  gap: 8px;
  align-items: center;
  flex: 1;
  flex-wrap: wrap;
}
.prompt-actions-divider {
  width: 1px;
  height: 32px;
  background: var(--borderColor);
  margin: 0 12px;
  flex-shrink: 0;
}
.prompt-actions-right {
  display: flex;
  gap: 8px;
  align-items: center;
  flex-shrink: 0;
}

/* Primary action */
.btn-copy {
  background-color: var(--orange500);
  color: var(--white);
  padding: 8px 18px;
  font-size: 13px;
  font-weight: 600;
  cursor: pointer;
  border: none;
  border-radius: 6px;
  display: flex;
  align-items: center;
  gap: 6px;
  transition: background-color 200ms ease, box-shadow 200ms ease;
  font-family: system-ui, sans-serif;
  box-shadow: 0 2px 6px rgba(253, 81, 8, 0.25);
}
.btn-copy:hover {
  background-color: #d94000;
  box-shadow: 0 3px 10px rgba(253, 81, 8, 0.35);
}
.btn-copy.copied {
  background-color: var(--success);
  box-shadow: 0 2px 6px rgba(34, 197, 94, 0.25);
}

/* Secondary/ghost utility actions — CHANGE 11 */
.btn-secondary-action {
  background: transparent;
  color: var(--secondaryText);
  padding: 6px 12px;
  font-size: 12px;
  font-weight: 500;
  cursor: pointer;
  border: 1px solid var(--borderColor);
  border-radius: 6px;
  transition: all 200ms ease;
  font-family: system-ui, sans-serif;
}
.btn-secondary-action:hover {
  background: var(--grey100);
  color: var(--textColor);
  border-color: var(--grey400);
}

.copy-hint {
  font-size: 12px;
  color: var(--secondaryText);
}

/* CHANGE 11: Export as secondary ghost */
.btn-export {
  background: transparent;
  color: var(--secondaryText);
  padding: 6px 12px;
  font-size: 12px;
  font-weight: 500;
  cursor: pointer;
  border: 1px solid var(--borderColor);
  border-radius: 6px;
  transition: all 200ms ease;
  font-family: system-ui, sans-serif;
}
.btn-export:hover {
  background: var(--grey100);
  color: var(--textColor);
  border-color: var(--grey400);
}
.btn-export.exported {
  background: var(--successBg);
  color: var(--success);
  border-color: var(--success);
}

/* CHANGE 12: export-hint hidden — replaced by single tip banner */
.export-hint {
  display: none;
}

.stage-gate {
  background-color: var(--warningBg);
  border-left: 4px solid var(--warning);
  padding: 16px 20px;
  font-size: 13px;
  margin-top: 12px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.error-msg {
  background-color: #fee2e2;
  border-left: 4px solid #ef4444;
  padding: 12px 16px;
  font-size: 13px;
  color: #991b1b;
  margin-bottom: 16px;
}
/* #formPage.active — defined in new form CSS below */
.form-scroll-body {
  flex: 1;
  overflow-y: auto;
}
#workflowPage.active {
  position: fixed;
  top: 41px;
  left: 0;
  right: 0;
  bottom: 0;
  overflow: hidden;
}
.guidance-panel {
  display: none;
  position: fixed;
  bottom: 24px;
  right: 24px;
  z-index: 1000;
  width: 340px;
  background: #fff;
  border: 1px solid var(--borderColor);
  border-radius: 6px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.14);
  font-family: system-ui, sans-serif;
}
.guidance-panel.visible {
  display: block;
}
.guidance-panel-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 10px 14px;
  background: var(--orange500);
  border-radius: 6px 6px 0 0;
}
.guidance-panel-title {
  font-size: 11px;
  font-weight: 700;
  color: #fff;
  text-transform: uppercase;
  letter-spacing: 0.06em;
}
.guidance-panel-counter {
  font-size: 11px;
  color: rgba(255, 255, 255, 0.75);
}
.guidance-panel-body {
  padding: 14px;
}
.guidance-panel-step-title {
  font-size: 14px;
  font-weight: 700;
  color: var(--textColor);
  margin-bottom: 6px;
}
.guidance-panel-text {
  font-size: 13px;
  color: #555;
  line-height: 1.6;
  margin: 0 0 8px;
}
.guidance-panel-example {
  font-size: 12px;
  color: var(--secondaryText);
  background: var(--surfaceColor);
  border-left: 2px solid var(--orange300);
  padding: 8px 10px;
  line-height: 1.5;
}
.guidance-panel-footer {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 10px 14px;
  border-top: 1px solid var(--borderColor);
  background: var(--surfaceColor);
  border-radius: 0 0 6px 6px;
}
.guidance-panel-skip {
  font-size: 11px;
  color: var(--secondaryText);
  background: none;
  border: none;
  cursor: pointer;
  padding: 0;
}
.guidance-panel-skip:hover {
  color: var(--textColor);
}
.guidance-panel-actions {
  display: flex;
  gap: 8px;
}
.btn-guidance-back {
  padding: 6px 14px;
  font-size: 12px;
  font-weight: 600;
  background: #fff;
  border: 1px solid var(--borderColor);
  cursor: pointer;
  border-radius: 3px;
}
.btn-guidance-next {
  padding: 6px 14px;
  font-size: 12px;
  font-weight: 600;
  background: var(--orange500);
  color: #fff;
  border: none;
  cursor: pointer;
  border-radius: 3px;
}
.btn-guidance-next:hover {
  background: #d44000;
}
.guidance-highlight {
  outline: 2px solid var(--orange500);
  outline-offset: 3px;
}
/* ── CHUNK 1: Section completion indicators ── */
.section-header {
  position: relative;
}
.section-status-dot {
  width: 9px;
  height: 9px;
  border-radius: 50%;
  background: var(--grey300);
  flex-shrink: 0;
  transition: background 200ms ease;
  margin-left: 4px;
}
.section-status-dot.complete {
  background: var(--success);
}
.section-status-dot.partial {
  background: var(--warning);
}
.section-status-dot.empty {
  background: #e57373;
}

/* ── CHUNK 1: Draft restore banner ── */
#draftBanner {
  display: none;
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  background: #1e293b;
  color: #fff;
  padding: 12px 24px;
  z-index: 999;
  display: none;
  align-items: center;
  justify-content: space-between;
  font-size: 13px;
  gap: 16px;
}
#draftBanner.visible {
  display: flex;
}
.draft-banner-actions {
  display: flex;
  gap: 8px;
  flex-shrink: 0;
}
.btn-draft-restore {
  padding: 6px 14px;
  font-size: 12px;
  font-weight: 600;
  background: var(--orange500);
  color: #fff;
  border: none;
  border-radius: 2px;
  cursor: pointer;
}
.btn-draft-dismiss {
  padding: 6px 14px;
  font-size: 12px;
  font-weight: 500;
  background: transparent;
  color: #aaa;
  border: 1px solid #444;
  border-radius: 2px;
  cursor: pointer;
}
.btn-draft-restore:hover {
  background: #d44000;
}
.btn-draft-dismiss:hover {
  color: #fff;
  border-color: #888;
}

/* CHUNK 2 — BRIEF STRENGTH + REVIEW PANEL */
.brief-strength-wrap {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 8px 24px 8px;
}
.brief-strength-label {
  font-size: 12px;
  color: var(--secondaryText);
  white-space: nowrap;
}
.brief-strength-bar-outer {
  flex: 1;
  height: 8px;
  background: var(--grey200);
  border-radius: 4px;
  overflow: hidden;
}
.brief-strength-bar-inner {
  height: 100%;
  border-radius: 4px;
  transition:
    width 400ms ease,
    background 400ms ease;
  width: 0%;
}
.brief-strength-badge {
  font-size: 11px;
  font-weight: 700;
  padding: 2px 10px;
  border-radius: 100px;
  white-space: nowrap;
}
.strength-weak {
  background: #ffebee;
  color: #c62828;
}
.strength-fair {
  background: var(--warningBg);
  color: #92400e;
}
.strength-strong {
  background: #e8f5e9;
  color: #1b5e20;
}
.strength-excellent {
  background: #e8f5e9;
  color: #16a34a;
}
.bar-weak {
  background: #e57373;
}
.bar-fair {
  background: var(--warning);
}
.bar-strong {
  background: var(--success);
}
.bar-excellent {
  background: #16a34a;
}
.btn-load-example {
  padding: 6px 14px;
  font-size: 12px;
  font-weight: 500;
  background: transparent;
  color: var(--secondaryText);
  border: 1px solid var(--borderColor);
  border-radius: 2px;
  cursor: pointer;
  transition: all 140ms ease;
  white-space: nowrap;
}
.btn-load-example:hover {
  background: var(--grey100);
  color: var(--textColor);
  border-color: var(--grey400);
}
#reviewOverlay {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.45);
  z-index: 600;
  align-items: center;
  justify-content: center;
}
#reviewOverlay.visible {
  display: flex;
}
#reviewPanel {
  background: var(--cardBg);
  width: 680px;
  max-width: 95vw;
  max-height: 85vh;
  border-radius: 4px;
  display: flex;
  flex-direction: column;
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.25);
  animation: slideDown 200ms ease;
}
#reviewPanel-header {
  padding: 16px 20px;
  border-bottom: 1px solid var(--borderColor);
  display: flex;
  align-items: center;
  justify-content: space-between;
  flex-shrink: 0;
}
#reviewPanel-header h3 {
  font-size: 16px;
  font-weight: 600;
}
#reviewPanel-header p {
  font-size: 12px;
  color: var(--secondaryText);
  margin-top: 2px;
}
.review-close-btn {
  background: none;
  border: none;
  font-size: 20px;
  cursor: pointer;
  color: var(--secondaryText);
  line-height: 1;
  padding: 4px;
}
.review-close-btn:hover {
  color: var(--textColor);
}
#reviewPanel-body {
  overflow-y: auto;
  padding: 16px 20px;
  flex: 1;
}
.review-section {
  margin-bottom: 16px;
}
.review-section-title {
  font-size: 11px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.06em;
  color: var(--secondaryText);
  margin-bottom: 8px;
  padding-bottom: 4px;
  border-bottom: 1px solid var(--borderColor);
}
.review-row {
  display: flex;
  gap: 8px;
  margin-bottom: 4px;
  font-size: 12px;
  align-items: flex-start;
}
.review-key {
  color: var(--secondaryText);
  min-width: 160px;
  flex-shrink: 0;
  padding-top: 5px;
}
.review-val {
  color: var(--textColor);
  font-weight: 500;
  flex: 1;
  cursor: pointer;
  padding: 4px 6px;
  border-radius: 3px;
  border: 1px solid transparent;
  transition:
    border-color 120ms,
    background 120ms;
}
.review-val:hover {
  border-color: var(--borderColor);
  background: var(--grey100);
}
.review-val.editing {
  border-color: var(--orange500) !important;
  background: #fff !important;
  cursor: text;
}
.review-val.missing {
  color: #e57373;
  font-style: italic;
  font-weight: 400;
}
.review-val-input {
  width: 100%;
  padding: 4px 6px;
  border: 1px solid var(--orange500);
  border-radius: 3px;
  font-size: 12px;
  font-family: system-ui;
  color: var(--textColor);
  font-weight: 500;
  background: #fff;
  box-sizing: border-box;
  resize: vertical;
}
.review-edit-hint {
  font-size: 10px;
  color: var(--secondaryText);
  margin-bottom: 6px;
  font-style: italic;
}
.review-list-item {
  font-size: 12px;
  padding: 3px 0;
  color: var(--textColor);
  border-bottom: 1px dashed var(--borderColor);
}
.review-list-item:last-child {
  border-bottom: none;
}
.review-callout {
  background: var(--warningBg);
  border-left: 3px solid var(--warning);
  padding: 8px 12px;
  font-size: 12px;
  color: #78350f;
  border-radius: 0 2px 2px 0;
  margin-top: 8px;
}
#reviewPanel-footer {
  padding: 14px 20px;
  border-top: 1px solid var(--borderColor);
  display: flex;
  align-items: center;
  justify-content: flex-end;
  gap: 10px;
  flex-shrink: 0;
}
.btn-review-back {
  padding: 8px 18px;
  font-size: 13px;
  font-weight: 500;
  background: transparent;
  color: var(--textColor);
  border: 1px solid var(--borderColor);
  border-radius: 2px;
  cursor: pointer;
}
.btn-review-back:hover {
  background: var(--grey100);
}
.btn-review-launch {
  padding: 8px 20px;
  font-size: 13px;
  font-weight: 600;
  background: var(--orange500);
  color: #fff;
  border: none;
  border-radius: 2px;
  cursor: pointer;
}
.btn-review-launch:hover {
  background: #d44000;
}

/* CHUNK 3 — REOPEN, STAGE GATE MODAL, INLINE EDIT */
/* CHANGE 11: Reopen as secondary ghost — right side */
.btn-reopen {
  background: transparent;
  color: var(--secondaryText);
  padding: 6px 12px;
  font-size: 12px;
  font-weight: 500;
  cursor: pointer;
  border: 1px solid var(--borderColor);
  border-radius: 6px;
  transition: all 140ms ease;
  display: none;
  font-family: system-ui, sans-serif;
}
.btn-reopen:hover {
  background: var(--grey100);
  color: var(--textColor);
}
.completed-card .btn-reopen {
  display: inline-flex;
}
.completed-card .btn-mark-done {
  display: none;
}
/* CHANGE 11: Mark Complete — green outline, right-side state-change action */
.btn-mark-done {
  background: transparent;
  color: var(--success);
  padding: 7px 16px;
  font-size: 13px;
  font-weight: 600;
  cursor: pointer;
  border: 1.5px solid var(--success);
  border-radius: 6px;
  transition: all 200ms ease;
  font-family: system-ui, sans-serif;
  white-space: nowrap;
}
.btn-mark-done:hover {
  background-color: var(--success);
  color: var(--white);
  box-shadow: 0 2px 6px rgba(34, 197, 94, 0.3);
}
/* CHANGE 11: Edit as small secondary ghost */
.btn-edit-prompt {
  background: transparent;
  color: var(--secondaryText);
  padding: 6px 12px;
  font-size: 12px;
  font-weight: 500;
  cursor: pointer;
  border: 1px solid var(--borderColor);
  border-radius: 6px;
  transition: all 140ms ease;
  font-family: system-ui, sans-serif;
}
.btn-edit-prompt:hover {
  background: var(--grey100);
  color: var(--textColor);
}
.btn-edit-prompt.active {
  background: var(--orange100);
  color: var(--orange500);
  border-color: var(--orange500);
}
.prompt-text-box[contenteditable="true"] {
  outline: 2px solid var(--orange300);
  background: #fffdf9;
  cursor: text;
}
#gateModal {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.45);
  z-index: 700;
  align-items: center;
  justify-content: center;
}
#gateModal.visible {
  display: flex;
}
#gateModalBox {
  background: var(--cardBg);
  width: 460px;
  max-width: 95vw;
  border-radius: 4px;
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.25);
  animation: slideDown 200ms ease;
  overflow: hidden;
}
#gateModalBox .gate-modal-header {
  background: var(--warningBg);
  border-bottom: 1px solid #fde68a;
  padding: 20px 24px;
  display: flex;
  align-items: center;
  gap: 10px;
}
#gateModalBox .gate-modal-icon {
  font-size: 20px;
}
#gateModalBox .gate-modal-title {
  font-size: 15px;
  font-weight: 600;
  color: #78350f;
}
#gateModalBox .gate-modal-body {
  padding: 20px 24px;
  font-size: 13px;
  color: var(--textColor);
  line-height: 1.7;
}
#gateModalBox .gate-modal-body p {
  margin-bottom: 12px;
}
#gateModalBox .gate-modal-checklist {
  list-style: none;
  margin: 8px 0 0;
  padding: 0;
}
#gateModalBox .gate-modal-checklist li {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 6px 0;
  border-bottom: 1px solid var(--borderColor);
  font-size: 12px;
}
#gateModalBox .gate-modal-checklist li:last-child {
  border-bottom: none;
}
#gateModalBox .gate-modal-checklist input[type="checkbox"] {
  width: 15px;
  height: 15px;
  accent-color: var(--orange500);
  flex-shrink: 0;
}
#gateModalBox .gate-modal-footer {
  padding: 16px 24px;
  border-top: 1px solid var(--borderColor);
  display: flex;
  justify-content: flex-end;
  gap: 10px;
}
.btn-gate-cancel {
  padding: 8px 16px;
  font-size: 13px;
  font-weight: 500;
  background: transparent;
  color: var(--textColor);
  border: 1px solid var(--borderColor);
  border-radius: 2px;
  cursor: pointer;
}
.btn-gate-cancel:hover {
  background: var(--grey100);
}
.btn-gate-confirm {
  padding: 8px 18px;
  font-size: 13px;
  font-weight: 600;
  background: var(--orange500);
  color: #fff;
  border: none;
  border-radius: 2px;
  cursor: pointer;
  opacity: 0.45;
  pointer-events: none;
  transition: all 140ms ease;
}
.btn-gate-confirm.ready {
  opacity: 1;
  pointer-events: auto;
}
.btn-gate-confirm.ready:hover {
  background: #d44000;
}
#resumeModal {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.45);
  z-index: 700;
  align-items: center;
  justify-content: center;
}
#resumeModal.visible {
  display: flex;
}
#resumeModalBox {
  background: var(--cardBg);
  width: 420px;
  max-width: 95vw;
  border-radius: 4px;
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.25);
  animation: slideDown 200ms ease;
  overflow: hidden;
}
#sparseBriefModal {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.45);
  z-index: 700;
  align-items: center;
  justify-content: center;
}
#sparseBriefModal.visible {
  display: flex;
}
#sparseBriefModalBox {
  background: var(--cardBg);
  width: 460px;
  max-width: 95vw;
  border-radius: 10px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.18);
  overflow: hidden;
}
#sparseBriefModalBox .gate-modal-header {
  background: var(--warningBg);
  border-bottom: 1px solid #fde68a;
  padding: 20px 24px;
  display: flex;
  align-items: center;
  gap: 10px;
}
#sparseBriefModalBox .gate-modal-icon {
  font-size: 20px;
}
#sparseBriefModalBox .gate-modal-title {
  font-size: 15px;
  font-weight: 600;
  color: #78350f;
}
#sparseBriefModalBox .gate-modal-body {
  padding: 20px 24px;
  font-size: 13px;
  color: var(--textColor);
  line-height: 1.7;
}
#sparseBriefModalBox .gate-modal-body p {
  margin-bottom: 12px;
}
#sparseBriefModalBox .gate-modal-body p:last-child {
  margin-bottom: 0;
}
#sparseBriefModalBox .gate-modal-footer {
  padding: 16px 24px;
  border-top: 1px solid var(--borderColor);
  display: flex;
  justify-content: space-between;
  gap: 10px;
}
#sparseBriefModalBox .btn-gate-confirm {
  opacity: 1;
  pointer-events: auto;
}
.resume-modal-header {
  padding: 16px 20px;
  border-bottom: 1px solid var(--borderColor);
  font-size: 15px;
  font-weight: 600;
}
.resume-modal-body {
  padding: 16px 20px;
  font-size: 13px;
  color: var(--textColor);
  line-height: 1.6;
}
.resume-modal-footer {
  padding: 14px 20px;
  border-top: 1px solid var(--borderColor);
  display: flex;
  justify-content: flex-end;
  gap: 10px;
}
.btn-resume-restart {
  padding: 8px 16px;
  font-size: 13px;
  font-weight: 500;
  background: transparent;
  color: var(--textColor);
  border: 1px solid var(--borderColor);
  border-radius: 2px;
  cursor: pointer;
}
.btn-resume-restart:hover {
  background: var(--grey100);
}
.btn-resume-continue {
  padding: 8px 18px;
  font-size: 13px;
  font-weight: 600;
  background: var(--orange500);
  color: #fff;
  border: none;
  border-radius: 2px;
  cursor: pointer;
}
.btn-resume-continue:hover {
  background: #d44000;
}

/* CHUNK 4 */
#toastContainer {
  position: fixed;
  top: 20px;
  right: 20px;
  z-index: 9999;
  display: flex;
  flex-direction: column;
  gap: 8px;
  pointer-events: none;
}
.toast {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 12px 16px;
  border-radius: 6px;
  font-size: 13px;
  font-weight: 500;
  color: #fff;
  min-width: 260px;
  max-width: 360px;
  box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
  animation: slideDown 250ms ease;
  pointer-events: auto;
  cursor: pointer;
}
.toast-info {
  background: #1e293b;
}
.toast-success {
  background: #16a34a;
}
.toast-warning {
  background: #d97706;
}
.toast-error {
  background: #c62828;
}
.toast-icon {
  font-size: 15px;
  flex-shrink: 0;
}
.toast-msg {
  flex: 1;
  line-height: 1.4;
}
.toast-close {
  font-size: 16px;
  opacity: 0.7;
  cursor: pointer;
  flex-shrink: 0;
}
.toast-close:hover {
  opacity: 1;
}
.nav-pill.pill-partial {
  border-color: var(--orange300);
  background: var(--orange100);
  color: var(--orange500);
}
.nav-pill.pill-complete {
  border-color: var(--success);
  background: #dcfce7;
  color: #16a34a;
  font-weight: 600;
}
.grid-search {
  width: 100%;
  padding: 7px 10px;
  font-size: 12px;
  border: 1px solid var(--borderColor);
  border-radius: 2px;
  margin-bottom: 8px;
  font-family: system-ui, sans-serif;
  background: var(--cardBg);
  color: var(--textColor);
  outline: none;
  box-sizing: border-box;
}
.grid-search:focus {
  border-color: var(--orange300);
}
.check-item.hidden {
  display: none !important;
}
.bb-info-btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 16px;
  height: 16px;
  border-radius: 50%;
  background: var(--grey200);
  color: var(--secondaryText);
  font-size: 10px;
  font-weight: 700;
  cursor: pointer;
  flex-shrink: 0;
  border: none;
  line-height: 1;
  transition: background 120ms ease;
  margin-left: 4px;
  vertical-align: middle;
}
.bb-info-btn:hover {
  background: var(--orange300);
  color: #fff;
}
#bbTooltip {
  display: none;
  position: fixed;
  z-index: 800;
  background: #1e293b;
  color: #f1f5f9;
  font-size: 11px;
  line-height: 1.5;
  padding: 10px 12px;
  border-radius: 3px;
  width: 280px;
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.25);
  pointer-events: none;
}
#bbTooltip.visible {
  display: block;
}
.btn-bulk-export {
  padding: 7px 16px;
  font-size: 12px;
  font-weight: 600;
  background: transparent;
  color: var(--secondaryText);
  border: 1px solid var(--borderColor);
  border-radius: 6px;
  cursor: pointer;
  transition: all 140ms ease;
  white-space: nowrap;
  display: flex;
  align-items: center;
  gap: 6px;
}
.btn-bulk-export:hover {
  background: var(--grey100);
  color: var(--textColor);
  border-color: var(--grey400);
}
.btn-bulk-export.exported {
  background: var(--successBg);
  color: var(--success);
  border-color: var(--success);
}

/* BB tags inside domain columns — compact toggleable */
.cascade-container-flex .check-item {
  width: 100%;
  border-radius: 4px;
  justify-content: space-between;
  padding: 5px 10px;
  font-size: 12px;
  transition:
    background 120ms ease,
    border-color 120ms ease,
    color 120ms ease;
}
.cascade-container-flex .check-item.selected {
  background: var(--orange500);
  border-color: var(--orange500);
  color: #fff;
}
.cascade-container-flex .check-item.selected .bb-info-btn {
  background: rgba(255, 255, 255, 0.25);
  color: #fff;
}

/* S5–S8: flex-wrap chip containers with .cci interleave support */
#techCategoryGrid,
#partnerGrid,
#regulatoryIndustryGrid,
#riskIndustryGrid,
#objectiveTypeGrid,
#domainGrid {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
  align-items: flex-start;
}
/* search input always full width */
#techCategoryGrid .grid-search,
#partnerGrid .grid-search,
#regulatoryIndustryGrid .grid-search,
#riskIndustryGrid .grid-search,
#objectiveTypeGrid .grid-search,
#domainGrid .grid-search {
  flex: 0 0 100%;
}
/* chips: natural pill width — auto-wrap gives multi-col appearance */
#techCategoryGrid > .cci > .check-item {
  min-width: calc(50% - 6px);
  flex: 1 1 calc(50% - 6px);
  border-radius: 4px;
  justify-content: center;
  text-align: center;
}
#partnerGrid > .cci > .check-item {
  min-width: calc(33% - 6px);
  flex: 1 1 calc(33% - 6px);
  border-radius: 4px;
  justify-content: center;
  text-align: center;
}
#regulatoryIndustryGrid > .cci > .check-item {
  min-width: calc(50% - 6px);
  flex: 1 1 calc(50% - 6px);
  border-radius: 4px;
  justify-content: center;
  text-align: center;
}
#riskIndustryGrid > .cci > .check-item {
  min-width: calc(50% - 6px);
  flex: 1 1 calc(50% - 6px);
  border-radius: 4px;
  justify-content: center;
  text-align: center;
}
/* cascade panels always span the full container width */
#techCategoryGrid > .cci > .cascade-block,
#partnerGrid > .cci > .cascade-block,
#regulatoryIndustryGrid > .cci > .cascade-block,
#riskIndustryGrid > .cci > .cascade-block,
#objectiveTypeGrid > .cci > .cascade-block,
#domainGrid > .cci > .cascade-block {
  flex: 0 0 100%;
}

/* S2 Industry breadcrumb */
.industry-breadcrumb-row {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 12px 0;
  flex-wrap: wrap;
}
.industry-step {
  display: flex;
  flex-direction: column;
  gap: 4px;
  flex: 1;
  min-width: 160px;
}
.industry-step-label {
  font-size: 10px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.06em;
  color: var(--secondaryText);
}
.industry-select {
  padding: 7px 10px;
  font-size: 13px;
  border: 1px solid var(--borderColor);
  border-radius: 3px;
  background: var(--cardBg);
  color: var(--textColor);
  font-family: system-ui, sans-serif;
  width: 100%;
}
.industry-select:focus {
  outline: none;
  border-color: var(--orange300);
}
.industry-select:disabled {
  background: var(--grey100);
  color: var(--grey400);
  cursor: not-allowed;
}
.industry-arrow {
  font-size: 20px;
  color: var(--grey400);
  flex-shrink: 0;
  padding-top: 16px;
}

/* S7/S8 regulator/risk checkbox list */
.reg-regulator-row {
  margin-bottom: 6px;
}
.reg-checkbox-label {
  display: flex;
  align-items: center;
  gap: 8px;
  cursor: pointer;
  padding: 6px 8px;
  border-radius: 3px;
  border: 1px solid var(--borderColor);
  background: var(--cardBg);
  font-size: 12px;
  font-weight: 600;
  color: var(--textColor);
  transition: background 120ms;
}
.reg-checkbox-label:hover {
  background: var(--grey100);
}
.reg-checkbox {
  width: 14px;
  height: 14px;
  accent-color: var(--orange500);
  flex-shrink: 0;
}
.req-chips-wrap {
  display: flex;
  flex-wrap: wrap;
  gap: 4px;
  padding: 8px 6px 4px;
}
.req-chip {
  display: inline-flex;
  align-items: center;
  gap: 5px;
  padding: 4px 9px;
  font-size: 11px;
  border: 1px solid var(--borderColor);
  border-radius: 100px;
  cursor: pointer;
  background: var(--cardBg);
  color: var(--textColor);
  transition: all 120ms;
  line-height: 1.3;
}
.req-chip:hover {
  border-color: var(--orange300);
  background: var(--orange100);
}
.req-chip input[type="checkbox"] {
  width: 12px;
  height: 12px;
  accent-color: var(--orange500);
  flex-shrink: 0;
  margin: 0;
}
.req-chip:has(input:checked) {
  background: var(--orange500);
  border-color: var(--orange500);
  color: #fff;
}

/* ══════════════════════════════════════
       FORM BUILDER — NEW DESIGN
       ══════════════════════════════════════ */

/* Page visibility — formPage hidden by default, shown via .active */
#formPage {
  display: none;
}
#formPage.active {
  display: flex !important;
  flex-direction: column;
  position: fixed;
  top: 41px;
  left: 0;
  right: 0;
  bottom: 0;
  overflow: hidden;
  background: #f4f5f6;
}

/* ── Topbar ── */

/* ══════════════════════════════════════
       REBUILT FORM PAGE — v8
    ══════════════════════════════════════ */

#formPage {
  display: none;
}
#formPage.active {
  display: flex !important;
  flex-direction: column;
  position: fixed;
  top: 41px;
  left: 0;
  right: 0;
  bottom: 0;
  overflow: hidden;
  background: #f2f3f5;
}

/* ── Top bar ── */
.fb-topbar {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 24px;
  height: 52px;
  background: #fff;
  border-bottom: 1px solid var(--borderColor);
  flex-shrink: 0;
  z-index: 10;
}
.fb-topbar-left {
  display: flex;
  align-items: center;
}
.fb-topbar-brand {
  display: flex;
  align-items: center;
  gap: 10px;
}
.fb-topbar-title {
  font-size: 14px;
  font-weight: 700;
  color: var(--textColor);
}
.fb-topbar-divider {
  width: 1px;
  height: 16px;
  background: var(--borderColor);
}
.fb-topbar-sub {
  font-size: 13px;
  color: var(--secondaryText);
}
.fb-topbar-right {
  display: flex;
  align-items: center;
  gap: 12px;
}

.fb-btn-primary {
  padding: 8px 20px;
  background: var(--orange500);
  color: #fff;
  border: none;
  border-radius: 4px;
  font-size: 13px;
  font-weight: 600;
  cursor: pointer;
  transition: opacity 140ms;
}
.fb-btn-primary:hover {
  opacity: 0.87;
}
.fb-btn-ghost {
  padding: 7px 14px;
  background: transparent;
  color: var(--textColor);
  border: 1px solid var(--borderColor);
  border-radius: 4px;
  font-size: 13px;
  cursor: pointer;
  transition: background 120ms;
}
.fb-btn-ghost:hover {
  background: var(--grey100);
}

/* Brief strength */
.brief-strength-wrap {
  display: flex;
  align-items: center;
  gap: 8px;
}
.brief-strength-label {
  font-size: 11px;
  font-weight: 600;
  color: var(--secondaryText);
  text-transform: uppercase;
  letter-spacing: 0.05em;
}
.brief-strength-bar-bg {
  width: 130px;
  height: 6px;
  background: var(--grey200);
  border-radius: 3px;
  overflow: hidden;
}
.brief-strength-bar {
  height: 100%;
  width: 0%;
  background: var(--orange500);
  border-radius: 3px;
  transition:
    width 400ms ease,
    background 400ms ease;
}
.brief-strength-value {
  font-size: 12px;
  font-weight: 600;
  color: var(--orange500);
  min-width: 56px;
}

/* ── Stepper ── */
.fb-stepper {
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 0 32px;
  height: 56px;
  background: #fff;
  border-bottom: 1px solid var(--borderColor);
  flex-shrink: 0;
  gap: 0;
  overflow-x: auto;
}
.fb-stepper::-webkit-scrollbar {
  display: none;
}
.fb-step {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 3px;
  cursor: pointer;
  padding: 0 4px;
  flex-shrink: 0;
}
.fb-step-num {
  width: 26px;
  height: 26px;
  border-radius: 50%;
  background: var(--grey200);
  color: var(--secondaryText);
  font-size: 11px;
  font-weight: 700;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 180ms;
  position: relative;
}
.fb-step-label {
  font-size: 10px;
  font-weight: 500;
  color: var(--secondaryText);
  transition: color 180ms;
  white-space: nowrap;
}
.fb-step.active .fb-step-num {
  background: var(--orange500);
  color: #fff;
  box-shadow: 0 0 0 4px rgba(253, 81, 8, 0.2);
}
.fb-step.active .fb-step-label {
  color: var(--orange500);
  font-weight: 700;
}
.fb-step.done .fb-step-num {
  background: #22c55e;
  color: #fff;
  font-size: 0;
}
.fb-step.done .fb-step-num::after {
  content: "✓";
  font-size: 13px;
}
.fb-step.done .fb-step-label {
  color: #16a34a;
}
.fb-step.partial .fb-step-num {
  background: var(--orange300);
  color: #fff;
}
.fb-step.partial .fb-step-label {
  color: var(--orange500);
}
.fb-step:hover:not(.active) .fb-step-num {
  background: var(--grey300);
}
.fb-step-line {
  flex: 1;
  height: 1px;
  background: var(--borderColor);
  min-width: 16px;
  max-width: 48px;
  margin-bottom: 14px;
}

/* ── Panels ── */
.fb-panels {
  flex: 1;
  overflow: hidden;
  position: relative;
}
.fb-panel {
  display: none;
  position: absolute;
  inset: 0;
  overflow-y: auto;
  padding: 28px 32px 100px;
}
.fb-panel.active {
  display: block;
  animation: fbPanelIn 200ms ease;
}
@keyframes fbPanelIn {
  from {
    opacity: 0;
    transform: translateY(8px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}
.fb-panel-inner {
  max-width: 900px;
  margin: 0 auto;
}
.fb-panel-heading {
  margin-bottom: 24px;
}
.fb-panel-title {
  font-size: 20px;
  font-weight: 700;
  color: var(--textColor);
  margin: 0 0 6px;
}
.fb-panel-desc {
  font-size: 13px;
  color: var(--secondaryText);
  margin: 0;
  line-height: 1.6;
}

/* ── Form grid (S1) ── */
.fb-form-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 16px;
  margin-bottom: 16px;
}
.fb-field {
  display: flex;
  flex-direction: column;
  gap: 5px;
}
.fb-field-full {
  grid-column: 1 / -1;
}
.fb-label {
  font-size: 12px;
  font-weight: 600;
  color: var(--textColor);
}
.fb-req {
  color: var(--orange500);
}
.fb-field input[type="text"],
.fb-field input[type="date"],
.fb-field select,
.fb-field textarea {
  padding: 9px 12px;
  border: 1px solid var(--borderColor);
  border-radius: 4px;
  font-size: 13px;
  font-family: system-ui, sans-serif;
  color: var(--textColor);
  background: #fff;
  transition: border-color 120ms;
  width: 100%;
  box-sizing: border-box;
}
.fb-field select {
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='6' viewBox='0 0 10 6'%3E%3Cpath fill='%23B5BCC4' d='M5 6L0 0h10z'/%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 12px center;
  padding-right: 32px;
  appearance: none;
  -webkit-appearance: none;
  cursor: pointer;
}
.fb-field input:focus,
.fb-field select:focus,
.fb-field textarea:focus {
  outline: none;
  border-color: var(--orange500);
  box-shadow: 0 0 0 3px rgba(253, 81, 8, 0.1);
}
.fb-field-error {
  font-size: 11px;
  color: #ef4444;
  min-height: 14px;
}
.fb-required.has-error input,
.fb-required.has-error select {
  border-color: #ef4444;
}
.fb-field textarea {
  resize: vertical;
  min-height: 90px;
}

/* ── Industry cascade (S2) ── */
.fb-cascade {
  display: grid;
  grid-template-columns: 1fr auto 1fr auto 1fr;
  gap: 0;
  align-items: start;
  background: #fff;
  border: 1px solid var(--borderColor);
  border-radius: 6px;
  overflow: hidden;
}
.fb-cascade-col {
  padding: 20px;
  min-height: 300px;
}
.fb-cascade-col + .fb-cascade-col {
  border-left: 1px solid var(--borderColor);
}
.fb-cascade-arrow {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 24px;
  color: var(--grey300);
  font-size: 18px;
  padding-top: 52px;
  flex-shrink: 0;
}
.fb-cascade-label {
  font-size: 11px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.07em;
  color: var(--secondaryText);
  margin-bottom: 12px;
}
.fb-cascade-placeholder {
  font-size: 12px;
  color: var(--grey400);
  font-style: italic;
}
.fb-cascade-dim {
  opacity: 0.45;
  pointer-events: none;
  transition: opacity 200ms;
}
.fb-cascade-dim.ready {
  opacity: 1;
  pointer-events: all;
}

/* ── Pills (industry cascade + general) ── */
.fb-pill-grid {
  display: flex;
  flex-direction: column;
  gap: 4px;
}
.fb-pill {
  display: block;
  padding: 7px 12px;
  border: 1px solid var(--borderColor);
  border-radius: 4px;
  font-size: 12px;
  font-weight: 500;
  cursor: pointer;
  background: #fff;
  color: var(--textColor);
  transition: all 100ms;
  text-align: left;
}
.fb-pill:hover {
  border-color: var(--orange300);
  background: var(--orange100);
  color: var(--orange500);
}
.fb-pill.selected {
  background: var(--orange500);
  border-color: var(--orange500);
  color: #fff;
  font-weight: 600;
}

/* ── Split layout (S3-S8) ── */
.fb-split {
  display: grid;
  grid-template-columns: 220px 1fr;
  gap: 0;
  background: #fff;
  border: 1px solid var(--borderColor);
  border-radius: 6px;
  overflow: hidden;
  min-height: 420px;
}
.fb-split-left {
  border-right: 1px solid var(--borderColor);
  padding: 16px 0;
  overflow-y: auto;
}
.fb-split-right {
  padding: 20px;
  overflow-y: auto;
}
.fb-split-label {
  font-size: 10px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.08em;
  color: var(--secondaryText);
  padding: 0 16px 10px;
}

/* Tab list items */
.fb-tab-list {
  display: flex;
  flex-direction: column;
}
.fb-tab-item {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 9px 16px;
  font-size: 12px;
  font-weight: 500;
  color: var(--textColor);
  cursor: pointer;
  border-left: 3px solid transparent;
  transition: all 100ms;
}
.fb-tab-item:hover {
  background: var(--grey100);
  border-left-color: var(--orange300);
}
.fb-tab-item.active {
  background: var(--orange100);
  border-left-color: var(--orange500);
  color: var(--orange500);
  font-weight: 700;
}
.fb-tab-dot {
  width: 7px;
  height: 7px;
  border-radius: 50%;
  background: var(--grey300);
  flex-shrink: 0;
  transition: background 150ms;
}
.fb-tab-item.has-data .fb-tab-dot {
  background: #22c55e;
}

/* ── Building blocks (S4) ── */
.fb-bb-grid {
  display: flex;
  flex-direction: column;
  gap: 6px;
}
.fb-bb-item {
  display: flex;
  align-items: flex-start;
  gap: 10px;
  padding: 10px 12px;
  border: 1px solid var(--borderColor);
  border-radius: 4px;
  cursor: pointer;
  transition: all 100ms;
}
.fb-bb-item:hover {
  border-color: var(--orange300);
  background: #fff8f5;
}
.fb-bb-item.selected {
  border-color: var(--orange500);
  background: var(--orange100);
}
.fb-bb-check {
  width: 16px;
  height: 16px;
  border: 2px solid var(--borderColor);
  border-radius: 3px;
  flex-shrink: 0;
  margin-top: 1px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 10px;
  color: transparent;
  transition: all 100ms;
}
.fb-bb-item.selected .fb-bb-check {
  background: var(--orange500);
  border-color: var(--orange500);
  color: #fff;
}
.fb-bb-name {
  font-size: 13px;
  font-weight: 500;
  color: var(--textColor);
}
.fb-bb-desc {
  font-size: 11px;
  color: var(--secondaryText);
  margin-top: 2px;
  line-height: 1.4;
}
.fb-bb-edit-btn {
  font-size: 10px;
  font-weight: 500;
  color: var(--orange500);
  background: transparent;
  border: 1px solid var(--orange300);
  border-radius: 3px;
  padding: 3px 7px;
  cursor: pointer;
  white-space: nowrap;
  flex-shrink: 0;
  margin-left: auto;
  align-self: flex-start;
}
.fb-bb-edit-btn:hover {
  background: var(--orange100);
}
.fb-bb-desc-textarea {
  font-size: 11px;
  color: var(--textColor);
  margin-top: 4px;
  width: 100%;
  padding: 5px 8px;
  border: 1px solid var(--orange300);
  border-radius: 3px;
  font-family: system-ui;
  line-height: 1.5;
  resize: vertical;
  min-height: 54px;
  box-sizing: border-box;
  background: #fffaf7;
}
.fb-bb-tooltip {
  position: relative;
  display: inline;
}
.fb-bb-tooltip:hover::after {
  content: attr(data-tip);
  position: absolute;
  left: 0;
  top: 100%;
  z-index: 200;
  background: #1a1a1a;
  color: #fff;
  font-size: 11px;
  line-height: 1.5;
  padding: 8px 12px;
  border-radius: 4px;
  width: 320px;
  white-space: normal;
  pointer-events: none;
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.18);
  margin-top: 4px;
}
/* ── Chips (S5 / S6) ── */
.fb-detail-label {
  font-size: 10px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.07em;
  color: var(--secondaryText);
  margin-bottom: 8px;
  margin-top: 16px;
}
.fb-detail-label:first-child {
  margin-top: 0;
}
.fb-chip-grid {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
  margin-bottom: 4px;
}
.fb-chip {
  padding: 5px 12px;
  border: 1.5px solid var(--borderColor);
  border-radius: 100px;
  font-size: 12px;
  font-weight: 500;
  cursor: pointer;
  background: #fff;
  color: var(--textColor);
  transition: all 100ms;
}
.fb-chip:hover {
  border-color: var(--orange500);
  color: var(--orange500);
  background: var(--orange100);
}
.fb-chip.selected {
  background: var(--orange500);
  border-color: var(--orange500);
  color: #fff;
  font-weight: 600;
}

/* ── Reg / Risk checklist (S7 / S8) ── */
.fb-check-group {
  display: flex;
  flex-direction: column;
  gap: 3px;
  margin-bottom: 8px;
}
.fb-check-item {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 9px 12px;
  border: 1px solid var(--borderColor);
  border-radius: 4px;
  cursor: pointer;
  transition: all 100ms;
}
.fb-check-item:hover {
  border-color: var(--orange300);
  background: #fff8f5;
}
.fb-check-item.checked {
  border-color: var(--orange500);
  background: var(--orange100);
}
.fb-check-box {
  width: 16px;
  height: 16px;
  border: 2px solid var(--borderColor);
  border-radius: 3px;
  flex-shrink: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 10px;
  color: transparent;
  transition: all 100ms;
}
.fb-check-item.checked .fb-check-box {
  background: var(--orange500);
  border-color: var(--orange500);
  color: #fff;
}
.fb-check-name {
  flex: 1;
  font-size: 13px;
  font-weight: 500;
  color: var(--textColor);
}
.fb-check-expand {
  font-size: 11px;
  color: var(--secondaryText);
  flex-shrink: 0;
}
.fb-check-reqs {
  padding: 8px 12px 8px 38px;
}

/* ── Objectives (S3) ── */
.fb-theme-table {
  display: flex;
  flex-direction: column;
  gap: 0;
}
.fb-theme-row {
  display: grid;
  grid-template-columns: 160px 1fr auto;
  align-items: center;
  gap: 10px;
  padding: 8px 0;
  border-bottom: 1px solid var(--grey100);
}
.fb-theme-row:last-child {
  border-bottom: none;
}
.fb-theme-name {
  font-size: 11px;
  font-weight: 600;
  color: var(--textColor);
  text-transform: uppercase;
  letter-spacing: 0.04em;
}
.fb-theme-row select,
.fb-theme-row input[type="text"] {
  padding: 7px 10px;
  border: 1px solid var(--borderColor);
  border-radius: 4px;
  font-size: 13px;
  font-family: system-ui;
  color: var(--textColor);
  background: #fff;
  width: 100%;
  box-sizing: border-box;
}
.fb-theme-row select {
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='6' viewBox='0 0 10 6'%3E%3Cpath fill='%23B5BCC4' d='M5 6L0 0h10z'/%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 10px center;
  padding-right: 28px;
  appearance: none;
  -webkit-appearance: none;
  cursor: pointer;
}
.fb-theme-row select:focus,
.fb-theme-row input:focus {
  outline: none;
  border-color: var(--orange500);
}
.fb-manual-btn {
  font-size: 11px;
  font-weight: 500;
  color: var(--orange500);
  background: transparent;
  border: 1px solid var(--orange300);
  border-radius: 3px;
  padding: 5px 8px;
  cursor: pointer;
  white-space: nowrap;
}
.fb-manual-btn:hover {
  background: var(--orange100);
}
.fb-section-hint {
  font-size: 12px;
  color: var(--secondaryText);
  margin-bottom: 12px;
}
.fb-obj-context {
  margin-top: 14px;
  padding-top: 14px;
  border-top: 1px solid var(--grey100);
}
.fb-panel-empty {
  font-size: 13px;
  color: var(--grey400);
  font-style: italic;
  padding: 20px 0;
}

/* ── Footer nav ── */
.fb-footer {
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  height: 60px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 32px;
  background: #fff;
  border-top: 1px solid var(--borderColor);
  z-index: 10;
}
.fb-foot-prev,
.fb-foot-next {
  padding: 8px 20px;
  border-radius: 4px;
  font-size: 13px;
  font-weight: 600;
  cursor: pointer;
  transition: all 120ms;
  border: 1px solid var(--borderColor);
}
.fb-foot-prev {
  background: #fff;
  color: var(--textColor);
}
.fb-foot-prev:hover:not(:disabled) {
  background: var(--grey100);
}
.fb-foot-prev:disabled {
  opacity: 0.35;
  cursor: default;
}
.fb-foot-next {
  background: var(--orange500);
  color: #fff;
  border-color: var(--orange500);
}
.fb-foot-next:hover {
  opacity: 0.88;
}
.fb-foot-center {
  display: flex;
  align-items: center;
  gap: 8px;
}
.fb-foot-counter {
  font-size: 12px;
  color: var(--secondaryText);
  font-weight: 500;
}

/* ═══════════════════════════════════════════
       CHANGE 9: Responsive / Mobile CSS
       ═══════════════════════════════════════════ */
@media (max-width: 768px) {
  /* Workflow container: single column, sidebar becomes top strip */
  .workflow-container {
    grid-template-columns: 1fr;
    grid-template-rows: auto 1fr;
    height: 100%;
  }
  #workflowPage.active {
    overflow: auto;
  }
  .workflow-sidebar {
    height: auto;
    max-height: 130px;
    overflow-x: auto;
    overflow-y: hidden;
    border-right: none;
    border-bottom: 1px solid var(--borderColor);
    /* Horizontal scroll strip */
    display: flex;
    flex-direction: row;
    align-items: stretch;
    box-shadow: none;
  }
  .sidebar-summary {
    display: none;
  }
  .sidebar-phase-list {
    display: flex;
    flex-direction: row;
    flex: 1;
    overflow-x: auto;
    overflow-y: hidden;
  }
  .workflow-sidebar .sidebar-phase-list #workflowSidebar {
    display: flex;
    flex-direction: row;
    min-width: max-content;
  }
  .sidebar-phase {
    display: flex;
    flex-direction: row;
    border-bottom: none;
    border-right: 1px solid var(--borderColor);
    align-items: stretch;
  }
  .sidebar-phase-label {
    writing-mode: vertical-lr;
    transform: rotate(180deg);
    padding: 8px 6px;
    font-size: 10px;
    background: var(--surfaceColor);
    border-right: 1px solid var(--borderColor);
    min-width: 26px;
    flex-direction: column;
    justify-content: space-between;
  }
  .sidebar-phase-count-badge {
    display: none;
  }
  .sidebar-item {
    padding: 8px 12px;
    font-size: 11px;
    border-left: none;
    border-bottom: 3px solid transparent;
    white-space: nowrap;
    flex-direction: column;
    align-items: center;
    gap: 4px;
    text-align: center;
    min-width: 70px;
  }
  .sidebar-item:hover {
    border-bottom-color: var(--orange300);
  }
  .sidebar-item.active {
    border-bottom-color: var(--orange500);
    background: var(--orange100);
  }
  .step-dot {
    width: 14px;
    height: 14px;
    font-size: 7px;
  }

  /* Workflow main: full width */
  .workflow-main {
    height: auto;
    overflow-y: visible;
  }

  /* Header: stack vertically */
  .workflow-header {
    flex-direction: column;
    align-items: flex-start;
    gap: 10px;
    padding: 12px 14px;
  }
  .workflow-header h2 {
    font-size: 15px;
  }
  .workflow-header p {
    font-size: 12px;
  }
  .progress-bar {
    width: 120px;
  }
  .progress-breakdown {
    font-size: 10px;
  }

  /* Phase filter */
  .phase-filter-bar {
    padding: 6px 14px;
    top: auto;
    position: relative;
  }

  /* Phase dividers */
  .phase-divider {
    padding: 8px 12px;
    flex-wrap: wrap;
    gap: 6px;
  }
  .phase-divider-right {
    flex-wrap: wrap;
  }
  .phase-divider-bar-outer {
    width: 60px;
  }

  /* Prompt cards */
  #promptCards {
    padding: 0 10px 24px;
  }
  .prompt-card-header {
    padding: 12px 14px;
  }
  .prompt-card-body {
    padding: 0 14px 16px;
  }
  .prompt-name {
    font-size: 13px;
  }
  .prompt-actions {
    flex-wrap: wrap;
    gap: 6px;
  }
  .prompt-actions-divider {
    display: none;
  }
  .prompt-actions-left {
    flex-wrap: wrap;
  }
  .prompt-actions-right {
    flex-wrap: wrap;
  }

  /* Tip banner */
  .workflow-tip-banner {
    padding: 8px 14px;
    font-size: 11px;
  }

  /* Bulk export button */
  .btn-bulk-export {
    font-size: 11px;
    padding: 6px 10px;
  }
}

@media (max-width: 480px) {
  #lp-nav {
    padding: 16px 20px;
  }
  #lp-title {
    font-size: 36px;
  }
  #lp-sub {
    font-size: 13px;
  }
  .workflow-header h2 {
    font-size: 14px;
  }
  .prompt-card-header-left {
    gap: 8px;
  }
  .prompt-id {
    font-size: 10px;
    padding: 3px 8px;
  }
}
</style>
</head>
<body>

<!-- PAGE 0: LANDING -->
<div class="page active" id="landingPage">
  <div id="lp-wrap">
    <div id="lp-grid"></div>

    <!-- ── NAV ── -->
    <nav id="lp-nav">
      <span id="lp-nav-brand"><svg style="height:24px;width:auto;vertical-align:middle;margin-right:8px;" viewBox="0 0 104 67" xmlns="http://www.w3.org/2000/svg"><defs><style>.cls-1{fill:#000;}.cls-2{fill:#fd5108;}</style></defs><path class="cls-1" d="M69.26,30.74c-2.53.41-3.83,2.28-3.83,5.57s1.73,5.53,4.37,5.53c1.23,0,2.35-.41,4.7-1.56v2.68c-2.82,1.29-4.48,1.69-6.76,1.69-2.46,0-4.19-.65-5.61-2.09-1.45-1.45-2.17-3.36-2.17-5.5,0-4.74,3.51-7.95,8.64-7.95,3.41,0,5.75,1.56,5.75,3.84,0,1.47-1.09,2.48-2.71,2.48-.83,0-1.51-.22-2.39-.72v-3.98ZM56.76,37.06c2.27-2.86,3.07-4.02,3.07-5.42s-1.11-2.53-2.6-2.53c-.91,0-1.74.43-2.14.88v5.83l-3.72,4.96v-11.31h-3.54l-5.88,9.75v-9.75h-2.03l-5.34,1.3v1.36l2.91.3v11.96h3.76l5.64-9.27v9.27h4.12l5.74-7.34ZM23.34,32.52c.87-.11,1.29-.15,1.7-.15,2.45,0,3.78,1.63,3.78,4.7,0,3.62-1.63,5.51-4.66,5.51-.25,0-.43,0-.83-.02v-10.04ZM23.34,44.25c.98.11,1.93.15,2.5.15,5.04,0,8.24-3.23,8.24-8.03,0-4.15-2.4-7.15-5.65-7.15-1.41,0-2.35.29-5.09,1.92v-2h-1.52l-5.86,1.78v1.43h2.43v16.73l-2.18.54v1.39h9.58v-1.39s-2.44-.54-2.44-.54v-4.84Z"/><path class="cls-2" d="M66.54,24.97h-15.98l2.72-4.51h15.98l-2.72,4.51ZM87.96,15.94h-15.98l-2.72,4.51h15.98l2.72-4.51Z"/></svg>Delivery Launchpad</span>
    </nav>

    <!-- ── HERO ── -->
    <div id="lp-hero">
      <h1 id="lp-title">Delivery<em>Launchpad.</em></h1>
      <p id="lp-sub">an AI-powered workflow that expedites project planning by generating a full suite of tailored artifacts, enabling teams to spend less time on documentation and more time delivering value to clients.
</p>
      <div id="lp-cta-row">
        <button class="lp-chip lp-chip-active" id="chip-guided" onclick="selectMode('guided')">Guided</button>
        <button class="lp-chip" id="chip-quick" onclick="selectMode('quick')">Quick</button>
        <button id="lp-start-btn" onclick="launchSelected()">Start</button>
      </div>
    </div>

  <!-- ── PROCESS CHAIN ── -->
    <div id="lp-chain-wrap">
      <div id="lp-chain-label">What gets produced</div>
      <div id="lp-conveyor-outer">
        <div id="lp-conveyor-track"></div>
        <div id="lp-conveyor">

          <div class="lp-cv-card" data-phase="Initiation">
            <div class="lp-cv-name">Engagement Intake</div>
            <div class="lp-cv-desc">Your brief processed into a structured summary that drives every prompt that follows.</div>
          </div>

          <div class="lp-cv-card" data-phase="Initiation">
            <div class="lp-cv-name">Stakeholder Analysis</div>
            <div class="lp-cv-desc">Every key stakeholder mapped by role, influence and interest, with a tailored engagement approach for each.</div>
          </div>

          <div class="lp-cv-card" data-phase="Initiation">
            <div class="lp-cv-name">Scope, Objectives & Success Criteria</div>
            <div class="lp-cv-desc">What is in, what is out, measurable objectives and success criteria — defined and agreed before planning begins.</div>
          </div>

          <div class="lp-cv-card lp-cv-gate" data-phase="Initiation">
            <div class="lp-cv-name">Engagement Charter</div>
            <div class="lp-cv-desc">The founding document of the engagement, purpose, scope, team, authority and constraints in one place.</div>
          </div>

          <div class="lp-cv-card" data-phase="Initiation">
            <div class="lp-cv-name">Governance Framework</div>
            <div class="lp-cv-desc">Decision-making structure, escalation paths, meeting cadence and reporting lines across the engagement.</div>
          </div>

          <div class="lp-cv-card" data-phase="Planning">
            <div class="lp-cv-name">WBS & Schedule</div>
            <div class="lp-cv-desc">Every deliverable decomposed into work packages with a phased timeline, key milestones and sequencing in one workbook.</div>
          </div>

          <div class="lp-cv-card" data-phase="Planning">
            <div class="lp-cv-name">Resource Plan & RACI</div>
            <div class="lp-cv-desc">Roles, effort estimates and loading mapped against the schedule, with RACI accountability defined for every key activity.</div>
          </div>

          <div class="lp-cv-card" data-phase="Planning">
            <div class="lp-cv-name">Budget & Cost Baseline</div>
            <div class="lp-cv-desc">A structured cost estimate across phases, resource categories and delivery activities.</div>
          </div>

          <div class="lp-cv-card" data-phase="Planning">
            <div class="lp-cv-name">Risk Register</div>
            <div class="lp-cv-desc">Identified risks with likelihood, impact rating, owner and mitigation action for each.</div>
          </div>

          <div class="lp-cv-card" data-phase="Planning">
            <div class="lp-cv-name">Communications Plan</div>
            <div class="lp-cv-desc">What gets communicated, to whom, at what frequency and through which channel.</div>
          </div>

          <div class="lp-cv-card" data-phase="Planning">
            <div class="lp-cv-name">Quality Plan</div>
            <div class="lp-cv-desc">Review gates, quality standards and acceptance criteria for every key deliverable.</div>
          </div>

          <div class="lp-cv-card" data-phase="Planning">
            <div class="lp-cv-name">Change Control Log</div>
            <div class="lp-cv-desc">The log for requesting, assessing, approving and tracking scope changes throughout delivery.</div>
          </div>

          <div class="lp-cv-card lp-cv-gate" data-phase="Planning">
            <div class="lp-cv-name">PMO Playbook</div>
            <div class="lp-cv-desc">The complete operating manual for the engagement — every plan, process and change control policy in one document.</div>
          </div>

        </div>
      </div>
     <div style="height: 32px;"></div>
       <p id="lp-contact">For assistance contact <a href="mailto:george.prowse@au.pwc.com">george.prowse@au.pwc.com</a></p>
    </div>
  </div>
</div>

<!-- LOADING OVERLAY -->
<div class="loading-overlay" id="loadingOverlay">
  <div class="loading-spinner"></div>
  <div class="loading-text" id="loadingText">Loading data...</div>
</div>

<!-- HEADER -->
<div class="header">
  <div class="header-left">
    <span class="header-title" id="headerTitle"><svg style="height:28px;width:auto;vertical-align:middle;margin-right:8px;" viewBox="0 0 104 67" xmlns="http://www.w3.org/2000/svg"><defs><style>.cls-1{fill:#000;}.cls-2{fill:#fd5108;}</style></defs><path class="cls-1" d="M69.26,30.74c-2.53.41-3.83,2.28-3.83,5.57s1.73,5.53,4.37,5.53c1.23,0,2.35-.41,4.7-1.56v2.68c-2.82,1.29-4.48,1.69-6.76,1.69-2.46,0-4.19-.65-5.61-2.09-1.45-1.45-2.17-3.36-2.17-5.5,0-4.74,3.51-7.95,8.64-7.95,3.41,0,5.75,1.56,5.75,3.84,0,1.47-1.09,2.48-2.71,2.48-.83,0-1.51-.22-2.39-.72v-3.98ZM56.76,37.06c2.27-2.86,3.07-4.02,3.07-5.42s-1.11-2.53-2.6-2.53c-.91,0-1.74.43-2.14.88v5.83l-3.72,4.96v-11.31h-3.54l-5.88,9.75v-9.75h-2.03l-5.34,1.3v1.36l2.91.3v11.96h3.76l5.64-9.27v9.27h4.12l5.74-7.34ZM23.34,32.52c.87-.11,1.29-.15,1.7-.15,2.45,0,3.78,1.63,3.78,4.7,0,3.62-1.63,5.51-4.66,5.51-.25,0-.43,0-.83-.02v-10.04ZM23.34,44.25c.98.11,1.93.15,2.5.15,5.04,0,8.24-3.23,8.24-8.03,0-4.15-2.4-7.15-5.65-7.15-1.41,0-2.35.29-5.09,1.92v-2h-1.52l-5.86,1.78v1.43h2.43v16.73l-2.18.54v1.39h9.58v-1.39s-2.44-.54-2.44-.54v-4.84Z"/><path class="cls-2" d="M66.54,24.97h-15.98l2.72-4.51h15.98l-2.72,4.51ZM87.96,15.94h-15.98l-2.72,4.51h15.98l2.72-4.51Z"/></svg>Delivery Launchpad</span>
  </div>
  <span class="header-subtitle" id="headerSubtitle">Form</span>
</div>

<div class="page" id="formPage">

  <!-- ══ TOP BAR ══ -->
  <div class="fb-topbar">
    <div class="fb-topbar-left">
      <div class="fb-topbar-brand">
        <span class="fb-topbar-title">New Engagement Brief</span>
        <span class="fb-topbar-divider"></span>
        <span class="fb-topbar-sub" id="fb-current-section-label">Engagement Context</span>
      </div>
    </div>
    <div class="fb-topbar-right">
      <div class="brief-strength-wrap">
        <span class="brief-strength-label">Brief Strength</span>
        <div class="brief-strength-bar-bg"><div class="brief-strength-bar" id="briefStrengthBar"></div></div>
        <span class="brief-strength-value" id="briefStrengthLabel">—</span>
      </div>
      <button class="fb-btn-ghost" onclick="clearAllFormData()" style="color:#c00;border-color:#f5c0c0;" title="Clear all data and start a new engagement">New Engagement</button>
      <button class="fb-btn-ghost" onclick="loadExampleData()">Load Example</button>
      <button class="fb-btn-primary" onclick="startWorkflow()">Launch Workflow →</button>
    </div>
  </div>

  <!-- ══ STEPPER ══ -->
  <div class="fb-stepper" id="fbStepper">
    <div class="fb-step active" id="step-s1" onclick="fbGoToSection(1)">
      <div class="fb-step-num" id="stepnum-s1">1</div>
      <span class="fb-step-label">Engagement</span>
    </div>
    <div class="fb-step-line"></div>
    <div class="fb-step" id="step-s2" onclick="fbGoToSection(2)">
      <div class="fb-step-num" id="stepnum-s2">2</div>
      <span class="fb-step-label">Industry</span>
    </div>
    <div class="fb-step-line"></div>
    <div class="fb-step" id="step-s3" onclick="fbGoToSection(3)">
      <div class="fb-step-num" id="stepnum-s3">3</div>
      <span class="fb-step-label">Objectives</span>
    </div>
    <div class="fb-step-line"></div>
    <div class="fb-step" id="step-s4" onclick="fbGoToSection(4)">
      <div class="fb-step-num" id="stepnum-s4">4</div>
      <span class="fb-step-label">Services</span>
    </div>
    <div class="fb-step-line"></div>
    <div class="fb-step" id="step-s5" onclick="fbGoToSection(5)">
      <div class="fb-step-num" id="stepnum-s5">5</div>
      <span class="fb-step-label">Technology</span>
    </div>
    <div class="fb-step-line"></div>
    <div class="fb-step" id="step-s6" onclick="fbGoToSection(6)">
      <div class="fb-step-num" id="stepnum-s6">6</div>
      <span class="fb-step-label">Partners</span>
    </div>
    <div class="fb-step-line"></div>
    <div class="fb-step" id="step-s7" onclick="fbGoToSection(7)">
      <div class="fb-step-num" id="stepnum-s7">7</div>
      <span class="fb-step-label">Regulatory</span>
    </div>
    <div class="fb-step-line"></div>
    <div class="fb-step" id="step-s8" onclick="fbGoToSection(8)">
      <div class="fb-step-num" id="stepnum-s8">8</div>
      <span class="fb-step-label">Risk</span>
    </div>
  </div>

  <!-- ══ SECTION PANELS ══ -->
  <div class="fb-panels" id="fbPanels">

    <!-- ── S1: ENGAGEMENT CONTEXT ── -->
    <div class="fb-panel active" id="fb-s1">
      <div class="fb-panel-inner">
        <div class="fb-panel-heading">
          <h2 class="fb-panel-title">Engagement Context</h2>
          <p class="fb-panel-desc">Core details used across all 19 prompts. Fields marked * are required to launch.</p>
        </div>
        <div class="fb-form-grid">
          <div class="fb-field fb-required" id="field-clientName">
            <label class="fb-label">Client Name <span class="fb-req">*</span></label>
            <input type="text" id="clientName" placeholder="e.g. Acme Corporation" oninput="fbFieldChange('s1')">
            <div class="fb-field-error" id="err-clientName"></div>
          </div>
          <div class="fb-field fb-required" id="field-engagementName">
            <label class="fb-label">Engagement Name <span class="fb-req">*</span></label>
            <input type="text" id="engagementName" placeholder="e.g. Finance Transformation" oninput="fbFieldChange('s1')">
            <div class="fb-field-error" id="err-engagementName"></div>
          </div>
          <div class="fb-field">
            <label class="fb-label">Engagement Lead</label>
            <input type="text" id="engagementLead" placeholder="Lead partner or manager name" oninput="fbFieldChange('s1')">
          </div>
          <div class="fb-field">
            <label class="fb-label">Delivery Methodology</label>
            <select id="deliveryMethodology" onchange="fbFieldChange('s1')">
              <option value="">Select methodology...</option>
              <option>Agile</option><option>Waterfall</option><option>Hybrid</option>
              <option>SAFe</option><option>PRINCE2</option><option>PMI/PMBOK</option>
              <option>Design Thinking</option><option>Lean</option>
            </select>
          </div>
          <div class="fb-field">
            <label class="fb-label">Start Date</label>
            <input type="date" id="startDate" onchange="fbFieldChange('s1')">
          </div>
          <div class="fb-field">
            <label class="fb-label">End Date</label>
            <input type="date" id="endDate" onchange="fbFieldChange('s1')">
          </div>
          <div class="fb-field">
            <label class="fb-label">Fee Structure</label>
            <select id="feeStructure" onchange="fbFieldChange('s1')">
              <option value="">Select fee structure...</option>
              <option>Fixed Fee</option><option>Time &amp; Materials</option>
              <option>Retainer</option><option>Value-Based</option>
              <option>Capped T&amp;M</option><option>Milestone-Based</option>
            </select>
          </div>
          <div class="fb-field">
            <label class="fb-label">Total Budget</label>
            <input type="text" id="totalBudget" placeholder="e.g. $2.4M" oninput="fbFieldChange('s1')">
          </div>
        </div>
        <div class="fb-field fb-field-full">
          <label class="fb-label">Engagement Description</label>
          <textarea id="engagementDescription" rows="4" placeholder="Brief summary of what this engagement aims to achieve, the client's situation, and key expected outcomes..." oninput="fbFieldChange('s1')"></textarea>
        </div>
      </div>
    </div>

    <!-- ── S2: INDUSTRY ── -->
    <div class="fb-panel" id="fb-s2">
      <div class="fb-panel-inner">
        <div class="fb-panel-heading">
          <h2 class="fb-panel-title">Industry</h2>
          <p class="fb-panel-desc">Select your client's industry, sector, and sub-sector to tailor all 19 prompts.</p>
        </div>
        <div class="fb-cascade">
          <div class="fb-cascade-col" id="trail-industry">
            <div class="fb-cascade-label">Industry</div>
            <div class="fb-pill-grid" id="industryPills"></div>
          </div>
          <div class="fb-cascade-arrow">›</div>
          <div class="fb-cascade-col fb-cascade-dim" id="trail-sector">
            <div class="fb-cascade-label">Sector</div>
            <div class="fb-pill-grid" id="sectorPills"><span class="fb-cascade-placeholder">Select an industry first</span></div>
          </div>
          <div class="fb-cascade-arrow">›</div>
          <div class="fb-cascade-col fb-cascade-dim" id="trail-subsector">
            <div class="fb-cascade-label">Sub-sector</div>
            <div class="fb-pill-grid" id="subsectorPills"><span class="fb-cascade-placeholder">Select a sector first</span></div>
          </div>
        </div>
      </div>
    </div>

    <!-- ── S3: OBJECTIVES ── -->
    <div class="fb-panel" id="fb-s3">
      <div class="fb-panel-inner">
        <div class="fb-panel-heading">
          <h2 class="fb-panel-title">Objectives</h2>
          <p class="fb-panel-desc">Select the engagement objective type, then assign themes and specific objectives.</p>
        </div>
        <div class="fb-split">
          <div class="fb-split-left">
            <div class="fb-split-label">Objective Type</div>
            <div class="fb-tab-list" id="objTypeList"></div>
          </div>
          <div class="fb-split-right" id="objThemePanel">
            <div class="fb-panel-empty">Select an objective type on the left</div>
          </div>
        </div>
      </div>
    </div>

    <!-- ── S4: SERVICES ── -->
    <div class="fb-panel" id="fb-s4">
      <div class="fb-panel-inner">
        <div class="fb-panel-heading">
          <h2 class="fb-panel-title">Service Offerings</h2>
          <p class="fb-panel-desc">Select a service domain then pick the building blocks that apply to this engagement.</p>
        </div>
        <div class="fb-split">
          <div class="fb-split-left">
            <div class="fb-split-label">Domain</div>
            <div class="fb-tab-list" id="domainTabList"></div>
          </div>
          <div class="fb-split-right" id="domainBlockPanel">
            <div class="fb-panel-empty">Select a domain to browse building blocks</div>
          </div>
        </div>
      </div>
    </div>

    <!-- ── S5: TECHNOLOGY ── -->
    <div class="fb-panel" id="fb-s5">
      <div class="fb-panel-inner">
        <div class="fb-panel-heading">
          <h2 class="fb-panel-title">Technology Landscape</h2>
          <p class="fb-panel-desc">Select categories, sub-categories, and specific products or tools relevant to this engagement.</p>
        </div>
        <div class="fb-split">
          <div class="fb-split-left">
            <div class="fb-split-label">Category</div>
            <div class="fb-tab-list" id="techCatList"></div>
          </div>
          <div class="fb-split-right" id="techDetailPanel">
            <div class="fb-panel-empty">Select a technology category</div>
          </div>
        </div>
      </div>
    </div>

    <!-- ── S6: PARTNERS ── -->
    <div class="fb-panel" id="fb-s6">
      <div class="fb-panel-inner">
        <div class="fb-panel-heading">
          <h2 class="fb-panel-title">Alliance Partners</h2>
          <p class="fb-panel-desc">Select relevant alliance partners and the product families or tools involved.</p>
        </div>
        <div class="fb-split">
          <div class="fb-split-left">
            <div class="fb-split-label">Partner</div>
            <div class="fb-tab-list" id="partnerTabList"></div>
          </div>
          <div class="fb-split-right" id="partnerDetailPanel">
            <div class="fb-panel-empty">Select a partner to view product families</div>
          </div>
        </div>
      </div>
    </div>

    <!-- ── S7: REGULATORY ── -->
    <div class="fb-panel" id="fb-s7">
      <div class="fb-panel-inner">
        <div class="fb-panel-heading">
          <h2 class="fb-panel-title">Regulatory Profile</h2>
          <p class="fb-panel-desc">Select applicable regulators and their requirements to enrich compliance-related prompts.</p>
        </div>
        <div class="fb-split">
          <div class="fb-split-left">
            <div class="fb-split-label">Industry Group</div>
            <div class="fb-tab-list" id="regGroupList"></div>
          </div>
          <div class="fb-split-right" id="regDetailPanel">
            <div class="fb-panel-empty">Select an industry group to view regulators</div>
          </div>
        </div>
      </div>
    </div>

    <!-- ── S8: RISK ── -->
    <div class="fb-panel" id="fb-s8">
      <div class="fb-panel-inner">
        <div class="fb-panel-heading">
          <h2 class="fb-panel-title">Risk Profile</h2>
          <p class="fb-panel-desc">Select risk categories and specific risks to populate the Risk Register and other risk-aware prompts.</p>
        </div>
        <div class="fb-split">
          <div class="fb-split-left">
            <div class="fb-split-label">Industry Group</div>
            <div class="fb-tab-list" id="riskGroupList"></div>
          </div>
          <div class="fb-split-right" id="riskDetailPanel">
            <div class="fb-panel-empty">Select an industry group to view risk types</div>
          </div>
        </div>
      </div>
    </div>

  </div><!-- /fb-panels -->

  <!-- ══ FOOTER NAV ══ -->
  <div class="fb-footer">
    <button class="fb-foot-prev" id="fbPrevBtn" onclick="fbNav(-1)" disabled>← Previous</button>
    <div class="fb-foot-center">
      <span class="fb-foot-counter" id="fbStepCounter">1 of 8</span>
    </div>
    <button class="fb-foot-next" id="fbNextBtn" onclick="fbNav(1)">Next →</button>
  </div>

</div>

<div class="page" id="workflowPage">
  <div class="workflow-container">
    <div class="workflow-sidebar" id="workflowSidebarWrap">
      <!-- Sidebar overall progress summary -->
      <div class="sidebar-summary" id="sidebarSummary">
        <div class="sidebar-summary-title">Overall Progress</div>
        <div class="sidebar-summary-count" id="sidebarSummaryCount">0 of 20 steps</div>
        <div class="sidebar-summary-subtext" id="sidebarSummarySubtext">Get started below</div>
        <div class="sidebar-summary-bar-outer">
          <div class="sidebar-summary-bar-inner" id="sidebarSummaryBar" style="width:0%"></div>
        </div>
      </div>
      <div class="sidebar-phase-list">
        <div id="workflowSidebar"></div>
      </div>
    </div>
    <div class="workflow-main">
      <div class="workflow-header">
        <div style="display:flex; align-items:center; gap:16px;">
          <button class="btn btn-secondary" onclick="goBackToForm()" style="white-space:nowrap;">&#8592; Back</button>
          <div>
            <h2 id="workflowTitle">Engagement Workflow</h2>
            <p id="workflowSubtitle">Copy each prompt in sequence into your AI tool</p>
          </div>
        </div>
        <div style="display:flex;align-items:center;gap:14px;flex-shrink:0;">
          <button class="btn-bulk-export" id="bulkExportBtn" onclick="exportAllPrompts()">&#8681; Export All</button>
          <div class="progress-wrap">
            <div class="progress-label" id="progressText" aria-live="polite">0 of 20 steps complete</div>
            <div class="progress-breakdown" id="progressBreakdown"></div>
            <div class="progress-bar"><div class="progress-fill" id="progressFill" style="width:0%"></div></div>
          </div>
        </div>
      </div>
      <!-- CHANGE 5: Phase filter pill row -->
      <div class="phase-filter-bar">
        <div class="phase-filter-pills" id="phaseFilterPills">
          <span class="phase-filter-label">Filter:</span>
        </div>
      </div>
      <!-- CHANGE 12: Single dismissible tip banner -->
      <div class="workflow-tip-banner" id="workflowTipBanner">
        <span class="workflow-tip-icon">&#9432;</span>
        <span class="workflow-tip-text">Export saves a .txt backup if your session times out. Run each prompt with <strong>Code Interpreter enabled</strong> in your AI tool.</span>
        <button class="workflow-tip-dismiss" onclick="dismissWorkflowTip()" aria-label="Dismiss tip">&#x2715;</button>
      </div>
      <div id="promptCards"></div>
    </div>
  </div>
</div>

<script>
// ══════════════════════════════════════
// REBUILT FORM PAGE — STEPPER NAV
// ══════════════════════════════════════

var _fbCurrentSection = 1;
var FB_TOTAL_SECTIONS = 8;

var FB_SECTION_LABELS = {
  1: "Engagement Context",
  2: "Industry",
  3: "Objectives",
  4: "Service Offerings",
  5: "Technology Landscape",
  6: "Alliance Partners",
  7: "Regulatory Profile",
  8: "Risk Profile",
};

function fbGoToSection(n) {
  if (n < 1 || n > FB_TOTAL_SECTIONS) return;
  // Hide current
  var cur = document.getElementById("fb-s" + _fbCurrentSection);
  if (cur) cur.classList.remove("active");
  var curStep = document.getElementById("step-s" + _fbCurrentSection);
  if (curStep) curStep.classList.remove("active");
  // Show new
  _fbCurrentSection = n;
  var next = document.getElementById("fb-s" + n);
  if (next) next.classList.add("active");
  var nextStep = document.getElementById("step-s" + n);
  if (nextStep) nextStep.classList.add("active");
  // Update label
  var lbl = document.getElementById("fb-current-section-label");
  if (lbl) lbl.textContent = FB_SECTION_LABELS[n] || "";
  // Update counter
  var ctr = document.getElementById("fbStepCounter");
  if (ctr) ctr.textContent = n + " of " + FB_TOTAL_SECTIONS;
  // Update prev/next buttons
  var prev = document.getElementById("fbPrevBtn");
  var nxt = document.getElementById("fbNextBtn");
  if (prev) prev.disabled = n === 1;
  if (nxt) nxt.textContent = n === FB_TOTAL_SECTIONS ? "Done ✓" : "Next →";
  // Scroll panel to top
  if (next) next.scrollTop = 0;
  // Eval dots
  fbEvalDots();
}

function fbNav(dir) {
  fbGoToSection(_fbCurrentSection + dir);
}

// Legacy compat shim — old fbScrollTo calls still work
function fbScrollTo(id, el) {
  var match = id.match(/fb-s(\d+)/);
  if (match) fbGoToSection(parseInt(match[1]));
  return false;
}

// ── Init sections on load ──
function fbInitSections() {
  fbGoToSection(1);
}

// ── Scroll spy is no longer needed (single-panel view) ──
function fbInitScrollSpy() {}

// ── Stepper dot states ──
function fbUpdateDot(sectionId, state) {
  // sectionId is like 's1', 's2' ...
  var n = parseInt(sectionId.replace("s", ""));
  var stepEl = document.getElementById("step-s" + n);
  if (!stepEl) return;
  stepEl.classList.remove("done", "partial");
  if (state === "filled") stepEl.classList.add("done");
  else if (state === "partial") stepEl.classList.add("partial");
  // keep 'active' class for current
  if (n === _fbCurrentSection) stepEl.classList.add("active");
}

function fbEvalDots() {
  // S1
  var s1 = [
    "clientName",
    "engagementName",
    "engagementLead",
    "deliveryMethodology",
    "startDate",
    "endDate",
    "feeStructure",
    "totalBudget",
    "engagementDescription",
  ];
  var s1filled = s1.filter(function (id) {
    var el = document.getElementById(id);
    return el && (el.value || "").trim();
  }).length;
  fbUpdateDot(
    "s1",
    s1filled >= 4 ? "filled" : s1filled > 0 ? "partial" : "empty",
  );
  // S2
  var ind = document.getElementById("industryDrop"),
    sec = document.getElementById("sectorDrop");
  fbUpdateDot(
    "s2",
    sec && sec.value ? "filled" : ind && ind.value ? "partial" : "empty",
  );
  // S3
  var objSels = document.querySelectorAll("#fb-s3 select");
  var objFilled = Array.from(objSels).filter(function (s) {
    return s.value;
  }).length;
  fbUpdateDot(
    "s3",
    objFilled >= 3 ? "filled" : objFilled > 0 ? "partial" : "empty",
  );
  // S4
  var bbSel = document.querySelectorAll("#fb-s4 .fb-bb-item.selected").length;
  fbUpdateDot("s4", bbSel >= 3 ? "filled" : bbSel > 0 ? "partial" : "empty");
  // S5
  var techSel = document.querySelectorAll("#fb-s5 .fb-chip.selected").length;
  fbUpdateDot(
    "s5",
    techSel >= 2 ? "filled" : techSel > 0 ? "partial" : "empty",
  );
  // S6
  var partSel = document.querySelectorAll(
    "#fb-s6 .fb-chip.selected, #fb-s6 .fb-tab-item.has-data",
  ).length;
  fbUpdateDot(
    "s6",
    partSel >= 2 ? "filled" : partSel > 0 ? "partial" : "empty",
  );
  // S7
  var regSel = document.querySelectorAll(
    "#fb-s7 .fb-check-item.checked",
  ).length;
  fbUpdateDot("s7", regSel >= 2 ? "filled" : regSel > 0 ? "partial" : "empty");
  // S8
  var riskSel = document.querySelectorAll(
    "#fb-s8 .fb-check-item.checked",
  ).length;
  fbUpdateDot(
    "s8",
    riskSel >= 2 ? "filled" : riskSel > 0 ? "partial" : "empty",
  );
  // Brief strength
  if (typeof updateBriefStrength === "function") updateBriefStrength();
}

function fbFieldChange(sectionId) {
  fbEvalDots();
  clearTimeout(window._fbAutoSave);
  window._fbAutoSave = setTimeout(function () {
    try {
      var st = collectFormState();
      localStorage.setItem(DRAFT_KEY, JSON.stringify(st));
    } catch (e) {}
  }, 1200);
}

function fbFilterList(listId, query) {
  var q = (query || "").toLowerCase().trim();
  document
    .querySelectorAll("#" + listId + " .fb-tab-item")
    .forEach(function (item) {
      item.style.display =
        !q || item.textContent.toLowerCase().indexOf(q) !== -1 ? "" : "none";
    });
}

// ── Toggle section is no longer used in stepper mode but kept for compat ──
function fbToggleSection(section) {
  // no-op in stepper mode
}

// ── APP STATE ──
let appData = {};
let completedSteps = new Set();
let formData = {};

// ── INLINED DATA (standalone mode) ──
const INLINED_DATA = {
  industries: {
    industries: [
      {
        industry: "Consumer Markets",
        sectors: [
          {
            sector: "Consumer",
            sub_sectors: [
              "Agriculture",
              "Farming of Animals",
              "Fishing, Hunting & Trapping",
              "Soap, Detergents, Perfume & Toilet Preparations Production",
              "Food, Confectionery, Tobacco, Animal Foods Production",
              "Drinks Production",
              "Textiles Production",
              "Leather & Leather Goods Production",
              "Footwear Manufacture & Design",
              "Clothing Manufacture & Design",
              "Household Goods Production",
              "Digital Consumer",
            ],
          },
          {
            sector: "Forest, Paper and Packaging",
            sub_sectors: [
              "Forestry",
              "Sawmilling & Preparation of Wood",
              "Manufacture of Wood Products",
              "Manufacture of Paper & Paper Products",
            ],
          },
          {
            sector: "Hospitality and Leisure",
            sub_sectors: ["Hotels & Catering", "Tourism", "Casinos & Gambling"],
          },
          {
            sector: "Retail",
            sub_sectors: [
              "Wholesale Distribution",
              "Agents Involved in the Sale of Goods",
              "Retail & Distribution",
              "Repair of Consumer Goods",
              "Digital Retail",
              "Personal Services",
              "Domestic Services",
              "Persons & Families",
            ],
          },
          {
            sector: "Transportation and Logistics",
            sub_sectors: [
              "Railways (excluding City Railways)",
              "City Railways",
              "Road Passenger & Goods Transport",
              "Other Land Transport including Pipeline",
              "Inland Water Transport",
              "Sea Transport & Shipping",
              "Air Transport",
              "Support Services to Transport including Airports & Seaports",
              "Logistics & Freight Forwarders including Warehousing",
              "Postal/Delivery Services",
            ],
          },
        ],
      },
      {
        industry: "Energy, Utilities and Resources",
        sectors: [
          {
            sector: "Chemicals",
            sub_sectors: [
              "Manufacture of Industrial Chemicals",
              "Manufacture of Petrochemicals",
              "Manufacture of Paint, Varnishes & Allied Products",
              "Manufacture of Agricultural Chemicals",
            ],
          },
          {
            sector: "Energy",
            sub_sectors: [
              "Upstream Exploration and Production of Petroleum",
              "Crude Petroleum and Natural Gas",
              "Extraction & Production of Gas",
              "Oilfield Services",
              "Petroleum Refining",
              "Wholesale Dealing in Petroleum",
              "Retail Distribution of Motor Fuel, Lubricating Oil & LPG",
              "Holding Companies of Oil & Gas Conglomerates",
            ],
          },
          {
            sector: "Metals and Mining",
            sub_sectors: [
              "Extraction & Briquetting of Solid Fuels",
              "Extraction & Preparation of Metalliferous Ores",
              "Production & Preliminary Processing of Metals & Steel",
              "Extraction of Minerals other than Metals",
            ],
          },
          {
            sector: "Power and Utilities",
            sub_sectors: [
              "Nuclear Fuels Industry",
              "Electricity Production, Wholesale, Transmission, Distribution & Retail",
              "Gas Wholesale, Transport & Storage, Distribution & Retail",
              "Production & Distribution of Steam, Hot Water & Compressed Air",
              "Water Supply, Collection, Purification & Distribution",
            ],
          },
        ],
      },
      {
        industry: "Financial Services",
        sectors: [
          {
            sector: "Asset and Wealth Management",
            sub_sectors: [
              "Asset/Wealth Management of CISs, Pension/Insurance/HNW Assets",
              "Traditional Collective Investment Schemes (Open/Closed)",
              "Hedge Fund Managers & Hedge Funds",
              "Real Estate Managers, Funds & Investment Portfolios",
              "Pension Funds & Retirement Plans",
              "Infrastructure Investments & Funds",
            ],
          },
          {
            sector: "Banking and Capital Markets",
            sub_sectors: [
              "Retail Banking",
              "Asset-based Finance, Leasing & Hire Purchase",
              "Mortgage, Building Societies, Savings & Loan Institutions",
              "Broker/Securities Dealers (Front-office)",
              "Settlements, Exchanges & Clearing Organisations",
              "Consumer Finance",
              "Non-Governmental Financial Regulators",
            ],
          },
          {
            sector: "Insurance",
            sub_sectors: [
              "Non-Life Insurance (including P&C)",
              "Life Insurance",
              "Composite Insurance",
              "Reinsurance",
              "Lloyds",
              "Insurance Broking & Other Activities",
            ],
          },
          { sector: "Private Equity", sub_sectors: ["Private Equity"] },
        ],
      },
      {
        industry: "Government and Public Services",
        sectors: [
          {
            sector: "Central, National, Federal Government",
            sub_sectors: [
              "Central/National/Federal Government Entities",
              "Central Government Owned Enterprises/Companies",
              "Agencies/Other Government Bodies",
              "Defence",
              "Education - National",
            ],
          },
          {
            sector: "G and PS - Other",
            sub_sectors: [
              "Religious, Charitable & Other Not-for-Profit Local Organisations",
              "Membership Organisations (Trade, Social, Political, etc.)",
            ],
          },
          {
            sector: "International Government Organisations",
            sub_sectors: ["International Government Organisations"],
          },
          {
            sector: "Regional, State, Local and City Government",
            sub_sectors: ["Regional/State/Local & City Government"],
          },
        ],
      },
      {
        industry: "Health Industries",
        sectors: [
          {
            sector: "Health Services",
            sub_sectors: ["Health Payers/Insurers", "Health Providers"],
          },
          {
            sector: "Pharma and Life Sciences",
            sub_sectors: ["Medical Devices & Diagnostics", "Biotech"],
          },
        ],
      },
      {
        industry: "Industrial Manufacturing and Automotive",
        sectors: [
          {
            sector: "Automotive",
            sub_sectors: [
              "Manufacture of Motor Vehicles",
              "Vehicle Retail/Parts Retail/Hire/Repair/Garages",
            ],
          },
          {
            sector: "Business Services",
            sub_sectors: [
              "Business Services other than Legal & Financial",
              "Legal Services",
              "Cleansing Services",
            ],
          },
          {
            sector: "Engineering and Construction",
            sub_sectors: [
              "Contractor/Construction",
              "Civil Engineering/Design Services",
              "Manufacture of Building Products",
            ],
          },
          {
            sector: "Manufacturing",
            sub_sectors: [
              "Man-made Fibres",
              "Manufacture of Metal Items excluding Engineering & Vehicles",
              "Mechanical Engineering",
              "Manufacture of Office Machinery",
              "Electrical Engineering",
              "Non-automotive Rubber & Plastic Products",
              "Other Manufacturing Industries",
              "Dealing in Scrap",
              "Holding Companies of Multi-sector Conglomerate Business",
            ],
          },
        ],
      },
      {
        industry: "PE, Real Assets and SIF",
        sectors: [
          { sector: "Private Equity", sub_sectors: ["Private Equity"] },
        ],
      },
      {
        industry: "Technology, Media and Telecommunications",
        sectors: [
          {
            sector: "Media and Entertainment",
            sub_sectors: [
              "Publishing",
              "Advertising & PR Agencies",
              "Filmed Entertainment",
              "Radio & Television Broadcasting",
              "Entertainment & Media Not Specified Elsewhere",
              "Sport & Live Events",
              "Recreational & Cultural Services Not Specified Elsewhere",
            ],
          },
          {
            sector: "Technology",
            sub_sectors: [
              "Computers & Networking",
              "Semiconductors",
              "Software & Internet",
              "Venture Capital Activities in Tech & Related Sectors",
            ],
          },
          { sector: "Telecommunications", sub_sectors: ["Telecommunications"] },
        ],
      },
    ],
  },
  workflow: {
    phases: [
      {
        phase_id: "P1",
        phase_name: "Initiation",
        prompts: [
          {
            prompt_id: "P1.1",
            prompt_name: "Engagement Intake",
            file: "engagement_intake.json",
            artifact: "Engagement Intake Summary",
            depends_on: null,
            sign_off_gate: false,
          },
          {
            prompt_id: "P1.2",
            prompt_name: "Stakeholder Analysis",
            file: "stakeholder_analysis.json",
            artifact: "Stakeholder Analysis Workbook",
            depends_on: ["P1.1"],
            sign_off_gate: false,
          },
          {
            prompt_id: "P1.3",
            prompt_name: "Scope, Objectives & Success Criteria",
            file: "scope_statement.json",
            artifact: "Scope & Objectives Workbook",
            depends_on: ["P1.1"],
            sign_off_gate: false,
          },
          {
            prompt_id: "P1.4",
            prompt_name: "Engagement Charter",
            file: "engagement_charter.json",
            artifact: "Engagement Charter",
            depends_on: ["P1.1", "P1.2", "P1.3"],
            sign_off_gate: true,
          },
          {
            prompt_id: "P1.5",
            prompt_name: "Governance Framework",
            file: "governance_framework.json",
            artifact: "Governance Framework",
            depends_on: ["P1.4", "P1.2"],
            sign_off_gate: false,
          },
        ],
      },
      {
        phase_id: "P2",
        phase_name: "Planning",
        prompts: [
          {
            prompt_id: "P2.1",
            prompt_name: "WBS & Schedule",
            file: "wbs_schedule.json",
            artifact: "WBS & Project Schedule",
            depends_on: ["P1.3"],
            sign_off_gate: false,
          },
          {
            prompt_id: "P2.2",
            prompt_name: "Resource Plan & RACI",
            file: "resource_plan.json",
            artifact: "Resource & RACI Workbook",
            depends_on: ["P2.1", "P1.2"],
            sign_off_gate: false,
          },
          {
            prompt_id: "P2.3",
            prompt_name: "Budget & Cost Baseline",
            file: "budget_cost_baseline.json",
            artifact: "Budget Baseline & Cost Tracker",
            depends_on: ["P2.2", "P1.4"],
            sign_off_gate: false,
          },
          {
            prompt_id: "P2.4",
            prompt_name: "Risk Register",
            file: "risk_register.json",
            artifact: "Risk Register",
            depends_on: ["P1.1", "P2.1"],
            sign_off_gate: false,
          },
          {
            prompt_id: "P2.5",
            prompt_name: "Communications Plan",
            file: "communications_plan.json",
            artifact: "Communications Workbook",
            depends_on: ["P1.2", "P1.5"],
            sign_off_gate: false,
          },
          {
            prompt_id: "P2.6",
            prompt_name: "Quality Plan",
            file: "quality_plan.json",
            artifact: "Quality Plan & Deliverable Review Schedule",
            depends_on: ["P2.1", "P2.2"],
            sign_off_gate: false,
          },
          {
            prompt_id: "P2.7",
            prompt_name: "Change Control Log",
            file: "change_control_plan.json",
            artifact: "Change Control Workbook",
            depends_on: ["P1.3", "P1.5", "P2.3"],
            sign_off_gate: false,
          },
          {
            prompt_id: "P2.8",
            prompt_name: "PMO Playbook",
            file: "pmo_playbook.json",
            artifact: "PMO Playbook",
            depends_on: ["P2.1", "P2.2", "P2.3", "P2.4", "P2.5", "P2.6", "P2.7"],
            sign_off_gate: true,
          },
        ],
      },
    ],
  },
  objectives: {
    engagement_objectives: {
      field_type: "multi-select",
      objective_types: [
        {
          objective_type: "Business Problem",
          description: "What is broken or underperforming today",
          themes: [
            {
              theme: "Financial Performance",
              specific_objectives: [
                "N/A",
                "High operating costs",
                "Declining margins",
                "Inefficient capital allocation",
                "Poor financial reporting accuracy",
                "Lack of financial visibility and transparency",
                "Ineffective budgeting and forecasting",
                "High cost of finance function",
                "Revenue leakage",
                "Inefficient tax management",
                "Poor working capital management",
              ],
            },
            {
              theme: "Operational Performance",
              specific_objectives: [
                "N/A",
                "Inefficient or broken business processes",
                "High error rates and rework",
                "Poor productivity",
                "Lack of process standardisation",
                "Siloed operations across business units",
                "Ineffective supplier and vendor management",
                "Poor asset utilisation",
                "High cost of operations",
                "Lack of operational visibility",
                "Ineffective demand and capacity planning",
              ],
            },
            {
              theme: "Customer & Market",
              specific_objectives: [
                "N/A",
                "Poor customer experience",
                "High customer churn",
                "Declining market share",
                "Inability to acquire new customers",
                "Lack of customer insight and analytics",
                "Inconsistent customer service across channels",
                "Slow response to changing customer needs",
                "Ineffective pricing strategy",
                "Poor brand perception",
                "Weak digital customer engagement",
              ],
            },
            {
              theme: "Data & Information",
              specific_objectives: [
                "N/A",
                "Poor data quality",
                "Fragmented and siloed data",
                "Lack of trusted single source of truth",
                "Inability to access and use data effectively",
                "Inadequate data governance",
                "Lack of real-time reporting and insight",
                "Ineffective use of analytics",
                "Data duplication and inconsistency",
                "Lack of data literacy across the organisation",
                "Inability to leverage AI and advanced analytics",
              ],
            },
            {
              theme: "Technology & Systems",
              specific_objectives: [
                "N/A",
                "Ageing and legacy technology landscape",
                "Fragmented and poorly integrated systems",
                "High cost of IT operations and maintenance",
                "Inability to scale technology infrastructure",
                "Poor system performance and reliability",
                "Lack of digital capabilities",
                "Shadow IT and ungoverned technology use",
                "Poor cybersecurity posture",
                "Technology debt inhibiting innovation",
                "Lack of cloud adoption",
              ],
            },
            {
              theme: "People & Organisation",
              specific_objectives: [
                "N/A",
                "High employee turnover and attrition",
                "Low employee engagement and morale",
                "Skills gaps and capability shortfalls",
                "Ineffective organisational structure",
                "Poor leadership and management effectiveness",
                "Resistance to change",
                "Lack of innovation culture",
                "Ineffective performance management",
                "Poor workforce planning",
                "Unclear roles and responsibilities",
              ],
            },
            {
              theme: "Risk & Control",
              specific_objectives: [
                "N/A",
                "Weak internal control environment",
                "High exposure to operational risk",
                "Inadequate risk management frameworks",
                "Poor visibility of enterprise risk",
                "Ineffective audit and assurance processes",
                "Lack of business continuity and resilience planning",
                "Supply chain vulnerability",
                "Third party and vendor risk exposure",
                "Fraud and financial crime exposure",
                "Cybersecurity vulnerabilities",
              ],
            },
          ],
        },
        {
          objective_type: "Strategic Objective",
          description: "Where the client wants to get to",
          themes: [
            {
              theme: "Growth & Market Position",
              specific_objectives: [
                "N/A",
                "Enter new markets or geographies",
                "Launch new products or services",
                "Grow market share",
                "Develop new customer segments",
                "Build strategic partnerships and alliances",
                "Monetise data and digital assets",
                "Develop platform or ecosystem business model",
                "Improve pricing and revenue management",
                "Accelerate organic growth",
                "Drive inorganic growth through M&A",
              ],
            },
            {
              theme: "Business Transformation",
              specific_objectives: [
                "N/A",
                "Define and implement a new business strategy",
                "Transform the operating model",
                "Drive enterprise-wide digital transformation",
                "Consolidate and simplify the business",
                "Outsource or shared services non-core functions",
                "Restructure the organisation",
                "Build a data and AI-driven business",
                "Transform the customer experience",
                "Achieve operational excellence",
                "Build a sustainable and responsible business",
              ],
            },
            {
              theme: "Financial Strategy",
              specific_objectives: [
                "N/A",
                "Improve return on invested capital",
                "Optimise cost structure",
                "Improve cash flow and working capital",
                "Optimise tax position",
                "Prepare for IPO or capital markets transaction",
                "Drive shareholder value",
                "Achieve financial targets and KPIs",
                "Improve financial planning and analysis capability",
                "Optimise capital allocation",
                "Deliver cost reduction programme",
              ],
            },
            {
              theme: "Innovation & Differentiation",
              specific_objectives: [
                "N/A",
                "Build innovation capability and culture",
                "Develop and launch digital products and services",
                "Leverage AI and emerging technologies",
                "Create competitive differentiation through technology",
                "Build an agile and adaptive organisation",
                "Develop new business models",
                "Accelerate speed to market",
                "Build ecosystem and platform capabilities",
                "Harness IoT and connected technologies",
                "Drive sustainability through innovation",
              ],
            },
            {
              theme: "Sustainability & ESG",
              specific_objectives: [
                "N/A",
                "Define and implement ESG strategy",
                "Achieve net zero or carbon reduction targets",
                "Improve ESG reporting and disclosure",
                "Build sustainable supply chain",
                "Improve social impact and community engagement",
                "Strengthen corporate governance",
                "Meet investor ESG expectations",
                "Embed sustainability into products and services",
                "Reduce environmental footprint",
                "Build workforce diversity and inclusion",
              ],
            },
          ],
        },
        {
          objective_type: "Regulatory & Compliance Driver",
          description: "What the client is being required to do",
          themes: [
            {
              theme: "Financial Regulation",
              specific_objectives: [
                "N/A",
                "Comply with new or changing financial regulation",
                "Meet capital adequacy and liquidity requirements",
                "Strengthen financial crime compliance",
                "Improve AML and KYC processes",
                "Meet sanctions compliance requirements",
                "Comply with reporting and disclosure requirements",
                "Address regulatory findings or remediation",
                "Prepare for regulatory examination or audit",
                "Implement new accounting standards",
                "Manage tax compliance obligations",
              ],
            },
            {
              theme: "Data & Privacy Regulation",
              specific_objectives: [
                "N/A",
                "Comply with GDPR or equivalent data privacy regulation",
                "Implement data residency and sovereignty requirements",
                "Strengthen data protection controls",
                "Meet consent management requirements",
                "Address data breach or privacy incident",
                "Comply with sector-specific data regulations",
                "Implement privacy by design",
                "Meet cross-border data transfer requirements",
                "Strengthen data subject rights management",
                "Comply with AI regulation and ethics requirements",
              ],
            },
            {
              theme: "Operational & Industry Regulation",
              specific_objectives: [
                "N/A",
                "Comply with industry-specific operational regulation",
                "Meet health and safety regulatory requirements",
                "Comply with environmental regulation",
                "Meet product safety and quality standards",
                "Comply with trade and export control requirements",
                "Meet licensing and authorisation requirements",
                "Address operational resilience regulatory requirements",
                "Comply with third party and outsourcing regulation",
                "Meet consumer protection requirements",
                "Comply with competition and antitrust regulation",
              ],
            },
            {
              theme: "Cyber & Technology Regulation",
              specific_objectives: [
                "N/A",
                "Comply with cybersecurity regulation",
                "Meet critical national infrastructure protection requirements",
                "Comply with NIS2 or equivalent directive",
                "Meet DORA requirements",
                "Comply with cloud and technology regulation",
                "Address technology risk regulatory requirements",
                "Meet secure software development requirements",
                "Comply with AI governance regulation",
                "Meet digital operational resilience requirements",
                "Comply with telecommunications regulation",
              ],
            },
          ],
        },
        {
          objective_type: "Technology Driver",
          description:
            "What technology challenges or opportunities are driving the engagement",
          themes: [
            {
              theme: "Technology Modernisation",
              specific_objectives: [
                "N/A",
                "Replace or upgrade legacy ERP system",
                "Migrate to cloud infrastructure",
                "Modernise data platform and architecture",
                "Consolidate fragmented application landscape",
                "Decommission legacy systems",
                "Upgrade or replace CRM platform",
                "Modernise integration architecture",
                "Implement new HR technology platform",
                "Replace on-premise solutions with SaaS",
                "Modernise customer-facing digital platforms",
              ],
            },
            {
              theme: "Digital Enablement",
              specific_objectives: [
                "N/A",
                "Build digital products and channels",
                "Implement AI and machine learning capabilities",
                "Enable data-driven decision making",
                "Implement robotic process automation",
                "Build mobile and omnichannel capabilities",
                "Implement IoT and connected device capabilities",
                "Enable real-time analytics and reporting",
                "Build API and ecosystem integration capabilities",
                "Implement intelligent automation",
                "Enable personalisation at scale",
              ],
            },
            {
              theme: "Technology Risk & Security",
              specific_objectives: [
                "N/A",
                "Strengthen cybersecurity posture",
                "Implement zero trust security architecture",
                "Improve identity and access management",
                "Address technology vulnerabilities",
                "Improve disaster recovery and business continuity",
                "Strengthen cloud security",
                "Implement security operations centre",
                "Address third party technology risk",
                "Improve technology resilience",
                "Implement data loss prevention controls",
              ],
            },
            {
              theme: "Technology Efficiency",
              specific_objectives: [
                "N/A",
                "Reduce IT costs and total cost of ownership",
                "Optimise cloud spend",
                "Improve IT service delivery and performance",
                "Rationalise software licensing",
                "Improve DevOps and delivery capability",
                "Optimise IT vendor and contract management",
                "Improve IT governance and control",
                "Reduce technology complexity",
                "Improve IT service management processes",
                "Build internal technology capability",
              ],
            },
          ],
        },
        {
          objective_type: "People & Organisational Driver",
          description:
            "What workforce or structural challenges are driving the engagement",
          themes: [
            {
              theme: "Organisational Change",
              specific_objectives: [
                "N/A",
                "Implement a new organisational structure",
                "Manage a major business transformation programme",
                "Integrate organisations following a merger or acquisition",
                "Separate or carve out a business unit",
                "Transition to a new operating model",
                "Consolidate shared services or outsourcing",
                "Manage workforce restructuring or redundancy",
                "Drive culture change programme",
                "Improve change management capability",
                "Build organisational agility and adaptability",
              ],
            },
            {
              theme: "Workforce Capability",
              specific_objectives: [
                "N/A",
                "Address critical skills gaps",
                "Build digital and technology skills",
                "Develop leadership capability",
                "Upskill workforce for new ways of working",
                "Build data and analytics literacy",
                "Develop agile and product management capability",
                "Build customer experience capability",
                "Improve workforce planning and talent pipeline",
                "Develop change management capability",
                "Build innovation and entrepreneurial capability",
              ],
            },
            {
              theme: "Employee Experience & Engagement",
              specific_objectives: [
                "N/A",
                "Improve employee engagement and satisfaction",
                "Reduce employee turnover and attrition",
                "Improve diversity, equity and inclusion",
                "Enhance employee well-being and mental health",
                "Build a high performance culture",
                "Improve internal communication and collaboration",
                "Enhance recognition and reward programmes",
                "Build a culture of continuous learning",
                "Improve new employee onboarding experience",
                "Strengthen employee value proposition",
              ],
            },
            {
              theme: "Future of Work",
              specific_objectives: [
                "N/A",
                "Implement hybrid and flexible working models",
                "Redesign work for human and machine collaboration",
                "Build workforce resilience and adaptability",
                "Implement AI-augmented workforce models",
                "Redesign jobs and roles for the digital age",
                "Build gig and contingent workforce strategies",
                "Implement new workforce productivity tools",
                "Develop workforce sustainability strategy",
                "Build multigenerational workforce strategies",
                "Implement new performance management approaches",
              ],
            },
          ],
        },
      ],
    },
  },
  services: {
    domains: [
      {
        domain: "Strategy",
        building_blocks: [
          {
            building_block: "Value Case Development",
            description:
              "Supports clients in identifying, evaluating, and presenting the potential benefits of an investment or project against associated costs and risks. This involves understanding client business objectives, market dynamics, and competitive landscape, while conducting rigorous financial analysis and ensuring strategic alignment. Key activities include stakeholder management, return on investment modelling, regulatory compliance assessment, and identification of operational efficiency opportunities through managed services. Outputs include robust, data-driven business cases that clearly articulate the value proposition and pathway to success. The goal is to ensure strategic decisions are grounded in sound financial and business rationale, facilitating effective resource allocation and driving sustainable business growth.",
          },
          {
            building_block: "Performance Management, KPIs, Metrics",
            description:
              "Supports clients in developing and refining key performance indicators (KPIs) and metrics that align with their specific business goals. This involves assessing current performance measurement approaches, identifying gaps, and designing bespoke frameworks tailored to the client's operational context across multiple business functions. Key activities include KPI design, performance framework development, data analysis, and benchmarking against industry standards. Outputs include customised performance measurement frameworks, dashboards, and data-driven insights that enable informed decision-making. The goal is to help clients measure what matters, drive continuous improvement, and achieve sustainable and measurable business growth.",
          },
          {
            building_block: "Strategy & Op Model",
            description:
              "Assists clients in designing and implementing strategies that align with their business goals, and developing operating models that effectively execute those strategies. This involves conducting a comprehensive analysis of the client's industry, market dynamics, internal capabilities, and tax position to outline strategic priorities and identify growth opportunities. Key activities include operating model design, organisational structure optimisation, business process alignment, IT operating model development, and tax strategy integration. Outputs include a clearly defined strategic roadmap, target operating model, and an aligned IT and tax framework that supports the chosen strategic direction. The goal is to create a synergistic relationship between strategy and operations that facilitates sustained business growth, competitive advantage, and efficient tax management.",
          },
          {
            building_block: "Tax Strategy & Integration",
            description:
              "Assists clients in developing and implementing effective tax strategies that align with their broader business goals and operating model. This involves understanding the client's specific tax needs, analysing their current tax position, and identifying planning opportunities across domestic and cross-border operations. Key activities include tax structuring, mergers and acquisitions tax advisory, management of cross-border transactions, identification of tax incentives, and integration of tax strategy into the overall business framework. Outputs include customised tax strategies, risk management frameworks, and compliance roadmaps that optimise tax efficiency and minimise liabilities. The goal is to enhance the client's tax position, reduce financial and regulatory risk, and contribute to long-term financial sustainability.",
          },
          {
            building_block: "Deal Design & Integration",
            description:
              "Supports clients in structuring, designing, and executing mergers, acquisitions, divestitures, and other strategic transactions to maximise deal value. This involves assessing strategic fit, conducting due diligence, and designing integration or separation plans that align with the client's business objectives. Key activities include deal structuring, synergy identification, integration planning, regulatory and tax consideration, and post-deal value realisation tracking. Outputs include deal design frameworks, integration roadmaps, and governance structures that enable a smooth and effective transaction process. The goal is to help clients navigate the complexity of deals and integrations, minimise risk, and realise the full strategic and financial value of the transaction.",
          },
        ],
      },
      {
        domain: "Business, People & Organization",
        building_blocks: [
          {
            building_block: "Value and Benefit Realization",
            description:
              "Supports clients in identifying, tracking, and maximising the value and benefits derived from their investments, programmes, and operational activities. This involves aligning business objectives with operational capabilities, establishing benefit ownership, and conducting structured benefits tracking throughout the lifecycle of an initiative. Key activities include benefits mapping, KPI definition, realisation reporting, risk and compliance assessment, and identification of operational efficiency opportunities through managed services. Outputs include benefits realisation frameworks, tracking dashboards, and periodic realisation reports that provide transparency and accountability. The goal is to ensure clients achieve and sustain the full value of their investments while maintaining regulatory compliance and operational efficiency.",
          },
          {
            building_block: "Business Process with Industry Insights",
            description:
              "Supports clients in improving their business performance by applying industry-specific insights and process optimisation strategies tailored to their sector. This involves assessing current business processes, understanding the unique challenges and opportunities within the client's industry, and recommending improvements based on leading practices and sector benchmarks. Key activities include process mapping, gap analysis, process redesign, risk management, cybersecurity integration, and regulatory compliance strategy development. Outputs include process improvement roadmaps, redesigned workflows, and industry-specific guidance documents that enhance operational efficiency and customer value. The goal is to help clients optimise their operations, drive innovation, and achieve stronger business performance within the context of their industry.",
          },
          {
            building_block: "Capability Design & Development",
            description:
              "Supports clients in assessing, designing, and developing the organisational and technology capabilities required to achieve their strategic objectives. This involves conducting current state capability assessments, identifying gaps, and creating high-level target capability designs that span both business and technology domains. Key activities include capability mapping, gap analysis, capability acquisition strategy, and alignment with the Business Process and Organisational Design building blocks for detailed execution. Outputs include capability frameworks, target state designs, and capability development roadmaps that provide a clear path to building competitive advantage. The goal is to help clients align their organisational capabilities with strategic priorities, foster innovation, and enable agility in a rapidly evolving business environment.",
          },
          {
            building_block: "Business Readiness",
            description:
              "Supports organisations in assessing and building their readiness to adopt new strategies, processes, technologies, or regulatory changes prior to implementation. This involves evaluating the organisation's current state, identifying gaps and barriers to change, and developing targeted plans to ensure successful transition and adoption. Key activities include impact assessments, stakeholder analysis, change readiness assessments, communication planning, and coordination with the Change Management, Enablement and Adoption building block. Outputs include readiness assessment reports, gap analyses, and readiness improvement plans that provide a structured pathway to successful change. The goal is to help organisations proactively manage change, minimise resistance, and maximise the likelihood of achieving desired business outcomes.",
          },
          {
            building_block: "Enterprise Resilience",
            description:
              "Supports clients in planning for and building a resilient operational and technological environment capable of withstanding large-scale disruptive events. This involves assessing the client's current resilience posture across multiple domains and designing programmes that address vulnerabilities and strengthen organisational durability. Key activities include operational resilience planning, business continuity management, disaster recovery design, cyber resilience assessment, physical security planning, emergency planning, and supply chain resilience analysis. Outputs include enterprise resilience frameworks, business continuity plans, disaster recovery playbooks, and compliance monitoring programmes. The goal is to help clients anticipate, prepare for, respond to, and recover from events that threaten their ability to deliver critical business services.",
          },
          {
            building_block: "Organizational Design",
            description:
              "Supports clients in optimising their organisational structures to enhance efficiency, promote collaboration, and align with strategic objectives. This involves assessing the current organisational structure, evaluating the alignment of roles and responsibilities, and designing target state structures that support the delivery of the agreed operating model. Key activities include organisational assessment, design of reporting lines and governance structures, decision-making process redesign, outsourcing consideration, and tax-efficient organisational design. Outputs include organisational charts, governance frameworks, RACI matrices, and design recommendations that provide clarity and accountability across the organisation. The goal is to help clients create agile, adaptable organisations that drive innovation, increase productivity, and enable sustainable growth in a rapidly changing business environment.",
          },
          {
            building_block: "Employee Experience",
            description:
              "Supports clients in enhancing the employee experience and fostering a culture of innovation, engagement, and continuous development within their organisations. This involves assessing the current employee experience, identifying areas for improvement, and designing programmes that create a positive, inclusive, and productive work environment. Key activities include employee engagement strategy design, well-being programme development, talent development planning, performance management framework design, and implementation of technology-enabled learning and collaboration tools. Outputs include employee experience strategies, engagement programme designs, talent development frameworks, and innovation initiative roadmaps. The goal is to help clients build an environment where employees feel valued, motivated, and empowered, resulting in increased productivity, improved talent retention, and sustained business success.",
          },
          {
            building_block: "Change Management, Enablement and Adoption",
            description:
              "Supports clients in effectively managing organisational change and ensuring that individuals and teams are informed, engaged, and equipped to embrace new ways of working. This involves understanding the drivers and scope of change, identifying potential challenges, and developing comprehensive change management and communications plans. Key activities include change impact assessment, stakeholder engagement strategy, communication planning, resistance management, training programme design, and adoption tracking. Outputs include change management strategies, communication plans, training materials, and adoption metrics dashboards that provide a structured and measurable approach to change. The goal is to help clients navigate the complexities of change, minimise disruption, and achieve successful implementation with high levels of employee adoption and sustained behaviour change.",
          },
          {
            building_block: "Workforce Planning",
            description:
              "Supports clients in strategically planning, developing, and upskilling their workforce to meet current and future business needs. This involves assessing the current workforce capabilities, identifying skill gaps, and designing strategies to align talent with the organisation's goals and evolving operating model. Key activities include workforce demand and supply analysis, talent acquisition strategy, succession planning, training curriculum development, and performance management framework design. Outputs include workforce plans, skills gap analyses, talent development roadmaps, and upskilling programme designs that provide a structured approach to building organisational capability. The goal is to help clients build a resilient and adaptable workforce that drives employee engagement, retention, and productivity while fostering a culture of continuous learning and growth.",
          },
          {
            building_block: "GBS - Outsourcing",
            description:
              "Supports clients in selecting and transitioning to external service providers for functions identified as suitable for outsourcing following a strategic operating model decision. This involves assessing which services are most appropriate to procure externally, defining service requirements, and managing the provider selection and contracting process. Key activities include outsourcing candidate assessment, market analysis, provider selection, contract design, service level agreement definition, governance framework establishment, and transition management. Outputs include outsourcing strategies, provider shortlists, contracts, SLA frameworks, and transition plans that ensure a smooth and accountable handover of responsibilities. The goal is to help clients achieve cost efficiency, access specialist expertise, and focus internal resources on core strategic activities.",
          },
          {
            building_block: "GBS - Shared Services",
            description:
              "Supports clients in establishing and implementing shared services operating models to consolidate and centralise support functions within a captive organisational structure. This involves assessing which functions are suitable for centralisation, defining the scope and operating model of the shared service centre, and managing the transition of responsibilities. Key activities include shared services scoping, process standardisation, location strategy, technology enablement, governance design, change management, and transition planning. Outputs include shared services business cases, operating model designs, process migration plans, and governance frameworks that provide a structured foundation for the shared service centre. The goal is to help clients reduce operational costs, improve service quality and consistency, and free up business units to focus on value-adding activities.",
          },
          {
            building_block: "IT Service Management",
            description:
              "Supports clients in designing and optimising their IT service delivery models to align with business objectives, improve operational efficiency, and enhance end-user satisfaction. This involves evaluating the current IT service delivery model, identifying areas for improvement including cybersecurity, and designing a target model that leverages leading frameworks and emerging technologies. Key activities include IT service management framework design, ITIL-aligned process improvement, service catalogue design, service level agreement development, IT governance design, and vendor management optimisation. Outputs include IT service delivery models, governance frameworks, service catalogues, and SLA structures that provide a clear and scalable foundation for IT operations. The goal is to help clients establish a robust and scalable IT service delivery capability that optimises resource allocation, improves service quality, and enables digital transformation.",
          },
        ],
      },
      {
        domain: "Data & AI",
        building_blocks: [
          {
            building_block: "Data Privacy & Protection",
            description:
              "Supports clients in unlocking the value of their data assets in a secure, ethical, and compliant manner across global operations. This involves assessing the client's current data privacy posture, identifying risks associated with the handling of sensitive information, and designing frameworks that ensure compliance with applicable privacy regulations. Key activities include privacy impact assessments, data classification, consent management design, regulatory compliance analysis (including GDPR and other regional frameworks), and implementation of data protection controls. Outputs include data privacy frameworks, protection policies, compliance roadmaps, and risk registers that provide a structured and auditable approach to data governance. The goal is to help clients protect sensitive information, build trust with customers and regulators, and enable responsible and compliant use of data across the organisation.",
          },
          {
            building_block: "Data & Analytics Strategy and Governance",
            description:
              "Supports clients in developing comprehensive data and analytics strategies and implementing effective governance practices that enable data-driven decision-making across the organisation. This involves understanding the client's business objectives, evaluating their data assets and current governance maturity, and designing strategies to harness the full value of data and analytics. Key activities include data governance framework design, data quality management, data integration planning, analytics capability assessment, and compliance with data regulations. Outputs include data and analytics strategies, governance frameworks, data architecture blueprints, and analytics roadmaps that provide a clear and actionable path to data maturity. The goal is to help clients establish a robust and agile data and analytics ecosystem that fosters innovation, improves decision-making, and drives sustainable competitive advantage.",
          },
          {
            building_block: "Master Data Management",
            description:
              "Supports clients in establishing a centralised and consistent approach to managing their critical business data across multiple systems and platforms. This involves understanding the client's master data requirements, evaluating their existing data landscape, and designing strategies and processes to ensure accurate, reliable, and up-to-date master data. Key activities include data governance design, data stewardship role definition, data quality assessment, data synchronisation, data consolidation, and cross-platform master data alignment. Outputs include master data management frameworks, data stewardship models, data quality scorecards, and synchronisation architectures that provide a single, trusted view of critical business data. The goal is to help clients improve decision-making, reduce data redundancy and duplication, streamline processes, and enhance overall data quality and operational integrity.",
          },
          {
            building_block: "Business Intelligence & Analytics Consumption",
            description:
              "Supports clients in effectively consuming and utilising business intelligence and analytics solutions through the strategic implementation of data technologies and platforms. This involves understanding the client's business objectives, evaluating their existing data and analytics infrastructure, and designing strategies to enhance the accessibility and utilisation of insights. Key activities include analytics tool selection, data integration design, visualisation solution development, data architecture design, governance and compliance assessment, and privacy and security review. Outputs include analytics platforms, data integration solutions, visualisation dashboards, and compliance reporting structures that provide intuitive and reliable access to business insights. The goal is to help clients leverage data effectively to enable seamless access to information, enhance decision-making quality, and improve overall business performance.",
          },
          {
            building_block: "AI/ML Solutions",
            description:
              "Supports clients in leveraging artificial intelligence and machine learning technologies to develop innovative solutions that address business challenges and drive measurable outcomes. This involves understanding the client's specific needs, evaluating their data landscape, and designing and implementing AI/ML solutions that are fit for purpose and aligned with strategic goals. Key activities include opportunity identification, data availability and quality assessment, algorithm and model selection, data preprocessing, model development, training, validation, deployment, and integration into existing systems. Outputs include deployed AI/ML models, performance evaluation reports, integration architectures, and AI strategy roadmaps that provide a clear path to intelligent automation and insight generation. The goal is to help clients unlock the value of their data through AI and ML, enabling process automation, data-driven decision-making, enhanced cyber and operational risk management, and sustained competitive advantage.",
          },
          {
            building_block: "Data Engineering & Data Modernization",
            description:
              "Supports clients in building modern, scalable data platforms that underpin effective data management and advanced analytics across the enterprise. This involves designing and constructing cloud-based data infrastructure, developing robust data pipelines, and implementing automated data operations that support the full lifecycle of data from collection through to analysis. Key activities include cloud platform design, data pipeline development, scalable storage architecture, data operations automation, and integration with analytics and AI capabilities. Outputs include modern data platforms, data pipeline architectures, cloud infrastructure designs, and operational runbooks that provide a reliable and scalable foundation for enterprise data management. The goal is to help clients modernise their data environment, foster better decision-making, and enable seamless integration with advanced analytics and AI capabilities.",
          },
          {
            building_block: "Data Quality & Conversion",
            description:
              "Supports clients in elevating data quality and managing data conversion activities to ensure high data integrity across systems and throughout transformation programmes. This involves comprehensive data profiling, cleansing, and enrichment activities aligned to industry-leading data quality frameworks, as well as managing the transition of data from legacy systems to new platforms. Key activities include data profiling, cleansing, enrichment, audit trail implementation, regulatory compliance assessment, legacy data migration, and ongoing data quality monitoring. Outputs include data quality assessments, cleansed and enriched datasets, conversion plans, audit reports, and data quality scorecards that provide transparency and accountability throughout the data lifecycle. The goal is to ensure that data is accurate, consistent, and fit for purpose at go-live and beyond, supporting both immediate system transitions and long-term data quality standards across the organisation.",
          },
          {
            building_block: "Data Design",
            description:
              "Supports clients in developing a strategic and structured approach to managing and leveraging their data assets in alignment with business objectives. This involves assessing current data management practices, understanding business requirements, and designing data architectures, models, and governance frameworks that enable effective use of data across the organisation. Key activities include data requirements definition, data model design, governance framework implementation, data quality optimisation, cybersecurity and risk management integration, and regulatory compliance design. Outputs include data architecture blueprints, data models, governance frameworks, and compliance design documents that provide a clear and actionable foundation for enterprise data management. The goal is to ensure data is effectively structured, governed, and utilised to run business operations, deliver insights, support decision-making, and drive business performance.",
          },
          {
            building_block: "Information Governance",
            description:
              "Supports clients in governing their data assets throughout the full data lifecycle, from generation and protection through to disposal, in compliance with applicable regulations and business requirements. This involves understanding the client's data landscape, identifying the most valuable and sensitive data assets, and designing governance frameworks that ensure data is protected, managed, and retired appropriately. Key activities include data lifecycle mapping, regulatory compliance assessment, data classification, risk identification, digital platform enablement, and analytics-driven data discovery. Outputs include information governance frameworks, data lifecycle policies, compliance registers, and risk remediation plans that provide a structured and auditable approach to data stewardship. The goal is to help clients protect their most valuable data, optimise the management of unsecured or unreliable data, and maintain ongoing compliance with relevant data regulations.",
          },
        ],
      },
      {
        domain: "Solution",
        building_blocks: [
          {
            building_block: "Business Process & Technology Controls",
            description:
              "Supports clients in creating and implementing a robust business and technology control environment that prevents, mitigates, and manages regulatory and operational risks. This involves assessing the current control landscape, identifying control gaps and weaknesses, and designing an integrated control framework that spans both business processes and technology systems. Key activities include control environment assessment, risk identification, control design and implementation, technology control testing, and regulatory compliance alignment. Outputs include control frameworks, risk and control matrices, testing results, and remediation plans that provide a comprehensive and auditable approach to risk and control management. The goal is to help clients establish a resilient control environment that reduces exposure to operational and regulatory risk while supporting business performance and compliance objectives.",
          },
          {
            building_block:
              "Financial Crimes & Investigations (Internal & External)",
            description:
              "Supports clients in preventing, detecting, and investigating financial crimes including fraud, money laundering, and sanctions breaches, while ensuring compliance with applicable regulatory requirements. This involves assessing the client's current financial crime risk posture, designing compliance frameworks, and conducting investigations in support of regulatory, legal, and commercial matters. Key activities include Anti-Money Laundering (AML) programme design, Know Your Customer (KYC) framework implementation, sanctions compliance assessment, financial crime risk assessment, internal and external investigations, and litigation and M&A due diligence support. Outputs include compliance frameworks, investigation reports, due diligence findings, and remediation recommendations that provide clients and their legal counsel with clear and actionable intelligence. The goal is to help clients reduce financial crime risk, meet regulatory obligations, and respond effectively to instances of suspected criminal activity.",
          },
          {
            building_block: "Regulatory Risk & Compliance",
            description:
              "Supports clients in navigating their regulatory compliance and risk management obligations by developing a holistic and structured approach to identifying, assessing, and mitigating regulatory requirements. This involves understanding the client's regulatory environment, assessing their current compliance posture, and designing frameworks that embed compliance into business-as-usual operations. Key activities include regulatory landscape analysis, compliance gap assessment, risk identification and prioritisation, compliance framework design, regulatory change management, and readiness programme development. Outputs include regulatory compliance frameworks, risk registers, gap assessment reports, and compliance roadmaps that provide clients with a clear and structured path to regulatory readiness. The goal is to help clients proactively manage regulatory risk, maintain compliance across all applicable jurisdictions, and build a culture of accountability and governance.",
          },
          {
            building_block: "Hardware Product Design",
            description:
              "Supports clients in designing and developing physical hardware products from initial concept through to high-yield manufacturing readiness. This involves guiding clients through the full product development lifecycle including market research, product definition, design for excellence (DFX), technology research, and manufacturing qualification. Key activities include industrial design, mechanical and electrical engineering, audio and software engineering, regulatory compliance, prototyping, testing and validation, engineering validation testing (EVT), design validation testing (DVT), and production validation testing (PVT). Outputs include product definitions, design files, validated prototypes, compliance documentation, and manufacturing-ready specifications that provide a complete and manufacturable product design. The goal is to help clients bring innovative, high-quality physical products to market efficiently, with robust manufacturing processes that support high-yield production at scale.",
          },
          {
            building_block: "Identity & Access Management (IAM)",
            description:
              "Supports clients in governing and maturing their Identity and Access Management programmes to ensure secure and appropriate access to company data, systems, and equipment. This involves assessing the client's current IAM posture, identifying gaps and vulnerabilities, and designing and implementing solutions across the key IAM domains. Key activities include Identity Governance and Administration (IGA) design, Access Management (AM) implementation, Privileged Access Management (PAM) controls, Customer Identity and Access Management (CIAM) design, and ongoing programme governance. Outputs include IAM frameworks, access policies, governance models, and implementation roadmaps that provide a structured and scalable approach to identity and access control. The goal is to help clients reduce security risk, enforce least-privilege access principles, improve regulatory compliance, and deliver a seamless and secure identity experience for both employees and customers.",
          },
          {
            building_block: "Software Evaluation & Selection",
            description:
              "Supports clients in navigating the process of identifying and selecting the right software solution to meet their specific business needs and strategic objectives. This involves assessing the client's current state capabilities, defining future state requirements, and conducting a structured evaluation of available vendor solutions. Key activities include current state assessment, requirements definition, vendor market analysis, evaluation criteria development, demonstration facilitation, scoring and shortlisting, and adoption readiness planning. Outputs include requirements documentation, vendor assessment scorecards, recommendation reports, and selection roadmaps that provide clients with a clear and evidence-based basis for their software investment decision. The goal is to help clients make informed, objective software selection decisions that enhance business performance and support successful long-term adoption.",
          },
          {
            building_block: "Vendor Solution Configuration & Development",
            description:
              "Supports clients in implementing and configuring major enterprise software solutions tailored to their specific business requirements and operational context. This involves understanding the client's business processes, selecting the appropriate solution configuration approach, and managing the end-to-end implementation lifecycle. Key activities include solution design, system configuration, data migration, customisation, integration, testing, training, go-live support, and incorporation of risk, regulatory, and tax considerations. Primary solutions supported include Oracle, SAP, Salesforce, Microsoft Dynamics, Workday, Contract Lifecycle Management, Maximo, ESRI, Guidewire, Smart Energy Water, and Coupa. Outputs include configured and tested solutions, data migration plans, integration designs, training materials, and go-live readiness assessments that provide a fully operational and tailored business solution. The goal is to guide clients through the entire implementation journey, ensuring the chosen solution is aligned to their business needs and delivers the desired operational and strategic outcomes.",
          },
          {
            building_block: "Integration",
            description:
              "Supports clients in designing, implementing, and executing integration platforms and API solutions that enable seamless connectivity and data flow across systems and applications. This involves understanding the client's integration needs, evaluating available platforms, and providing end-to-end support for successful integration delivery. Key activities include integration strategy and roadmap development, platform selection and configuration, data mapping and transformation, API development and management, integration testing, and cybersecurity and compliance integration. Primary platforms supported include MuleSoft and Boomi. Outputs include integration architectures, API catalogues, platform configurations, and testing results that provide a reliable and scalable integration foundation. The goal is to help clients achieve seamless interoperability between their systems, reduce data silos, and enable efficient and secure data exchange across the enterprise.",
          },
          {
            building_block: "Solution Architecture",
            description:
              "Supports clients in designing optimal solution architectures for their technology initiatives that are scalable, secure, and aligned with business objectives. This involves understanding the client's requirements and technology landscape, evaluating options, and providing expert guidance on architecture design across both enterprise and solution levels. Key activities include enterprise architecture strategy, business architecture design, application architecture, data architecture, cloud architecture, DevOps architecture, process architecture, cyber risk management integration, and regulatory compliance consideration. Outputs include architecture blueprints, solution design documents, architecture decision records, and compliance frameworks that provide a clear and actionable technical foundation for delivery. The goal is to help clients design technology solutions that are robust, future-proof, and well-aligned to their strategic direction, while managing risk and ensuring regulatory compliance.",
          },
          {
            building_block: "User Experience",
            description:
              "Supports clients in designing products and services that deliver seamless, intuitive, and engaging experiences for their users. This involves understanding the client's target audience, conducting user research, and applying human-centred design principles to inform the design of interfaces and interactions. Key activities include user research, usability testing, persona development, journey mapping, wireframing, prototyping, and iterative design validation. Outputs include user research findings, journey maps, wireframes, interactive prototypes, and UX design specifications that provide a clear and validated blueprint for interface development. The goal is to help clients create products and services that meet user needs, drive customer satisfaction and loyalty, and deliver measurable improvements in engagement and business performance.",
          },
          {
            building_block: "Cloud & Infrastructure Engineering",
            description:
              "Supports clients in designing, implementing, and optimising their infrastructure and cloud environments to provide a secure, scalable, and resilient foundation for their technology operations. This involves assessing the client's current infrastructure landscape, identifying areas for improvement, and designing target state environments that meet business and technical requirements. Key activities include network architecture design, server and storage infrastructure design, cloud platform selection and configuration, infrastructure security design, performance optimisation, and ongoing infrastructure management. Outputs include infrastructure designs, cloud architecture blueprints, implementation plans, and operational runbooks that provide a robust and well-documented foundation for technology operations. The goal is to help clients establish a modern, efficient, and secure infrastructure environment that supports business agility, reduces operational risk, and enables digital transformation.",
          },
          {
            building_block: "Cloud Migration & Optimization",
            description:
              "Supports clients in planning and executing successful migrations to cloud environments and optimising their existing cloud deployments to maximise value and efficiency. This involves assessing the client's current application and infrastructure estate, defining a cloud migration strategy, and managing the end-to-end migration process using leading cloud technologies and best practices. Key activities include cloud readiness assessment, migration strategy development, workload prioritisation, migration execution, post-migration optimisation, cost management, and security and compliance validation. Outputs include cloud migration strategies, workload migration plans, optimisation recommendations, and post-migration performance reports that provide a clear and structured path to cloud adoption. The goal is to help clients realise the full benefits of cloud computing including improved agility, reduced infrastructure costs, enhanced resilience, and accelerated innovation.",
          },
          {
            building_block: "Custom Application Development",
            description:
              "Supports clients in designing, building, and deploying robust and scalable software applications tailored to their specific business needs and objectives. This involves managing the full application development lifecycle from requirements gathering through to deployment and ongoing support. Key activities include requirements gathering and analysis, product management, UX design, solution architecture, coding and development, testing and quality assurance, deployment and release management, and R&D tax credit eligibility assessment. Outputs include fully developed and tested applications, technical documentation, deployment packages, and support frameworks that provide clients with reliable and fit-for-purpose software solutions. The goal is to help clients deliver high-quality custom software that solves specific business problems, drives operational efficiency, promotes innovation, and where applicable, leverages available R&D tax incentives.",
          },
          {
            building_block: "Performance Optimization & SRE",
            description:
              "Supports clients in improving the performance, stability, and scalability of their software applications and systems through the application of performance engineering and site reliability engineering (SRE) practices. This involves assessing current system performance, identifying bottlenecks and reliability risks, and implementing targeted optimisation and reliability improvements. Key activities include performance profiling and benchmarking, bottleneck identification, optimisation implementation, SRE framework design, incident management, reliability monitoring, and ongoing SRE operational support. Outputs include performance assessment reports, optimisation recommendations, SRE frameworks, monitoring dashboards, and incident response playbooks that provide a structured and measurable approach to system reliability. The goal is to help clients achieve high-performing, resilient, and scalable systems that meet user expectations, reduce downtime, and support the reliable delivery of business-critical services.",
          },
          {
            building_block: "Security Integration",
            description:
              "Supports clients in embedding security controls into their enterprise applications and identity solutions to protect assets, maintain data confidentiality, ensure integrity, and meet compliance requirements. This involves assessing the current security posture of application and identity environments, identifying vulnerabilities and compliance gaps, and designing and implementing integrated security solutions. Key activities include security architecture design, application security controls implementation, identity solution security integration, compliance framework alignment, vulnerability assessment, and security testing. Outputs include security architecture designs, integrated security controls, compliance evidence packages, and remediation plans that provide a structured and verifiable approach to application and identity security. The goal is to help clients build a security-by-design culture across their application landscape, reducing the risk of data breaches, ensuring regulatory compliance, and maintaining the trust of customers and stakeholders.",
          },
          {
            building_block: "Cyber Security",
            description:
              "Supports clients in protecting their digital assets, systems, and data from the full spectrum of cyber threats through a comprehensive and proactive approach to cybersecurity. This involves assessing the client's current cyber risk posture, identifying vulnerabilities and threat vectors, and designing and implementing security measures that ensure the confidentiality, integrity, and availability of information assets. Key activities include cyber risk assessment, threat intelligence analysis, security architecture design, penetration testing, incident response planning, malware and ransomware protection, phishing mitigation, and ongoing security monitoring and support. Outputs include cyber risk assessments, security architectures, incident response playbooks, vulnerability reports, and security monitoring frameworks that provide a robust and comprehensive defence against cyber threats. The goal is to help clients reduce their cyber risk exposure, respond effectively to incidents, and build a resilient and compliant security posture that protects the organisation and its stakeholders.",
          },
        ],
      },
      {
        domain: "Operations",
        building_blocks: [
          {
            building_block: "Internal Audit & Monitoring of Internal Controls",
            description:
              "Supports clients in obtaining an independent and objective assessment of their processes, systems, data, and financial statements to identify and mitigate applicable risks. This involves planning and executing audit activities across a range of risk domains including financial reporting, cybersecurity, and operational risk, and providing actionable recommendations for improvement. Key activities include audit planning, risk-based scoping, process and control testing, financial statement review, cybersecurity audit, operational risk assessment, and findings reporting. Outputs include internal audit reports, control testing results, risk registers, and management action plans that provide clients with a clear and evidence-based view of their control environment. The goal is to help clients strengthen their internal control frameworks, improve governance and accountability, and reduce exposure to financial, operational, and regulatory risk.",
          },
          {
            building_block:
              "Operational Engineering (incl. Quality Engineering)",
            description:
              "Supports clients in enhancing product quality and customer satisfaction through scalable, efficient, and expert-led operational and quality engineering capabilities. This involves assessing current quality practices, implementing advanced quality engineering techniques, and flexibly scaling quality engineering capacity to meet changing business demands. Key activities include quality framework design, quality assurance process implementation, quality control testing, performance benchmarking, defect management, and capacity planning for quality engineering resources. Outputs include quality engineering frameworks, test plans, quality assessment reports, defect logs, and performance benchmarks that provide clients with a structured and measurable approach to quality management. The goal is to help clients consistently deliver high-quality software and products, reduce defect rates, improve customer satisfaction, and optimise the efficiency of their quality engineering operations.",
          },
          {
            building_block: "Technology Managed Service",
            description:
              "Supports clients in maintaining the ongoing availability, performance, and functionality of their enterprise business applications through expert-led managed service operations. This involves providing routine maintenance, updates, troubleshooting, and system optimisation services for major platforms including Oracle, SAP, Workday, Salesforce, Guidewire, Atlassian, and ServiceNow. Key activities include application maintenance, incident management, system updates and patching, performance monitoring, user support, and continuous improvement of application operations. Outputs include service performance reports, incident logs, system health dashboards, and improvement recommendations that provide clients with full visibility of their application landscape. The goal is to help clients offload application support and maintenance responsibilities, ensuring reliable and responsive technology operations that free internal teams to focus on core business activities.",
          },
          {
            building_block: "Risk & Regulatory Managed Services",
            description:
              "Supports clients in managing risk and regulatory obligations through specialist managed services that combine operational expertise, strategic thinking, and advanced technology solutions. This involves designing and operating efficient workflows that address the risk and regulatory components of client operations, including process automation, data management, and customer support functions. Key activities include regulatory process management, risk monitoring, compliance reporting, workflow automation, data management, and operational performance tracking. Outputs include managed service performance reports, compliance dashboards, process automation solutions, and risk and regulatory status updates that provide clients with ongoing assurance and operational efficiency. The goal is to help clients reduce the cost and complexity of managing risk and regulatory obligations while maintaining high standards of compliance, accuracy, and operational performance.",
          },
          {
            building_block: "Business Outcome Managed Services (BOMS)",
            description:
              "Supports clients in managing their legal, finance, and accounting operations through outcome-focused managed services that drive efficiency, reduce costs, and enhance productivity. This involves combining operational expertise, strategic thinking, and advanced technology solutions to deliver efficient and reliable support for business-critical functions. Key activities include legal operations support, finance and accounting process management, workflow automation, data management, process optimisation, and customer support operations. Outputs include managed service performance reports, process efficiency metrics, automation solutions, and operational improvement recommendations that provide clients with a clear view of outcomes delivered. The goal is to help clients achieve better business outcomes from their legal, finance, and accounting functions by leveraging specialist expertise and technology-enabled operations at scale.",
          },
        ],
      },
      {
        domain: "Enablement",
        building_blocks: [
          {
            building_block: "DevSecOps",
            description:
              "Supports clients in adopting a unified and integrated approach to software development, security, and operations that accelerates delivery while maintaining consistent security and operational standards. This involves assessing the client's current development and operations practices, identifying security and efficiency gaps, and designing and implementing a DevSecOps framework that embeds security throughout the delivery pipeline. Key activities include DevOps toolchain selection and configuration, security protocol automation, pipeline design, vulnerability management, release velocity optimisation, and security integration at the earliest stages of development. Outputs include DevSecOps frameworks, automated pipeline configurations, security assessment reports, and toolchain architectures that provide a secure, efficient, and repeatable path from development to deployment. The goal is to help clients reduce security vulnerabilities, accelerate release cycles, and maintain the agility and innovation speed required to remain competitive.",
          },
          {
            building_block: "Program Management",
            description:
              "Supports clients in planning, executing, and governing strategic programmes and projects through expert programme management and agile coaching capabilities. This involves providing leadership and guidance across both traditional project management methodologies and agile practices to ensure initiatives are delivered within scope, on time, and within budget. Key activities include programme planning, project governance, scope and schedule management, budget tracking, agile team formation, scrum facilitation, agile coaching, impediment resolution, and continuous improvement facilitation. Outputs include programme plans, governance frameworks, status reports, agile delivery artefacts, and coaching assessments that provide clients with clear visibility and control over their strategic initiatives. The goal is to help clients deliver their programmes successfully, foster a culture of continuous improvement and adaptability, and build internal delivery capability that sustains long-term organisational performance.",
          },
          {
            building_block: "Deployment & Deployment Support",
            description:
              "Supports clients in ensuring a smooth, controlled, and reliable transition from development to production for business and cloud solutions. This involves providing expertise in both manual and automated deployment methodologies and delivering post-deployment support to ensure stability, performance, and user adoption following release. Key activities include deployment strategy design, release management, automated and manual deployment execution, infrastructure configuration, post-deployment troubleshooting, performance monitoring, and user training. Outputs include deployment plans, release packages, post-deployment monitoring dashboards, and support documentation that provide clients with a structured and well-governed approach to solution release. The goal is to help clients minimise deployment risk and disruption, maximise system stability and performance, and ensure that newly deployed solutions are fully adopted and delivering value as quickly as possible.",
          },
          {
            building_block: "Quality Management",
            description:
              "Supports clients and delivery teams in embedding a systematic and structured approach to quality across all phases of a project or programme to increase the likelihood of success and reduce quality-related risks. This involves designing and implementing quality management activities that are tailored to the specific context of the engagement and aligned with PwC's governance and delivery standards. Key activities include quality planning, quality assurance, quality control, quality review facilitation, Quality Partner or Quality Review Partner (QRP) engagement, and quality reporting at delivery, territory, and network levels. Outputs include quality management plans, assurance review reports, control testing results, and quality performance dashboards that provide a comprehensive and layered view of quality across the programme. The goal is to help clients and delivery teams consistently deliver high-quality outcomes for the Firm, clients, and people, while proactively managing quality risks that could otherwise prevent the realisation of planned programme benefits.",
          },
        ],
      },
    ],
  },
  technologies: {
    technology_and_tools: {
      field_type: "multi-select",
      categories: [
        {
          category: "ERP & Business Applications",
          sub_categories: [
            {
              sub_category: "Core ERP",
              options: [
                "SAP S/4HANA",
                "SAP ECC",
                "Oracle Fusion Cloud ERP",
                "Oracle EBS",
                "Microsoft Dynamics 365 Finance & Operations",
                "Infor CloudSuite",
                "Unit4 ERP",
                "Epicor ERP",
                "IFS Cloud",
                "Sage X3",
              ],
            },
            {
              sub_category: "ERP Platform & Extension",
              options: [
                "SAP BTP",
                "SAP Fiori",
                "Oracle Cloud Platform",
                "Microsoft Power Platform",
              ],
            },
            {
              sub_category: "Finance & Accounting",
              options: [
                "BlackLine",
                "HighRadius",
                "Trintech",
                "Kyriba",
                "OneStream",
                "Anaplan",
                "Adaptive Insights",
                "Board",
                "IBM TM1",
                "Longview",
                "Hyperion",
              ],
            },
            {
              sub_category: "Planning & Budgeting",
              options: [
                "Anaplan",
                "Adaptive Insights",
                "OneStream",
                "Oracle EPM Cloud",
                "SAP BPC",
                "Board",
                "Planful",
              ],
            },
          ],
        },
        {
          category: "CRM & Customer Engagement",
          sub_categories: [
            {
              sub_category: "CRM Platforms",
              options: [
                "Salesforce Sales Cloud",
                "Salesforce Service Cloud",
                "Microsoft Dynamics 365 CRM",
                "HubSpot CRM",
                "Pegasystems CRM",
                "Zendesk Sell",
                "SugarCRM",
              ],
            },
            {
              sub_category: "Marketing Automation",
              options: [
                "Salesforce Marketing Cloud",
                "Adobe Experience Cloud",
                "HubSpot Marketing",
                "Marketo",
                "Eloqua",
                "Pardot",
                "Braze",
              ],
            },
            {
              sub_category: "Customer Service & Contact Centre",
              options: [
                "Salesforce Service Cloud",
                "Zendesk",
                "ServiceNow CSM",
                "Genesys",
                "NICE CXone",
                "Pegasystems Customer Service",
                "Freshdesk",
              ],
            },
            {
              sub_category: "Customer Experience & Feedback",
              options: [
                "Qualtrics",
                "Medallia",
                "Hotjar",
                "UserTesting",
                "Sprinklr",
                "Confirmit",
              ],
            },
            {
              sub_category: "eCommerce",
              options: [
                "Salesforce Commerce Cloud",
                "SAP Commerce Cloud",
                "Adobe Commerce (Magento)",
                "Shopify Plus",
                "BigCommerce",
                "Commercetools",
              ],
            },
          ],
        },
        {
          category: "Data & Analytics",
          sub_categories: [
            {
              sub_category: "Data Warehousing & Lakehouse",
              options: [
                "Snowflake",
                "Databricks",
                "Microsoft Azure Synapse",
                "Google BigQuery",
                "AWS Redshift",
                "Teradata",
                "IBM Db2 Warehouse",
              ],
            },
            {
              sub_category: "Business Intelligence & Visualisation",
              options: [
                "Microsoft Power BI",
                "Tableau",
                "Qlik Sense",
                "Looker",
                "SAP Analytics Cloud",
                "MicroStrategy",
                "TIBCO Spotfire",
                "Sisense",
              ],
            },
            {
              sub_category: "Advanced & Predictive Analytics",
              options: ["SAS", "Alteryx", "KNIME", "RapidMiner", "MATLAB"],
            },
            {
              sub_category: "Data Governance & Cataloguing",
              options: [
                "Collibra",
                "Alation",
                "Informatica Axon",
                "IBM Watson Knowledge Catalog",
                "Microsoft Purview",
                "Atlan",
                "Alex Solutions",
              ],
            },
            {
              sub_category: "Master Data Management",
              options: [
                "Informatica MDM",
                "SAP MDG",
                "IBM InfoSphere MDM",
                "Stibo Systems STEP",
                "Reltio",
                "Semarchy",
                "Profisee",
                "Ataccama",
              ],
            },
            {
              sub_category: "Data Quality",
              options: [
                "Informatica Data Quality",
                "Talend Data Quality",
                "IBM InfoSphere QualityStage",
                "Ataccama ONE",
                "Experian Data Quality",
                "SAS Data Quality",
              ],
            },
            {
              sub_category: "Data Integration & ETL",
              options: [
                "Informatica PowerCenter",
                "Talend",
                "IBM DataStage",
                "Microsoft Azure Data Factory",
                "AWS Glue",
                "Google Cloud Dataflow",
                "Fivetran",
                "dbt",
              ],
            },
          ],
        },
        {
          category: "Artificial Intelligence & Machine Learning",
          sub_categories: [
            {
              sub_category: "AI & ML Platforms",
              options: [
                "Microsoft Azure AI",
                "Google Vertex AI",
                "AWS SageMaker",
                "IBM Watson Studio",
                "DataRobot",
                "H2O.ai",
                "Dataiku",
                "C3.ai",
                "Palantir AIP",
              ],
            },
            {
              sub_category: "Generative AI & Large Language Models",
              options: [
                "Microsoft Azure OpenAI",
                "OpenAI GPT",
                "Google Gemini",
                "AWS Bedrock",
                "Anthropic Claude",
                "Cohere",
                "Mistral AI",
              ],
            },
            {
              sub_category: "AI-Powered Automation",
              options: [
                "UiPath AI",
                "Automation Anywhere AI",
                "Microsoft Copilot",
                "Salesforce Einstein",
                "ServiceNow AI",
                "IBM Watson Orchestrate",
              ],
            },
            {
              sub_category: "Computer Vision & NLP",
              options: [
                "Google Cloud Vision",
                "AWS Rekognition",
                "Microsoft Azure Cognitive Services",
                "ABBYY",
                "Nuance",
                "OpenCV",
              ],
            },
          ],
        },
        {
          category: "Cloud Platforms",
          sub_categories: [
            {
              sub_category: "Hyperscale Cloud",
              options: [
                "Microsoft Azure",
                "Amazon Web Services (AWS)",
                "Google Cloud Platform (GCP)",
                "IBM Cloud",
                "Oracle Cloud Infrastructure",
                "Alibaba Cloud",
              ],
            },
            {
              sub_category: "Cloud Management & FinOps",
              options: [
                "CloudHealth by VMware",
                "Apptio Cloudability",
                "AWS Cost Explorer",
                "Azure Cost Management",
                "Spot.io",
                "Flexera",
              ],
            },
            {
              sub_category: "Containerisation & Orchestration",
              options: [
                "Kubernetes",
                "Docker",
                "Red Hat OpenShift",
                "Rancher",
                "VMware Tanzu",
              ],
            },
            {
              sub_category: "Serverless & PaaS",
              options: [
                "AWS Lambda",
                "Azure Functions",
                "Google Cloud Functions",
                "Heroku",
                "Salesforce Platform",
              ],
            },
          ],
        },
        {
          category: "Integration & Middleware",
          sub_categories: [
            {
              sub_category: "Integration Platforms",
              options: [
                "MuleSoft Anypoint",
                "Boomi AtomSphere",
                "Microsoft Azure Integration Services",
                "IBM App Connect",
                "Software AG webMethods",
                "TIBCO BusinessWorks",
                "Axway Amplify",
                "SnapLogic",
              ],
            },
            {
              sub_category: "API Management",
              options: [
                "MuleSoft API Manager",
                "Apigee",
                "AWS API Gateway",
                "Azure API Management",
                "Kong",
                "WSO2",
              ],
            },
            {
              sub_category: "Messaging & Event Streaming",
              options: [
                "Apache Kafka",
                "IBM MQ",
                "RabbitMQ",
                "AWS SQS",
                "Azure Service Bus",
                "Solace",
              ],
            },
            {
              sub_category: "Workflow & Process Automation",
              options: [
                "Workato",
                "Microsoft Power Automate",
                "Zapier Enterprise",
                "Nintex",
                "K2",
              ],
            },
          ],
        },
        {
          category: "Cybersecurity",
          sub_categories: [
            {
              sub_category: "Security Information & Event Management (SIEM)",
              options: [
                "Microsoft Sentinel",
                "Splunk Enterprise Security",
                "IBM QRadar",
                "LogRhythm",
                "Exabeam",
                "Elastic Security",
              ],
            },
            {
              sub_category: "Endpoint & Network Security",
              options: [
                "CrowdStrike Falcon",
                "Palo Alto Networks",
                "Fortinet",
                "Check Point",
                "Darktrace",
                "Carbon Black",
                "SentinelOne",
                "Symantec",
              ],
            },
            {
              sub_category: "Data Loss Prevention & Protection",
              options: [
                "Varonis",
                "Digital Guardian",
                "Microsoft Purview Information Protection",
                "Forcepoint DLP",
                "Symantec DLP",
              ],
            },
            {
              sub_category: "Vulnerability Management",
              options: [
                "Tenable",
                "Qualys",
                "Rapid7 InsightVM",
                "Veracode",
                "Checkmarx",
                "Snyk",
              ],
            },
            {
              sub_category: "Zero Trust & Network Access",
              options: [
                "Zscaler",
                "Akamai",
                "Cloudflare",
                "Cisco Duo",
                "Illumio",
                "Netskope",
              ],
            },
            {
              sub_category: "Security Orchestration & Response (SOAR)",
              options: [
                "Palo Alto XSOAR",
                "Splunk SOAR",
                "IBM Resilient",
                "ServiceNow Security Operations",
                "Swimlane",
              ],
            },
          ],
        },
        {
          category: "Identity & Access Management",
          sub_categories: [
            {
              sub_category: "Identity Governance & Administration",
              options: [
                "SailPoint IdentityNow",
                "Saviynt",
                "One Identity",
                "IBM Security Identity Manager",
                "Omada",
              ],
            },
            {
              sub_category: "Access Management & SSO",
              options: [
                "Okta",
                "Microsoft Entra ID",
                "Ping Identity",
                "ForgeRock",
                "Auth0",
                "CyberArk Identity",
              ],
            },
            {
              sub_category: "Privileged Access Management",
              options: [
                "CyberArk PAM",
                "BeyondTrust",
                "Thycotic",
                "Delinea",
                "HashiCorp Vault",
              ],
            },
            {
              sub_category: "Customer Identity & Access Management",
              options: [
                "Okta Customer Identity",
                "ForgeRock CIAM",
                "Ping Identity CIAM",
                "Auth0",
                "Gigya (SAP Customer Data Cloud)",
              ],
            },
          ],
        },
        {
          category: "IT Service Management",
          sub_categories: [
            {
              sub_category: "ITSM Platforms",
              options: [
                "ServiceNow ITSM",
                "Jira Service Management",
                "BMC Helix",
                "Ivanti Service Manager",
                "Freshservice",
                "Micro Focus SMAX",
              ],
            },
            {
              sub_category: "IT Operations Management",
              options: [
                "ServiceNow ITOM",
                "BMC TrueSight",
                "Dynatrace",
                "Datadog",
                "New Relic",
                "AppDynamics",
                "Moogsoft",
              ],
            },
            {
              sub_category: "Configuration Management",
              options: [
                "ServiceNow CMDB",
                "BMC Atrium CMDB",
                "Device42",
                "Freshservice CMDB",
              ],
            },
          ],
        },
        {
          category: "DevOps & Application Development",
          sub_categories: [
            {
              sub_category: "Source Control & Collaboration",
              options: ["GitHub", "GitLab", "Azure DevOps", "Bitbucket"],
            },
            {
              sub_category: "CI/CD & Pipeline",
              options: [
                "Jenkins",
                "CircleCI",
                "Azure DevOps Pipelines",
                "GitHub Actions",
                "GitLab CI/CD",
                "ArgoCD",
                "Harness",
              ],
            },
            {
              sub_category: "Infrastructure as Code",
              options: [
                "HashiCorp Terraform",
                "Ansible",
                "Chef",
                "Puppet",
                "AWS CloudFormation",
                "Pulumi",
              ],
            },
            {
              sub_category: "Code Quality & Security",
              options: [
                "SonarQube",
                "Veracode",
                "Checkmarx",
                "Snyk",
                "Black Duck",
              ],
            },
            {
              sub_category: "Low Code & No Code Development",
              options: [
                "Microsoft Power Apps",
                "Salesforce Lightning",
                "OutSystems",
                "Mendix",
                "Appian",
                "ServiceNow App Engine",
              ],
            },
          ],
        },
        {
          category: "Infrastructure & Networking",
          sub_categories: [
            {
              sub_category: "Networking",
              options: [
                "Cisco",
                "Juniper Networks",
                "Aruba Networks",
                "F5",
                "Palo Alto Networks",
              ],
            },
            {
              sub_category: "Virtualisation & Compute",
              options: [
                "VMware vSphere",
                "Nutanix",
                "Microsoft Hyper-V",
                "Citrix",
                "HPE",
                "Dell Technologies",
              ],
            },
            {
              sub_category: "Storage",
              options: [
                "NetApp",
                "Dell EMC",
                "IBM Storage",
                "Pure Storage",
                "HPE Storage",
              ],
            },
            {
              sub_category: "Monitoring & Observability",
              options: [
                "Datadog",
                "Dynatrace",
                "New Relic",
                "AppDynamics",
                "Nagios",
                "Zabbix",
                "Grafana",
              ],
            },
          ],
        },
        {
          category: "HR Technology",
          sub_categories: [
            {
              sub_category: "Core HR & Payroll",
              options: [
                "Workday HCM",
                "SAP SuccessFactors",
                "Oracle HCM Cloud",
                "ADP Workforce Now",
                "Ceridian Dayforce",
                "Bamboo HR",
              ],
            },
            {
              sub_category: "Talent Acquisition",
              options: [
                "Workday Recruiting",
                "SAP SuccessFactors Recruiting",
                "Oracle Taleo",
                "Greenhouse",
                "Lever",
                "iCIMS",
              ],
            },
            {
              sub_category: "Learning & Development",
              options: [
                "Cornerstone OnDemand",
                "SAP SuccessFactors Learning",
                "Workday Learning",
                "Degreed",
                "LinkedIn Learning",
                "Docebo",
              ],
            },
            {
              sub_category: "Workforce Management",
              options: [
                "Kronos (UKG)",
                "Workday Workforce Management",
                "SAP Time & Attendance",
                "Reflexis",
                "Deputy",
              ],
            },
          ],
        },
        {
          category: "Supply Chain & Procurement",
          sub_categories: [
            {
              sub_category: "Procurement & Sourcing",
              options: [
                "SAP Ariba",
                "Coupa",
                "Jaggaer",
                "Ivalua",
                "GEP SMART",
                "Basware",
                "Zycus",
              ],
            },
            {
              sub_category: "Supply Chain Planning",
              options: [
                "Blue Yonder",
                "Kinaxis RapidResponse",
                "o9 Solutions",
                "Oracle SCM Cloud",
                "SAP IBP",
                "Infor Nexus",
              ],
            },
            {
              sub_category: "Warehouse & Inventory Management",
              options: [
                "Manhattan Associates WMS",
                "SAP Extended Warehouse Management",
                "Oracle WMS Cloud",
                "Blue Yonder WMS",
                "Infor WMS",
              ],
            },
            {
              sub_category: "Transport & Logistics Management",
              options: [
                "Manhattan Associates TMS",
                "Oracle TMS",
                "Blue Yonder TMS",
                "SAP TM",
                "MercuryGate",
              ],
            },
          ],
        },
        {
          category: "Asset & Field Service Management",
          sub_categories: [
            {
              sub_category: "Enterprise Asset Management",
              options: [
                "IBM Maximo",
                "SAP PM / EAM",
                "Infor EAM",
                "IFS Ultimo",
                "Hexagon EAM",
                "Fiix",
                "UpKeep",
              ],
            },
            {
              sub_category: "Field Service Management",
              options: [
                "Salesforce Field Service",
                "ServiceNow FSM",
                "Microsoft Dynamics 365 Field Service",
                "IFS Field Service Management",
                "ClickSoftware",
                "ServiceMax",
              ],
            },
            {
              sub_category: "GIS & Spatial Analytics",
              options: [
                "ESRI ArcGIS",
                "Google Maps Platform",
                "Hexagon Geospatial",
                "Trimble",
              ],
            },
          ],
        },
        {
          category: "Industry-Specific Technologies",
          sub_categories: [
            {
              sub_category: "Insurance",
              options: [
                "Guidewire PolicyCenter",
                "Guidewire ClaimCenter",
                "Guidewire BillingCenter",
                "Duck Creek Policy",
                "Duck Creek Claims",
                "Majesco",
                "OneShield",
              ],
            },
            {
              sub_category: "Banking & Capital Markets",
              options: [
                "Temenos T24",
                "Finastra Fusion",
                "Murex",
                "Calypso",
                "Finacle",
                "TCS BaNCS",
                "Mambu",
              ],
            },
            {
              sub_category: "Healthcare",
              options: [
                "Epic Systems",
                "Cerner",
                "Meditech",
                "Allscripts",
                "athenahealth",
                "InterSystems HealthShare",
              ],
            },
            {
              sub_category: "Life Sciences",
              options: [
                "Veeva Vault",
                "Veeva CRM",
                "IQVIA",
                "Oracle Life Sciences",
                "Medidata",
              ],
            },
            {
              sub_category: "Utilities & Energy",
              options: [
                "Smart Energy Water",
                "Oracle Utilities",
                "SAP IS-Utilities",
                "OSIsoft PI",
                "Aveva",
                "Itron",
              ],
            },
            {
              sub_category: "Industrial & Manufacturing",
              options: [
                "PTC ThingWorx",
                "Siemens MindSphere",
                "GE Digital Predix",
                "Rockwell Automation",
                "Bentley Systems",
                "Aveva MES",
              ],
            },
            {
              sub_category: "Real Estate & Facilities",
              options: [
                "Yardi",
                "MRI Software",
                "CoStar",
                "Planon",
                "IBM TRIRIGA",
              ],
            },
            {
              sub_category: "Public Sector",
              options: [
                "Salesforce Government Cloud",
                "Microsoft Azure Government",
                "Tyler Technologies",
                "Oracle Public Sector",
                "Unison",
              ],
            },
          ],
        },
        {
          category: "Collaboration & Productivity",
          sub_categories: [
            {
              sub_category: "Productivity Suites",
              options: ["Microsoft 365", "Google Workspace", "Zoho Workplace"],
            },
            {
              sub_category: "Collaboration & Messaging",
              options: [
                "Microsoft Teams",
                "Slack",
                "Zoom",
                "Webex",
                "Google Meet",
              ],
            },
            {
              sub_category: "Content & Document Management",
              options: [
                "Microsoft SharePoint",
                "Box",
                "Dropbox Business",
                "OpenText",
                "Laserfiche",
                "M-Files",
              ],
            },
            {
              sub_category: "Project & Portfolio Management",
              options: [
                "Microsoft Project",
                "Smartsheet",
                "Monday.com",
                "Planview",
                "Clarity PPM",
                "Workfront",
                "Asana",
                "Wrike",
              ],
            },
          ],
        },
        {
          category: "Contract & Legal Technology",
          sub_categories: [
            {
              sub_category: "Contract Lifecycle Management",
              options: [
                "Icertis",
                "Ironclad",
                "Agiloft",
                "DocuSign CLM",
                "ContractPodAi",
                "Conga CLM",
              ],
            },
            {
              sub_category: "Legal Operations & Matter Management",
              options: [
                "Wolters Kluwer ELM",
                "TeamConnect",
                "SimpleLegal",
                "Mitratech",
                "Legal Tracker",
              ],
            },
            {
              sub_category: "eDiscovery & Investigations",
              options: ["Relativity", "Nuix", "Everlaw", "Logikcull", "Disco"],
            },
            {
              sub_category: "Digital Signatures & Agreements",
              options: ["DocuSign", "Adobe Sign", "HelloSign", "OneSpan"],
            },
          ],
        },
        {
          category: "Robotic Process Automation",
          sub_categories: [
            {
              sub_category: "RPA Platforms",
              options: [
                "UiPath",
                "Automation Anywhere",
                "Blue Prism",
                "Microsoft Power Automate Desktop",
                "NICE RPA",
                "Pegasystems RPA",
              ],
            },
            {
              sub_category: "Intelligent Document Processing",
              options: [
                "ABBYY FlexiCapture",
                "Kofax",
                "UiPath Document Understanding",
                "Automation Anywhere IQ Bot",
                "IBM Datacap",
              ],
            },
          ],
        },
        {
          category: "Testing & Quality Assurance",
          sub_categories: [
            {
              sub_category: "Test Management",
              options: [
                "Micro Focus ALM",
                "TestRail",
                "Zephyr",
                "Xray",
                "qTest",
              ],
            },
            {
              sub_category: "Test Automation",
              options: [
                "Selenium",
                "Tricentis Tosca",
                "Appium",
                "Cypress",
                "Playwright",
                "Sauce Labs",
              ],
            },
            {
              sub_category: "Performance & Load Testing",
              options: [
                "LoadRunner",
                "Apache JMeter",
                "Gatling",
                "BlazeMeter",
                "NeoLoad",
              ],
            },
            {
              sub_category: "API Testing",
              options: ["Postman", "SoapUI", "REST Assured", "Karate"],
            },
          ],
        },
        {
          category: "Process & Design",
          sub_categories: [
            {
              sub_category: "Process Mapping & Modelling",
              options: [
                "Signavio",
                "ARIS",
                "iGrafx",
                "Lucidchart",
                "Microsoft Visio",
                "Miro",
              ],
            },
            {
              sub_category: "Process Mining",
              options: [
                "Celonis",
                "UiPath Process Mining",
                "ABBYY Timeline",
                "IBM Process Mining",
                "SAP Signavio Process Intelligence",
              ],
            },
            {
              sub_category: "UX & Product Design",
              options: [
                "Figma",
                "Adobe XD",
                "InVision",
                "Sketch",
                "Maze",
                "Axure",
              ],
            },
            {
              sub_category: "Enterprise Architecture",
              options: [
                "LeanIX",
                "Ardoq",
                "Alfabet",
                "MEGA HOPEX",
                "Sparx Systems Enterprise Architect",
                "Bizzdesign",
              ],
            },
          ],
        },
      ],
    },
  },
  partners: {
    alliance_partners: {
      field_type: "multi-select",
      partners: [
        {
          partner: "Adobe",
          product_families: [
            {
              product_family: "Experience Cloud",
              products: [
                "Adobe Experience Manager",
                "Adobe Experience Platform",
                "Adobe Analytics",
                "Adobe Target",
                "Adobe Campaign",
                "Adobe Audience Manager",
                "Adobe Customer Journey Analytics",
              ],
            },
            {
              product_family: "Commerce",
              products: ["Adobe Commerce (Magento)", "Adobe Commerce Cloud"],
            },
            {
              product_family: "Creative & Document",
              products: [
                "Adobe Creative Cloud",
                "Adobe Document Cloud",
                "Adobe Acrobat Sign",
                "Adobe Workfront",
              ],
            },
            {
              product_family: "Data & AI",
              products: [
                "Adobe Sensei (AI)",
                "Adobe Real-Time CDP",
                "Adobe Journey Optimizer",
              ],
            },
          ],
        },
        {
          partner: "AWS",
          product_families: [
            {
              product_family: "Compute & Infrastructure",
              products: [
                "Amazon EC2",
                "Amazon ECS",
                "Amazon EKS",
                "AWS Lambda",
                "AWS Outposts",
                "AWS Elastic Beanstalk",
              ],
            },
            {
              product_family: "Storage & Database",
              products: [
                "Amazon S3",
                "Amazon RDS",
                "Amazon DynamoDB",
                "Amazon Redshift",
                "Amazon Aurora",
                "AWS Backup",
              ],
            },
            {
              product_family: "Data & Analytics",
              products: [
                "AWS Glue",
                "Amazon Athena",
                "Amazon EMR",
                "Amazon Kinesis",
                "AWS Lake Formation",
                "Amazon QuickSight",
              ],
            },
            {
              product_family: "AI & Machine Learning",
              products: [
                "Amazon SageMaker",
                "AWS Bedrock",
                "Amazon Rekognition",
                "Amazon Comprehend",
                "Amazon Lex",
                "AWS Trainium",
              ],
            },
            {
              product_family: "Security & Identity",
              products: [
                "AWS IAM",
                "AWS Security Hub",
                "Amazon GuardDuty",
                "AWS Shield",
                "AWS WAF",
                "Amazon Macie",
              ],
            },
            {
              product_family: "Networking & Integration",
              products: [
                "Amazon VPC",
                "AWS Direct Connect",
                "Amazon API Gateway",
                "AWS Transit Gateway",
                "Amazon CloudFront",
                "AWS App Mesh",
              ],
            },
            {
              product_family: "DevOps & Developer Tools",
              products: [
                "AWS CodePipeline",
                "AWS CodeBuild",
                "AWS CodeDeploy",
                "AWS CloudFormation",
                "AWS CDK",
                "Amazon CodeCatalyst",
              ],
            },
          ],
        },
        {
          partner: "Google",
          product_families: [
            {
              product_family: "Cloud Infrastructure",
              products: [
                "Google Compute Engine",
                "Google Kubernetes Engine",
                "Google Cloud Run",
                "Google Cloud Functions",
                "Google Cloud VMware Engine",
              ],
            },
            {
              product_family: "Data & Analytics",
              products: [
                "Google BigQuery",
                "Google Cloud Dataflow",
                "Google Cloud Dataproc",
                "Google Looker",
                "Google Cloud Pub/Sub",
                "Google Cloud Composer",
              ],
            },
            {
              product_family: "AI & Machine Learning",
              products: [
                "Google Vertex AI",
                "Google Gemini",
                "Google Cloud Natural Language API",
                "Google Cloud Vision API",
                "Google Cloud Speech-to-Text",
                "Google Cloud AutoML",
              ],
            },
            {
              product_family: "Security",
              products: [
                "Google Chronicle",
                "Google Security Command Center",
                "Google Cloud Armor",
                "Google BeyondCorp Enterprise",
                "Google Mandiant",
              ],
            },
            {
              product_family: "Workspace & Productivity",
              products: [
                "Google Workspace",
                "Google Meet",
                "Google Drive",
                "Google Sites",
                "Google AppSheet",
              ],
            },
            {
              product_family: "Networking",
              products: [
                "Google Cloud CDN",
                "Google Cloud Load Balancing",
                "Google Cloud Interconnect",
                "Google Cloud DNS",
                "Google Network Intelligence Centre",
              ],
            },
          ],
        },
        {
          partner: "Guidewire",
          product_families: [
            {
              product_family: "Core Insurance",
              products: [
                "Guidewire PolicyCenter",
                "Guidewire ClaimCenter",
                "Guidewire BillingCenter",
              ],
            },
            {
              product_family: "Digital & Engagement",
              products: [
                "Guidewire CustomerEngage",
                "Guidewire ProducerEngage",
                "Guidewire ServiceRepEngage",
                "Guidewire VendorEngage",
              ],
            },
            {
              product_family: "Data & Analytics",
              products: [
                "Guidewire DataHub",
                "Guidewire InfoCenter",
                "Guidewire Explore",
                "Guidewire Predict",
                "Guidewire Compare",
              ],
            },
            {
              product_family: "Cloud Platform",
              products: [
                "Guidewire Cloud Platform",
                "Guidewire Marketplace",
                "Guidewire Integration Framework",
                "Guidewire Cloud APIs",
              ],
            },
          ],
        },
        {
          partner: "Microsoft",
          product_families: [
            {
              product_family: "Azure Cloud",
              products: [
                "Azure Virtual Machines",
                "Azure Kubernetes Service",
                "Azure App Service",
                "Azure Functions",
                "Azure Virtual Desktop",
                "Azure Arc",
              ],
            },
            {
              product_family: "Data & Analytics",
              products: [
                "Azure Synapse Analytics",
                "Azure Data Factory",
                "Azure Databricks",
                "Microsoft Fabric",
                "Azure Stream Analytics",
                "Microsoft Power BI",
              ],
            },
            {
              product_family: "AI & Machine Learning",
              products: [
                "Azure OpenAI Service",
                "Azure Machine Learning",
                "Azure Cognitive Services",
                "Microsoft Copilot",
                "Azure Bot Service",
                "Azure Applied AI Services",
              ],
            },
            {
              product_family: "Business Applications",
              products: [
                "Microsoft Dynamics 365 Finance",
                "Microsoft Dynamics 365 Supply Chain",
                "Microsoft Dynamics 365 Sales",
                "Microsoft Dynamics 365 Customer Service",
                "Microsoft Dynamics 365 Field Service",
                "Microsoft Dynamics 365 Human Resources",
              ],
            },
            {
              product_family: "Productivity & Collaboration",
              products: [
                "Microsoft 365",
                "Microsoft Teams",
                "Microsoft SharePoint",
                "Microsoft Viva",
                "Microsoft Power Platform",
                "Microsoft Power Apps",
                "Microsoft Power Automate",
              ],
            },
            {
              product_family: "Security & Identity",
              products: [
                "Microsoft Sentinel",
                "Microsoft Defender",
                "Microsoft Entra ID",
                "Microsoft Purview",
                "Microsoft Intune",
                "Microsoft Priva",
              ],
            },
            {
              product_family: "DevOps & Development",
              products: [
                "Azure DevOps",
                "GitHub",
                "Azure API Management",
                "Azure Integration Services",
                "Visual Studio",
                "Microsoft Dev Box",
              ],
            },
          ],
        },
        {
          partner: "Oracle",
          product_families: [
            {
              product_family: "Cloud Infrastructure",
              products: [
                "Oracle Cloud Infrastructure (OCI)",
                "Oracle Autonomous Database",
                "Oracle Cloud VMware Solution",
                "Oracle Kubernetes Engine",
                "Oracle Cloud Functions",
              ],
            },
            {
              product_family: "ERP & Finance",
              products: [
                "Oracle Fusion Cloud ERP",
                "Oracle Fusion Cloud EPM",
                "Oracle Fusion Cloud SCM",
                "Oracle EBS",
                "Oracle Fusion Cloud Procurement",
                "Oracle Fusion Cloud Project Management",
              ],
            },
            {
              product_family: "HCM",
              products: [
                "Oracle Fusion Cloud HCM",
                "Oracle Taleo",
                "Oracle Fusion Cloud Workforce Management",
                "Oracle Fusion Cloud Payroll",
                "Oracle Learning Management",
              ],
            },
            {
              product_family: "CX & Sales",
              products: [
                "Oracle Fusion Cloud CX",
                "Oracle Sales",
                "Oracle Service",
                "Oracle Marketing",
                "Oracle Commerce",
                "Oracle CPQ",
              ],
            },
            {
              product_family: "Data & Analytics",
              products: [
                "Oracle Analytics Cloud",
                "Oracle Data Integrator",
                "Oracle GoldenGate",
                "Oracle Big Data Service",
                "Oracle Essbase",
              ],
            },
            {
              product_family: "Industry Solutions",
              products: [
                "Oracle Utilities",
                "Oracle Health (Cerner)",
                "Oracle Financial Services",
                "Oracle Hospitality",
                "Oracle Construction and Engineering",
              ],
            },
          ],
        },
        {
          partner: "Salesforce",
          product_families: [
            {
              product_family: "Sales & Service",
              products: [
                "Sales Cloud",
                "Service Cloud",
                "Field Service",
                "Revenue Cloud",
                "Salesforce CPQ",
              ],
            },
            {
              product_family: "Marketing & Commerce",
              products: [
                "Marketing Cloud",
                "Marketing Cloud Account Engagement (Pardot)",
                "Commerce Cloud",
                "Loyalty Management",
                "Referral Marketing",
              ],
            },
            {
              product_family: "Data & AI",
              products: [
                "Salesforce Data Cloud",
                "Einstein AI",
                "Einstein Analytics",
                "Tableau",
                "MuleSoft",
              ],
            },
            {
              product_family: "Platform & Development",
              products: [
                "Salesforce Platform",
                "Heroku",
                "Salesforce Flow",
                "Apex & Visualforce",
                "Lightning Web Components",
              ],
            },
            {
              product_family: "Industry Clouds",
              products: [
                "Financial Services Cloud",
                "Health Cloud",
                "Manufacturing Cloud",
                "Consumer Goods Cloud",
                "Energy & Utilities Cloud",
                "Government Cloud",
                "Nonprofit Cloud",
                "Education Cloud",
              ],
            },
            {
              product_family: "Collaboration & Productivity",
              products: ["Slack", "Salesforce Anywhere", "Quip"],
            },
          ],
        },
        {
          partner: "SAP",
          product_families: [
            {
              product_family: "ERP & Finance",
              products: [
                "SAP S/4HANA Cloud",
                "SAP S/4HANA On-premise",
                "SAP ECC",
                "SAP Central Finance",
                "SAP Group Reporting",
                "SAP Cash Management",
              ],
            },
            {
              product_family: "Supply Chain",
              products: [
                "SAP Integrated Business Planning (IBP)",
                "SAP Extended Warehouse Management",
                "SAP Transportation Management",
                "SAP Manufacturing Execution",
                "SAP Asset Management",
                "SAP Ariba",
              ],
            },
            {
              product_family: "Human Experience Management",
              products: [
                "SAP SuccessFactors Employee Central",
                "SAP SuccessFactors Recruiting",
                "SAP SuccessFactors Learning",
                "SAP SuccessFactors Performance & Goals",
                "SAP SuccessFactors Compensation",
                "SAP SuccessFactors Workforce Analytics",
              ],
            },
            {
              product_family: "Customer Experience",
              products: [
                "SAP Sales Cloud",
                "SAP Service Cloud",
                "SAP Commerce Cloud",
                "SAP Marketing Cloud",
                "SAP Customer Data Platform",
              ],
            },
            {
              product_family: "Data & Analytics",
              products: [
                "SAP Analytics Cloud",
                "SAP BW/4HANA",
                "SAP Datasphere",
                "SAP HANA Cloud",
                "SAP Business Objects",
              ],
            },
            {
              product_family: "Platform & Integration",
              products: [
                "SAP Business Technology Platform (BTP)",
                "SAP Integration Suite",
                "SAP Extension Suite",
                "SAP Build",
                "SAP Signavio",
              ],
            },
            {
              product_family: "Industry Solutions",
              products: [
                "SAP for Banking",
                "SAP for Insurance",
                "SAP for Utilities",
                "SAP for Healthcare",
                "SAP for Public Sector",
                "SAP for Retail",
                "SAP for Oil & Gas",
              ],
            },
          ],
        },
        {
          partner: "Workday",
          product_families: [
            {
              product_family: "Human Capital Management",
              products: [
                "Workday Human Resource Management",
                "Workday Payroll",
                "Workday Time Tracking",
                "Workday Absence Management",
                "Workday Benefits Administration",
                "Workday Compensation",
              ],
            },
            {
              product_family: "Talent Management",
              products: [
                "Workday Recruiting",
                "Workday Learning",
                "Workday Performance Management",
                "Workday Succession Planning",
                "Workday Career & Development",
                "Workday Skills Cloud",
              ],
            },
            {
              product_family: "Finance",
              products: [
                "Workday Financial Management",
                "Workday Accounting Centre",
                "Workday Revenue Management",
                "Workday Expenses",
                "Workday Procurement",
                "Workday Projects",
              ],
            },
            {
              product_family: "Planning & Analytics",
              products: [
                "Workday Adaptive Planning",
                "Workday People Analytics",
                "Workday Prism Analytics",
                "Workday Financial Planning",
                "Workday Workforce Planning",
              ],
            },
            {
              product_family: "Platform & Integration",
              products: [
                "Workday Platform",
                "Workday Extend",
                "Workday Integration Cloud",
                "Workday Studio",
                "Workday AI and ML",
              ],
            },
          ],
        },
      ],
    },
  },
  regulatory: {
    regulatory_profile: {
      field_type: "multi-select",
      description:
        "The regulatory bodies and frameworks applicable to this client and engagement",
      industry_groups: [
        {
          industry_group: "All Industries",
          regulators: [
            {
              regulator: "ATO",
              requirements: [
                "Income Tax Compliance",
                "GST Compliance",
                "Fringe Benefits Tax Compliance",
                "Transfer Pricing Requirements",
                "Thin Capitalisation Rules",
                "R&D Tax Incentive Compliance",
                "Diverted Profits Tax",
                "Reportable Tax Position Schedule",
                "Top 100 Tax Performance Programme",
                "Top 1000 Tax Performance Programme",
                "Payroll Tax Compliance",
                "Superannuation Guarantee Compliance",
              ],
            },
            {
              regulator: "OAIC",
              requirements: [
                "Privacy Act 1988",
                "Australian Privacy Principles (APPs)",
                "Notifiable Data Breaches Scheme",
                "Freedom of Information Act",
                "Cross-border Data Transfer Requirements",
                "Children's Online Privacy",
              ],
            },
            {
              regulator: "ACCC",
              requirements: [
                "Competition and Consumer Act 2010",
                "Australian Consumer Law",
                "Merger Review Requirements",
                "Unfair Contract Terms",
                "Product Safety Standards",
                "Misleading and Deceptive Conduct",
              ],
            },
            {
              regulator: "Safe Work Australia",
              requirements: [
                "Work Health and Safety Act 2011",
                "WHS Regulations",
                "Codes of Practice",
                "Incident Notification Requirements",
                "Hazardous Chemicals Requirements",
                "Psychosocial Hazards Requirements",
              ],
            },
            {
              regulator: "Fair Work Commission",
              requirements: [
                "Fair Work Act 2009",
                "Modern Awards Compliance",
                "Enterprise Agreement Requirements",
                "Unfair Dismissal Requirements",
                "General Protections",
                "Right of Entry Requirements",
              ],
            },
            {
              regulator: "WGEA",
              requirements: [
                "Workplace Gender Equality Act Compliance",
                "Gender Pay Gap Reporting",
                "Employer of Choice Citation",
                "Action Plan Requirements",
              ],
            },
            {
              regulator: "Department of Home Affairs",
              requirements: [
                "Modern Slavery Act 2018",
                "Foreign Investment Review Board (FIRB)",
                "Export Controls",
                "Customs Act 1901",
              ],
            },
            {
              regulator: "ASX",
              requirements: [
                "ASX Listing Rules",
                "Continuous Disclosure Obligations",
                "Corporate Governance Principles and Recommendations",
                "Related Party Transaction Requirements",
                "Capital Raising Requirements",
                "Financial Reporting Requirements",
                "Shareholder Approval Requirements",
              ],
            },
            {
              regulator: "ASIC Sustainability Reporting",
              requirements: [
                "Australian Sustainability Reporting Standards (ASRS)",
                "Climate-related Financial Disclosure Requirements",
                "TCFD Alignment",
                "Greenwashing Compliance",
                "ESG Ratings Disclosure",
              ],
            },
            {
              regulator: "Clean Energy Regulator",
              requirements: [
                "National Greenhouse and Energy Reporting (NGER)",
                "Safeguard Mechanism",
                "Australian Carbon Credit Units (ACCUs)",
                "Renewable Energy Target",
                "Carbon Credits Carbon Farming Initiative",
              ],
            },
            {
              regulator: "International Frameworks",
              requirements: [
                "ISO 27001 Information Security",
                "ISO 31000 Risk Management",
                "NIST Cybersecurity Framework",
                "SOC 2 Type II",
                "PCI DSS",
                "GRI Sustainability Standards",
                "SASB Standards",
                "UN Sustainable Development Goals",
                "IFRS Accounting Standards",
                "FATF Recommendations",
              ],
            },
          ],
        },
        {
          industry_group: "Financial Services",
          regulators: [
            {
              regulator: "APRA",
              requirements: [
                "CPS 220 Risk Management",
                "CPS 230 Operational Risk Management",
                "CPS 234 Information Security",
                "CPS 510 Governance",
                "CPS 520 Fit and Proper",
                "APS 110 Capital Adequacy",
                "APS 330 Public Disclosure",
                "LPS 220 Risk Management",
                "SPS 220 Risk Management",
                "SPS 515 Strategic Planning and Member Outcomes",
                "SPS 530 Investment Governance",
                "HPS 310 Audit and Related Matters",
              ],
            },
            {
              regulator: "ASIC",
              requirements: [
                "Financial Services Licensing",
                "Market Integrity Rules",
                "Reportable Situations Regime",
                "Design and Distribution Obligations (DDO)",
                "Product Intervention Powers",
                "Financial Adviser Standards",
                "Responsible Lending Obligations",
                "Internal Dispute Resolution Requirements",
                "Breach Reporting Requirements",
                "Hawking Prohibition",
                "Anti-Hawking Provisions",
              ],
            },
            {
              regulator: "AUSTRAC",
              requirements: [
                "AML/CTF Programme Requirements",
                "Know Your Customer (KYC) Requirements",
                "Transaction Monitoring Requirements",
                "Suspicious Matter Reporting",
                "Threshold Transaction Reporting",
                "International Funds Transfer Reporting",
                "Correspondent Banking Requirements",
                "Digital Currency Exchange Registration",
                "AML/CTF Risk Assessment Requirements",
              ],
            },
            {
              regulator: "Reserve Bank of Australia",
              requirements: [
                "Payments System Regulation",
                "Card Scheme Rules",
                "Retail Payment Activity Reporting",
                "Foreign Exchange Settlement Risk",
                "Financial Stability Standards",
              ],
            },
            {
              regulator: "OAIC - Financial Services",
              requirements: [
                "Consumer Data Right (CDR) - Banking",
                "Open Banking Data Sharing Requirements",
                "Credit Reporting Privacy Code",
                "Financial Services Privacy Requirements",
              ],
            },
            {
              regulator: "Financial Accountability Regime",
              requirements: [
                "Accountable Person Requirements",
                "Accountability Obligations",
                "Key Personnel Requirements",
                "Deferred Remuneration Requirements",
                "Notification and Registration Requirements",
              ],
            },
          ],
        },
        {
          industry_group: "Health & Life Sciences",
          regulators: [
            {
              regulator: "TGA",
              requirements: [
                "Therapeutic Goods Act Compliance",
                "Medical Device Registration",
                "Clinical Trial Requirements",
                "Advertising Requirements",
                "Manufacturing Licence Requirements",
                "Pharmacovigilance Requirements",
                "Prescription Medicine Approval",
                "Over-the-Counter Medicine Requirements",
                "Biologicals Regulation",
                "In Vitro Diagnostic Requirements",
              ],
            },
            {
              regulator: "AHPRA",
              requirements: [
                "Health Practitioner Registration Requirements",
                "Mandatory Notification Requirements",
                "Advertising Guidelines",
                "Continuing Professional Development Requirements",
                "Criminal History Requirements",
                "Student Registration Requirements",
              ],
            },
            {
              regulator: "Aged Care Quality and Safety Commission",
              requirements: [
                "Aged Care Quality Standards",
                "Star Ratings Requirements",
                "Serious Incident Response Scheme",
                "Financial Reporting Requirements",
                "Governance Requirements",
                "Worker Screening Requirements",
              ],
            },
            {
              regulator: "NDIS Quality and Safeguards Commission",
              requirements: [
                "NDIS Practice Standards",
                "Worker Screening Requirements",
                "Incident Management Requirements",
                "Behaviour Support Requirements",
                "Registration Requirements",
                "Audit Requirements",
              ],
            },
            {
              regulator: "Department of Health and Aged Care",
              requirements: [
                "Medicare Compliance",
                "Private Health Insurance Act Compliance",
                "Hospital Licensing Requirements",
                "Pharmaceutical Benefits Scheme Compliance",
                "My Health Record Requirements",
                "National Health Reform Agreement",
              ],
            },
            {
              regulator: "OAIC - Health",
              requirements: [
                "My Health Records Act 2012",
                "Health Records Privacy Requirements",
                "Healthcare Identifiers Act Compliance",
                "Clinical Data Sharing Requirements",
              ],
            },
          ],
        },
        {
          industry_group: "Energy & Utilities",
          regulators: [
            {
              regulator: "AER",
              requirements: [
                "National Electricity Rules",
                "National Gas Rules",
                "Network Pricing Requirements",
                "Reliability Standards",
                "Ring Fencing Guidelines",
                "Regulatory Investment Test Requirements",
                "Retailer Authorisation Requirements",
                "Energy Retail Law Compliance",
                "Metering Provider Requirements",
                "Default Market Offer Requirements",
              ],
            },
            {
              regulator: "AEMO",
              requirements: [
                "National Electricity Market Requirements",
                "Gas Market Requirements",
                "System Security Requirements",
                "Market Participant Obligations",
                "Metering Requirements",
                "Wholesale Demand Response Requirements",
                "Power of Choice Requirements",
                "Five Minute Settlement Requirements",
                "Integrated System Plan Compliance",
              ],
            },
            {
              regulator: "AEMC",
              requirements: [
                "Rule Change Process Requirements",
                "Review and Assessment Obligations",
                "Market Development Requirements",
                "Consumer Protections",
                "Network Regulation Requirements",
              ],
            },
            {
              regulator: "Clean Energy Regulator - Energy",
              requirements: [
                "Large-scale Renewable Energy Target",
                "Small-scale Renewable Energy Scheme",
                "National Greenhouse and Energy Reporting",
                "Safeguard Mechanism",
                "Australian Carbon Credit Units",
              ],
            },
            {
              regulator: "Department of Home Affairs - Critical Infrastructure",
              requirements: [
                "Security of Critical Infrastructure Act 2018",
                "Critical Infrastructure Risk Management Programme",
                "System of National Significance Requirements",
                "Positive Security Obligations",
                "Government Assistance Measures",
              ],
            },
            {
              regulator: "OAIC - Energy",
              requirements: [
                "Consumer Data Right (CDR) - Energy",
                "Energy Data Sharing Requirements",
                "Smart Meter Data Privacy Requirements",
              ],
            },
          ],
        },
        {
          industry_group: "Government & Public Sector",
          regulators: [
            {
              regulator: "Department of Finance",
              requirements: [
                "Public Governance Performance and Accountability Act (PGPA)",
                "Commonwealth Procurement Rules",
                "Commonwealth Grants Rules and Guidelines",
                "Resource Management Framework",
                "Annual Performance Statements Requirements",
                "Corporate Plan Requirements",
              ],
            },
            {
              regulator: "ANAO",
              requirements: [
                "Performance Audit Requirements",
                "Financial Statement Audit Requirements",
                "Assurance Review Requirements",
                "Better Practice Guide Compliance",
                "Parliamentary Committee Requirements",
              ],
            },
            {
              regulator: "ASD / ACSC",
              requirements: [
                "Australian Government Information Security Manual (ISM)",
                "Protective Security Policy Framework (PSPF)",
                "Essential Eight Maturity Model",
                "Cyber Threat Intelligence Requirements",
                "Incident Reporting Requirements",
                "Security Assessment and Authorisation",
              ],
            },
            {
              regulator: "Digital Transformation Agency",
              requirements: [
                "Digital Service Standard",
                "Whole of Government ICT Policies",
                "Data Sharing and Release Act Compliance",
                "Hosting Certification Framework",
                "Cloud Policy Compliance",
                "Australian Government Architecture Requirements",
              ],
            },
            {
              regulator: "OAIC - Government",
              requirements: [
                "Freedom of Information Act 1982",
                "Archives Act 1983",
                "Government Privacy Requirements",
                "Data Matching Programme Requirements",
                "Tax File Number Guidelines",
              ],
            },
            {
              regulator: "Australian Public Service Commission",
              requirements: [
                "Public Service Act 1999",
                "APS Values and Code of Conduct",
                "Workforce Planning Requirements",
                "Senior Executive Service Requirements",
                "Capability Framework Requirements",
              ],
            },
          ],
        },
        {
          industry_group: "Technology, Media & Telecommunications",
          regulators: [
            {
              regulator: "ACMA",
              requirements: [
                "Telecommunications Act 1997",
                "Broadcasting Services Act 1992",
                "Spam Act 2003",
                "Do Not Call Register Act 2006",
                "Radiocommunications Act 1992",
                "Online Safety Act 2021",
                "Network Reliability Framework",
                "Telecommunications Consumer Protections Code",
              ],
            },
            {
              regulator: "ACCC - Digital",
              requirements: [
                "Digital Platform Services Inquiry",
                "News Media Bargaining Code",
                "Digital Advertising Services Inquiry",
                "App Marketplace Inquiry",
                "Search Engine Requirements",
                "Social Media Platform Requirements",
              ],
            },
            {
              regulator: "eSafety Commissioner",
              requirements: [
                "Online Safety Act 2021",
                "Basic Online Safety Expectations",
                "Cyber Abuse Requirements",
                "Image-based Abuse Requirements",
                "Online Content Scheme",
                "Safety by Design Requirements",
              ],
            },
            {
              regulator: "ASD / ACSC - Technology",
              requirements: [
                "Critical Infrastructure Protection",
                "Telecommunications Security Requirements",
                "Vendor Security Assessment Requirements",
                "Software Security Requirements",
                "Cloud Security Requirements",
              ],
            },
            {
              regulator: "OAIC - Technology",
              requirements: [
                "Privacy Act Digital Platform Requirements",
                "Data Broker Requirements",
                "Direct Marketing Requirements",
                "Automated Decision Making Requirements",
                "AI Governance Requirements",
              ],
            },
          ],
        },
        {
          industry_group: "Consumer & Retail",
          regulators: [
            {
              regulator: "ACCC - Consumer",
              requirements: [
                "Australian Consumer Law",
                "Product Safety Standards",
                "Country of Origin Labelling",
                "Unit Pricing Code",
                "Franchising Code of Conduct",
                "Horticulture Code of Conduct",
                "Grocery Code of Conduct",
                "Fuel and Energy Code",
              ],
            },
            {
              regulator: "Food Standards Australia New Zealand",
              requirements: [
                "Australia New Zealand Food Standards Code",
                "Food Labelling Requirements",
                "Food Safety Standards",
                "Novel Food Requirements",
                "Nutrition and Health Claims",
              ],
            },
            {
              regulator: "Department of Agriculture",
              requirements: [
                "Biosecurity Act 2015",
                "Agricultural and Veterinary Chemicals",
                "Export Requirements",
                "Import Requirements",
                "Organic Certification Requirements",
                "Country of Origin Requirements",
              ],
            },
            {
              regulator: "ABCB",
              requirements: [
                "National Construction Code",
                "Building Product Safety Requirements",
                "Energy Efficiency Requirements",
                "Accessibility Requirements",
                "Fire Safety Requirements",
              ],
            },
          ],
        },
        {
          industry_group: "Industrial & Manufacturing",
          regulators: [
            {
              regulator: "Safe Work Australia - Industrial",
              requirements: [
                "Major Hazard Facilities Regulations",
                "Dangerous Goods Requirements",
                "Plant and Equipment Requirements",
                "Noise and Vibration Requirements",
                "Asbestos Management Requirements",
                "Mine Safety Requirements",
              ],
            },
            {
              regulator: "Department of Environment",
              requirements: [
                "Environment Protection and Biodiversity Conservation Act",
                "National Environment Protection Measures",
                "Product Stewardship Act",
                "Hazardous Waste Act",
                "Ozone Protection Requirements",
                "Illegal Logging Prohibition Act",
              ],
            },
            {
              regulator: "NHVR",
              requirements: [
                "Heavy Vehicle National Law",
                "Mass and Dimension Requirements",
                "Fatigue Management Requirements",
                "Vehicle Standards Requirements",
                "Accreditation Scheme Requirements",
                "Chain of Responsibility Requirements",
              ],
            },
            {
              regulator: "CASA",
              requirements: [
                "Civil Aviation Safety Regulations",
                "Aircraft Maintenance Requirements",
                "Pilot Licensing Requirements",
                "Air Operator Certificate Requirements",
                "Drone and RPAS Requirements",
                "Dangerous Goods Air Transport Requirements",
              ],
            },
            {
              regulator: "AMSA",
              requirements: [
                "Marine Safety National Law",
                "Vessel Registration Requirements",
                "Seafarer Certification Requirements",
                "Marine Pollution Requirements",
                "Maritime Security Requirements",
                "Port State Control Requirements",
              ],
            },
          ],
        },
      ],
    },
  },
  risk: {
    risk_profile: {
      field_type: "multi-select",
      description:
        "The risk categories and specific risks most relevant to this client and engagement",
      risk_rating_options: ["High", "Medium", "Low"],
      risk_maturity_options: [
        "Initial",
        "Developing",
        "Defined",
        "Managed",
        "Optimising",
      ],
      industry_groups: [
        {
          industry_group: "All Industries",
          risk_types: [
            {
              risk_type: "Strategic Risk",
              specific_risks: [
                "Business model disruption",
                "Failure to execute strategy",
                "Mergers and acquisitions risk",
                "Reputational risk",
                "Geopolitical risk",
                "Market and competitive risk",
                "Stakeholder and investor relations risk",
                "Concentration risk",
                "Joint venture and partnership risk",
                "Board and governance effectiveness",
              ],
            },
            {
              risk_type: "Financial Risk",
              specific_risks: [
                "Liquidity and funding risk",
                "Credit and counterparty risk",
                "Market and interest rate risk",
                "Foreign exchange risk",
                "Financial reporting risk",
                "Tax risk",
                "Fraud and financial crime risk",
                "Insurance and liability risk",
                "Revenue leakage risk",
                "Capital adequacy risk",
              ],
            },
            {
              risk_type: "Operational Risk",
              specific_risks: [
                "Business process failure",
                "Third party and supplier risk",
                "Business continuity risk",
                "Project and programme delivery risk",
                "Change management risk",
                "Health and safety risk",
                "Asset and infrastructure risk",
                "Quality and product risk",
                "Natural disaster and climate risk",
                "Outsourcing and offshoring risk",
              ],
            },
            {
              risk_type: "Technology & Cyber Risk",
              specific_risks: [
                "Ransomware and malware risk",
                "Data breach risk",
                "Legacy system risk",
                "Cloud migration risk",
                "Third party technology risk",
                "System availability and resilience risk",
                "AI and machine learning risk",
                "IoT and connected device risk",
                "Identity and access management risk",
                "Technology concentration risk",
              ],
            },
            {
              risk_type: "People Risk",
              specific_risks: [
                "Key person dependency",
                "Talent attraction and retention",
                "Workforce capability and skills gaps",
                "Industrial relations risk",
                "Workplace culture and conduct risk",
                "Employee misconduct and fraud",
                "Workforce health and wellbeing",
                "Contractor and contingent workforce risk",
                "Succession planning risk",
                "Diversity and inclusion risk",
              ],
            },
            {
              risk_type: "Legal & Compliance Risk",
              specific_risks: [
                "Contract and commercial risk",
                "Intellectual property risk",
                "Litigation and dispute risk",
                "Regulatory breach risk",
                "Whistleblower risk",
                "Conflict of interest risk",
                "Bribery and corruption risk",
                "Trade and sanctions compliance risk",
                "Consumer protection risk",
                "Privacy and data breach risk",
              ],
            },
            {
              risk_type: "ESG & Sustainability Risk",
              specific_risks: [
                "Climate transition risk",
                "Physical climate risk",
                "Stranded asset risk",
                "Water scarcity risk",
                "Biodiversity and land use risk",
                "Supply chain sustainability risk",
                "Social licence to operate risk",
                "Greenwashing risk",
                "ESG reporting and disclosure risk",
                "Stakeholder activism risk",
              ],
            },
          ],
        },
        {
          industry_group: "Financial Services",
          risk_types: [
            {
              risk_type: "Prudential Risk",
              specific_risks: [
                "Capital adequacy risk",
                "Liquidity coverage ratio risk",
                "Net stable funding ratio risk",
                "Credit concentration risk",
                "Large exposures risk",
                "Pillar 2 supervisory review risk",
                "Stress testing risk",
                "Recovery and resolution planning risk",
                "Contagion risk",
                "Systemic risk",
              ],
            },
            {
              risk_type: "Financial Crime Risk",
              specific_risks: [
                "Money laundering risk",
                "Terrorism financing risk",
                "Sanctions breach risk",
                "Bribery and corruption risk",
                "Market manipulation risk",
                "Insider trading risk",
                "Tax evasion facilitation risk",
                "Proliferation financing risk",
                "Fraud risk",
                "Cybercrime risk",
              ],
            },
            {
              risk_type: "Conduct & Consumer Risk",
              specific_risks: [
                "Mis-selling risk",
                "Product suitability risk",
                "Conflicts of interest risk",
                "Remuneration and incentive risk",
                "Vulnerable customer risk",
                "Complaints handling risk",
                "Unfair contract terms risk",
                "Responsible lending risk",
                "Superannuation member outcomes risk",
                "Insurance claims handling risk",
              ],
            },
          ],
        },
        {
          industry_group: "Health & Life Sciences",
          risk_types: [
            {
              risk_type: "Clinical & Patient Risk",
              specific_risks: [
                "Patient safety risk",
                "Clinical governance risk",
                "Medication error risk",
                "Adverse event risk",
                "Infection control risk",
                "Clinical trial risk",
                "Medical device failure risk",
                "Diagnostic error risk",
                "Treatment outcome risk",
                "Consent and autonomy risk",
              ],
            },
            {
              risk_type: "Regulatory & Quality Risk",
              specific_risks: [
                "TGA compliance risk",
                "AHPRA registration risk",
                "Aged care quality standards risk",
                "NDIS compliance risk",
                "Medicare compliance risk",
                "Clinical coding risk",
                "Accreditation risk",
                "Pharmacovigilance risk",
                "Product recall risk",
                "Supply chain quality risk",
              ],
            },
          ],
        },
        {
          industry_group: "Energy & Utilities",
          risk_types: [
            {
              risk_type: "Energy Market Risk",
              specific_risks: [
                "Wholesale energy price risk",
                "Retail margin risk",
                "Network revenue risk",
                "Renewable energy certificate risk",
                "Carbon price risk",
                "Fuel supply risk",
                "Demand forecasting risk",
                "Interconnector risk",
                "Ancillary services risk",
                "Hedging and derivative risk",
              ],
            },
            {
              risk_type: "Infrastructure & Operational Risk",
              specific_risks: [
                "Asset failure and outage risk",
                "Network reliability risk",
                "Critical infrastructure protection risk",
                "Natural disaster risk",
                "Bushfire risk",
                "Flood risk",
                "Cyber attack on operational technology risk",
                "SCADA and control system risk",
                "Aging infrastructure risk",
                "New technology integration risk",
              ],
            },
          ],
        },
        {
          industry_group: "Government & Public Sector",
          risk_types: [
            {
              risk_type: "Public Accountability Risk",
              specific_risks: [
                "Parliamentary scrutiny risk",
                "Freedom of information risk",
                "Audit finding risk",
                "Ministerial direction risk",
                "Public interest disclosure risk",
                "Procurement compliance risk",
                "Grant administration risk",
                "Programme delivery risk",
                "Policy implementation risk",
                "Inter-agency coordination risk",
              ],
            },
            {
              risk_type: "National Security Risk",
              specific_risks: [
                "Foreign interference risk",
                "Critical infrastructure attack risk",
                "Espionage risk",
                "Classified information risk",
                "Security clearance risk",
                "Supply chain national security risk",
                "Foreign investment risk",
                "Cyber espionage risk",
                "Insider threat risk",
                "Disinformation risk",
              ],
            },
          ],
        },
        {
          industry_group: "Technology, Media & Telecommunications",
          risk_types: [
            {
              risk_type: "Digital Platform Risk",
              specific_risks: [
                "Platform liability risk",
                "Content moderation risk",
                "Algorithmic bias risk",
                "Data monetisation risk",
                "Digital advertising risk",
                "Platform dependency risk",
                "App store risk",
                "Digital rights management risk",
                "Online safety risk",
                "Deepfake and synthetic media risk",
              ],
            },
            {
              risk_type: "Telecommunications Risk",
              specific_risks: [
                "Network outage risk",
                "Spectrum risk",
                "Roaming and interconnection risk",
                "Infrastructure sharing risk",
                "5G deployment risk",
                "NBN dependency risk",
                "Critical communications risk",
                "Emergency services network risk",
                "Telecommunications security risk",
                "Foreign equipment vendor risk",
              ],
            },
          ],
        },
        {
          industry_group: "Consumer & Retail",
          risk_types: [
            {
              risk_type: "Supply Chain Risk",
              specific_risks: [
                "Supplier concentration risk",
                "Offshore manufacturing risk",
                "Logistics and freight risk",
                "Inventory management risk",
                "Raw material price risk",
                "Food safety and contamination risk",
                "Product recall risk",
                "Counterfeiting and grey market risk",
                "Ethical sourcing risk",
                "Modern slavery in supply chain risk",
              ],
            },
            {
              risk_type: "Consumer & Brand Risk",
              specific_risks: [
                "Brand and reputational risk",
                "Consumer sentiment risk",
                "Social media risk",
                "Product liability risk",
                "Customer data breach risk",
                "Loyalty programme risk",
                "Pricing and promotional risk",
                "Channel conflict risk",
                "Franchise risk",
                "Retail crime and loss prevention risk",
              ],
            },
          ],
        },
        {
          industry_group: "Industrial & Manufacturing",
          risk_types: [
            {
              risk_type: "Industrial Safety Risk",
              specific_risks: [
                "Major hazard facility risk",
                "Dangerous goods risk",
                "Industrial accident risk",
                "Mine safety risk",
                "Contractor safety risk",
                "Equipment and machinery risk",
                "Noise and vibration risk",
                "Hazardous substance exposure risk",
                "Fatigue management risk",
                "Emergency response risk",
              ],
            },
            {
              risk_type: "Environmental Risk",
              specific_risks: [
                "Environmental contamination risk",
                "Waste management risk",
                "Emissions and pollution risk",
                "Water usage and discharge risk",
                "Biodiversity impact risk",
                "Site rehabilitation risk",
                "Environmental licence breach risk",
                "Climate physical risk to assets",
                "Carbon and emissions liability risk",
                "Community environmental impact risk",
              ],
            },
          ],
        },
      ],
    },
  },
};
const INLINED_PROMPTS = {
  "wbs_schedule.json": {
    prompt_id: "P2.1",
    prompt_name: "WBS & Schedule",
    artifact: "WBS & Project Schedule",
    instruction:
      `EXECUTION CONSTRAINTS — MANDATORY:\\nYou must follow these execution rules without exception before performing any task.\\n\\n1. Do all parsing, validation, reasoning, and content drafting in your response text only. Do not use code interpreter for any of these steps.\\n\\n2. Make exactly ONE code interpreter call. This call must contain the complete, final file generation script in its entirety. Do not split file generation across multiple calls.\\n\\n3. Do not use code interpreter to inspect, test, explore, or validate data, variables, or helper functions before the final generation call.\\n\\n4. Do not make iterative or exploratory code calls at any stage.\\n\\n5. If a code error occurs inside the single permitted call, handle it internally using try/except. Do not make a second code call to fix or retry it.\\n\\n6. Generate and save all required output files within the single permitted code call. Do not make additional code calls for each file format separately.\\n\\n7. Do not confirm, summarise, or test outputs with a code call. Confirm completion in your response text only.\\n\\n8. Do not present preview tables or confirmation gates mid-execution. Treat all proposed content as confirmed and proceed directly to file generation without waiting for user input.\\n\\n9. After delivering all output files, include a brief closing message confirming what was generated and inviting the user to request changes or proceed with the next prompt. Do not await a response — this message is terminal.\\n\\n---\\n\\n# P2.1 — WBS & Schedule (Chain Step)

SS-1, DD-1, WE-1 are loaded from P1.1. Apply them. Do not restate them.

---

## PURPOSE
Produce the canonical WBS and Project Schedule as a single combined workbook. Output:
1) Real .xlsx — WBS & Schedule Workbook (operational tracker combining scope decomposition and timeline)
2) Canonical JSON handoff in-chat for downstream prompts

Do not pause for user input. Where inputs are missing, apply DD-1 placeholder conventions and raise open_items.

---

## INPUTS
Parse the most recent in-chat JSON objects:
- P1_1_CANONICAL_HANDOFF — engagement identifiers; service offerings; technology; methodology; dates
- P1_2_CANONICAL_HANDOFF — stakeholder register for workstream ownership
- P1_3_CANONICAL_HANDOFF — scope inclusions/exclusions; objectives; success criteria; constraints; assumptions
- P1_4_CANONICAL_HANDOFF — charter; commercial terms; sign-off authorities
- P1_5_CANONICAL_HANDOFF — governance bodies; cadence; escalation; RAID expectations

---

## HARD PRECONDITIONS (FAIL-FAST)
Required minimum:
1) P1_1_CANONICAL_HANDOFF.engagement.client_name and .engagement_name
2) P1_3_CANONICAL_HANDOFF.scope (inclusions OR boundary statement)
3) P1_1_CANONICAL_HANDOFF.engagement.start_date

If any missing, STOP and output only:
> BLOCKED: Missing required upstream handoff(s) for WBS & Schedule. Require P1.1 engagement IDs + P1.3 scope + P1.1 start date. Re-run upstream, then re-run P2.1.

---

## STEP 1 — EXTRACT + NORMALISE
From P1_3_CANONICAL: inclusions, exclusions, constraints, assumptions, workstreams, deliverables, objectives, success criteria
From P1_1_CANONICAL: service offerings, building blocks, technology, regulatory domains, delivery methodology, start date, end date (if available)
From P1_5_CANONICAL: governance, reporting, RAID, quality governance expectations

WBS levels:
- L1: Engagement
- L2: Phase or Workstream
- L3: Deliverable
- L4: Work Package

Always include these standard L2 workstreams unless explicitly excluded:
- Programme Management & Governance
- Stakeholder Engagement & Change
- Quality Assurance
- Risk/Issue/Dependency Management

---

## STEP 2 — DERIVE SCHEDULING PARAMETERS
From P1_1_CANONICAL:
- Delivery methodology (Waterfall / Agile / Hybrid)
- Start date (mandatory; use as anchor for all scheduling)
- End date or engagement duration (if stated; else derive from scope and effort)
- Fee structure and engagement scale (affects realistic duration estimate)

From P1_5_CANONICAL (governance bodies):
- Extract meeting cadence to anchor reporting milestones
- Identify Steering Committee cadence for sign-off milestone timing

If methodology is Agile or Hybrid:
- Calculate sprint length (default 2 weeks unless stated)
- Derive sprint count from duration

If end date is not stated: estimate based on scope size and typical engagement norms; flag as assumption.

---

## STEP 2B — USER CONFIRMATION GATE (mandatory; do NOT skip)

### Execution behaviour
- Do NOT pause, stop, or wait for user input at any point.
- Treat the engagement data provided as confirmed and authoritative.
- If data is missing or ambiguous, apply reasonable professional assumptions, note them in open_items, and proceed immediately.
- Generate all deliverables in a single uninterrupted pass.
- Do NOT ask clarifying questions — proceed directly to file generation.

---

## STEP 3 — BUILD WBS STRUCTURE (EXTRACT + INFER, NO INVENTION)
Generate WBS elements from scope. Infer standard workstreams if not explicitly listed.

For each WBS element define:
wbs_id (DD-1 format) | parent_wbs_id | level (1–4) | element_type (Phase | Workstream | Deliverable | Work_Package) | name | description | owner_type (PwC | Client | Joint | Third_Party) | responsible_role | effort_days (estimate; flag as assumption if not stated) | start_week (relative offset from start date) | end_week

---

## STEP 4 — BUILD SCHEDULE
For each L3 Deliverable and L4 Work Package:
- Map to a week range anchored from P1_1 start_date
- Apply sequential scheduling where predecessors are defined
- Allow concurrent scheduling where workstreams can run in parallel
- Flag milestone rows (sign-off gates, phase completions, governance reviews)
- If Agile/Hybrid: assign each work package to a sprint

Mandatory milestones (create if implied; else mark TBC with open item):
- Engagement kickoff
- End of each phase
- Steering Committee review points (from P1_5 cadence)
- Final delivery / sign-off

---

## STEP 5 — BUILD THE XLSX WORKBOOK
Generate a real .xlsx using openpyxl. Apply SS-1 Excel + WE-1 throughout.

Exactly 6 sheets (stable names):
1) WBS_Structure
2) WBS_Dictionary
3) Deliverable_Register
4) Milestone_Plan
5) Project_Schedule
6) Change_Log

**WBS_Structure**
Tab colour: primary per SS-1. SS-1 header block rows 1-2.
Excel Table tbl_wbs columns:
WBS_ID | Parent_WBS_ID | Level | Element_Type | Name | Description | Owner_Type | Responsible_Role | Effort_Days | Start_Week | End_Week | Status | Notes
Conditional formatting: L1 bold/shaded; L2 semi-bold; L3/L4 standard. Freeze panes + filters per WE-1.
Dropdown validations: Element_Type, Owner_Type, Status (Not Started | In Progress | Complete | On Hold | Cancelled).

**WBS_Dictionary**
Tab colour: reference per SS-1.
Excel Table tbl_dictionary columns:
WBS_ID | Element_Name | Full_Description | Acceptance_Criteria | Dependencies | Assumptions | Key_Risks | Notes
Populate from WBS elements. Link Acceptance_Criteria to objectives/success criteria from P1_3_CANONICAL.

**Deliverable_Register**
Tab colour: reference per SS-1.
Excel Table tbl_deliverables columns:
Deliverable_ID | WBS_ID | Deliverable_Name | Workstream | Owner_Type | Responsible_Role | Effort_Days | Planned_Start | Planned_End | Acceptance_Criteria | Sign_Off_Required | Sign_Off_Authority | Scope_Objective_Trace | Status | Notes
Populate all L3 deliverables. Link Scope_Objective_Trace to P1_3_CANONICAL scope inclusions and objectives.
Named ranges: nr_total_deliverables, nr_deliverables_complete, nr_deliverables_at_risk.

**Milestone_Plan**
Tab colour: primary per SS-1.
Excel Table tbl_milestones columns:
Milestone_ID | Milestone_Name | Phase_or_Workstream | Milestone_Type (Phase_Gate | Governance_Review | Deliverable_Sign_Off | Client_Approval | Reporting_Cycle | Sprint_Review | Other) | Planned_Date | Actual_Date | Status | Owner_Role | Notes
Pre-populate with all identified milestones anchored to start_date. Include governance meeting milestones from P1_5.
If Agile/Hybrid: include sprint review milestones.
Conditional formatting: Status colour-coding (On Track green, At Risk amber, Delayed red).

**Project_Schedule**
Tab colour: primary per SS-1.
Excel Table tbl_schedule columns:
Task_ID | WBS_ID | Task_Name | Level | Workstream | Owner_Role | Planned_Start | Planned_End | Duration_Days | Predecessors | Status | Pct_Complete | Is_Milestone | Is_Critical_Path | Sprint (if Agile/Hybrid) | Notes
Plus Gantt columns: one column per week commencing across engagement duration. Apply conditional formatting formula to shade Gantt cells where planned start <= week <= planned end.
Freeze first 12 columns. Filter on all columns.
If Agile/Hybrid: include Sprint_Plan sub-section grouping tasks by sprint.
If Waterfall: Critical_Path column flags tasks with zero float.

**Change_Log**
Tab colour: reference per SS-1.
Excel Table tbl_changes per WE-1.
Columns: Change_ID | Date | Sheet | Record_ID | Field | Previous_Value | New_Value | Changed_By_Role | Reason | Approved_By_Role
Pre-populate one instruction row.

File: P2.1_WBS_Schedule_{YYYY-MM-DD}_v1.0.xlsx → /mnt/data/

---

## STEP 6 — JSON HANDOFF
After QA, output fenced JSON in-chat with top-level key P2_1_CANONICAL_HANDOFF:
- prompt_id: "P2.1"
- generated_on: YYYY-MM-DD
- wbs: [{ wbs_id, parent_wbs_id, level, element_type, name, description, owner_type, responsible_role, effort_days, start_week, end_week }]
- deliverables: [{ deliverable_id, name, workstream, acceptance_criteria, owner_type, responsible_role, effort_days, scope_trace }]
- milestones: [{ milestone_id, name, type, planned_date, owner_role }]
- schedule_bounds: { start_date, end_date, duration_weeks, methodology }
- standard_workstreams_included: [string]
- assumptions: [string]
- open_items: [{ id, area, description, source, priority }]
- validation: { status: "PASS", notes: [] }

Do not embed SS-1/DD-1/WE-1 in this JSON.

---

## QA
XLSX: exactly 6 sheets with specified names; all required Excel Tables present; Gantt columns span full engagement duration; dropdown validations applied; milestone dates anchored to start_date; no formula errors; freeze panes and filters set.

QA FAIL: output only — QA FAIL: followed by compact list of failures (Sheet + Table/Column).

---

## OUTPUT
1) Download link: P2.1_WBS_Schedule_{YYYY-MM-DD}_v1.0.xlsx
2) P2_1_CANONICAL_HANDOFF fenced JSON in-chat
No other narrative output.

After delivering all files, include a brief closing message confirming what was generated and inviting the user to request changes or send the next prompt. Do not await a response — this message is terminal.

---

{{PROMPT_DATA}}`,
  },
  "budget_cost_baseline.json": {
    prompt_id: "P2.3",
    prompt_name: "Budget & Cost Baseline",
    artifact: "Budget Baseline & Cost Tracker",
    instruction:
      `EXECUTION CONSTRAINTS — MANDATORY:\\nYou must follow these execution rules without exception before performing any task.\\n\\n1. Do all parsing, validation, reasoning, and content drafting in your response text only. Do not use code interpreter for any of these steps.\\n\\n2. Make exactly ONE code interpreter call. This call must contain the complete, final file generation script in its entirety. Do not split file generation across multiple calls.\\n\\n3. Do not use code interpreter to inspect, test, explore, or validate data, variables, or helper functions before the final generation call.\\n\\n4. Do not make iterative or exploratory code calls at any stage.\\n\\n5. If a code error occurs inside the single permitted call, handle it internally using try/except. Do not make a second code call to fix or retry it.\\n\\n6. Generate and save all required output files within the single permitted code call. Do not make additional code calls for each file format separately.\\n\\n7. Do not confirm, summarise, or test outputs with a code call. Confirm completion in your response text only.\\n\\n8. Do not present preview tables or confirmation gates mid-execution. Treat all proposed content as confirmed and proceed directly to file generation without waiting for user input.\\n\\n9. After delivering all output files, include a brief closing message confirming what was generated and inviting the user to request changes or proceed with the next prompt. Do not await a response — this message is terminal.\\n\\n---\\n\\nSS-1, DD-1, WE-1 are loaded from P1.1. Apply them. Do not restate them.\n\n---\n\nYou are a PwC engagement planning assistant with access to code interpreter.\n\nRefer to the following documents generated in this message thread above:\n- Engagement Intake Summary (P1.1)\n- Engagement Charter (P1.4)\n- Work Breakdown Structure (P2.1)\n- Schedule & Milestones (P2.1)\n- Resource Plan (P2.2)\n- RACI Matrix (P2.2)\n\nBefore building the Budget and Cost Baseline, you must first work through a structured budget clarification process with the user. Follow the steps below in sequence.\n\n---\n\nCONTEXT CHECK\n\nBefore presenting any clarification questions to the user, count how many of the 16 Engagement Context fields above are populated (i.e. not blank and not still containing a placeholder such as [CLIENT_NAME]).\n\nIf fewer than 8 of the 16 fields are completed, stop and output the message below — do not proceed to Step 1 until the user confirms the fields have been filled:\n\n"⚠️ Insufficient engagement context detected. Only key engagement context fields context fields are populated. To generate a meaningful Budget Baseline & Cost Tracker rather than a generic template, please fill in at minimum: Client Name, Engagement Name, Delivery Methodology, Fee Structure, Engagement Start Date, Total Budget, and Primary Workstreams. Update the context block above and re-run."\n\nIf 8 or more fields are populated, proceed to Step 1 below.\n\n---\n\nSTEP 1 — BUDGET REVIEW AND CLARIFICATION\n\nParse all input documents and extract the following:\n- Commercial terms from the Engagement Charter (fee structure, estimated budget, billing frequency)\n- Resource roles, effort estimates and daily rates from the Resource Plan\n- WBS phases, workstreams and deliverables\n- Engagement timeline and milestone dates from the Schedule\n- Any cost-related assumptions or constraints already noted\n- Alliance partner or third party costs referenced\n- Travel, expense or other non-labour costs referenced\n- Contingency assumptions referenced\n\nBased on this information construct a proposed budget structure and present it Do NOT pause or wait for user input. Treat all engagement data as confirmed.\nApply reasonable professional assumptions for any missing values, note them as assumptions, and proceed directly to STEP 3.\n\n\nThen proceed to build the Budget and Cost Baseline as specified below.\n\n---\n\nSTEP 3 — BUILD THE DELIVERABLE\n\nFEE STRUCTURE ADAPTATION\n\nApply the following model before generating any Excel sheets:\n\n**If Time and Materials:**\n- Cost baseline: Effort Hours × Daily Rate per Role per Workstream per Month.\n- Track: Planned Cost | Actual Cost | Forecast to Complete | Variance.\n- Include EVM metrics: SPI, CPI, EAC, VAC, TCPI.\n\n**If Fixed Price:**\n- Replace the T&M cost build with a Fixed Price Cost Control model:\n  - Fixed Fee: [confirmed amount]\n  - Estimated Internal Cost to Deliver: effort × internal rates from Resource Plan\n  - Gross Margin: Fixed Fee minus Internal Cost\n  - Cost to Complete (CTC): remaining estimated cost\n  - Earned Value: % of deliverables signed off × Fixed Fee\n  - Margin at Risk: CTC vs remaining Fixed Fee\n- Replace the Invoice Schedule sheet with a Milestone Invoicing Schedule: Milestone | Invoiceable Amount | Invoice Date | Status.\n- Add a Margin Tracker table to the Financial Dashboard & EVM sheet: Month | Planned Cost | Actual Cost | Fixed Fee Earned | Margin £ | Margin %.\n\n**If Capped T&M:**\n- Build as T&M above and add:\n  - Cap Amount column (the agreed NTE cap per period or total).\n  - Cap Utilisation % = (Actual + Forecast to Complete) ÷ Cap Amount.\n  - Colour warning: orange when Cap Utilisation > 80%, red when > 95%.\n\n---\n\n\nGenerate the Budget and Cost Baseline as two outputs:\n1. A formatted Word document (.docx) applying PwC formatting standards containing the budget narrative, cost baseline summary and financial management approach\n2. A formatted Excel workbook (.xlsx) containing the full budget baseline, cost tracker, invoice schedule, financial dashboard, earned value analysis and cost change log applying PwC formatting standards\n\nMake both files available for download.\n\n---\n\nPWC FORMATTING STANDARDS FOR WORD\n\nTypography\n- Primary font: ITC Charter (body text). If unavailable use Georgia.\n- Heading font: Helvetica Neue (headings and labels). If unavailable use Arial.\n- Body text size: 10pt\n- H1 size: 20pt, bold\n- H2 size: 14pt, bold\n- H3 size: 11pt, bold\n- Line spacing: 1.15\n- Paragraph spacing: 6pt after\n\nColour Palette\n- Primary: PwC Orange SS-1 colour token\n- Secondary: PwC Red SS-1 colour token\n- Dark: PwC Black SS-1 --black\n- Light background: SS-1 --grey100 fill\n- Borders and rules: SS-1 colour token\n\nDocument Structure\n- Page headers: document title left, client name and engagement name right, in grey\n- Page footers: confidentiality notice left, page number right, in grey\n- First page header block: document title, client name, engagement name, prepared by PwC, date, version, status\n- Section dividers: full-width horizontal rule in PwC Orange SS-1 colour token\n- All section headings in PwC Orange SS-1 colour token\n- Confidentiality footer on every page: \'PwC Private and Confidential — prepared for [Client Name] only\'\n\nTables\n- Header row background: SS-1 colour token, text white, bold, 9pt\n- Alternating row shading: white and SS-1 --grey100 fill\n- Table borders: 0.5pt SS-1 colour token\n- Cell padding: 4pt\n\nCallout Boxes\n- Key budget decisions: left border 3pt SS-1 colour token, background SS-1 --orange100 fill\n- Budget risks and TBC items: left border 3pt SS-1 colour token, background SS-1 --orange100 fill\n- Notes and assumptions: left border 3pt SS-1 colour token, background SS-1 --grey100 fill\n- Contingency note: left border 3pt SS-1 colour token, background SS-1 colour token\n\nBudget status badges:\n- On Budget: background SS-1 --successBg fill, text SS-1 colour token\n- At Risk: background SS-1 colour token, text SS-1 colour token\n- Over Budget: background SS-1 --dangerBg fill, text SS-1 --danger\n- TBC: background SS-1 --grey100 fill, text SS-1 colour token\n\nPWC FORMATTING STANDARDS FOR EXCEL\n\nFonts\n- Headings and column headers: Arial, 10pt, bold\n- Body text: Arial, 10pt\n- Currency cells: Arial, 10pt, right-aligned, currency format\n- Small labels and notes: Arial, 9pt\n\nColour Palette\n- Primary header background: SS-1 colour token, text white, bold\n- Secondary header background: SS-1 --grey100 fill, text SS-1 --black, bold\n- Category subtotal rows: SS-1 --grey100 fill, text SS-1 --black, bold\n- Grand total rows: SS-1 colour token, text white, bold\n- Alternating row shading: SS-1 colour token and SS-1 colour token\n- Borders: SS-1 colour token, thin\n- On Budget (variance <= 5%): SS-1 --successBg fill, text SS-1 colour token\n- At Risk (variance 5-15%): SS-1 colour token, text SS-1 colour token\n- Over Budget (variance > 15%): SS-1 --dangerBg fill, text SS-1 --danger\n- TBC cells: SS-1 --grey100 fill, text SS-1 colour token, italic\n- Contingency rows: SS-1 colour token, text SS-1 colour token\n- Fixed price rows: SS-1 colour token, text SS-1 colour token\n\nWorkbook Structure\n- Tab colour for main sheets: SS-1 colour token\n- Tab colour for reference and baseline sheets: SS-1 --grey100 fill\n- Freeze top two rows on all tabs\n- Auto-filter on all data columns\n- Column widths set to content\n- All currency columns formatted as currency with 2 decimal places\n- Footer on every sheet: \'PwC Private and Confidential — prepared for [Client Name] only\' left, page number right\n\n---\n\nWORD DOCUMENT STRUCTURE\n\n**DOCUMENT HEADER (first page only)**\n- Document title: Budget & Cost Baseline\n- Client name and engagement name\n- Prepared by: PwC\n- Date: today\'s date\n- Version: 1.0\n- Status: Draft\n- Confidentiality notice\n\n**TABLE OF CONTENTS**\n\n**1. Purpose**\nA brief section explaining:\n- The purpose of the Budget and Cost Baseline\n- How it was developed from the Resource Plan, WBS and commercial terms\n- How it will be used to manage financial performance throughout the engagement\n- How it connects to the Governance Framework and Change Control Plan\n\n**2. Engagement Overview**\nSummary table: Client Name, Engagement Name, Fee Structure, Total Approved Budget, Billing Currency, Billing Frequency, Purchase Order Number, Contingency Amount, Contingency Percentage, Baseline Set Date\n\n**3. Budget Summary**\nA high-level budget summary table:\n- Cost Category | Estimated Amount | % of Total Budget | Confidence | Notes\n\nInclude subtotals by major category (Labour, Non-Labour, Contingency).\nInclude a grand total row.\nFormat all amounts as currency.\n\nFollow with a budget composition narrative (1-2 paragraphs) describing the cost structure and key cost drivers.\n\n**4. Labour Cost Baseline**\n\n4.1 PwC Labour\nA table showing PwC labour costs by seniority level:\n- Seniority Level | Number of Resources | Total Effort (days) | Daily Rate | Total Cost | % of PwC Labour\n\nInclude a subtotal row.\n\n4.2 Alliance Partner and Third Party Labour\nA table showing non-PwC labour costs:\n- Organisation | Role | Effort (days) | Daily Rate | Total Cost | Notes\n\n4.3 Labour Cost by Phase\nA table showing total labour cost by phase:\n- Phase | Start Date | End Date | PwC Labour | Third Party Labour | Total Labour | % of Total Labour\n\n4.4 Labour Cost by Workstream\nA table showing total labour cost by workstream:\n- Workstream | Total Effort (days) | Total Labour Cost | % of Total Labour\n\n**5. Non-Labour Cost Baseline**\nA table showing all non-labour costs:\n- # | Cost Item | Category | Amount | Basis | Reimbursable (Yes/No) | Notes\n\nCategories: Travel and Accommodation, Technology and Software, Training, Printing and Production, Other Direct Costs\n\n**6. Contingency**\nA section describing:\n- Contingency amount and percentage\n- What the contingency covers\n- How contingency will be accessed and approved\n- Who approves drawdown of contingency\n\nInclude a contingency note callout box.\n\n**7. Payment Schedule**\nA table showing the planned invoice schedule:\n- # | Invoice | Milestone or Period | Planned Invoice Date | Amount | Cumulative Amount | % of Total\n\nIf milestone-based: link to specific milestones.\nIf time and materials: show monthly billing periods.\n\n**8. Cost Baseline by Month**\nA table showing the planned cost profile month by month:\n- Month | Labour Cost | Non-Labour Cost | Total Cost | Cumulative Cost | % of Total Budget\n\nInclude a note: \'The monthly cost profile is the S-curve baseline against which actual spend will be tracked.\'\n\n**9. Financial Management Approach**\nA narrative section describing:\n- How costs will be tracked and reported\n- Reporting frequency and format\n- Variance thresholds and escalation triggers\n- How change requests will impact the budget\n- Who has financial authority at each level\n- How invoices will be prepared and submitted\n\n**10. Budget Risks and Assumptions**\n\n10.1 Budget Assumptions\nA table of all budget assumptions:\n- # | Assumption | Impact if Wrong | Confidence | Notes\n\n10.2 Budget Risks\nA table of the top budget risks:\n- # | Risk | Category | Likelihood | Financial Impact | Mitigation\n\n**11. Open Items**\nA table of any budget items still TBC:\n- # | Open Item | Category | Priority | Action Required | Owner | Due Date\n\n**APPENDIX A — Document Version History**\n\n**APPENDIX B — Reference Documents**\n\n---\n\nWORKBOOK RATIONALISATION — generate a maximum of 5 sheets:\n1. Budget Baseline & Tracker — merge the Budget Baseline and Cost Tracker; baseline columns sit alongside actuals/forecast so variance is visible in one view (Baseline Cost | Actual Cost | Forecast to Complete | Variance £ | Variance %).\n2. Monthly Cost Profile — S-curve and monthly spend breakdown, kept as is.\n3. Invoice Schedule — kept as is for T&M; replaced with Milestone Invoicing Schedule for Fixed Price (see fee structure adaptation below).\n4. Financial Dashboard & EVM — merge the Financial Dashboard and Earned Value Analysis; KPI summary at top, EVM metrics (SPI, CPI, EAC, VAC, TCPI) below.\n5. Change Log.\nDo not generate separate Cost Baseline Snapshot or Budget Risk Log sheets (budget risks are captured in the Risk Register P2.4).\n\nEXCEL WORKBOOK STRUCTURE\n\n**Sheet 1: Budget Baseline**\n\nSummary bar (rows 1-2):\n- Total Approved Budget: sum of all baseline amounts\n- Total Labour Cost: =SUMIF(D4:D1000,"Labour",H4:H1000)\n- Total Non-Labour Cost: =SUMIF(D4:D1000,"Non-Labour",H4:H1000)\n- Contingency: =SUMIF(D4:D1000,"Contingency",H4:H1000)\n- TBC Items: =COUNTIF(I4:I1000,"TBC")\n- TBC Amount: =SUMIF(I4:I1000,"TBC",H4:H1000)\n- Budget Version: 1.0\n- Baseline Set Date: today\n\nColumns:\n- Line ID (="BL-"&TEXT(ROW()-3,"000"))\n- Cost Item Description\n- Phase or Workstream\n- Cost Type (dropdown: Labour — PwC, Labour — Client, Labour — Alliance Partner, Labour — Third Party, Travel and Accommodation, Technology and Software, Training, Printing and Production, Contingency, Other)\n- Resource Role (if labour)\n- Seniority Level (if PwC labour)\n- Effort (days) (if labour)\n- Daily Rate (if labour)\n- Baseline Amount (formula: =IFERROR(G4*H4,H4) — uses effort x rate for labour, direct amount for non-labour)\n- Confidence (dropdown: High, Medium, Low, TBC)\n- Reimbursable (dropdown: Yes, No, N/A)\n- Fixed or Variable (dropdown: Fixed, Variable, Capped)\n- Notes\n\nSubtotal rows by Cost Type using SUMIF.\nGrand total row at bottom.\n\nConditional formatting:\n- Confidence TBC: SS-1 --grey100 fill, text SS-1 colour token, italic\n- Cost Type Contingency: SS-1 colour token, text SS-1 colour token\n- Cost Type Fixed price: SS-1 colour token, text SS-1 colour token\n- Grand total row: SS-1 colour token, text white, bold\n\n**Sheet 2: Cost Tracker**\n\nSummary bar (rows 1-2):\n- Total Budget: linked from Sheet 1 grand total\n- Total Actual to Date: =SUM(ActualToDate column)\n- Total Forecast to Complete: =SUM(ForecastToComplete column)\n- Total Estimate at Completion: =TotalActual+TotalForecast\n- Budget Variance: =TotalBudget-EstimateAtCompletion\n- Budget Variance %: =IFERROR(BudgetVariance/TotalBudget,0) — format as percentage\n- Contingency Used: =SUMIF(CostType,"Contingency",ActualToDate)\n- Contingency Remaining: =ContingencyBudget-ContingencyUsed\n\nColumns:\n- Line ID (reference to Sheet 1)\n- Cost Item Description\n- Phase or Workstream\n- Cost Type\n- Baseline Amount (linked from Sheet 1)\n- Actual Month 1\n- Actual Month 2\n- Actual Month 3\n- [Continue for each month of engagement duration]\n- Total Actual to Date (formula: =SUM of all actual month columns)\n- Forecast to Complete\n- Estimate at Completion (formula: =TotalActual+ForecastToComplete)\n- Budget Variance (formula: =BaselineAmount-EstimateAtCompletion)\n- Variance % (formula: =IFERROR(BudgetVariance/BaselineAmount,0) — format as percentage)\n- Status (formula: =IF(VariancePct>0.15,"Over Budget",IF(VariancePct>0.05,"At Risk","On Budget")))\n- Notes\n\nConditional formatting on Status:\n- On Budget: SS-1 --successBg fill, text SS-1 colour token\n- At Risk: SS-1 colour token, text SS-1 colour token\n- Over Budget: SS-1 --dangerBg fill, text SS-1 --danger, bold\n\nConditional formatting on Variance %:\n- > 15%: SS-1 --dangerBg fill, text SS-1 --danger, bold\n- 5-15%: SS-1 colour token, text SS-1 colour token\n- <= 5%: SS-1 --successBg fill, text SS-1 colour token\n\n**Sheet 3: Monthly Cost Profile**\n\nA month-by-month view of the planned versus actual cost profile:\n\nColumns:\n- Month\n- Month Start Date\n- Month End Date\n- Planned Labour Cost\n- Planned Non-Labour Cost\n- Planned Total Cost\n- Planned Cumulative Cost\n- Actual Labour Cost\n- Actual Non-Labour Cost\n- Actual Total Cost\n- Actual Cumulative Cost\n- Variance (formula: =PlannedTotal-ActualTotal)\n- Variance % (formula: =IFERROR(Variance/PlannedTotal,0))\n- Status (formula: same as Sheet 2)\n\nAll amounts as currency.\n\nS-curve data (cumulative planned vs cumulative actual) in columns L and M for charting.\n\nNote: Build a simple line chart showing planned cumulative cost (S-curve) versus actual cumulative cost. Label the chart \'Cost S-Curve — Planned vs Actual\'.\n\nConditional formatting on Variance %:\n- > 15%: SS-1 --dangerBg fill, text SS-1 --danger\n- 5-15%: SS-1 colour token, text SS-1 colour token\n- <= 5%: SS-1 --successBg fill, text SS-1 colour token\n\n**Sheet 4: Invoice Schedule**\n\nSummary bar (rows 1-2):\n- Total Contract Value: linked from budget\n- Total Invoiced to Date: =SUMIF(H4:H1000,"Sent",F4:F1000)+SUMIF(H4:H1000,"Paid",F4:F1000)\n- Total Outstanding: =SUMIF(H4:H1000,"Sent",F4:F1000)\n- Total Paid: =SUMIF(H4:H1000,"Paid",F4:F1000)\n- Total Remaining to Invoice: =TotalContractValue-TotalInvoiced\n- Next Invoice Due: =IFERROR(MINIFS(E4:E1000,H4:H1000,"Planned"),"No upcoming invoices")\n\nColumns:\n- Invoice ID (="INV-"&TEXT(ROW()-3,"000"))\n- Invoice Description\n- Billing Period or Milestone\n- Invoice Type (dropdown: Time and Materials, Fixed Fee, Milestone, Expense Reimbursement, Other)\n- Planned Invoice Date\n- Invoice Amount\n- GST Amount (formula: =F4*0.1 — adjust GST rate as confirmed)\n- Total Invoice Amount (formula: =F4+G4)\n- Status (dropdown: Planned, Prepared, Sent, Paid, Overdue, Disputed, Cancelled)\n- Invoice Number\n- Date Sent\n- Date Paid\n- Payment Reference\n- Days Outstanding (formula: =IF(AND(L4="",H4="Sent"),TODAY()-K4,""))\n- Notes\n\nConditional formatting:\n- Status Paid: SS-1 --successBg fill, text SS-1 colour token\n- Status Overdue: SS-1 --dangerBg fill, text SS-1 --danger, bold\n- Status Disputed: SS-1 --dangerBg fill, text SS-1 --danger\n- Status Sent: SS-1 colour token, text SS-1 colour token\n- Days Outstanding > 30: SS-1 --dangerBg fill, text SS-1 --danger, bold\n\n**Sheet 5: Earned Value Analysis**\n\nEarned Value Management (EVM) calculations by period:\n\nSummary bar (rows 1-2):\n- Budget at Completion (BAC): linked from baseline\n- Planned Value (PV) to Date: latest PV from table\n- Earned Value (EV) to Date: latest EV from table\n- Actual Cost (AC) to Date: latest AC from table\n- Schedule Variance (SV): =EV-PV\n- Cost Variance (CV): =EV-AC\n- Schedule Performance Index (SPI): =IFERROR(EV/PV,0)\n- Cost Performance Index (CPI): =IFERROR(EV/AC,0)\n- Estimate at Completion (EAC): =IFERROR(BAC/CPI,BAC)\n- Variance at Completion (VAC): =BAC-EAC\n- To Complete Performance Index (TCPI): =IFERROR((BAC-EV)/(BAC-AC),0)\n\nPeriod table columns:\n- Period (month)\n- Planned Value (PV) — budgeted cost of work scheduled\n- Earned Value (EV) — budgeted cost of work performed\n- Actual Cost (AC) — actual cost of work performed\n- Schedule Variance (SV) (formula: =C4-B4)\n- Cost Variance (CV) (formula: =C4-D4)\n- SPI (formula: =IFERROR(C4/B4,0))\n- CPI (formula: =IFERROR(C4/D4,0))\n- EAC (formula: =IFERROR(BACTotal/H4,BACTotal))\n- Status (formula: =IF(AND(G4>=1,H4>=1),"On Track",IF(AND(G4<1,H4<1),"Over Budget and Behind Schedule",IF(G4<1,"Behind Schedule","Over Budget"))))\n\nConditional formatting on SPI and CPI:\n- >= 1.0: SS-1 --successBg fill, text SS-1 colour token\n- 0.9-1.0: SS-1 colour token, text SS-1 colour token\n- < 0.9: SS-1 --dangerBg fill, text SS-1 --danger, bold\n\nConditional formatting on Status:\n- On Track: SS-1 --successBg fill, text SS-1 colour token\n- Over Budget and Behind Schedule: SS-1 --dangerBg fill, text SS-1 --danger, bold\n- Behind Schedule: SS-1 colour token, text SS-1 colour token\n- Over Budget: SS-1 colour token, text SS-1 colour token\n\n**Sheet 6: Financial Dashboard**\n\nA one-page financial summary dashboard:\n\nSection 1 — Budget Summary\n- Total Budget | Total Actual to Date | Forecast to Complete | Estimate at Completion | Budget Variance | Variance %\n- All as large formatted currency cells with status badges\n\nSection 2 — Cost by Category\n- Summary table: Labour | Non-Labour | Contingency | Total\n- Planned | Actual | Variance per category\n\nSection 3 — Monthly Spend\n- Monthly planned vs actual table (last 3 months and next 3 months)\n\nSection 4 — Invoice Status\n- Total Invoiced | Total Paid | Total Outstanding | Next Invoice Due\n\nSection 5 — EVM Indicators\n- SPI | CPI | EAC | VAC | TCPI\n- With traffic light conditional formatting\n\nSection 6 — Top Budget Risks\n- Top 3 budget risks from Sheet 7 with likelihood and financial impact\n\nAll values linked from other sheets using formulas. No manual entry on this sheet.\n\n**Sheet 7: Budget Risk Log**\n\nSummary bar (rows 1-2):\n- Total Budget Risks: =COUNTA(B4:B1000)\n- High Risks: =COUNTIF(F4:F1000,"High")\n- Open Risks: =COUNTIF(I4:I1000,"Open")\n- Total Financial Exposure: =SUMIF(I4:I1000,"Open",H4:H1000)\n\nColumns:\n- Risk ID (="BR-"&TEXT(ROW()-3,"000"))\n- Risk Description\n- Cost Category\n- Likelihood (dropdown: High, Medium, Low)\n- Financial Impact Description\n- Impact Level (dropdown: High, Medium, Low)\n- Estimated Financial Exposure\n- Risk Score (formula: =IF(AND(D4="High",F4="High"),9,IF(OR(AND(D4="High",F4="Medium"),AND(D4="Medium",F4="High")),6,IF(OR(AND(D4="High",F4="Low"),AND(D4="Low",F4="High"),AND(D4="Medium",F4="Medium")),4,IF(OR(AND(D4="Medium",F4="Low"),AND(D4="Low",F4="Medium")),2,1)))))\n- Status (dropdown: Open, Mitigated, Accepted, Closed)\n- Mitigation\n- Owner\n- Notes\n\nConditional formatting on Risk Score:\n- 9: SS-1 --dangerBg fill, text SS-1 --danger, bold\n- 6: SS-1 colour token, text SS-1 colour token\n- 4: SS-1 colour token, text SS-1 colour token\n- 2 or 1: SS-1 --successBg fill, text SS-1 colour token\n\n**Sheet 8: Cost Baseline Snapshot**\n\nA read-only snapshot of the approved baseline:\n\nColumns:\n- Line ID\n- Cost Item\n- Cost Type\n- Phase\n- Baseline Amount\n- Baseline Set Date\n- Baseline Version\n- Approved By\n\nInclude a note: \'This sheet is a read-only baseline snapshot. Do not edit. Changes to the baseline must follow the Change Control process and result in a new baseline version.\'\n\nProtect the sheet to prevent editing.\n\n**Sheet 9: Reference — Financial Standards**\n\nA read-only reference sheet containing:\n- EVM methodology and formula definitions\n- Variance threshold definitions and escalation triggers\n- Billing and invoicing process guidelines\n- Contingency drawdown process\n- Financial reporting cadence and format requirements\n- Currency and GST handling notes\n- PwC financial management standards reference\n\n**Sheet 10: Change Log**\n\nColumns:\n- Change ID (="CHG-"&TEXT(ROW()-3,"000"))\n- Date\n- Sheet Changed\n- Line ID or Record ID\n- Change Type (dropdown: Budget Line Added, Budget Line Removed, Rate Changed, Effort Changed, Baseline Updated, Forecast Updated, Contingency Drawn, Invoice Updated, Other)\n- Previous Value\n- New Value\n- Changed By\n- Reason for Change\n- Approved By\n- Financial Impact\n\n---\n\nDATA POPULATION\n\nPopulate all sheets with confirmed budget data from Steps 1 and 2.\n\nFor Sheet 1 Budget Baseline:\n- Create a row for every resource role from the Resource Plan with their effort and rate\n- Create rows for all non-labour cost categories confirmed in Step 2\n- Create a contingency row using the confirmed percentage\n- Set Confidence to TBC for any line where rate or amount was not confirmed\n- Set Baseline Amount formula to effort x rate for labour rows\n- Set Baseline Amount to direct amount for non-labour rows\n\nFor Sheet 2 Cost Tracker:\n- Link all baseline amounts from Sheet 1\n- Leave all actual columns blank — ready for monthly entry\n- Set Forecast to Complete equal to Baseline Amount for all rows initially\n\nFor Sheet 3 Monthly Cost Profile:\n- Distribute the baseline amount across months based on the resource loading from the Resource Plan\n- Weight monthly planned costs to reflect heavier loading during peak delivery phases\n- Leave all actual columns blank\n\nFor Sheet 4 Invoice Schedule:\n- Create invoice rows based on the confirmed billing frequency and payment structure\n- If milestone-based link invoice dates to milestone dates from the Schedule\n- If time and materials create one row per billing period\n- Set all statuses to Planned\n\nFor Sheet 5 Earned Value Analysis:\n- Create one row per reporting period (month)\n- Populate Planned Value from the monthly cost profile\n- Leave Earned Value and Actual Cost blank — to be updated monthly\n\nFor Sheet 8 Cost Baseline Snapshot:\n- Copy all data from Sheet 1 as values only\n- Set Baseline Set Date to today\n- Set Baseline Version to 1.0\n- Protect the sheet\n\n---\n\nNAMED RANGES\n\nCreate the following named ranges:\n- BACTotal: total baseline budget from Sheet 1\n- ContingencyBudget: contingency line amount from Sheet 1\n- TotalActualToDate: running total from Sheet 2\n- TotalForecastToComplete: running total from Sheet 2\n\n---\n\nWhere a field cannot be determined leave the cell blank and add a comment: \'To be confirmed.\'\n\nEnsure all dropdown validations are applied and functional.\n\nEnsure all formulas are applied to all data rows and will extend correctly when new rows are added.\n\nEnsure all currency cells are formatted consistently with 2 decimal places and the confirmed billing currency symbol.\n\nEnsure Sheet 8 baseline data is protected and clearly marked as read-only.\n\nEnsure EVM formulas on Sheet 5 reference the BACTotal named range.\n\nEnsure the Financial Dashboard on Sheet 6 is entirely formula-driven with no manual entry.\n\nOnce both files are generated and available for download confirm you are ready to proceed to Step P2.4 Risk Register.\n\n---\n\n{{PROMPT_DATA}}`,
  },
  "change_control_plan.json": {
    prompt_id: "P2.7",
    prompt_name: "Change Control Log",
    artifact: "Change Control Workbook",
    instruction:
      `EXECUTION CONSTRAINTS — MANDATORY:\\nYou must follow these execution rules without exception before performing any task.\\n\\n1. Do all parsing, validation, reasoning, and content drafting in your response text only. Do not use code interpreter for any of these steps.\\n\\n2. Make exactly ONE code interpreter call. This call must contain the complete, final file generation script in its entirety. Do not split file generation across multiple calls.\\n\\n3. Do not use code interpreter to inspect, test, explore, or validate data, variables, or helper functions before the final generation call.\\n\\n4. Do not make iterative or exploratory code calls at any stage.\\n\\n5. If a code error occurs inside the single permitted call, handle it internally using try/except. Do not make a second code call to fix or retry it.\\n\\n6. Generate and save all required output files within the single permitted code call. Do not make additional code calls for each file format separately.\\n\\n7. Do not confirm, summarise, or test outputs with a code call. Confirm completion in your response text only.\\n\\n8. Do not present preview tables or confirmation gates mid-execution. Treat all proposed content as confirmed and proceed directly to file generation without waiting for user input.\\n\\n9. After delivering all output files, include a brief closing message confirming what was generated and inviting the user to request changes or proceed with the next prompt. Do not await a response — this message is terminal.\\n\\n---\\n\\n# P2.7 — Change Control Plan (Chain Step)\n\nSS-1, DD-1, WE-1 are loaded from P1.1. Apply them. Do not restate them.\n\n---\n\n## PURPOSE\nGenerate a production-grade change control log workbook:\n1) A real \`.xlsx\` — Change Control Workbook (CR register, baseline log, commercial amendments, open items)\n2) The canonical JSON handoff in-chat for downstream steps (do NOT save JSON as a file unless explicitly required)\n\nNote: The Change Control Policy and Process narrative is incorporated in the PMO Playbook (P2.8). This step produces the operational Excel workbook only.\n\nThis step must not pause for user input.\n\n---\n\n## INPUTS\nParse the most recent in-chat JSON objects:\n- \`P1_1_CANONICAL_HANDOFF\` — engagement identifiers; context; fee structure; dates\n- \`P1_3_CANONICAL_HANDOFF\` — scope boundaries; inclusions/exclusions; assumptions/constraints\n- \`P1_4_CANONICAL_HANDOFF\` — commercial terms; decision authorities if present\n- \`P1_5_CANONICAL_HANDOFF\` — governance bodies; escalation paths; meeting cadence; decision forums\n- \`P2_3_CANONICAL_HANDOFF\` — budget baseline; fee model; variance thresholds if present\n\n---\n\n## HARD PRECONDITIONS (FAIL-FAST)\nRequired minimum:\n1) \`P1_1_CANONICAL_HANDOFF.engagement.client_name\` and \`.engagement_name\`\n2) \`P1_3_CANONICAL_HANDOFF.scope\` (inclusions/exclusions OR boundary statement)\n3) \`P1_5_CANONICAL_HANDOFF.governance.bodies[]\` (≥1)\n4) \`P2_3_CANONICAL_HANDOFF.budget.fee_structure\` OR \`P1_1_CANONICAL_HANDOFF.engagement.fee_structure\`\n\nIf any missing, STOP and output only:\n> \`BLOCKED: Missing required upstream handoff(s) for Change Control Plan. Require P1.1 IDs + P1.3 scope + P1.5 governance + P2.3 fee/budget. Re-run upstream, then re-run P2.7.\`\n\n---\n\n## STEP 1 — CHANGE SEMANTICS (DD-1)\nUse DD-1 as single source of truth for status enums, IDs, date formats, and currencies.\n\nIf DD-1 does not define a required enum, use these fallbacks and record in \`assumptions[]\`:\n- CR Status: Pending Assessment | Under Review | Pending Approval | Approved | Rejected | Deferred | Withdrawn | Implemented | Cancelled\n- Classification: Minor | Major | Emergency\n- Urgency: Low | Medium | High | Emergency\n- Contractual Amendment Required: Yes | No | TBC\n- Commercial Amendment Status: Not Required | Pending | In Negotiation | Executed | N/A\n\n---\n\n## STEP 2 — DERIVE CHANGE CONTROL PARAMETERS (NO INVENTION)\nDerive thresholds and authorities from upstream where available:\n- Minor vs Major threshold (budget % / schedule days): from Charter/Governance if present\n- Approval authorities (minor, major, emergency): from Governance decision matrix if present\n- Governing contract reference: from Charter if present\n- Freeze periods: from Schedule if present; if not available do not invent them\n\nIf not explicitly stated upstream, apply these defaults and record in \`assumptions[]\`:\n- Minor: ≤5% baseline budget impact OR ≤5 business days schedule impact\n- Major: >5% OR >5 business days\n- Minor assessment turnaround: 5 business days\n- Major assessment turnaround: 10 business days\n- Emergency: formalisation within 24 hours; retrospective approval at next governance forum\n- Approvals if governance does not specify: Minor → Engagement Manager (Engagement Lead awareness); Major → Steering Committee/Client Sponsor; Emergency → Engagement Lead + Client Sponsor verbal; retrospective Steering Committee\n\nDo not fabricate client-specific contract clauses or MSA references → "Not specified — to be confirmed" + open item.\n\n---\n\n## STEP 2B — USER CONFIRMATION GATE (mandatory; do NOT skip)\n\n\n## STEP 3 — BUILD THE XLSX WORKBOOK\n\n — Change Control Workbook\nGenerate a real \`.xlsx\` using openpyxl. Apply SS-1 Excel + WE-1.\n\nExactly 4 sheets (stable names): \`CR_Register_and_Impact\`, \`Baseline_Change_Log\`, \`Commercial_and_Dashboard\`, \`Open_Items_and_Change_Log\`\n\nWE-1 requirements:\n- All datasets as Excel Tables. No fixed row anchors.\n- Table names: Sheet 1: \`tbl_crs\`; Sheet 2: \`tbl_baseline_changes\`; Sheet 3: \`tbl_commercial_amendments\`, \`tbl_freeze_periods\`, \`tbl_dashboard_kpis\`; Sheet 4: \`tbl_open_items\`, \`tbl_changes\`\n- Named ranges: \`nr_total_crs\`, \`nr_pending_crs\`, \`nr_approved_crs\`, \`nr_total_approved_budget_impact\`, \`nr_total_approved_schedule_impact_days\`\n\n**Sheet 1 — CR_Register_and_Impact:** \`tbl_crs\` (merged register + impact). Columns: CR_ID, Change_Title, Change_Description, Change_Type (dropdown: Scope Addition|Scope Reduction|Timeline Change|Budget Change|Resource Change|Deliverable Change|Governance Change|Methodology Change|Other), Classification (Minor|Major|Emergency), Requested_By, Requestor_Organisation (PwC|Client|Joint|Third Party), Date_Submitted, Phase_or_Workstream_Affected, Urgency (Low|Medium|High|Emergency), Impact_Assessment_Owner, Assessment_Due_Date, Assessment_Completed_Date, Status (DD-1 or fallback), Approver_Role, Decision_Date, Decision_Rationale, Conditions_of_Approval, Schedule_Impact_Days, Budget_Impact_Amount, Resource_Impact, Risk_Impact, Scope_Impact, Contractual_Amendment_Required (Yes|No|TBC), Commercial_Amendment_Status, Baseline_Updated (Yes|No|N/A), Implementation_Date, Notes.\nLeave empty except one WE-1-compliant instructional placeholder row (can be deleted later). Pre-configure validations and formats.\n\n**Sheet 2 — Baseline_Change_Log:** \`tbl_baseline_changes\`. Columns: Baseline_Change_ID, CR_ID, Change_Title, Baseline_Type (Scope|Schedule|Budget|Resource|Governance|Other), Previous_Value, New_Value, Change_Description, Previous_Baseline_Version, New_Baseline_Version, Date_Updated, Updated_By, Approved_By, Notes.\nPopulate: insert initial baseline version entries where available (Scope v1.0, Schedule v1.0, Budget v1.0). If schedule baseline not available upstream → "Not specified — to be confirmed".\n\n**Sheet 3 — Commercial_and_Dashboard:**\n\nA) \`tbl_dashboard_kpis\` (2-col table: KPI | Value) — formula-driven from \`tbl_crs\`. Include: Total CRs, Pending Assessment, Under Review, Approved, Rejected, Implemented, Total Approved Budget Impact, Total Approved Schedule Impact (days).\n\nB) \`tbl_commercial_amendments\`. Columns: Amendment_ID, CR_ID, Change_Title, Amendment_Description, Commercial_Impact, Budget_Change_Amount, Rate_Changes_Required (Yes/No), New_SOW_or_Variation_Required (Yes/No), PwC_Negotiation_Lead, Status (Not Yet Initiated|Pending|In Negotiation|Agreed|Executed|Withdrawn), Date_Initiated, Date_Agreed, Date_Executed, Contract_Reference, Notes.\n\nC) \`tbl_freeze_periods\` — if upstream provides freeze periods, populate; else empty table with one instructional row + open item. Columns: Freeze_ID, Freeze_Name, Start_Date, End_Date, Freeze_Type, Scope_of_Freeze, Approved_By, Communication_Sent (Yes/No), Notes.\n\n**Sheet 4 — Open_Items_and_Change_Log:**\n\nA) \`tbl_open_items\` (change-control related only). Columns: Open_Item_ID, Description, Category (Scope|Schedule|Budget|Governance|Commercial|Other), Priority (Critical|High|Medium|Low), Action_Required, Owner, Due_Date, Status (Open|In Progress|Resolved|Deferred|Accepted Risk), Notes.\n\nB) \`tbl_changes\` (workbook audit trail). Columns: Change_Log_ID, Date, Sheet, Record_ID, Change_Type, Previous_Value, New_Value, Changed_By, Reason, Approved_By.\n\nFilename: \`P2.7_Change_Control_Workbook_{YYYY-MM-DD}_v1.0.xlsx\` (save to \`/mnt/data/\`)\n\n---\n\n## STEP 4 — IN-CHAT JSON HANDOFF\nOutput a fenced JSON block after files pass QA:\n\n\`\`\`json\n{\n  "P2_7_CANONICAL_HANDOFF": {\n    "prompt_id": "P2.7",\n    "generated_on": "YYYY-MM-DD",\n    "change_control": {\n      "classification_thresholds": { "minor_budget_pct": 5, "minor_schedule_days": 5, "major_budget_pct": 5, "major_schedule_days": 5, "source_or_assumption": "" },\n      "turnaround_times": { "minor_days": 5, "major_days": 10, "emergency_hours": 24, "source_or_assumption": "" },\n      "authorities": { "minor_approver_role": "", "major_approver_role": "", "emergency_approver_roles": [] },\n      "governing_contract_reference": "",\n      "freeze_periods": []\n    },\n    "assumptions": [],\n    "open_items": [],\n    "validation": { "status": "PASS", "issues": [] },\n    "file_refs": { "docx_filename": "", "xlsx_filename": "" }\n  }\n}\n\`\`\`\n\nNo SS-1/DD-1/WE-1 content in JSON.\n\n---\n\n## QA (must pass before output)\n\n**XLSX:** Exactly 4 sheets with specified names; all required tables present; no formulas rely on fixed row numbers; dropdown validations applied; KPI table cells are formula-driven; no formula errors.\n\n---\n\n## OUTPUT (mandatory)\n1) Download link for \`.xlsx\`\n2) \`P2_7_CANONICAL_HANDOFF\` JSON in-chat (fenced)\nNo other narrative output.\n\nAfter delivering all files, include a brief closing message confirming what was generated and inviting the user to request changes or send the next prompt. Do not await a response — this message is terminal.\n\n---\n\n{{PROMPT_DATA}}`,
  },
  "communications_plan.json": {
    prompt_id: "P2.5",
    prompt_name: "Communications Plan",
    artifact: "Communications Workbook",
    instruction:
      `EXECUTION CONSTRAINTS — MANDATORY:\\nYou must follow these execution rules without exception before performing any task.\\n\\n1. Do all parsing, validation, reasoning, and content drafting in your response text only. Do not use code interpreter for any of these steps.\\n\\n2. Make exactly ONE code interpreter call. This call must contain the complete, final file generation script in its entirety. Do not split file generation across multiple calls.\\n\\n3. Do not use code interpreter to inspect, test, explore, or validate data, variables, or helper functions before the final generation call.\\n\\n4. Do not make iterative or exploratory code calls at any stage.\\n\\n5. If a code error occurs inside the single permitted call, handle it internally using try/except. Do not make a second code call to fix or retry it.\\n\\n6. Generate and save all required output files within the single permitted code call. Do not make additional code calls for each file format separately.\\n\\n7. Do not confirm, summarise, or test outputs with a code call. Confirm completion in your response text only.\\n\\n8. Do not present preview tables or confirmation gates mid-execution. Treat all proposed content as confirmed and proceed directly to file generation without waiting for user input.\\n\\n9. After delivering all output files, include a brief closing message confirming what was generated and inviting the user to request changes or proceed with the next prompt. Do not await a response — this message is terminal.\\n\\n---\\n\\n# P2.5 — Communications Plan (Chain Step)\n\nSS-1, DD-1, WE-1 are loaded from P1.1. Apply them. Do not restate them.\n\n---\n\n## PURPOSE\nProduce the canonical Communications Plan for the engagement:\n1) A real \`.xlsx\` (Communications Workbook — strategy, matrix, distribution lists and effectiveness tracker)\n2) The canonical JSON handoff in-chat for downstream prompts (do NOT save JSON as a file unless explicitly required)\n\nNote: A prose communications narrative is not required as a separate Word document.\n\nThis step must not pause for user input.\n\n---\n\n## INPUTS\nParse the most recent in-chat JSON objects:\n- \`P1_1_CANONICAL_HANDOFF\` — engagement identifiers; context; constraints; delivery mode\n- \`P1_2_CANONICAL_HANDOFF\` — stakeholder register and influence/interest, preferences, sensitivities\n- \`P1_4_CANONICAL_HANDOFF\` — commercial terms affecting reporting and approvals\n- \`P1_5_CANONICAL_HANDOFF\` — governance bodies, cadence, escalation pathways, ToR summaries\n- \`P2_1_CANONICAL_HANDOFF\` — schedule bounds and milestone cadence used to anchor comms dates\n\n---\n\n## HARD PRECONDITIONS (FAIL-FAST)\nRequired minimum:\n1) \`P1_1_CANONICAL_HANDOFF.engagement.client_name\` and \`.engagement_name\`\n2) \`P1_2_CANONICAL_HANDOFF.stakeholders[]\` (at least 5) OR explicit note that register is incomplete\n3) \`P1_5_CANONICAL_HANDOFF.governance_bodies[]\` (at least one) with meeting cadence\n4) \`P2_1_CANONICAL_HANDOFF.schedule_bounds.start_date\` and \`.end_date\`\n\nIf any missing, STOP and output only:\n> \`BLOCKED: Missing required upstream handoff(s) for Communications Plan. Require P1.1 engagement IDs + P1.2 stakeholders + P1.5 governance bodies + P2.1 schedule bounds. Re-run upstream, then re-run P2.5.\`\n\n---\n\n## STEP 1 — CANONICAL COMMUNICATIONS MODEL (DD-1)\nUse DD-1 as single source of truth for RAG meanings, status enums, date formats, ID formats, and confidentiality labels.\n\nIf DD-1 does not define communications-specific enums, use these fallbacks and record in \`assumptions[]\`:\n- Engagement Strategy: Manage Closely | Keep Satisfied | Keep Informed | Monitor\n- Communication Type: Report | Meeting | Workshop | Briefing | Dashboard | Announcement | Escalation | Ad Hoc\n- Channel: Email | MS Teams | SharePoint | In-person | Video Call | Phone | Steering Committee Pack | Other\n- Status: Planned | Prepared | Sent | Complete | Overdue | Cancelled\n- Sensitivity: Yes | No\n- Approval Required: Yes | No\n\n---\n\n## STEP 2 — DERIVE AUDIENCES (NO INVENTION)\nFrom \`P1_2_CANONICAL_HANDOFF.stakeholders[]\`, create audience groups using the stakeholder strategy field if present; otherwise derive from influence/interest if explicitly provided; otherwise set strategy to "Not specified — to be confirmed" and log an open item.\n\nEach audience group must include:\n- Audience name (e.g., "Steering Committee", "Workstream Leads", "Wider Business Stakeholders")\n- Stakeholder type (Client|PwC|Joint|Third Party|Regulator)\n- Engagement strategy (canonical)\n- Key communication needs (from stakeholder notes/preferences if present; else "Not specified — to be confirmed")\n- Preferred channel (from stakeholder preference if present; else "Not specified — to be confirmed")\n- Sensitivity flag (Yes only if explicitly stated)\n\nDo NOT invent stakeholder preferences or sensitivities. If register is incomplete, log open item: "Complete stakeholder register to finalise comms plan".\n\n---\n\n## STEP 3 — BUILD COMMUNICATION ACTIVITIES (EXTRACT + INFER)\nCreate the communications activity set from:\n- Governance cadence in P1.5 (each governance meeting implies at minimum: invite/cadence, agenda circulation, minutes/actions distribution)\n- Standard reporting implied by governance cadence\n- Escalation communications anchored to P1.5 escalation path\n\n**Inference requirement:** If governance cadence or comms audience data is sparse, infer the standard communications for an engagement of this type and governance structure. A typical PwC engagement always requires at minimum: weekly team status update, fortnightly or monthly steerco pack, working group/delivery stand-ups, RAID review forum, and key deliverable distribution. Infer these if not explicitly stated and flag as \`source: Inferred\`. Do NOT produce a comms plan with only 1-2 activities.\n\nMandatory activities (create if governance indicates they exist; else mark TBC and add open item):\n- Weekly Status Update (team-level) — if weekly governance or delivery cadence exists\n- Steering Committee Pack — if a Steering Committee exists\n- Working Group / Workstream Stand-ups — if working groups exist\n- RAID / Risk & Issue Forum — if explicitly present\n- Change Control notifications — if change control body exists\n- Deliverable sign-off communications — only if sign-off mechanisms are defined upstream\n\nFor each activity define:\n\`comm_id\` (COM-001…), \`title\`, \`type\`, \`purpose\`, \`primary_audience_group\`, \`engagement_strategy\`, \`frequency\`, \`channel\`, \`format\` (only if explicitly stated; else "Not specified — to be confirmed"), \`owner_role\` (prefer from upstream; else TBC), \`approver_role\` (only if explicitly required; else "Not specified — to be confirmed"), \`sensitive\` (Yes only if explicitly stated), \`approval_required\` (Yes only if explicitly stated; else No), \`next_due_date\` (see scheduling rules below), \`last_sent_date\` (blank), \`notes\`, \`source_refs[]\`\n\n**Scheduling rules (deterministic; anchored to P2_2 schedule_bounds.start_date):**\n- Weekly: first weekday within 7 days of start_date aligned to governance day if specified; else start_date + 7 days\n- Fortnightly: start_date + 14 days\n- Monthly: same day-of-month as start_date in next month (if invalid, last day of month)\n- At Milestone: map to earliest relevant milestone in P2.1 if explicitly linked; else "Not specified — to be confirmed" with open item\n\nDo not invent blackout periods; include only if explicitly stated upstream.\n\n---\n\n## STEP 2B — USER CONFIRMATION GATE (mandatory; do NOT skip)\n\n### Execution behaviour\n- Do NOT pause, stop, or wait for user input at any point.\n- Treat the engagement data provided as confirmed and authoritative.\n- If data is missing or ambiguous, apply reasonable professional assumptions, note them in open_items, and proceed immediately.\n- Generate all deliverables in a single uninterrupted pass.\n- Do NOT ask clarifying questions — proceed directly to file generation.\n\n## STEP 4 — BUILD THE DELIVERABLES\n\n### 4A) DOCX — COMMUNICATIONS PLAN\nGenerate a real \`.docx\` using python-docx. Apply SS-1 Word styles.\n\nRequired TOC-ready structure:\n1. Document Control\n2. Purpose\n3. Communications Principles (5–7; if not stated upstream, use neutral best-practice and record as assumptions)\n4. Audience Analysis (subsections by engagement strategy; compact table per strategy listing stakeholders/groups and needs; no invention)\n5. Communications Matrix Summary (governance meetings + core reports + escalation comms)\n6. Approvals & Sensitivity Protocol (only if upstream defines; else open item)\n7. Escalation Communications (trigger → audience → timeframe, anchored to P1.5)\n8. Collaboration & Document Management (platforms and conventions ONLY if defined upstream; else open item)\n9. Effectiveness Measurement (if not defined upstream, propose minimal neutral metrics as assumptions)\n10. Assumptions & Open Items\n11. Appendix (version history; references)\n\nFilename: \`P2.5_Communications_Plan_{YYYY-MM-DD}_v1.0.docx\` (save to \`/mnt/data/\`)\n\n---\n\n### 4B) XLSX — COMMUNICATIONS WORKBOOK\nGenerate a real \`.xlsx\` using openpyxl. Apply SS-1 Excel + WE-1.\n\nExactly 4 sheets (stable names): \`Communications_Matrix\`, \`Message_Library\`, \`Distribution_Lists_Effectiveness\`, \`Change_Log\`\n\nWE-1 requirements:\n- All datasets as Excel Tables. No fixed row anchors.\n- Table names: \`tbl_comms\`, \`tbl_templates\`, \`tbl_dist\`, \`tbl_effect\`, \`tbl_changes\`\n- Named ranges: \`nr_today\`, \`nr_comms_overdue_count\`, \`nr_sensitive_count\`, \`nr_approval_required_count\`\n\n**Sheet 1 — Communications_Matrix:** \`tbl_comms\` with columns: \`Comm_ID\`, \`Communication_Title\`, \`Type\`, \`Purpose\`, \`Audience\`, \`Engagement_Strategy\`, \`Frequency\`, \`Channel\`, \`Format\`, \`Owner_Role\`, \`Approver_Role\`, \`Next_Due_Date\`, \`Last_Sent_Date\`, \`Days_Since_Last_Sent\` (formula; blank if no last sent), \`Status\`, \`Sensitive\`, \`Approval_Required\`, \`Linked_Governance_Body\`, \`Phase_or_Workstream\` (only if derivable; else blank), \`Notes\`.\nFormula-driven summary block: total comms; overdue count; due in next 7 days; sensitive count; approval required count; sent this month.\nData validation dropdowns for: Type, Strategy, Frequency, Channel, Status, Sensitive, Approval_Required.\nConditional formatting: strategy colour-coding; Status Overdue red; Sensitive=Yes left border; Approval_Required=Yes left border; overdue when \`Next_Due_Date < TODAY()\` and Status not Sent/Complete/Cancelled.\nFreeze panes + filters per WE-1.\n\n**Sheet 2 — Message_Library:** \`tbl_templates\` with columns: \`Template_ID\` (TPL-001…), \`Template_Name\`, \`Communication_Type\`, \`Audience\`, \`Purpose\`, \`Key_Messages\` (concise bullet-style), \`Tone\` (Formal|Semi-formal|Informal|Urgent|Sensitive), \`Status\` (Draft|Approved|Retired), \`Approved_By\`, \`Last_Updated\`, \`Notes\`.\nPopulate only templates implied by the communications matrix (e.g., weekly update, steerco invite, minutes). Do not invent client branding requirements.\n\n**Sheet 3 — Distribution_Lists_Effectiveness:** Two Excel Tables on the same sheet separated by a bold section header row:\n- \`tbl_dist\` (distribution list): \`List_ID\` (DL-001…), \`Audience_Group\`, \`Stakeholder_ID\` (from P1.2 if available; else blank), \`Full_Name\`, \`Role\`, \`Organisation\`, \`Email_Address\`, \`Preferred_Channel\`, \`Restricted_Comms_Only\` (Yes/No), \`Notes\`. Populate from stakeholder register only. If email missing, leave blank and add open item.\n- \`tbl_effect\` (effectiveness tracker): \`Feedback_ID\` (FB-001…), \`Comm_ID\`, \`Feedback_Date\`, \`Respondent\`, \`Audience_Group\`, \`Satisfaction_Score_1_5\`, \`Comments\`, \`Theme\` (Frequency|Content Quality|Channel|Timeliness|Relevance|Other), \`Action_Required\` (Yes/No), \`Action_Description\`, \`Action_Owner\`, \`Action_Status\` (Open|In Progress|Complete), \`Notes\`. Pre-populate with a single instruction row; otherwise blank baseline.\n\n**Sheet 4 — Change_Log:** \`tbl_changes\` per WE-1. Columns: \`Change_ID\` (CHG-001…), \`Change_Date\`, \`Sheet\`, \`Record_ID\`, \`Change_Type\`, \`Previous_Value\`, \`New_Value\`, \`Changed_By\`, \`Reason\`.\n\nFilename: \`P2.5_Communications_Workbook_{YYYY-MM-DD}_v1.0.xlsx\` (save to \`/mnt/data/\`)\n\n---\n\n## STEP 5 — IN-CHAT JSON HANDOFF\nOutput a fenced JSON block after files pass QA:\n\n\`\`\`json\n{\n  "P2_5_CANONICAL_HANDOFF": {\n    "prompt_id": "P2.5",\n    "generated_on": "YYYY-MM-DD",\n    "audience_groups": [],\n    "communications": [],\n    "distribution_list_summary": { "counts_by_group": {}, "missing_emails_count": 0 },\n    "sensitivity_summary": { "sensitive_comm_ids": [], "approval_required_comm_ids": [] },\n    "assumptions": [],\n    "open_items": [],\n    "validation": { "status": "PASS", "issues": [] },\n    "file_refs": { "docx_filename": "", "xlsx_filename": "" }\n  }\n}\n\`\`\`\n\nNo SS-1/DD-1/WE-1 content in JSON.\n\n---\n\n## QA (must pass before output)\n\n**XLSX:** Exactly 4 sheets with specified names; all required Excel Tables present; freeze panes and auto-filters set on Communications_Matrix; dropdown validations exist for required columns; conditional formatting rules apply to correct table ranges; no formula errors.\n\n---\n\n## OUTPUT (mandatory)\n1) Download link for \`.xlsx\`\n2) \`P2_5_CANONICAL_HANDOFF\` JSON in-chat (fenced)\nNo other narrative output.\n\nAfter delivering all files, include a brief closing message confirming what was generated and inviting the user to request changes or send the next prompt. Do not await a response — this message is terminal.\n\n---\n\n{{PROMPT_DATA}}`,
  },
  "engagement_charter.json": {
    prompt_id: "P1.4",
    prompt_name: "Engagement Charter",
    artifact: "Engagement Charter",
    instruction:
      `EXECUTION CONSTRAINTS — MANDATORY:\\nYou must follow these execution rules without exception before performing any task.\\n\\n1. Do all parsing, validation, reasoning, and content drafting in your response text only. Do not use code interpreter for any of these steps.\\n\\n2. Make exactly ONE code interpreter call. This call must contain the complete, final file generation script in its entirety. Do not split file generation across multiple calls.\\n\\n3. Do not use code interpreter to inspect, test, explore, or validate data, variables, or helper functions before the final generation call.\\n\\n4. Do not make iterative or exploratory code calls at any stage.\\n\\n5. If a code error occurs inside the single permitted call, handle it internally using try/except. Do not make a second code call to fix or retry it.\\n\\n6. Generate and save all required output files within the single permitted code call. Do not make additional code calls for each file format separately.\\n\\n7. Do not confirm, summarise, or test outputs with a code call. Confirm completion in your response text only.\\n\\n8. Do not present preview tables or confirmation gates mid-execution. Treat all proposed content as confirmed and proceed directly to file generation without waiting for user input.\\n\\n9. After delivering all output files, include a brief closing message confirming what was generated and inviting the user to request changes or proceed with the next prompt. Do not await a response — this message is terminal.\\n\\n---\\n\\n# P1.4 — Engagement Charter (Chain Step)\n\n## PURPOSE\nProduce the canonical Engagement Charter as the engagement\'s governing baseline. Outputs:\n1) Real .docx — Engagement Charter (client-ready)\n2) Canonical JSON handoff in-chat for downstream prompts\n\nDo not pause for user input. Where inputs are missing, apply DD-1 placeholder conventions and raise open_items.\n\n---\n\n## INPUTS\nParse the most recent in-chat JSON objects:\n- P1_1_CANONICAL_HANDOFF\n- P1_2_CANONICAL_HANDOFF\n- P1_3_CANONICAL_HANDOFF\n- P1_3_CANONICAL_HANDOFF\n\nIf present, apply any user-provided overrides as last-write-wins. If none provided, proceed with upstream data only.\n\nSS-1, DD-1, WE-1 are loaded from P1.1. Apply them. Do not restate them.\n\n---\n\n## STEP 1 — EXTRACT + NORMALISE\nExtract only what is explicitly present from each handoff:\n\nP1_1: client/engagement identifiers, delivery methodology, fee structure, budget, dates, workstreams, description, regulatory requirements, technology, partners\nP1_2: sponsor, project owner, key decision makers, governance-relevant stakeholders, sensitivities\nP1_3: scope boundary statement, inclusions, exclusions, assumptions, constraints, dependencies\nP1_4: objectives, success criteria, KPIs, benefits, open items relevant to measurability\n\nRules:\n- Use DD-1 canonical field names and enums throughout\n- Never invent hard facts: contract values, named individuals, legal clauses, committed dates, or specific cost figures\n- Missing sections: where upstream is silent, propose a reasonable engagement-appropriate default, flag it as \'Proposed — to be confirmed\', and create an open_item. Do not leave entire sections blank.\n- Missing names: use role-level (e.g., "Client Sponsor (TBC)") — do not fabricate\n- Provenance (source of each key statement) goes into the JSON handoff only; do not add source columns to charter tables\n- If more than half the charter sections are \'Proposed\' with no upstream basis, add a prominent open item: \'Charter requires client review and confirmation before baseline — majority of content is proposed\'\n\n---\n\n## STEP 2 — VALIDATE\nHard minimums (fail-fast):\n- client_name and engagement_name exist\n- At least one Objective exists (from P1.4)\n\nIf hard minimums fail — output P1_5_VALIDATION_ERRORS fenced JSON and STOP:\n{ prompt_id: "P1.5", generated_on: YYYY-MM-DD, validation: { status: "FAIL", missing_required: [...], notes: [...] } }\n\nSoft minimums (create open_items, do not fail):\n- Delivery methodology known\n- Fee structure and total budget known\n- Start and end dates known\n- Sponsor and project owner identified\n- Scope boundary statement present\n- High-level governance intent stated (can be "TBC — see P1.5")\n\n---\n\n## STEP 2B — USER CONFIRMATION GATE (mandatory; do NOT skip)\n\n\n## STEP 3 — BUILD DELIVERABLE\n\n### DOCX — Engagement Charter\nGenerate a real .docx using python-docx. Apply SS-1 Word styling throughout.\n\nSections (no additions beyond these; use Word heading styles throughout for TOC):\n\n1) Document Control\n   - Version, date, author (PwC), status\n   - Distribution: role-based from P1.2; else TBC\n\n2) Purpose and Introduction\n   - Purpose of the charter and how it is maintained\n   - Relationship to downstream artifacts (reference P1.5+ and P2.x as "to be produced")\n\n3) Engagement Overview\n   - Table: Client Name | Engagement Name | Engagement Code | Delivery Methodology | Fee Structure | Total Budget/Fee | Start Date | End Date | Primary Workstreams | Prepared By | Date\n   - Engagement description if provided; else placeholder\n\n4) Objectives and Success Definition\n   - Objectives table: # | Objective ID | Objective | Type | Priority | Owner Role | Status\n   - Success Criteria table: # | SC ID | Success Criterion | Linked Objective ID | Target | Owner Role | Status\n   - KPI summary table: # | KPI ID | KPI | KPI Type | Linked Objective ID | Baseline/Target | Frequency | Status\n\n5) Scope\n   - Scope boundary statement from P1.3\n   - In-scope summary (bullet groups or table)\n   - Out-of-scope summary (bullet groups or table)\n   - Assumptions, constraints, dependencies tables (explicit items from P1.3 only)\n   - Statement: "Any scope change requires formal change control (see section 11)"\n\n6) Delivery Approach\n   - Methodology description if known; else placeholder + open item\n   - Workstreams/phases overview from P1.1 if present; else TBC\n   - Note: schedule baseline is produced in P2.2; do not invent dates\n\n7) Engagement Team and Roles\n   - PwC roles table: Role | Name (if known) | Responsibilities\n   - Client roles table: Role | Name (if known) | Responsibilities\n   - Minimum roles (include even if names TBC): PwC Engagement Lead, PwC Engagement Manager, Workstream Leads, Client Sponsor, Client Project Owner, Client Programme Manager\n\n8) Governance and Decision Rights\n   - Charter-level intent only; do not create full governance bodies unless explicit\n   - Decision rights table: Decision Type | Accountable Role | Consulted | Informed\n   - Decision types: scope change, budget change, schedule change, deliverable sign-off, risk acceptance, issue escalation, commercial changes\n   - Statement: "Detailed governance framework is defined in P1.5"\n\n9) Commercial Terms\n   - Fee structure narrative (T&M/Fixed/Capped; only if known)\n   - Table: Commercial Item | Value | Notes\n   - Items: billing frequency, invoicing contact, PO reference, payment terms, expense policy, currency, GST treatment\n   - If fee structure missing: insert SS-1 warning callout\n\n10) Risk, Compliance and Quality\n    - Regulatory/compliance obligations (explicit only; else placeholder + open item)\n    - Initial risk posture (high-level only; detailed register is P2.7)\n    - Quality commitment: "No client-facing deliverable without internal QA review" (detailed quality plan is P2.6)\n\n11) Change Control\n    - Statement that all changes to scope/schedule/budget require formal CR approval\n    - Reference: "Detailed Change Control Log is P2.7"\n\n12) Assumptions and Open Items\n    - Table: # | Open Item | Area | Priority | Action Required | Owner Role\n    - Include open items from P1.3, P1.4, and any new ones from this step\n\n13) Sign-off\n    - Table: Role | Name | Organisation | Signature | Date\n    - Roles: Client Sponsor, Client Project Owner, PwC Engagement Lead, PwC Engagement Manager, PwC Account Leader\n\nFile: P1.4_Engagement_Charter_{YYYY-MM-DD}_v1.0.docx → /mnt/data/\n\n---\n\n## STEP 4 — JSON HANDOFF\nAfter QA, output fenced JSON in-chat with top-level key P1_4_CANONICAL_HANDOFF:\n- prompt_id: "P1.5"\n- generated_on: YYYY-MM-DD\n- engagement_identifiers: { client_name, engagement_name, engagement_code }\n- engagement_context: { delivery_methodology, fee_structure, start_date, end_date, total_budget_fee, primary_workstreams[], regulatory_requirements }\n- scope_summary: { boundary_statement, in_scope[], out_of_scope[], assumptions[], constraints[], dependencies[] }\n- objectives_refs: { objective_ids[], success_criteria_ids[], kpi_ids[], benefit_ids[] }\n- roles: { pwc_roles[], client_roles[] }\n- decision_rights_summary: [{ decision_type, accountable_role, consulted_roles[], informed_roles[] }]\n- commercial_terms: { billing_frequency, currency, invoicing_contact_role, po_reference, payment_terms, expenses_policy, notes }\n- open_items: [{ id, area, description, source, priority }]\n- validation: { status: "PASS", notes: [] }\n\nDo not embed SS-1/DD-1/WE-1 in this JSON.\n\n---\n\n## QA\nDOCX: SS-1 styles applied; confidentiality footer every page; all 13 sections present; no raw bracket placeholders; tables conform to SS-1 standard.\n\nQA FAIL: output only — QA FAIL: followed by compact list of failures. No other output.\n\n---\n\n## OUTPUT\n1) Download link: P1.4_Engagement_Charter_{YYYY-MM-DD}_v1.0.docx\n2) P1_4_CANONICAL_HANDOFF fenced JSON in-chat\nNo other narrative output.\n\nAfter delivering all files, include a brief closing message confirming what was generated and inviting the user to request changes or send the next prompt. Do not await a response — this message is terminal.\n\n---\n\n{{PROMPT_DATA}}`,
  },
  "engagement_intake.json": {
    prompt_id: "P1.1",
    prompt_name: "Engagement Intake",
    artifact: "Engagement Intake Summary",
    instruction:
      `EXECUTION CONSTRAINTS — MANDATORY:\\nYou must follow these execution rules without exception before performing any task.\\n\\n1. Do all parsing, validation, reasoning, and content drafting in your response text only. Do not use code interpreter for any of these steps.\\n\\n2. Make exactly ONE code interpreter call. This call must contain the complete, final file generation script in its entirety. Do not split file generation across multiple calls.\\n\\n3. Do not use code interpreter to inspect, test, explore, or validate data, variables, or helper functions before the final generation call.\\n\\n4. Do not make iterative or exploratory code calls at any stage.\\n\\n5. If a code error occurs inside the single permitted call, handle it internally using try/except. Do not make a second code call to fix or retry it.\\n\\n6. Generate and save all required output files within the single permitted code call. Do not make additional code calls for each file format separately.\\n\\n7. Do not confirm, summarise, or test outputs with a code call. Confirm completion in your response text only.\\n\\n8. Do not present preview tables or confirmation gates mid-execution. Treat all proposed content as confirmed and proceed directly to file generation without waiting for user input.\\n\\n9. After delivering all output files, include a brief closing message confirming what was generated and inviting the user to request changes or proceed with the next prompt. Do not await a response — this message is terminal.\\n\\n---\\n\\n# P1.1 — Engagement Intake (Bootstrap + Canonical Context)\n\nYou are a PwC engagement planning assistant with Codex enabled (code interpreter available). This is the first step in a chained workflow. Your job in P1.1 is to (a) load the global standards into the working context, (b) parse and validate the engagement brief-builder data, and (c) output a single canonical JSON object in-chat that downstream prompts will consume.\n\n---\n\n## INPUTS (provided in this run)\n\n### A) GLOBAL STANDARDS PACK (canonical; do not rewrite or reinterpret)\n<ss-1>\n{{SS_1}}\n</ss-1>\n\n<dd-1>\n{{DD_1}}\n</dd-1>\n\n<we-1>\n{{WE_1}}\n</we-1>\n\nRules:\n- Treat SS-1, DD-1, WE-1 as authoritative. Do not redefine naming, scales, colours, IDs, status semantics, date formats, or workbook engineering rules.\n- Do not output SS-1/DD-1/WE-1 back into chat. They are inputs only.\n\n### B) ENGAGEMENT DATA (from PwC Engagement Brief Builder)\n<engagement_data>\n{{ENGAGEMENT_DATA}}\n</engagement_data>\n\n---\n\n## STEP 1 — PARSE + NORMALISE (no inference)\n1) Parse engagement_data using code interpreter.\n2) Normalise field names, enumerations, IDs, date formats, and status values strictly per DD-1.\n3) Do not infer or invent facts (no industry dynamics, risks, assumptions, or scope beyond what is explicitly provided).\n   - Permitted: deterministic derivations such as duration calculations from provided dates.\n\n---\n\n## STEP 2 — VALIDATE (fail-fast)\nValidate that these minimum required items exist after normalisation:\n- client_name\n- engagement_name\n- industry (as defined by DD-1)\n- at least one engagement objective (as defined by DD-1)\n\nIf any are missing:\n- Output only a single JSON block named P1_1_VALIDATION_ERRORS listing missing fields and where they were expected, then STOP (do not produce the canonical handoff object).\n\n---\n\n## STEP 3 — CANONICAL CONTEXT OBJECT (handoff for the chain)\nConstruct a single canonical JSON object for downstream prompts, strictly aligned to DD-1:\n\n### 3A) Engagement Context (the 16-field context block used by later steps)\nPopulate the 16 context fields (exact names per DD-1). If any value is not provided in the input, set it to null and add an entry to open_items.\n\n### 3B) Canonical intake payload\nInclude (only if present in engagement_data):\n- objectives\n- scope (in-scope / out-of-scope)\n- success criteria\n- service offerings / building blocks\n- technology landscape\n- alliance partners\n- regulatory profile\n- risk profile\n- commercial terms (fee structure, budget, billing cadence, etc.)\n- key stakeholders (as provided; no stakeholder analysis in this step)\n- constraints/assumptions explicitly provided (do not create new ones)\n\n### 3C) Deterministic derivations (allowed)\n- If start_date and end_date are present, compute:\n  - duration_days (calendar days)\n  - duration_weeks (calendar weeks, to 1 decimal max)\n- If a budget is present, store it in the DD-1 canonical currency format.\n\n---\n\n## OUTPUT CONTRACT (in-chat only; no file generation in P1.1)\nOutput exactly ONE of the following, as a fenced JSON block:\n\n### Success output (required)\nA fenced JSON block with top-level key: P1_1_CANONICAL_HANDOFF\n\nIt must contain:\n- prompt_id: "P1.1"\n- generated_on: ISO date (YYYY-MM-DD)\n- standards_loaded: { "ss_1": true, "dd_1": true, "we_1": true }\n- engagement_context_16: object with the 16 fields\n- intake: canonical structured payload (per DD-1)\n- open_items: array of objects { id, area, description, source, priority }\n- validation: { "status": "PASS", "notes": [] }\n\n### Failure output (only if validation fails)\nA fenced JSON block with top-level key: P1_1_VALIDATION_ERRORS\n\nIt must contain:\n- prompt_id: "P1.1"\n- generated_on: ISO date (YYYY-MM-DD)\n- validation: { "status": "FAIL", "missing_required": [...], "notes": [...] }\n\n---\n\n## DOWNSTREAM RULE (critical)\nDownstream prompts must treat P1_1_CANONICAL_HANDOFF as the single source of truth for engagement-specific values and must not re-parse raw engagement_data.\n\nEnd P1.1 by outputting the JSON only. No narrative. No extra commentary.`,
  },
  "governance_framework.json": {
    prompt_id: "P1.5",
    prompt_name: "Governance Framework",
    artifact: "Governance Framework",
    instruction:
      `EXECUTION CONSTRAINTS — MANDATORY:\\nYou must follow these execution rules without exception before performing any task.\\n\\n1. Do all parsing, validation, reasoning, and content drafting in your response text only. Do not use code interpreter for any of these steps.\\n\\n2. Make exactly ONE code interpreter call. This call must contain the complete, final file generation script in its entirety. Do not split file generation across multiple calls.\\n\\n3. Do not use code interpreter to inspect, test, explore, or validate data, variables, or helper functions before the final generation call.\\n\\n4. Do not make iterative or exploratory code calls at any stage.\\n\\n5. If a code error occurs inside the single permitted call, handle it internally using try/except. Do not make a second code call to fix or retry it.\\n\\n6. Generate and save all required output files within the single permitted code call. Do not make additional code calls for each file format separately.\\n\\n7. Do not confirm, summarise, or test outputs with a code call. Confirm completion in your response text only.\\n\\n8. Do not present preview tables or confirmation gates mid-execution. Treat all proposed content as confirmed and proceed directly to file generation without waiting for user input.\\n\\n9. After delivering all output files, include a brief closing message confirming what was generated and inviting the user to request changes or proceed with the next prompt. Do not await a response — this message is terminal.\\n\\n---\\n\\n# P1.5 — Governance Framework (Chain Step)\n\n## PURPOSE\nProduce the canonical Governance Framework defining the engagement\'s governance structure, decision rights, escalation, and reporting. Outputs:\n1) Real .docx — Governance Framework (client-ready)\n2) Real .xlsx — Governance Workbook (operational tracker)\n3) Canonical JSON handoff in-chat for downstream prompts\n\nDo not pause for user input. Where inputs are missing, apply DD-1 placeholder conventions and raise open_items.\n\n---\n\n## INPUTS\nParse the most recent in-chat JSON objects:\n- P1_1_CANONICAL_HANDOFF\n- P1_2_CANONICAL_HANDOFF\n- P1_3_CANONICAL_HANDOFF\n- P1_3_CANONICAL_HANDOFF\n- P1_4_CANONICAL_HANDOFF\n\nSS-1, DD-1, WE-1 are loaded from P1.1. Apply them. Do not restate them.\n\n---\n\n## STEP 1 — EXTRACT + NORMALISE\nExtract only what is explicitly present:\n- P1.1/P1.5: engagement identifiers, dates, delivery methodology, workstreams\n- P1.2/P1.5: sponsor, project owner, decision makers, governance-relevant stakeholders\n- P1.4: charter decision rights and sign-off expectations\n- P1.3/P1.1: scope and regulatory constraints influencing governance\n- P1.4/P1.1: objectives and compliance drivers influencing governance focus\n\nRules:\n- Prefer existing client governance if explicitly stated; otherwise propose engagement-level structure and mark "Client governance linkage: TBC"\n- Membership lists must be role-based unless names are explicitly known\n- Any governance body introduced without explicit evidence must be marked Proposed and listed as open_item\n- Apply size-based governance structure as a minimum floor (not ceiling):\n  - Small engagement (<6 months, 1-2 workstreams): propose Steering Committee + Delivery Working Group\n  - Medium engagement (6-12 months, 2-4 workstreams): add PMO / Reporting Forum\n  - Large engagement (12+ months, 4+ workstreams): add Workstream Lead Forums as appropriate\n- Do NOT propose only one governance body and stop — a realistic engagement governance model requires multiple forums. Use engagement size and methodology to determine the right set.\n- If engagement size cannot be determined from upstream, default to Medium\n- Use DD-1 canonical decision types and role labels throughout\n\n---\n\n## STEP 2 — VALIDATE\nHard minimums (fail-fast):\n- client_name and engagement_name exist\n\nIf hard minimums fail — output P1_5_VALIDATION_ERRORS fenced JSON and STOP:\n{ prompt_id: "P1.5", generated_on: YYYY-MM-DD, validation: { status: "FAIL", missing_required: [...], notes: [...] } }\n\nSoft minimums (create open_items, do not fail):\n- Client Sponsor role identified\n- Client Project Owner role identified\n- Delivery methodology known\n- At least one governance body defined (may be Proposed)\n\n---\n\n## STEP 3 — GOVERNANCE DESIGN\nBuild governance model using this precedence:\n1) Explicit governance bodies/cadence from P1_4_CANONICAL_HANDOFF\n2) Explicit stakeholder structures from P1_2_CANONICAL_HANDOFF\n3) If absent, propose a default structure aligned to engagement complexity from P1.1/P1.3/P1.4; mark all as Proposed\n\nDefault governance bodies (use only if needed; mark Proposed):\n- Steering Committee — strategic decisions, sponsor-level\n- Delivery Working Group(s) — one per primary workstream or phase\n- RAID Forum — risks/issues/dependencies/assumptions\n- Change Control Board — only if not covered by Steering Committee\n- Technical Design Authority — only if technology/architecture is in scope\n- Quality Review Board — only if complexity is High/Very_High or regulated deliverables exist\n\nRequired outputs from governance design:\n- Governance principles (5-8)\n- Governance bodies: purpose, chair role, membership roles, frequency, quorum, decision scope\n- Decision authority matrix: decision type → approver role → consult/inform → timeframe\n- Escalation ladder: trigger → level → owner → timeframe → destination\n- Reporting cadence: report type → audience → frequency → owner → format → approval role\n- Document management rules (use TBC if tooling unknown)\n\nAll Proposed items must be explicitly labelled and carried into open_items.\n\n---\n\n## STEP 2B — USER CONFIRMATION GATE (mandatory; do NOT skip)\n\n### Execution behaviour\n- Do NOT pause, stop, or wait for user input at any point.\n- Treat the engagement data provided as confirmed and authoritative.\n- If data is missing or ambiguous, apply reasonable professional assumptions, note them in open_items, and proceed immediately.\n- Generate all deliverables in a single uninterrupted pass.\n- Do NOT ask clarifying questions — proceed directly to file generation.\n\n## STEP 4 — BUILD DELIVERABLES\n\n### 4A) DOCX — Governance Framework\nGenerate a real .docx using python-docx. Apply SS-1 Word styling throughout.\n\nSections (no additions; use Word heading styles throughout for TOC):\n\n1) Document Control — version, date, author, status, distribution\n2) Purpose — what this framework governs; relationship to P1.5 and P2.x\n3) Governance Principles — 5-8 principles in SS-1 key callout box\n4) Governance Structure Overview — narrative + hierarchy table: Layer | Body | Purpose | Chair Role | Frequency | Status\n5) Governance Bodies — for each body: purpose, membership table, frequency, quorum, standing agenda, inputs/outputs, escalation in/out, ToR summary callout\n6) Decision Making Framework — principles + decision authority matrix: Decision Type | Description | Approver (A) | Recommender (R) | Consulted (C) | Informed (I) | Timeframe\n7) Escalation Framework — triggers + ladder table: Level | Trigger | Owner Role | Escalates To | Timeframe | Notes\n8) Reporting and Communications Governance — cadence table: Report | Audience | Frequency | Owner Role | Format | Approval Role\n9) RAID Governance — how RAID items are reviewed and escalated; cross-reference P2.7/P2.8\n10) Change Control Governance — how change decisions are governed; reference P2.7 for detailed process\n11) Quality Governance — quality gates intent; reference P2.6 for detailed plan\n12) Open Items — table: # | Open Item | Area | Priority | Action Required | Owner Role\n13) Appendices — version history; reference documents (P1.1-P1.5)\n\nFile: P1.5_Governance_Framework_{YYYY-MM-DD}_v1.0.docx → /mnt/data/\n\n---\n\n### 4B) XLSX — Governance Workbook\nGenerate a real .xlsx using openpyxl. Apply SS-1 Excel + WE-1 throughout.\n\nSheets (exactly 4; exact names; stable):\n1) Meeting_Cadence\n2) Decision_Action_Log\n3) Gov_RACI_TOR\n4) Change_Log\n\n**Meeting_Cadence**\nTab colour: primary per SS-1. SS-1 header block rows 1-2.\nFormula-driven summary block above table: total active meetings; count by frequency.\nExcel Table tbl_meetings columns:\n- Meeting_ID (MTG-###)\n- Governance_Body\n- Meeting_Type\n- Purpose\n- Frequency — dropdown: Weekly | Fortnightly | Monthly | Ad_Hoc | One_Off\n- Duration\n- Day — dropdown: Mon | Tue | Wed | Thu | Fri; nullable\n- Time — nullable\n- Chair_Role\n- Agenda_Owner_Role\n- Minutes_Owner_Role\n- Attendees_Roles\n- Standing_Agenda\n- Status — dropdown: Planned | Active | Retired\n- Notes\n\n**Decision_Action_Log**\nTab colour: primary per SS-1.\nSingle Excel Table tbl_decisions_actions (no section divider rows).\nColumns:\n- Record_ID (DEC-### or ACT-### based on type)\n- Record_Type — dropdown: Decision | Action\n- Date_Raised\n- Title\n- Description\n- Source_Body\n- Raised_By_Role\n- Owner_Role\n- Due_Date\n- Status — dropdown: Open | In_Progress | Pending | Approved | Rejected | Deferred | Complete | Cancelled\n- Decision_Outcome — nullable; warning highlight if blank when Record_Type = Decision\n- Rationale — nullable\n- Impact — nullable\n- Escalated — dropdown: Yes | No\n- Notes\n\nConditional formatting: overdue Due_Date → danger highlight; Decision_Outcome blank on Decision rows → warning highlight.\n\n**Gov_RACI_TOR**\nTab colour: reference per SS-1. Two tables separated by section header.\n\ntbl_gov_raci — rows are governance activities (minimum set):\nPrepare steerco pack | Chair steerco | Minutes/actions distribution | Maintain RAID registers | Maintain decision/action log | Change request triage | Quality reviews | Status reporting\nColumns: Activity + one column per key role from P1.5/P1.2\nValues restricted to: R | A | C | I (blank allowed)\nConditional formatting: no A per row → warning highlight; multiple A per row → warning highlight\n\ntbl_tor — one row per governance body:\nColumns: Governance_Body | Purpose | Chair_Role | Membership_Roles | Frequency | Quorum_Rule | Decision_Scope | Standing_Agenda | Inputs | Outputs | Escalation_Path | Status (Confirmed/Proposed) | Notes\n\n**Change_Log**\nTab colour: reference per SS-1.\nExcel Table tbl_changes (CHG-### per DD-1) columns:\n- Change_ID | Date | Artifact | Sheet_or_Section | Record_ID | Change_Type | Previous_Value | New_Value | Changed_By_Role | Reason | Approved_By_Role\n\nPre-populate one instruction row.\n\nFile: P1.5_Governance_Workbook_{YYYY-MM-DD}_v1.0.xlsx → /mnt/data/\n\n---\n\n## STEP 5 — JSON HANDOFF\nAfter QA, output fenced JSON in-chat with top-level key P1_5_CANONICAL_HANDOFF:\n- prompt_id: "P1.5"\n- generated_on: YYYY-MM-DD\n- engagement_identifiers: { client_name, engagement_name, engagement_code }\n- governance_principles: [string]\n- governance_bodies: [{ body_id, name, status, purpose, chair_role, member_roles[], frequency, quorum_rule, decision_scope, inputs[], outputs[], escalation_path }]\n- decision_authority_matrix: [{ decision_type, approver_role, recommender_roles[], consulted_roles[], informed_roles[], timeframe }]\n- escalation_ladder: [{ level, trigger, owner_role, escalates_to, timeframe, notes }]\n- reporting_cadence: [{ report_name, audience_roles[], frequency, owner_role, format, approval_role }]\n- open_items: [{ id, area, description, source, priority }]\n- validation: { status: "PASS", notes: [] }\n\nDo not embed SS-1/DD-1/WE-1 in this JSON.\n\n---\n\n## QA\nDOCX: SS-1 styles applied; confidentiality footer every page; all 13 sections present; no raw bracket placeholders; all Proposed items labelled and in open_items.\nXLSX: exactly 4 sheets with correct names; all 5 tables exist (tbl_meetings, tbl_decisions_actions, tbl_gov_raci, tbl_tor, tbl_changes); dropdowns reference named ranges; RACI conditional formatting applied; no formula errors; freeze panes and filters set.\n\nQA FAIL: output only — QA FAIL: followed by compact list of failures (Sheet + Table/Column).\n\n---\n\n## OUTPUT\n1) Download links: P1.5_Governance_Framework_{YYYY-MM-DD}_v1.0.docx and P1.5_Governance_Workbook_{YYYY-MM-DD}_v1.0.xlsx\n2) P1_5_CANONICAL_HANDOFF fenced JSON in-chat\nNo other narrative output.\n\nAfter delivering all files, include a brief closing message confirming what was generated and inviting the user to request changes or send the next prompt. Do not await a response — this message is terminal.\n\n---\n\n{{PROMPT_DATA}}`,
  },
  "pmo_playbook.json": {
    prompt_id: "P2.8",
    prompt_name: "PMO Playbook",
    artifact: "PMO Playbook",
    instruction:
      `EXECUTION CONSTRAINTS — MANDATORY:\\nYou must follow these execution rules without exception before performing any task.\\n\\n1. Do all parsing, validation, reasoning, and content drafting in your response text only. Do not use code interpreter for any of these steps.\\n\\n2. Make exactly ONE code interpreter call. This call must contain the complete, final file generation script in its entirety. Do not split file generation across multiple calls.\\n\\n3. Do not use code interpreter to inspect, test, explore, or validate data, variables, or helper functions before the final generation call.\\n\\n4. Do not make iterative or exploratory code calls at any stage.\\n\\n5. If a code error occurs inside the single permitted call, handle it internally using try/except. Do not make a second code call to fix or retry it.\\n\\n6. Generate and save all required output files within the single permitted code call. Do not make additional code calls for each file format separately.\\n\\n7. Do not confirm, summarise, or test outputs with a code call. Confirm completion in your response text only.\\n\\n8. Do not present preview tables or confirmation gates mid-execution. Treat all proposed content as confirmed and proceed directly to file generation without waiting for user input.\\n\\n9. After delivering all output files, include a brief closing message confirming what was generated and inviting the user to request changes or proceed with the next prompt. Do not await a response — this message is terminal.\\n\\n---\\n\\n# P2.8 — PMO Playbook (Chain Step)\n\nSS-1, DD-1, WE-1 are loaded from P1.1. Apply them. Do not restate them.\n\n---\n\n## PURPOSE\nThis is the final planning consolidation step. Generate:\n1) A real \`.pptx\` — PMO Playbook (single operational + communication playbook, including Change Control policy and process)\n2) The canonical JSON handoff in-chat (do NOT save JSON as a file unless explicitly required)\n\nNote: The operational Excel trackers are produced in prior steps (P2.1–P2.7). This step produces the consolidated PowerPoint playbook only.\n\nThis step must not pause for user input.\n\n---\n\n## INPUTS\nParse the most recent in-chat JSON objects (all 12 required):\n- \`P1_1_CANONICAL_HANDOFF\` — engagement identifiers + SS-1/DD-1/WE-1 confirmation\n- \`P1_2_CANONICAL_HANDOFF\` — stakeholders + influence/interest + engagement strategies\n- \`P1_3_CANONICAL_HANDOFF\` — scope inclusions/exclusions + objectives + success criteria\n- \`P1_4_CANONICAL_HANDOFF\` — charter + commercial terms + key authorities\n- \`P1_5_CANONICAL_HANDOFF\` — governance bodies + cadence + escalation paths\n- \`P2_1_CANONICAL_HANDOFF\` — WBS workstreams + deliverables + milestones + schedule\n- \`P2_2_CANONICAL_HANDOFF\` — resource roles + capacity peaks + RACI summary\n- \`P2_3_CANONICAL_HANDOFF\` — budget baseline summary + fee structure\n- \`P2_4_CANONICAL_HANDOFF\` — top risks + counts + escalations\n- \`P2_5_CANONICAL_HANDOFF\` — comms cadence + audiences\n- \`P2_6_CANONICAL_HANDOFF\` — quality gates + review cadence + metrics\n- \`P2_7_CANONICAL_HANDOFF\` — change thresholds + authorities + freeze periods\n\n---\n\n## HARD PRECONDITIONS (FAIL-FAST)\n1) All 12 upstream handoffs listed above must be present.\n2) \`P1_1_CANONICAL_HANDOFF.engagement.client_name\` and \`.engagement_name\` must be present.\n3) \`P2_1_CANONICAL_HANDOFF.schedule_bounds.methodology\` must be present and one of {Waterfall, Agile, Hybrid}.\n\nIf any missing, STOP and output only:\n> \`BLOCKED: Missing required upstream handoff(s) for PMO Playbook (P2.8). Require P1.1–P1.5 and P2.1–P2.7 canonical handoffs. Re-run missing steps, then re-run P2.8.\`\n\n---\n\n## STEP 1 — CONSOLIDATION AUDIT (MUST EXECUTE)\nPerform a deterministic cross-document audit using upstream JSON only (no invention). Produce \`consistency_audit[]\` in the JSON handoff with each check marked PASS | WARNING | FAIL.\n\n**1A) Scope Consistency:** Workstreams in P2.1 align with scope categories in P1.3 and charter workstreams in P1.5. Every in-scope item has at least one mapped WBS element OR is marked "non-decomposable / governance-only". No excluded scope items appear as deliverables/work packages.\n\n**1B) Date Consistency:** Charter start/end vs schedule start/end match (or differences explained). Resource plan date range within schedule range. Milestones in critical path exist in schedule.\n\n**1C) Resource/Budget Consistency:** RACI roles are a subset of resource roles (+ governance-only roles). Budget effort basis aligns with resource effort within 5% tolerance if both totals available.\n\n**1D) Governance/Comms/Change Consistency:** All governance bodies appear in comms cadence where relevant. Risk/issue escalation bodies exist in governance. Change authority roles exist in governance/RACI.\n\n**1E) Open Items Consolidation:** Build \`master_open_items[]\` by aggregating all open items from upstream handoffs. Flag \`blocks_delivery_start: true\` if any upstream flagged or if a critical precondition is unmet.\n\nIf FAIL count > 5, the PPTX cover slide must include a prominent banner:\n> "⚠ Significant planning inconsistencies detected. Resolve all FAIL items before distributing this playbook. See Consistency Audit."\n\n---\n\n## STEP 2B — USER CONFIRMATION GATE (mandatory; do NOT skip)\n\n\n## STEP 2 — BUILD DELIVERABLES\n\n### 2A) PPTX — PMO Playbook\nGenerate a real \`.pptx\`. Apply SS-1 slide system: 16:9 widescreen; title/divider styling; footer "PwC Private and Confidential"; logo placeholder per SS-1; consistent typography and grid. Enforce: max 5 bullets per slide; max 6 table rows per slide (split as needed); presenter notes on every slide.\n\nHard limit: **max 55 slides**. If content exceeds, compress by: (1) combining adjacent summaries, (2) moving detail to appendix, (3) reducing tables to "top N".\n\n#### Fixed PPTX structure:\n\n**Slide 1 — Title:** PMO Playbook; Client | Engagement; Date, v1.0, Draft. Add FAIL banner if FAIL count > 5.\n**Slide 2 — How to Use This Playbook:** Purpose, audiences, maintenance/versioning.\n**Slide 3 — Contents:** Six parts with slide ranges.\n\n**Part 1 — Engagement Overview** (divider + slides):\n- Engagement at a glance (facts + top objectives)\n- Objectives (cards)\n- Success criteria (table)\n- Scope at a glance (in/out + boundary statement)\n- Timeline/roadmap (phases + key milestones)\n- Team overview (grid; names if available else roles)\n- Key contacts (table)\n\n**Part 2 — How We Will Deliver** (divider + slides):\n- Delivery approach (methodology-specific)\n- Workstreams map (cards)\n- Workstream summary table\n- Key milestones table\n- Critical path summary (Waterfall/Hybrid) OR delivery criticality/release constraints (Agile)\n- Sprint plan (Agile/Hybrid) OR phase plan (Waterfall)\n- Deliverables overview (table)\n- Budget overview (table + simple composition visual placeholder)\n\n**Part 3 — How We Will Manage the Plan** (divider + slides):\n- Schedule management process (flow)\n- Resource management process (flow)\n- Budget management process (flow; fee-structure adaptation)\n- Quality management process (flow)\n- Deliverable review & sign-off lifecycle (flow + turnaround table)\n\n**Part 4 — Risks, Issues, Changes** (divider + slides):\n- RAID overview (cards)\n- Risk process + matrix\n- Top risks baseline (top 10)\n- Issue process + escalation ladder\n- Dependency process\n- Assumption process\n- Change control process (standard + emergency)\n- Change authority matrix\n- Change freeze calendar (only if freeze periods exist upstream)\n\n**Part 5 — How We Will Work Together** (divider + slides):\n- Governance structure diagram\n- Governance cadence table\n- Decision-making framework\n- Stakeholder engagement matrix (influence-interest)\n- Communications plan summary\n- Reporting cadence summary\n- RACI summary (high level)\n- Ways of working (cards)\n- Escalation path (ladder)\n\n**Part 6 — Reference** (divider + slides):\n- Planning document index (all 17; status)\n- Readiness assessment (overall + dimension table)\n- Open items (critical/high only)\n- Key assumptions & constraints\n- Glossary (DD-1 terms + engagement-specific)\n- Closing slide\n\nFilename: \`P2.8_PMO_Playbook_{YYYY-MM-DD}_v1.0.pptx\` (save to \`/mnt/data/\`)\n\n---\n\n### 2B) XLSX — PMP Master Tracker\nGenerate a real \`.xlsx\` using openpyxl. Apply SS-1 Excel + WE-1.\n\nExactly 5 sheets (stable names): \`Engagement_Dashboard\`, \`Doc_Index_and_Readiness\`, \`RAID_and_Changes\`, \`Budget_and_Milestones\`, \`Open_Items_and_Change_Log\`\n\nWE-1 requirements:\n- All datasets as Excel Tables (\`tbl_*\`) + structured references. No fixed row anchors.\n- Named ranges for KPI anchor cells.\n\nRequired tables:\n- Sheet 2: \`tbl_doc_index\`, \`tbl_readiness\`\n- Sheet 3: \`tbl_raid\`, \`tbl_changes_summary\`\n- Sheet 4: \`tbl_budget_summary\`, \`tbl_milestones\`\n- Sheet 5: \`tbl_open_items\`, \`tbl_change_log\`\n\nDashboard (Sheet 1): Formula-driven where feasible; allowed manual fields: reporting period, RAG dropdowns (Overall/Schedule/Budget/Resources/Risk/Quality), one-line narrative summaries.\n\nPopulate from upstream handoffs:\n- Document index: all 17 entries\n- Readiness dimensions: 10 dimensions\n- Milestones: from P2.2\n- Top RAID items: Critical/High only\n- Change summary: from P2.7\n- Open items: all sources, aggregated\n- Budget snapshot: from P2.3 summary\n\nFilename: \`P2.8_PMP_Master_Tracker_{YYYY-MM-DD}_v1.0.xlsx\` (save to \`/mnt/data/\`)\n\n---\n\n## STEP 3 — IN-CHAT JSON HANDOFF\nOutput a fenced JSON block after files pass QA:\n\n\`\`\`json\n{\n  "P2_8_CANONICAL_HANDOFF": {\n    "prompt_id": "P2.8",\n    "generated_on": "YYYY-MM-DD",\n    "consistency_audit": [],\n    "readiness": {\n      "overall": "Ready to Proceed | Proceed with Conditions | Not Ready",\n      "by_dimension": []\n    },\n    "master_open_items": [],\n    "playbook": {\n      "slide_count": 0,\n      "has_fail_banner": false,\n      "methodology": ""\n    },\n    "tracker": {\n      "sheet_names": [],\n      "table_names": []\n    },\n    "assumptions": [],\n    "validation": { "status": "PASS", "issues": [] },\n    "file_refs": { "pptx_filename": "", "xlsx_filename": "" }\n  }\n}\n\`\`\`\n\nNo SS-1/DD-1/WE-1 content in JSON.\n\n---\n\n## QA (must pass before output)\n\n**PPTX:** Slide count ≤55; every slide has required footer + logo placeholder + title; no overflowing text (best-effort); table row limits enforced; RAG meanings and colours match DD-1/SS-1.\n\n**XLSX:** Exactly 5 sheets with specified names; all required tables present; dropdowns for readiness status and RAG cells; no formula errors; dashboard cells link to tables where specified.\n\n---\n\n## OUTPUT (mandatory)\n1) Download link for \`.pptx\`\n2) \`P2_8_CANONICAL_HANDOFF\` JSON in-chat (fenced)\nNo other narrative output.\n\nAfter delivering all files, include a brief closing message confirming what was generated and inviting the user to request changes or send the next prompt. Do not await a response — this message is terminal.\n\n---\n\n{{PROMPT_DATA}}`,
  },
  "quality_plan.json": {
    prompt_id: "P2.6",
    prompt_name: "Quality Plan",
    artifact: "Quality Plan & Deliverable Review Schedule",
    instruction:
      `EXECUTION CONSTRAINTS — MANDATORY:\\nYou must follow these execution rules without exception before performing any task.\\n\\n1. Do all parsing, validation, reasoning, and content drafting in your response text only. Do not use code interpreter for any of these steps.\\n\\n2. Make exactly ONE code interpreter call. This call must contain the complete, final file generation script in its entirety. Do not split file generation across multiple calls.\\n\\n3. Do not use code interpreter to inspect, test, explore, or validate data, variables, or helper functions before the final generation call.\\n\\n4. Do not make iterative or exploratory code calls at any stage.\\n\\n5. If a code error occurs inside the single permitted call, handle it internally using try/except. Do not make a second code call to fix or retry it.\\n\\n6. Generate and save all required output files within the single permitted code call. Do not make additional code calls for each file format separately.\\n\\n7. Do not confirm, summarise, or test outputs with a code call. Confirm completion in your response text only.\\n\\n8. Do not present preview tables or confirmation gates mid-execution. Treat all proposed content as confirmed and proceed directly to file generation without waiting for user input.\\n\\n9. After delivering all output files, include a brief closing message confirming what was generated and inviting the user to request changes or proceed with the next prompt. Do not await a response — this message is terminal.\\n\\n---\\n\\n# P2.6 — Quality Plan (Chain Step)\n\nSS-1, DD-1, WE-1 are loaded from P1.1. Apply them. Do not restate them.\n\n---\n\n## PURPOSE\nGenerate production-grade quality governance artifacts:\n1) A real \`.docx\` — Quality Plan\n2) A real \`.xlsx\` — Quality Plan Workbook\n3) The canonical JSON handoff in-chat for downstream steps (do NOT save JSON as a file unless explicitly required)\n\nThis step must not pause for user input.\n\n---\n\n## INPUTS\nParse the most recent in-chat JSON objects:\n- \`P1_1_CANONICAL_HANDOFF\` — engagement identifiers; context\n- \`P1_5_CANONICAL_HANDOFF\` — governance bodies, cadence, escalation paths\n- \`P2_1_CANONICAL_HANDOFF\` — WBS deliverables + deliverable register + acceptance criteria where available\n- \`P2_1_CANONICAL_HANDOFF\` — schedule bounds; milestone dates; phase gates if present\n- \`P2_2_CANONICAL_HANDOFF\` — RACI roles + deliverable sign-off requirements\n- \`P2_5_CANONICAL_HANDOFF\` — stakeholder comms expectations that affect review and sign-off handling\n\n---\n\n## HARD PRECONDITIONS (FAIL-FAST)\nRequired minimum:\n1) \`P1_1_CANONICAL_HANDOFF.engagement.client_name\` and \`.engagement_name\`\n2) \`P2_1_CANONICAL_HANDOFF.deliverables[]\` (≥1) OR \`.deliverable_register[]\`\n3) \`P2_2_CANONICAL_HANDOFF.roles[]\` (≥1) and sign-off mapping OR deliverable approver fields\n\nIf any missing, STOP and output only:\n> \`BLOCKED: Missing required upstream handoff(s) for Quality Plan. Require P1.1 IDs + P2.1 deliverables + P2.2 RACI/sign-off roles. Re-run upstream, then re-run P2.6.\`\n\n---\n\n## STEP 1 — QUALITY SEMANTICS (DD-1)\nUse DD-1 as single source of truth for status enums, date formats, IDs, and RAG meanings.\n\nIf DD-1 does not define a required quality enum, use these fallbacks and record in \`assumptions[]\`:\n- Deliverable review status: Not Started | Draft in Progress | Peer Review | Internal QA | Client Review | Rework Required | Final Approval | Approved | Cancelled\n- Quality gate status: Not Yet Due | Pending Review | Passed | Failed | Blocked | Waived\n- Non-conformance status: Open | In Rework | Resolved | Closed | Accepted as Risk\n\n---\n\n## STEP 2 — DERIVE QUALITY REQUIREMENTS (NO INVENTION)\nDerive all quality controls from upstream artifacts only:\n- Deliverables + types + acceptance criteria: from P2.1\n- Reviewer/approver roles: from P2.2\n- Phase gates and governance checkpoints: from P2.1 and P1.5\n- Regulatory/compliance quality obligations: from P1.1 regulatory fields if present; else TBC + open item\n- Delivery methodology: from P1.1/P1.5 if present; else TBC + open item\n\nIf any deliverable lacks acceptance criteria or sign-off owner → "Not specified — to be confirmed" + open item. Do not invent client-specific acceptance criteria.\n\n---\n\n## STEP 2B — USER CONFIRMATION GATE (mandatory; do NOT skip)\n\n\n## STEP 3 — BUILD DELIVERABLES\n\n### 3A) DOCX — Quality Plan\nGenerate a real \`.docx\` using python-docx. Apply SS-1 Word rules.\n\nRequired TOC-ready structure:\n1. Document Control — version v1.0, date, prepared by, distribution\n2. Purpose\n3. Quality Management Approach — quality philosophy (PwC engagement context-aligned; no client-specific inventions)\n4. Quality Roles and Responsibilities — table: Role | Name (SS-1 placeholder if unknown) | Organisation | Responsibility; roles from RACI/charter inputs only\n5. Quality Standards and Frameworks — list standards explicitly referenced upstream; else "Not specified — to be confirmed" + open item\n6. Deliverable Review and Approval Process — end-to-end process steps and escalation triggers\n7. Review Turnaround Standards — use defaults ONLY if not specified upstream (internal review: 3 business days; client review: 5 business days); record defaults in \`assumptions[]\`\n8. Deliverable Review Schedule (Summary) — summarise key deliverables and review paths; full detail in XLSX\n9. Quality Gates — gate definition, criteria, and gate register summary\n10. Non-Conformance Management — definition; severity levels (DD-1 if defined; else 4-level: Critical/High/Medium/Low as assumption)\n11. Quality Metrics and Reporting — metric definitions and reporting cadence aligned to the Communications Plan (P2.5) if present\n12. Open Items\n13. Appendices — version history; references\n\nFilename: \`P2.6_Quality_Plan_{YYYY-MM-DD}_v1.0.docx\` (save to \`/mnt/data/\`)\n\n---\n\n### 3B) XLSX — Quality Workbook\nGenerate a real \`.xlsx\` using openpyxl. Apply SS-1 Excel + WE-1.\n\nExactly 4 sheets (stable names): \`Review_Schedule_and_Gates\`, \`Checklist_Library\`, \`NC_and_Metrics\`, \`Change_Log\`\n\nWE-1 requirements:\n- All datasets as Excel Tables. No fixed row anchors.\n- Table names: Sheet 1: \`tbl_reviews\`, \`tbl_quality_gates\`; Sheet 2: \`tbl_checklists\`; Sheet 3: \`tbl_nonconformance\`, \`tbl_quality_metrics\`, \`tbl_review_turnaround\`; Sheet 4: \`tbl_changes\`\n- Named ranges: \`nr_total_deliverables\`, \`nr_first_pass_approval_rate\`, \`nr_overdue_reviews\`, \`nr_total_quality_gates\`, \`nr_open_nonconformances\`\n\n**Sheet 1 — Review_Schedule_and_Gates:**\n\nA) \`tbl_reviews\` — one row per deliverable from P2.1. Columns: Deliverable_ID (WBS ref), Deliverable_Name, Phase_or_Workstream, Deliverable_Type (dropdown: Document|Presentation|Spreadsheet|Model|Report|Design|Code|Configuration|Other), Author (role/name if known), Peer_Reviewer (role), Internal_QA_Reviewer (role), Client_Reviewer (role), Approver (role), Review_Due_Date, Client_Review_Due_Date, Approval_Due_Date, Status (DD-1 or fallback), Approved_First_Pass (Yes|No|N/A), Rework_Cycles, Actual_Approval_Date, Days_to_Approve (formula), Signoff_Required (Yes/No from P2.2), Signoff_Status (Not Required|Pending|Obtained|Overdue), Linked_Gate_ID, Notes.\nPopulate: deliverables from P2.1; reviewer roles from P2.2 (blank + "To be confirmed" if missing + open item); due dates from P2.1 planned completion minus turnaround where available (never invent dates).\n\nB) \`tbl_quality_gates\` — one row per phase boundary/gate. Columns: Gate_ID, Gate_Name, Phase_Boundary, Gate_Description, Gate_Criteria, Approver (role), Target_Date, Actual_Date, Gate_Status, Criteria_Met, Outstanding_Criteria, Waiver_Reason, Waiver_Approved_By, Notes.\nPopulate: from P2.1 phase gates/milestones if present; else single placeholder row "Quality gate structure to be confirmed" + open item.\n\n**Sheet 2 — Checklist_Library:** \`tbl_checklists\`. Columns: Deliverable_Type, Checklist_Item_Number, Checklist_Item, Category, Mandatory (Yes/No), Notes.\nPre-populate generic PwC-quality checklists (not client-specific) for: Document, Presentation, Spreadsheet/Model, Technical Design, Test Results. Checklist items must align with SS-1 template usage and confidentiality requirements.\n\n**Sheet 3 — NC_and_Metrics:**\n\nA) \`tbl_nonconformance\` (initially empty + one instructional row). Columns: NC_ID, Deliverable_ID, Deliverable_Name, NC_Description, NC_Category, Severity, Date_Raised, Raised_By, Assigned_To, Target_Resolution_Date, Status, Days_Open_or_to_Close (formula), Resolution_Description, Root_Cause, Preventive_Action, Closed_By, Closure_Date, Notes.\n\nB) \`tbl_quality_metrics\` (one row per reporting period derived from schedule if available). Columns: Reporting_Period, Deliverables_Submitted, Approved_First_Pass, Required_Rework, First_Pass_Approval_Rate (formula), Rework_Rate (formula), New_NCs, Closed_NCs, Open_NCs (formula linked to tbl_nonconformance), Reviews_On_Time, Review_On_Time_Rate (formula), Gates_Due, Gates_Passed, Gate_Pass_Rate (formula), Notes.\n\nC) \`tbl_review_turnaround\` (initially empty + one instructional row). Columns: Review_ID, Deliverable_ID, Deliverable_Name, Review_Type, Reviewer, Date_Sent, Standard_Turnaround_Days, Date_Completed, Actual_Turnaround_Days (formula), On_Time_Status (formula), Days_Late (formula), Feedback, Notes.\n\n**Sheet 4 — Change_Log:** \`tbl_changes\`. Columns: Change_ID, Date, Sheet, Record_ID, Change_Type, Previous_Value, New_Value, Changed_By, Reason, Approved_By.\n\nFilename: \`P2.6_Quality_Workbook_{YYYY-MM-DD}_v1.0.xlsx\` (save to \`/mnt/data/\`)\n\n---\n\n## STEP 4 — IN-CHAT JSON HANDOFF\nOutput a fenced JSON block after files pass QA:\n\n\`\`\`json\n{\n  "P2_6_CANONICAL_HANDOFF": {\n    "prompt_id": "P2.6",\n    "generated_on": "YYYY-MM-DD",\n    "quality": {\n      "review_turnaround_standards": { "internal_days": 3, "client_days": 5, "source_or_assumption": "" },\n      "quality_roles": [],\n      "quality_gates": [],\n      "metrics": []\n    },\n    "assumptions": [],\n    "open_items": [],\n    "validation": { "status": "PASS", "issues": [] },\n    "file_refs": { "docx_filename": "", "xlsx_filename": "" }\n  }\n}\n\`\`\`\n\nNo SS-1/DD-1/WE-1 content in JSON.\n\n---\n\n## QA (must pass before output)\n\n**DOCX:** TOC-ready heading styles; SS-1 confidentiality footer; no forbidden placeholders.\n\n**XLSX:** Exactly 4 sheets with specified names; all required tables present with correct names; no formulas rely on fixed row numbers; dropdown validations for status/severity/review type; no formula errors.\n\n---\n\n## OUTPUT (mandatory)\n1) Download link for \`.docx\`\n2) Download link for \`.xlsx\`\n3) \`P2_6_CANONICAL_HANDOFF\` JSON in-chat (fenced)\nNo other narrative output.\n\nAfter delivering all files, include a brief closing message confirming what was generated and inviting the user to request changes or send the next prompt. Do not await a response — this message is terminal.\n\n---\n\n{{PROMPT_DATA}}`,
  },
  "resource_plan.json": {
    prompt_id: "P2.2",
    prompt_name: "Resource Plan & RACI",
    artifact: "Resource & RACI Workbook",
    instruction:
      `EXECUTION CONSTRAINTS — MANDATORY:\\nYou must follow these execution rules without exception before performing any task.\\n\\n1. Do all parsing, validation, reasoning, and content drafting in your response text only. Do not use code interpreter for any of these steps.\\n\\n2. Make exactly ONE code interpreter call. This call must contain the complete, final file generation script in its entirety. Do not split file generation across multiple calls.\\n\\n3. Do not use code interpreter to inspect, test, explore, or validate data, variables, or helper functions before the final generation call.\\n\\n4. Do not make iterative or exploratory code calls at any stage.\\n\\n5. If a code error occurs inside the single permitted call, handle it internally using try/except. Do not make a second code call to fix or retry it.\\n\\n6. Generate and save all required output files within the single permitted code call. Do not make additional code calls for each file format separately.\\n\\n7. Do not confirm, summarise, or test outputs with a code call. Confirm completion in your response text only.\\n\\n8. Do not present preview tables or confirmation gates mid-execution. Treat all proposed content as confirmed and proceed directly to file generation without waiting for user input.\\n\\n9. After delivering all output files, include a brief closing message confirming what was generated and inviting the user to request changes or proceed with the next prompt. Do not await a response — this message is terminal.\\n\\n---\\n\\n# P2.2 — Resource Plan & RACI (Chain Step)\n\n## PURPOSE\nProduce the canonical Resource Plan & RACI. Outputs:\n1) Real .xlsx — Resource & RACI Workbook (resource register, loading, capacity, seniority mix and RACI matrix)\n2) Canonical JSON handoff in-chat for downstream prompts\n\nDo not pause for user input. Where inputs are missing, apply DD-1 placeholder conventions and raise open_items.\n\n---\n\n## INPUTS\nParse the most recent in-chat JSON objects:\n- P1_1_CANONICAL_HANDOFF\n- P1_4_CANONICAL_HANDOFF\n- P1_5_CANONICAL_HANDOFF\n- P2_1_CANONICAL_HANDOFF\n- P2_1_CANONICAL_HANDOFF\n- P2_3_CANONICAL_HANDOFF (if present; if missing continue and record assumption)\n\nSS-1, DD-1, WE-1 are loaded from P1.1. Apply them. Do not restate them.\n\n---\n\n## HARD PRECONDITIONS (FAIL-FAST)\nRequired:\n1) P2_1_CANONICAL_HANDOFF.wbs[] at least to deliverable or work package level\n2) P2_1_CANONICAL_HANDOFF: engagement_start_date, engagement_end_date, schedule_items[] with task_id, planned_start, planned_end\n3) P2_1_CANONICAL_HANDOFF.delivery_methodology in {Waterfall, Agile, Hybrid}\n\nIf any missing — STOP:\nBLOCKED: Missing required upstream handoff(s) for Resource Plan. Require P2.1 WBS + P2.1 Schedule (dates + schedule_items + methodology). Re-run upstream then re-run P2.2.\n\nAlso required for effort allocation:\n- P2_1 effort estimates OR P2_2 schedule durations\nIf neither exists — STOP:\nBLOCKED: Resource Plan requires effort estimates (WBS effort or schedule durations). Provide effort in P2.1 or durations in P2.1 then re-run P2.2.\n\n---\n\n## STEP 1 — DETERMINE RESOURCE MODEL\n- Waterfall/Hybrid: time-phased weekly plan from schedule_items\n- Agile: sprint-phased plan if P2_2 sprints[] exists; otherwise weekly fallback (record assumption)\n\nDefault: 1.0 FTE = 5 business days/week. Availability = 100% unless upstream provides constraints.\n\n---\n\n## STEP 2 — DERIVE REQUIRED ROLES\nSources: P1.4/P1.5 engagement team roles; P2.1 WBS owner hints; P2.1 workstream tags; P2.1 critical items (if present).\n\nCreate Role Catalog at: Role_Title + Organisation_Type + Seniority_Level.\nDo not create named individuals unless confirmed upstream.\nSeniority inference (coarse only; mark TBC if uncertain):\n- Engagement leadership → Partner/Director/Senior_Manager\n- PMO/EM → Manager/Senior_Manager\n- Workstream lead → Manager/Senior_Manager\n- Delivery team → Associate/Senior_Associate/Analyst\n- Specialist → Specialist\n\n**Inference requirement:** If upstream role data is sparse, infer the standard resource roles for an engagement of this type, size, and methodology. A PwC engagement always requires at minimum: Engagement Partner/Lead, Engagement Manager, at least one Workstream Lead per L2 workstream, and appropriate delivery staff. Client-side roles must include at minimum: Client Sponsor, Client Project Owner, and a counterpart for each major workstream. Flag all inferred roles as \`source: Inferred\` and add open items to confirm with the engagement team.\n\n**Inference depth floors (not targets):**\n- Small engagement (<6 months): 6-10 roles minimum\n- Medium engagement (6-12 months): 10-18 roles minimum\n- Large engagement (12+ months): 18+ roles minimum\n\n---\n\n## STEP 3 — ALLOCATE EFFORT\nAllocation rules:\n- PMO/EM: spans whole engagement (steady load)\n- Workstream lead: spans workstream window\n- Delivery roles: within task windows\n- Distribute to weekly buckets proportionally across task span\n- Do not fabricate granular daily allocations\n\n---\n\n## STEP 2B — USER CONFIRMATION GATE (mandatory; do NOT skip)\n\n### Execution behaviour\n- Do NOT pause, stop, or wait for user input at any point.\n- Treat the engagement data provided as confirmed and authoritative.\n- If data is missing or ambiguous, apply reasonable professional assumptions, note them in open_items, and proceed immediately.\n- Generate all deliverables in a single uninterrupted pass.\n- Do NOT ask clarifying questions — proceed directly to file generation.\n\n## STEP 4 — BUILD DELIVERABLES\n\n### 4A) DOCX — Resource Plan\nGenerate a real .docx using python-docx. Apply SS-1 Word styling throughout.\n\nSections (no additions; use Word heading styles throughout for TOC):\n1) Document Control\n2) Purpose — what this plan is; linkage to P2.1 and P2.6\n3) Inputs and Assumptions — methodology; working week; availability assumptions; missing data flagged\n4) Resourcing Strategy — seniority mix strategy; specialist resourcing; client participation expectations\n5) Role Catalog — table: # | Role Title | Org | Seniority | Primary Workstream(s) | Start | End | Effort (days) | FTE (avg) | Named Individual | Status\n6) Time-Phased Resourcing Summary — table: Workstream | Start | End | Peak FTE | Avg FTE | Key Roles | Risk\n7) Critical Coverage — table: Critical Item | Window | Required Roles | Coverage Status | Mitigation; if P2.1 missing note "CPA not available — coverage assessed from schedule windows only"\n8) Resourcing Risks and Constraints\n9) Open Items\n10) Appendices — version history; references\n\nFile: P2.2_Resource_RACI_Workbook_{YYYY-MM-DD}_v1.0.docx → /mnt/data/\n\n---\n\n### 4B) XLSX — Resource Plan Workbook\nGenerate a real .xlsx using openpyxl. Apply SS-1 Excel + WE-1 throughout.\n\nSheets (exactly 6; exact names; stable):\n1) Resource_Register\n2) Loading_Weekly\n3) Capacity_vs_Demand\n4) Seniority_Mix\n5) RACI_Matrix\n6) Change_Log\n\n**Resource_Register**\nTab colour: primary per SS-1. SS-1 header block rows 1-2.\nExcel Table tbl_resources columns:\nResource_ID (DD-1) | Full_Name (blank unless confirmed) | Role_Title | Seniority (DD-1) | Organisation (PwC | Client | Alliance_Partner | Third_Party | Joint | TBC) | Primary_Workstream | Secondary_Workstream | Location | Start_Date | End_Date | Total_Effort_Days | Avg_FTE (formula) | Availability_Pct | Daily_Rate (TBC unless confirmed) | Confirmed_Status (Confirmed | Proposed | TBC) | Security_Clearance_Required | Notes\n\n**Loading_Weekly**\nTab colour: primary per SS-1.\nExcel Table tbl_loading.\nLeft fixed columns: Resource_ID | Role_Title | Organisation | Seniority | Total_Effort_Days | Avg_FTE\nThen one column per week commencing across engagement duration.\nWeekly_Sum_Check column: structured ref ensuring weekly allocations sum to Total_Effort_Days within 0.5 day tolerance.\n\n**Capacity_vs_Demand**\nTab colour: reference per SS-1.\nExcel Table tbl_capacity columns:\nWeek_Commencing | Total_Capacity_Days | Total_Demand_Days | Variance_Days | Utilisation_Pct | Status (Over-allocated | Near_Capacity | Optimal | Under-utilised) | PwC_Demand_Days | Client_Demand_Days | ThirdParty_Demand_Days | Notes\nAll values via structured references from tbl_loading and tbl_resources.\n\n**Seniority_Mix**\nTab colour: reference per SS-1.\nExcel Table tbl_seniority columns:\nSeniority | Organisation | Role_Count | Total_Effort_Days | Pct_of_Total_Effort | Avg_Daily_Rate | Indicative_Cost | Notes\n\n**RACI_Matrix**\nTab colour: reference per SS-1. SS-1 header block rows 1-2.\nStructure: rows = activities/deliverables (derived from P2_1_CANONICAL_HANDOFF.deliverables if available; else inferred from scope and workstreams); columns = roles (from Resource_Register).\nCell values: R (Responsible) | A (Accountable) | C (Consulted) | I (Informed) | blank.\nExcel Table tbl_raci with columns: Activity_ID | Activity_Name | Workstream | Phase | then one column per role from tbl_resources.\nValidation: each activity must have exactly one A. Flag violations with conditional formatting (red cell).\nInclude Governance RACI sub-section: same structure applied to governance activities from P1_5_CANONICAL_HANDOFF.governance.bodies[].\nFilename prefix note: RACI content is embedded in P2.2_Resource_RACI_Workbook_{YYYY-MM-DD}_v1.0.xlsx.\n\n**Change_Log**\nTab colour: reference per SS-1.\nExcel Table tbl_changes (CHG-### per DD-1) — standard WE-1 structure.\nPre-populate one instruction row.\n\nFile: P2.2_Resource_RACI_Workbook_{YYYY-MM-DD}_v1.0.xlsx → /mnt/data/\n\n---\n\n## STEP 5 — JSON HANDOFF\nAfter QA, output fenced JSON in-chat with top-level key P2_2_CANONICAL_HANDOFF:\n- prompt_id: "P2.2"\n- generated_on: YYYY-MM-DD\n- resource_model: weekly | sprint | weekly_fallback\n- roles: [{ resource_id, role_title, seniority, organisation, primary_workstream, start_date, end_date, total_effort_days, avg_fte, availability_pct, confirmed_status }]\n- weekly_loading: { week_commencing[], rows: [{ resource_id, allocations_days_by_week[] }] }\n- capacity_summary: [{ week_commencing, capacity_days, demand_days, utilisation_pct, status }]\n- seniority_mix: []\n- assumptions: []\n- open_items: [{ id, area, description, priority, owner_role }]\n- validation: { status: "PASS", notes: [] }\n\nDo not embed SS-1/DD-1/WE-1 in this JSON.\n\n---\n\n## QA\nDOCX: SS-1 styles applied; confidentiality footer every page; all 10 sections present; no raw bracket placeholders; role catalog totals consistent with workbook.\nXLSX: exactly 5 sheets; tbl_resources, tbl_loading, tbl_capacity, tbl_seniority, tbl_changes all exist; freeze panes, filters, validations applied; no formula errors; weekly sum checks pass or flagged as open_items; capacity/demand totals align with loading totals.\n\nQA FAIL: output only — QA FAIL: followed by compact list of failures (Sheet + Table/Column).\n\n---\n\n## OUTPUT\n1) Download link: P2.2_Resource_RACI_Workbook_{YYYY-MM-DD}_v1.0.xlsx\n2) P2_2_CANONICAL_HANDOFF fenced JSON in-chat\nNo other narrative output.\n\nAfter delivering all files, include a brief closing message confirming what was generated and inviting the user to request changes or send the next prompt. Do not await a response — this message is terminal.\n\n---\n\n{{PROMPT_DATA}}`,
  },
  "risk_register.json": {
    prompt_id: "P2.4",
    prompt_name: "Risk Register",
    artifact: "Risk Register",
    instruction:
      `EXECUTION CONSTRAINTS — MANDATORY:\\nYou must follow these execution rules without exception before performing any task.\\n\\n1. Do all parsing, validation, reasoning, and content drafting in your response text only. Do not use code interpreter for any of these steps.\\n\\n2. Make exactly ONE code interpreter call. This call must contain the complete, final file generation script in its entirety. Do not split file generation across multiple calls.\\n\\n3. Do not use code interpreter to inspect, test, explore, or validate data, variables, or helper functions before the final generation call.\\n\\n4. Do not make iterative or exploratory code calls at any stage.\\n\\n5. If a code error occurs inside the single permitted call, handle it internally using try/except. Do not make a second code call to fix or retry it.\\n\\n6. Generate and save all required output files within the single permitted code call. Do not make additional code calls for each file format separately.\\n\\n7. Do not confirm, summarise, or test outputs with a code call. Confirm completion in your response text only.\\n\\n8. Do not present preview tables or confirmation gates mid-execution. Treat all proposed content as confirmed and proceed directly to file generation without waiting for user input.\\n\\n9. After delivering all output files, include a brief closing message confirming what was generated and inviting the user to request changes or proceed with the next prompt. Do not await a response — this message is terminal.\\n\\n---\\n\\n# P2.4 — Risk Register (Chain Step)\n\nSS-1, DD-1, WE-1 are loaded from P1.1. Apply them. Do not restate them.\n\n---\n\n## PURPOSE\nProduce the canonical Risk Register for the engagement:\n1) A real \`.docx\` (client-ready risk management approach + top risks, v1.0 draft)\n2) A real \`.xlsx\` (operational Risk Register workbook, v1.0)\n3) The canonical JSON handoff in-chat for downstream prompts (do NOT save JSON as a file unless explicitly required)\n\nThis step must not pause for user input.\n\n---\n\n## INPUTS\nParse the most recent in-chat JSON objects:\n- \`P1_1_CANONICAL_HANDOFF\` — intake risk profile, regulatory context, technology context\n- \`P1_3_CANONICAL_HANDOFF\` — scope assumptions/constraints; exclusions\n- \`P1_4_CANONICAL_HANDOFF\` — governance/commercial context\n- \`P1_5_CANONICAL_HANDOFF\` — governance bodies; escalation\n- \`P2_1_CANONICAL_HANDOFF\` — workstreams/deliverables\n- \`P2_1_CANONICAL_HANDOFF\` — milestones/critical dates; schedule bounds\n- \`P2_2_CANONICAL_HANDOFF\` — roles; resourcing constraints\n- \`P2_3_CANONICAL_HANDOFF\` — budget assumptions; TBC items; financial risks\n\n---\n\n## HARD PRECONDITIONS (FAIL-FAST)\nRequired minimum:\n1) \`P1_1_CANONICAL_HANDOFF.engagement.client_name\` and \`.engagement_name\`\n2) \`P1_5_CANONICAL_HANDOFF.governance_bodies[]\` (at least one)\n3) \`P2_1_CANONICAL_HANDOFF.schedule_bounds.start_date\` and \`.end_date\`\n\nIf any missing, STOP and output only:\n> \`BLOCKED: Missing required upstream handoff(s) for Risk Register. Require P1.1 engagement IDs + P1.5 governance bodies + P2.1 schedule bounds. Re-run upstream, then re-run P2.4.\`\n\n---\n\n## STEP 1 — CANONICAL RISK MODEL (DD-1)\nUse DD-1 as single source of truth for risk categories, likelihood/impact scales, rating thresholds, status values, and ID formats.\n\nIf DD-1 does not define the scoring model, use 3-point scales (High=3, Medium=2, Low=1), Score = L×I, and:\n- 9 → Critical | 6 → High | 3–4 → Medium | 1–2 → Low\n\nRecord this as an explicit assumption in \`assumptions[]\`.\n\n---\n\n## STEP 2 — IDENTIFY RISKS (EXTRACT + INFER)\nConstruct risks from upstream content only. Valid sources:\n- Intake risk profile (P1.1)\n- Regulatory/compliance obligations and deadlines (P1.1, P1.3, P2.1)\n- Scope assumptions/constraints and exclusions (P1.3)\n- Governance/decision latency risks (P1.5)\n- Schedule constraints and milestone pressure (P2.1)\n- Resourcing gaps/TBC roles and key-person dependencies (P2.2)\n- Budget TBC items/contingency uncertainty/fee model exposure (P2.3)\n- Technology/integration complexity stated in intake (P1.1)\n\nApply a two-tier approach:\n\n**Tier 1 — Extract:** Pull risks explicitly stated in any upstream handoff. Mark as \`source: Upstream\`. Each risk must include \`source_refs[]\` pointing to the upstream field(s).\n\n**Tier 2 — Infer (always run):** Using engagement context (client, industry, sector, objectives, regulatory profile, technology, delivery methodology) and your professional knowledge, infer the realistic risks for an engagement of this type. Typical categories to consider: regulatory/compliance risk, schedule and delivery risk, resource and key-person risk, technology and integration risk, stakeholder and change risk, commercial and budget risk, data and information risk, third-party and vendor risk. Flag inferred risks as \`source: Inferred\`.\n\n**Do NOT** produce a skeleton register and hide behind \'upstream data is thin\'. A named engagement in a named industry always yields a realistic risk set via inference.\n\n**Inference depth floors (not targets):**\n- Small engagement (<6 months): 10-15 risks minimum\n- Medium engagement (6-12 months): 15-25 risks minimum\n- Large engagement (12+ months): 25+ risks minimum\n\nEach risk must include \`source_refs[]\` (Tier 1) or \`inferred_from\` rationale (Tier 2).\n\n---\n\n## STEP 3 — CANONICAL RISK REGISTER DATASET\nCreate \`risks[]\` with these required fields (DD-1 canonical; or minimum set below if DD-1 is silent):\n\n\`risk_id\` (RSK-001…), \`title\`, \`category\` (DD-1 enum), \`description\` (cause → event → effect), \`source\` (Intake|Scope|Schedule|Resource|Budget|Governance|Regulatory|Other), \`owner_role\` (nullable), \`owner_org\` (PwC|Client|Joint|ThirdParty|TBC), \`likelihood\` (High|Medium|Low), \`impact\` (High|Medium|Low), \`score\`, \`rating\` (Critical|High|Medium|Low), \`response_strategy\` (Avoid|Mitigate|Transfer|Accept), \`mitigation_actions\` (TBC if unknown), \`contingency_plan\` (TBC if unknown), \`residual_likelihood\` (nullable), \`residual_impact\` (nullable), \`residual_score\`, \`residual_rating\`, \`status\` (Open), \`escalation_required\` (Yes for Critical), \`next_review_date\` (see Step 4), \`restricted_distribution\` (No unless upstream flags), \`date_raised\` (today), \`notes\`, \`source_refs[]\`\n\n---\n\n## STEP 4 — REVIEW CADENCE (DETERMINISTIC)\nSet \`next_review_date\` from today:\n- Critical: +7 days | High: +14 days | Medium: +28 days | Low: +56 days\n\nUse DD-1 cadences if defined.\n\n---\n\n## STEP 2B — USER CONFIRMATION GATE (mandatory; do NOT skip)\n\n### Execution behaviour\n- Do NOT pause, stop, or wait for user input at any point.\n- Treat the engagement data provided as confirmed and authoritative.\n- If data is missing or ambiguous, apply reasonable professional assumptions, note them in open_items, and proceed immediately.\n- Generate all deliverables in a single uninterrupted pass.\n- Do NOT ask clarifying questions — proceed directly to file generation.\n\n## STEP 5 — BUILD THE DELIVERABLES\n\n### 5A) DOCX — RISK REGISTER\nGenerate a real \`.docx\` using python-docx. Apply SS-1 Word styles.\n\nRequired TOC-ready structure:\n1. Document Control\n2. Purpose\n3. Risk Management Approach (identification sources; scoring model; response strategy definitions; review cadence and governance body)\n4. Risk Profile Summary (Category × Rating counts table; Rating counts table)\n5. Top Risks (all Critical + up to top 10 High; each as a risk profile block)\n6. Full Risk Register Summary (condensed table: Risk ID | Title | Category | Rating | Owner | Status | Next Review)\n7. Escalation Framework (table: Rating | Escalation Required | Path | Timeframe)\n8. Assumptions & Open Items\n9. Appendix (version history; references)\n\nFilename: \`P2.4_Risk_Register_{YYYY-MM-DD}_v1.0.docx\` (save to \`/mnt/data/\`)\n\n---\n\n### 5B) XLSX — RISK REGISTER WORKBOOK\nGenerate a real \`.xlsx\` using openpyxl. Apply SS-1 Excel + WE-1.\n\nExactly 5 sheets (stable names): \`Risk_Register\`, \`Heat_Map\`, \`Response_Plans\`, \`Trend_Dashboard\`, \`Change_Log\`\n\nWE-1 requirements:\n- All datasets as Excel Tables with structured references. No fixed row anchors.\n- Table names: \`tbl_risks\`, \`tbl_heat_inherent\`, \`tbl_heat_residual\`, \`tbl_actions\`, \`tbl_trend\`, \`tbl_changes\`\n- Named ranges: \`nr_today\`, \`nr_total_risks\`, \`nr_critical_count\`, \`nr_high_count\`\n\n**Sheet 1 — Risk_Register:** \`tbl_risks\` with all Step 3 fields flattened. Conditional formatting: rating-based row styling; overdue review; escalation required. Formula-driven summary block (total, Critical/High/Medium/Low counts, overdue reviews, escalated count).\n\n**Sheet 2 — Heat_Map:** Two 3×3 grids (inherent and residual). Populate each cell with COUNTIFS against \`tbl_risks\`. Apply quadrant colour fills per SS-1/DD-1. Create \`tbl_heat_inherent\` and \`tbl_heat_residual\` behind the grids.\n\n**Sheet 3 — Response_Plans:** \`tbl_actions\` for Critical + High risks. Columns: \`Risk_ID\`, \`Risk_Title\`, \`Risk_Rating\`, \`Action_ID\` (RA-001…), \`Specific_Action\`, \`Action_Type\` (Preventive|Detective|Corrective|Contingency), \`Action_Owner\`, \`Due_Date\`, \`Status\`, \`Completion_Date\`, \`Effectiveness\`, \`Notes\`. Min ≥2 actions per Critical, ≥1 per High. Mark unknown as "TBC — define in risk workshop".\n\n**Sheet 4 — Trend_Dashboard:** \`tbl_trend\` with columns: \`Risk_ID\`, \`Title\`, \`Category\`, \`Baseline_Rating\`, \`P1_Rating\`…\`P5_Rating\`, \`Current_Rating\`, \`Trend\`, \`Notes\`. Dashboard block (formula-driven): counts by rating baseline vs current; top 5 open risks by score; overdue reviews list.\n\n**Sheet 5 — Change_Log:** \`tbl_changes\` per WE-1.\n\nFilename: \`P2.4_Risk_Workbook_{YYYY-MM-DD}_v1.0.xlsx\` (save to \`/mnt/data/\`)\n\n---\n\n## STEP 6 — IN-CHAT JSON HANDOFF\nOutput a fenced JSON block after files pass QA:\n\n\`\`\`json\n{\n  "P2_4_CANONICAL_HANDOFF": {\n    "prompt_id": "P2.4",\n    "generated_on": "YYYY-MM-DD",\n    "risk_model": { "likelihood_scale": [], "impact_scale": [], "scoring": "", "rating_thresholds": {}, "review_cadence": {} },\n    "risks": [],\n    "top_risks": { "critical_ids": [], "high_ids": [] },\n    "summary": { "total": 0, "critical": 0, "high": 0, "medium": 0, "low": 0, "overdue_reviews": 0, "escalated": 0 },\n    "assumptions": [],\n    "open_items": [],\n    "validation": { "status": "PASS", "issues": [] },\n    "file_refs": { "docx_filename": "", "xlsx_filename": "" }\n  }\n}\n\`\`\`\n\nNo SS-1/DD-1/WE-1 content in JSON.\n\n---\n\n## QA (must pass before output)\n\n**DOCX:** TOC-ready headings; SS-1 confidentiality header/footer; all Critical risks in Top Risks section; no raw bracket placeholders.\n\n**XLSX:** Exactly 5 sheets with specified names; all required Excel Tables present; freeze panes and filters set; no formula errors; heat map counts match register (spot-check 3 quadrants); overdue conditional formatting triggers correctly.\n\n---\n\n## OUTPUT (mandatory)\n1) Download link for \`.docx\`\n2) Download link for \`.xlsx\`\n3) \`P2_4_CANONICAL_HANDOFF\` JSON in-chat (fenced)\nNo other narrative output.\n\nAfter delivering all files, include a brief closing message confirming what was generated and inviting the user to request changes or send the next prompt. Do not await a response — this message is terminal.\n\n---\n\n{{PROMPT_DATA}}`,
  },
  "scope_statement.json": {
    prompt_id: "P1.3",
    prompt_name: "Scope, Objectives & Success Criteria",
    artifact: "Scope & Objectives Workbook",
    instruction:
      `EXECUTION CONSTRAINTS — MANDATORY:\\nYou must follow these execution rules without exception before performing any task.\\n\\n1. Do all parsing, validation, reasoning, and content drafting in your response text only. Do not use code interpreter for any of these steps.\\n\\n2. Make exactly ONE code interpreter call. This call must contain the complete, final file generation script in its entirety. Do not split file generation across multiple calls.\\n\\n3. Do not use code interpreter to inspect, test, explore, or validate data, variables, or helper functions before the final generation call.\\n\\n4. Do not make iterative or exploratory code calls at any stage.\\n\\n5. If a code error occurs inside the single permitted call, handle it internally using try/except. Do not make a second code call to fix or retry it.\\n\\n6. Generate and save all required output files within the single permitted code call. Do not make additional code calls for each file format separately.\\n\\n7. Do not confirm, summarise, or test outputs with a code call. Confirm completion in your response text only.\\n\\n8. Do not present preview tables or confirmation gates mid-execution. Treat all proposed content as confirmed and proceed directly to file generation without waiting for user input.\\n\\n9. After delivering all output files, include a brief closing message confirming what was generated and inviting the user to request changes or proceed with the next prompt. Do not await a response — this message is terminal.\\n\\n---\\n\\n# P1.3 — Scope, Objectives & Success Criteria (Chain Step)\n\n## PURPOSE\nProduce the canonical Scope, Objectives & Success Criteria document. Outputs:\n1) Real .docx — Scope, Objectives & Success Criteria (client-ready)\n2) Real .xlsx — Scope & Objectives Workbook (inclusions/exclusions, objectives register, success criteria tracker)\n3) Canonical JSON handoff in-chat for downstream prompts\n\nGenerate a defensible draft where information is missing. Capture gaps as open_items. Do not use an interactive PROCEED loop.\n\n---\n\n## INPUTS\nParse the most recent in-chat JSON objects:\n- P1_1_CANONICAL_HANDOFF\n- P1_2_CANONICAL_HANDOFF\n\nIf present, apply scope_overrides as last-write-wins:\n<scope_overrides>\n{{SCOPE_OVERRIDES}}\n</scope_overrides>\n\nIf no scope_overrides provided, skip this section.\n\nSS-1, DD-1, WE-1 are loaded from P1.1. Apply them. Do not restate them.\n\n---\n\n## STEP 1 — EXTRACT + NORMALISE\nFrom P1_1_CANONICAL_HANDOFF extract: explicit in/out-of-scope statements, objectives, service offerings, technology, partners, regulatory requirements, assumptions, constraints.\nFrom P1_2_CANONICAL_HANDOFF extract: stakeholder roles relevant to scope sign-off.\n\nNormalise into four sets using DD-1 field names:\n- inclusions[]\n- exclusions[]\n- assumptions[]\n- constraints[]\n\nClassification rules:\n- Explicitly stated in-scope → Inclusion; confidence = High; source = Provided\n- Explicitly stated out-of-scope → Exclusion; confidence = High; source = Provided\n- Inferred → confidence = Medium or Low; source = Inferred_[type]\n- Uncertain → Assumption with confidence = Low; create open_item\n\nDo not invent items not grounded in inputs.\n\n---\n\n## STEP 2 — VALIDATE\nHard minimums (fail-fast):\n- client_name and engagement_name exist\n- At least 1 scope record exists after extraction\n\nIf hard minimums fail — output P1_3_VALIDATION_ERRORS fenced JSON and STOP:\n{ prompt_id: "P1.3", generated_on: YYYY-MM-DD, validation: { status: "FAIL", missing_required: [...], notes: [...] } }\n\nSoft minimums (create open_items, do not fail):\n- At least 3 inclusions or scope marked TBC\n- At least 1 assumption (if none, add: "Scope boundaries based on current brief; to be confirmed in workshop"; confidence = Low)\n- At least 1 exclusion or note "No exclusions specified"\n\n---\n\n## STEP 2B — USER CONFIRMATION GATE (mandatory; do NOT skip)\n\n### Execution behaviour\n- Do NOT pause, stop, or wait for user input at any point.\n- Treat the engagement data provided as confirmed and authoritative.\n- If data is missing or ambiguous, apply reasonable professional assumptions, note them in open_items, and proceed immediately.\n- Generate all deliverables in a single uninterrupted pass.\n- Do NOT ask clarifying questions — proceed directly to file generation.\n\n## STEP 3 — BUILD DELIVERABLES\n\n### 3A) DOCX — Scope Statement\nGenerate a real .docx using python-docx. Apply SS-1 Word styling throughout.\n\nSections (no additions beyond these):\n1) Cover block — title, client, engagement, version v1.0, status Draft, date, confidentiality notice\n2) Purpose — 1 paragraph\n3) Engagement Overview — compact table: Client | Engagement | Start Date | End Date | Delivery Methodology | Engagement Lead | Engagement Manager\n4) Scope Boundary Statement — 2-3 plain English paragraphs (what\'s in, what\'s out, how changes are managed); Key Boundaries callout box (5-8 most material items)\n5) In Scope — table: # | Scope Item | Category | Description | Source | Confidence\n6) Out of Scope — table: # | Exclusion Item | Category | Reason | Source | Confidence; note that inclusions require formal change control\n7) Assumptions — table: # | Assumption | Category | Impact if Wrong | Confidence | Status; Low-confidence or High-impact items in warning callout\n8) Constraints — table: # | Constraint | Category | Impact | Source | Status\n9) Open Items — table: # | Open Item | Priority | Action Required | Suggested Owner\n10) Sign-off — table: Role | Name | Organisation | Signature | Date; roles: Client Sponsor, Client Project Owner, PwC Engagement Lead, PwC Engagement Manager\n\nFile: P1.3_Scope_Objectives_{YYYY-MM-DD}_v1.0.docx → /mnt/data/\n\n---\n\n### 3B) XLSX — Scope Registers\nGenerate a real .xlsx using openpyxl. Apply SS-1 Excel + WE-1 throughout.\n\nSheets (exact names; stable):\n1) Scope_Register\n2) Scope_Change_Log\n3) Scope_RACI\n4) Change_Log\n\n**Scope_Register**\nSS-1 header block rows 1-2. Excel Table tblScope from row 3.\nColumns:\n1. scope_record_id — INC-### / EXC-### / ASM-### / CON-### per type\n2. type — dropdown: Inclusion | Exclusion | Assumption | Constraint\n3. item_title\n4. description\n5. category — dropdown: Scope | Resource | Technology | Timeline | Budget | Regulatory | Stakeholder | Other\n6. source — dropdown: Provided | Inferred_Objectives | Inferred_Services | Inferred_Industry | Inferred_Regulatory | Override | Other\n7. confidence — dropdown: High | Medium | Low\n8. owner_org — dropdown: PwC | Client | Joint | Third_Party | TBC\n9. owner_role — nullable\n10. status — dropdown: Open | Confirmed | Invalidated | Deferred\n11. date_confirmed — YYYY-MM-DD; blank if not confirmed\n12. notes\n13. linked_objective_ids — nullable\n14. linked_stakeholder_ids — nullable\n\nConditional formatting (SS-1 status tokens):\n- confidence = Low → warning highlight\n- status = Open AND type = Exclusion or Assumption → warning highlight\n- owner_org or owner_role blank on Confirmed items → danger highlight\n\nFreeze panes: row 3 + columns A:B. Tab colour: primary per SS-1.\n\n**Scope_Change_Log**\nExcel Table tblScopeChanges. Tab colour: reference per SS-1.\nColumns: change_id (SCH-###) | change_date | scope_record_id | change_type (dropdown: Add | Remove | Modify | Reclassify | Confirm | Invalidate | Defer) | change_description | requested_by | approved_by | decision (dropdown: Approved | Rejected | Deferred | Pending) | decision_date | notes\n\n**Scope_RACI**\nExcel Table tblScopeRACI. Tab colour: reference per SS-1.\nColumns: scope_record_id | item_title | primary_workstream | accountable_role | responsible_role | consulted_roles | informed_roles | notes\nPopulate from P1.2 roles where known. Leave blank and create open_item where uncertain.\n\n**Change_Log**\nExcel Table tblChangeLog (CHG-### per DD-1). Tab colour: reference per SS-1.\nColumns: change_id | change_date | sheet_name | record_id | field_changed | previous_value | new_value | changed_by | reason\nPre-populate one instruction row.\n\nFile: P1.3_Scope_Registers_{YYYY-MM-DD}_v1.0.xlsx → /mnt/data/\n\n---\n\n### 3C) JSON HANDOFF\nAfter QA, output fenced JSON in-chat with top-level key P1_3_CANONICAL_HANDOFF:\n- prompt_id: "P1.3"\n- generated_on: YYYY-MM-DD\n- engagement_identifiers: { client_name, engagement_name, engagement_code }\n- scope_boundary_statement: string\n- inclusions, exclusions, assumptions, constraints: arrays (DD-1 fields)\n- open_items: [{ id, area, description, source, priority, suggested_owner_role }]\n- validation: { status: "PASS", notes: [] }\n\n---\n\n## QA\nDOCX: SS-1 styles applied; confidentiality footer every page; all 10 sections present; no raw bracket placeholders.\nXLSX: sheet names match exactly; tblScope (14 cols), tblScopeChanges (10 cols), tblScopeRACI (8 cols), tblChangeLog (9 cols) all exist; dropdowns, freeze panes, filters, conditional formatting applied; no formula errors.\n\nQA FAIL: output only — QA FAIL: followed by compact list of failures (Sheet + Table/Column). No other output.\n\n---\n\n## OUTPUT\n1) Download links: P1.3_Scope_Objectives_{YYYY-MM-DD}_v1.0.docx and P1.3_Scope_Registers_{YYYY-MM-DD}_v1.0.xlsx\n2) P1_3_CANONICAL_HANDOFF fenced JSON in-chat\nNo other narrative output.\n\nAfter delivering all files, include a brief closing message confirming what was generated and inviting the user to request changes or send the next prompt. Do not await a response — this message is terminal.\n\n---\n\n{{PROMPT_DATA}}`,
  },
  "stakeholder_analysis.json": {
    prompt_id: "P1.2",
    prompt_name: "Stakeholder Analysis",
    artifact: "Stakeholder Analysis Workbook",
    instruction:
      `EXECUTION CONSTRAINTS — MANDATORY:\\nYou must follow these execution rules without exception before performing any task.\\n\\n1. Do all parsing, validation, reasoning, and content drafting in your response text only. Do not use code interpreter for any of these steps.\\n\\n2. Make exactly ONE code interpreter call. This call must contain the complete, final file generation script in its entirety. Do not split file generation across multiple calls.\\n\\n3. Do not use code interpreter to inspect, test, explore, or validate data, variables, or helper functions before the final generation call.\\n\\n4. Do not make iterative or exploratory code calls at any stage.\\n\\n5. If a code error occurs inside the single permitted call, handle it internally using try/except. Do not make a second code call to fix or retry it.\\n\\n6. Generate and save all required output files within the single permitted code call. Do not make additional code calls for each file format separately.\\n\\n7. Do not confirm, summarise, or test outputs with a code call. Confirm completion in your response text only.\\n\\n8. Do not present preview tables or confirmation gates mid-execution. Treat all proposed content as confirmed and proceed directly to file generation without waiting for user input.\\n\\n9. After delivering all output files, include a brief closing message confirming what was generated and inviting the user to request changes or proceed with the next prompt. Do not await a response — this message is terminal.\\n\\n---\\n\\n# P1.2 — Stakeholder Register & Analysis (Chain Step)\n\n## PURPOSE\nCreate the canonical Stakeholder Register & Analysis for the engagement, suitable for downstream steps (Governance, Communications, RACI). This step must generate:\n1) A real \`.xlsx\` Stakeholder Register workbook (primary artifact)\n2) A canonical JSON handoff object in-chat for downstream prompts (do not save JSON as a file unless explicitly required)\n\nNo additional artifacts unless explicitly listed in STEP 3.\n\n---\n\n## INPUTS (available in-chat from prior step)\nYou MUST locate and parse the most recent in-chat JSON object:\n- \`P1_1_CANONICAL_HANDOFF\`\n\nOptional additional stakeholder data may be provided by the user in this step (if present):\n<stakeholder_overrides>\n{{STAKEHOLDER_OVERRIDES}}\n</stakeholder_overrides>\n\nIf no stakeholder_overrides are provided, skip this section entirely.\n\nRules:\n- SS-1, DD-1, WE-1 are already loaded into context from P1.1. Treat them as authoritative.\n- Use DD-1 canonical field names, ID formats, date formats, and enums throughout.\n- Apply WE-1 workbook engineering rules (tables, structured refs, no brittle anchors).\n\n---\n\n## STEP 1 — EXTRACT + INFER + NORMALISE STAKEHOLDERS\n\nApply the following three tiers in order. Do NOT skip Tier 2 if Tier 1 yields sparse results.\n\n### Tier 1 — Extract (explicit upstream data)\nFrom \`P1_1_CANONICAL_HANDOFF\`, extract all stakeholder-related content:\n- \`intake.key_client_stakeholders\` (if present)\n- Any stakeholders explicitly named in objectives, scope, regulatory, or risk sections\n- Any named individuals in governance or commercial context\n\nMark all Tier 1 stakeholders as \`source: P1_1_Intake\`.\n\n### Tier 2 — Infer (professional judgment; always run; no floor limit)\nRegardless of how many stakeholders Tier 1 yields, apply professional judgment to infer the full realistic set of stakeholders for this engagement. This is not a "fill the minimum" exercise — infer every role that a competent engagement manager would expect to be in the room.\n\n**Inference sources (use all that are available):**\n- \`engagement_name\` — what does this project do? Who in a typical organisation owns, approves, or is impacted by work like this?\n- \`industry\` and \`sector\` — what is the standard organisational structure in this industry? What C-suite, operational, compliance, and technology roles typically exist?\n- \`objectives[]\` — which business functions will own each objective? Which will be impacted? Both are stakeholders.\n- \`regulatory_profile[]\` — which regulators, internal compliance functions, legal, or audit roles are implied?\n- \`service_offerings[]\` — what PwC capability domains are in scope? Each implies a client counterpart who owns that domain.\n- \`risk_profile[]\` — what risk owners, assurance functions, or oversight roles are implied by the stated risks?\n- \`engagement_context\` — delivery mode, timeline, and fee structure all imply additional stakeholders (e.g. procurement for commercial approvals, finance for budget governance)\n\n**Inference depth expectation:**\nFor a typical named engagement with a named client and at least one objective, you must infer a realistic full cast — not a skeleton. As a guide:\n- For a small/focused engagement (single workstream, <6 months): expect 8–15 stakeholders minimum\n- For a medium engagement (2–4 workstreams, 6–12 months): expect 15–25 stakeholders minimum\n- For a large/programme-level engagement: expect 25+ stakeholders minimum\n\nThese are floors, not targets. If the engagement context justifies more, include more.\n\n**If inference is blocked by insufficient context:**\nIf \`engagement_name\`, \`industry\`, and \`objectives[]\` are ALL absent or blank, you cannot infer a meaningful register. In this case, do NOT produce a thin register. Instead, STOP and output the following message to the user before doing anything else:\n\n> "⚠ Insufficient context to infer stakeholders. To generate a meaningful Stakeholder Register I need at minimum: (1) the engagement name or a description of what this project is trying to achieve, and (2) either the client\'s industry or the type of organisation. Please provide these and re-run P1.2."\n\nOnly trigger this block if all three signals are genuinely absent. A client name alone, combined with an engagement name, is sufficient to infer industry-typical roles — use your knowledge of that organisation and industry.\n\n**For each inferred role, create a stakeholder row with:**\n- \`full_name\`: null\n- \`role_title\`: specific inferred role title (not generic — e.g. "Head of Regulatory Compliance" not "Compliance Person")\n- \`organisation_name\`: Client or PwC as appropriate\n- \`source\`: \`Inferred\`\n- \`notes\`: one-line rationale (e.g. "Required for regulatory sign-off given stated compliance objective")\n\nInferred roles must be structurally plausible. Do not infer roles contradicted by the engagement context.\n\n### Tier 3 — Override (last-write-wins)\nApply \`stakeholder_overrides\` (if provided) over Tier 1 and Tier 2 results. Do not invent values not present in overrides.\n\n### Deduplication\nAfter all tiers: deduplicate using:\n- Exact email match (if present), OR\n- Exact \`full_name\` + \`organisation_name\`, OR\n- Exact \`role_title\` + \`organisation_name\` (only if name is null/missing)\n\n### Missing data handling\n- Use \`null\` for unknown values in the canonical model.\n- In the workbook, render unknowns as: \`Not specified — to be confirmed\` (italic per SS-1).\n\n---\n\n## STEP 2 — VALIDATE\n\n### Hard minimums (FAIL-FAST — stop and output errors if not met)\n- \`client_name\` exists in \`P1_1_CANONICAL_HANDOFF\`\n- At least one of \`engagement_name\` or \`objectives[]\` exists — sufficient to infer engagement purpose\n\nIf hard minimums are not met, output ONLY a fenced \`P1_2_VALIDATION_ERRORS\` JSON block and STOP.\n\n### Depth check (do NOT fail; flag as WARNING if triggered)\nAfter completing all three tiers, count total stakeholders. If the count is below the engagement-size floor defined in Tier 2:\n- Do NOT stop — instead add an open item: "Stakeholder register may be incomplete — review against engagement scope and supplement before P1.5 Governance Framework"\n- Include a \`WARNING\` flag in the \`validation.notes[]\` of the JSON handoff\n\n### Soft minimums (do NOT fail; create open_items instead)\n- A client sponsor or client accountable role is identified\n- A client project owner / day-to-day lead is identified\n- A PwC engagement lead and engagement manager exist\n- At least one \`preferred_channel\` is known for \`Manage_Closely\` stakeholders\n- If more than 70% of stakeholders are \`source: Inferred\`, add open item: "Stakeholder register is largely inferred — validate with client and engagement team before P1.5"\n\n### Transparency requirement\nIf any stakeholders were inferred (Tier 2), the workbook **must** include a visible notice in the Sheet 1 header block:\n> "⚠ This register includes inferred stakeholders (source = Inferred). These represent structurally expected roles based on engagement context and must be validated before use."\n\n---\n\n## STEP 2B — USER CONFIRMATION GATE (mandatory; do NOT skip)\n\n### Execution behaviour\n- Do NOT pause, stop, or wait for user input at any point.\n- Treat the engagement data provided as confirmed and authoritative.\n- If data is missing or ambiguous, apply reasonable professional assumptions, note them in open_items, and proceed immediately.\n- Generate all deliverables in a single uninterrupted pass.\n- Do NOT ask clarifying questions — proceed directly to file generation.\n\n## STEP 3 — BUILD THE DELIVERABLES\n\n### 3A) XLSX — Stakeholder Register & Analysis (PRIMARY ARTIFACT)\nGenerate a real \`.xlsx\` using openpyxl. Apply SS-1 (Excel) + WE-1 throughout.\n\nSheet names (must be stable and exact):\n- \`Stakeholder_Register\`\n- \`Stakeholder_Summary\`\n- \`Change_Log\`\n\n---\n\n### Sheet 1: Stakeholder_Register\nCreate an Excel Table named \`tblStakeholders\` with a compact SS-1 header block in rows 1–3.\n\nHeader block (rows 1–3) must contain:\n- Row 1: Client Name, Engagement Name, Generated Date, Version (v1.0), Status (Draft)\n- Row 2: Inference notice if any inferred stakeholders exist (see Step 2 transparency requirement); else blank\n- Row 3: blank separator\n\nTable \`tblStakeholders\` starts at row 4.\n\nColumns (use these headers exactly, in this order):\n1.  \`stakeholder_id\` — sequential IDs: STK-001, STK-002… per DD-1\n2.  \`full_name\`\n3.  \`organisation_name\`\n4.  \`stakeholder_type\` — dropdown: PwC | Client | Alliance_Partner | Third_Party | Regulator | Vendor | Other\n5.  \`role_title\`\n6.  \`group_or_function\` — nullable\n7.  \`decision_authority\` — dropdown: Yes | No | TBC\n8.  \`influence_score\` — dropdown: 1 | 2 | 3 | 4 | 5 (default 3 if not known; add open item)\n9.  \`interest_score\` — dropdown: 1 | 2 | 3 | 4 | 5 (default 3 if not known; add open item)\n10. \`influence_level\` — formula: \`=IF([@influence_score]<=2,"Low",IF([@influence_score]=3,"Medium","High"))\`\n11. \`interest_level\` — formula: \`=IF([@interest_score]<=2,"Low",IF([@interest_score]=3,"Medium","High"))\`\n12. \`influence_interest_quadrant\` — formula derived from influence_level + interest_level:\n    - High/High = Manage_Closely | High/Low or High/Medium = Keep_Satisfied\n    - Low or Medium/High = Keep_Informed | Low or Medium/Low or Medium/Medium = Monitor\n13. \`engagement_strategy\` — formula: mirrors \`influence_interest_quadrant\` (per DD-1 §2.10)\n14. \`primary_workstream\` — nullable; free text\n15. \`preferred_channel\` — dropdown: Email | Teams | Workshop | Meeting | Phone | Other\n16. \`communication_cadence\` — dropdown: Weekly | Fortnightly | Monthly | Ad_Hoc | TBC\n17. \`sensitivity\` — dropdown: Standard | Sensitive | Restricted\n18. \`email\` — nullable; text format\n19. \`phone\` — nullable; text format\n20. \`location\` — nullable\n21. \`notes\`\n22. \`source\` — dropdown: P1_1_Intake | Inferred | Override | Manual | Other\n23. \`last_confirmed_date\` — date format per DD-1 (YYYY-MM-DD); default blank\n\nFormatting + engineering requirements:\n- Apply WE-1: Excel Table + structured references only; no fixed row references in formulas.\n- Freeze panes: row 4 header + columns A:B.\n- Auto-filter enabled via the table.\n- Data validation: enforce dropdowns for all enumerated fields using named ranges.\n- Conditional formatting (apply SS-1 styling):\n  - \`sensitivity = Restricted\`: danger fill + danger text\n  - \`decision_authority = TBC\`: warning fill\n  - \`full_name\` AND \`role_title\` are both blank: warning fill\n  - \`source = Inferred\`: light italic fill to visually distinguish from confirmed rows\n- Tab colour: primary per SS-1\n\n---\n\n### Sheet 2: Stakeholder_Summary\nPurpose: executive summary and analysis for downstream prompt consumption.\n\nUse section header rows (per WE-1) to anchor each section. No fixed row numbers.\n\nSection 1 — COUNTS\nUsing COUNTIFS formulas referencing \`tblStakeholders\` structured references:\n- Total stakeholders\n- Count by \`stakeholder_type\`\n- Count by \`engagement_strategy\`\n- Count of Sensitive + Restricted stakeholders\n- Count of Inferred vs Confirmed stakeholders\n\nSection 2 — INFLUENCE-INTEREST MATRIX (2×2)\nFour quadrant cells showing:\n- Quadrant label\n- Count formula: \`=COUNTIF(tblStakeholders[influence_interest_quadrant],"Manage_Closely")\`\n- Names formula: \`=TEXTJOIN(", ",TRUE,IF(tblStakeholders[influence_interest_quadrant]="Manage_Closely",tblStakeholders[full_name],""))\` (array formula)\nInclude legend: 1-2 = Low, 3 = Medium, 4-5 = High\n\nSection 3 — TOP ATTENTION ITEMS\nTable \`tblAttentionItems\` listing stakeholders where:\n- \`decision_authority = TBC\`, OR\n- \`preferred_channel\` is blank, OR\n- \`sensitivity = Restricted\`, OR\n- \`source = Inferred\` (requires validation)\n\nColumns: \`stakeholder_id\` | \`full_name\` | \`issue\` | \`recommended_action\`\n\nAll formulas reference \`tblStakeholders\` structured references only. No hardcoded ranges.\n\n---\n\n### Sheet 3: Change_Log\nTable \`tblChangeLog\` with columns:\n- \`change_id\` (CHG-001…)\n- \`change_date\`\n- \`changed_by\`\n- \`change_description\`\n- \`affected_stakeholder_id\`\n- \`reason\`\n\nPre-populate one instruction row explaining how to use the log.\n\n---\n\n### 3B) IN-CHAT JSON HANDOFF (DOWNSTREAM CONTRACT)\nAfter generating the XLSX and passing QA, output a fenced JSON block in-chat with top-level key \`P1_2_CANONICAL_HANDOFF\`.\n\nIt must contain:\n- \`prompt_id\`: "P1.2"\n- \`generated_on\`: YYYY-MM-DD\n- \`engagement_identifiers\`: { client_name, engagement_name, engagement_code (nullable) }\n- \`stakeholders[]\`: canonical stakeholder objects per DD-1; nulls not placeholders\n- \`summary\`: { counts_by_stakeholder_type, counts_by_engagement_strategy, confirmed_count, inferred_count, restricted_stakeholders[] }\n- \`open_items[]\`: { id, area, description, source, priority }\n- \`validation\`: { status: "PASS", notes: [] }\n\nDo NOT include SS-1/DD-1/WE-1 content in this JSON.\n\n---\n\n## QA (must run before output; fail the step if any item fails)\n- Sheet names exactly match: \`Stakeholder_Register\`, \`Stakeholder_Summary\`, \`Change_Log\`\n- \`tblStakeholders\` exists with all 23 columns in the correct order\n- \`tblChangeLog\` exists with all 6 columns\n- Freeze panes set at row 4 + columns A:B on \`Stakeholder_Register\`\n- Auto-filter enabled on all tables\n- All dropdown validations exist and reference named ranges\n- All structured-reference formulas resolve without errors\n- No brittle fixed-row references used for core logic\n- Conditional formatting applied per SS-1 including \`source = Inferred\` styling\n- SS-1 header block present in rows 1–3 of \`Stakeholder_Register\`\n- Inference notice present in header row 2 if any inferred stakeholders exist\n- File saved to \`/mnt/data/\` with name: \`P1.2_Stakeholder_Register_v1.0_{YYYY-MM-DD}.xlsx\`\n\nIf QA fails, output only: \`QA FAIL:\` followed by a compact list of failures and locations (Sheet + Table/Column).\n\n---\n\n## OUTPUT CONTRACT\n**Success:**\n1) Download link for the generated \`.xlsx\`\n2) \`P1_2_CANONICAL_HANDOFF\` JSON fenced block in-chat\nNo other narrative output.\n\nAfter delivering all files, include a brief closing message confirming what was generated and inviting the user to request changes or send the next prompt. Do not await a response — this message is terminal.\n\n**Failure (validation):**\n\`P1_2_VALIDATION_ERRORS\` fenced JSON only:\n\`\`\`json\n{ "prompt_id": "P1.2", "generated_on": "YYYY-MM-DD", "validation": { "status": "FAIL", "missing_required": [], "notes": [] } }\n\`\`\`\n\n---\n\n{{PROMPT_DATA}}`,
  },
};
const GLOBAL_STANDARDS = {
  SS1: `## SS-1 — Global Style Standard (v1.0)
Applies to: All prompts in the engagement planning chain; all generated Word (.docx), Excel (.xlsx), PowerPoint (.pptx) artifacts.
Objective: Ensure every artifact is visually consistent, PwC-aligned, accessible, and production-ready without per-prompt style repetition.

## 1) Normative Language
- MUST = mandatory requirement.
- SHOULD = strongly recommended; deviations require explicit justification in the artifact notes.
- MAY = optional.

## 2) Design Principles
1. Clarity over decoration: Prioritise readability and scannability. Avoid visual noise.
2. Consistency beats novelty: Use the same layout, styles, and tokens across all artifacts.
3. Traceability: Titles, IDs, versions, dates, and confidentiality marks must be present and consistent.
4. Accessibility by default: Sufficient contrast, clear hierarchy, avoid relying on colour alone to convey meaning.
5. Executive-ready: No placeholder text left behind unless explicitly labelled as "To be confirmed" and captured as an open item.

## 3) Global Visual Tokens

Copy code
### 3.1 Colour Tokens (Hex)
Brand / Core:
- --orange500 = #FD5108 (primary accent; headings; table headers; key rules)
- --orange300 = #FFAA72 (secondary accent; hover states; highlights)
- --orange100 = #FFE8D4 (light orange fills; tinted backgrounds)
- --black = #000000 (primary text)
- --white = #FFFFFF
- --grey100 = #EEEFF1 (light fills; alt rows; section dividers; backgrounds)
- --grey200 = #DFE3E6 (borders/rules)
- --grey300 = #CBD1D6 (subtle borders; dividers)
- --grey400 = #B5BCC4 (inactive; disabled)
- --grey500 = #A1A8B3 (secondary/tertiary text; notes)

Status / Severity:
- --success = #22C55E ; --successBg = #DCFCE7 (on track; complete; positive)
- --warning = #EAB308 ; --warningBg = #FEF3C7 (at risk; attention required)
- --danger = #C62828 ; --dangerBg = #FFEBEE (critical; off track; errors)
- --info = #3B82F6 ; --infoBg = #EFF6FF (informational; closed/complete alt)

Callout Fills:
- --calloutKeyBg = #FFE8D4 (key points; --orange500 left rule)
- --calloutWarnBg = #FEF3C7 (warnings/gaps; --warning left rule)
- --calloutNoteBg = #EEEFF1 (notes/assumptions; --grey300 left rule)

### 3.2 Typography Tokens
Word body: ITC Charter > Georgia > Times New Roman
Word/PPT headings: Helvetica Neue > Arial > Calibri
Excel: Arial 10pt
PPT: Helvetica Neue > Arial

### 3.3 Type Scale and Spacing
Word: Body 10pt | H1 20pt Bold | H2 14pt Bold | H3 11pt Bold | Line spacing 1.15 | Para spacing 6pt after
PPT (16:9): Title 28pt Bold | Subtitle 18pt | Section label 11pt uppercase | Body 11-12pt | Table body 10pt | Caption 9pt | Footer 8pt
Excel: Headers Arial 10pt Bold | Body Arial 10pt | Notes Arial 9pt

### 3.4 Borders, Rules, and Shapes
- Standard border: 0.5pt --grey200
- Section rule: full-width 1pt --orange500
- Callout left rule: 3pt (colour depends on callout type; see 3.1)
- Avoid heavy borders; use fill + thin borders.

## 4) Global Layout and Metadata Standards

### 4.1 Document Metadata (All Artifacts)
Every artifact MUST include: Client Name, Engagement Name, Document/Artifact Title, Version, Status, Date, Confidentiality statement.

### 4.2 Naming Conventions
File names: {STEP_ID}_{ARTIFACT_NAME}_{CLIENT}_{ENGAGEMENT}_v{VERSION}_{YYYY-MM-DD}.{ext}
Example: P2.1_WBS_Optus_SPF_v1.0_2026-02-21.xlsx
Sheet names: <= 31 chars, no trailing spaces.

### 4.3 Confidentiality Marking
Use: "PwC Private and Confidential — prepared for [Client Name] only"
Word: footer every page. Excel: footer every sheet. PPT: footer every slide.

## 5) Word (.docx) Style Standard
Page size: A4. Margins: 2.0cm all sides.
Header: doc title left | client + engagement right | --grey500 9pt
Footer: confidentiality left | Page X of Y right | --grey500 9pt
Headings: heading font, --orange500, numbered where multiple sections.
Body: body font, 10pt, --black.
Tables: header --orange500 fill / --white text / bold 9pt; alternating --white/--grey100; borders 0.5pt --grey200; cell padding 4pt.
Callouts: Key=--calloutKeyBg + 3pt --orange500 left rule; Warning=--calloutWarnBg + 3pt --danger left rule; Note=--calloutNoteBg + 3pt --grey300 left rule.
Placeholders: write as _Not specified — to be confirmed_ (italic).

## 6) Excel (.xlsx) Style Standard

### 6.1 Approved Table Style Palette
The engagement uses a restricted palette derived from the approved PwC Excel table style set.
Only the following colour families are permitted in Excel workbooks:
- **Primary:** Orange (#FD5108 = --orange500), Light orange (#FFAA72 = --orange300), Peach (#FFE8D4 = --orange100)
- **Neutral:** White (#FFFFFF), Light grey (#EEEFF1 = --grey100), Mid grey (#DFE3E6 = --grey200)
- **Black/dark:** #000000 and #333333 for text only — NEVER as fill on data rows
- **Status only (conditional formatting only):** --success (#22C55E / bg #DCFCE7), --warning (#EAB308 / bg #FEF3C7), --danger (#C62828 / bg #FFEBEE), --info (#3B82F6 / bg #EFF6FF)
- **Prohibited fills:** Blue, green, purple, teal, red, yellow or any colour outside this palette — including default Excel blue table styles

### 6.2 Preferred openpyxl Table Style
When applying a TableStyleInfo to an Excel Table (ListObject), use these in priority order:
1. **Primary operational tables** (main data tables): \`TableStyleMedium3\` — orange header, white/light-orange banded rows
2. **Reference / log tables** (change log, lookup tables): \`TableStyleLight16\` — light orange/peach banding, no heavy header
3. **Dashboard KPI tables** (small 2-col summary tables): \`TableStyleMedium2\` — orange border, white fill, orange header
4. Do NOT use any blue, green or default Excel table styles.
5. Set \`showFirstColumn=False\`, \`showLastColumn=False\`, \`showRowStripes=True\`, \`showColumnStripes=False\` on all tables.

### 6.3 Fonts and Type Hierarchy
Apply these sizes consistently — do NOT mix sizes within a tier:
- Sheet title / engagement header (info block row 1): Arial 12pt Bold, --orange500
- Sub-header labels (info block rows 2+): Arial 10pt Bold, --grey500
- Table column headers: Arial 10pt Bold, --white on --orange500 fill
- Data rows: Arial 10pt, --black
- Notes / secondary text: Arial 9pt Italic, --grey500
- Section separator labels (between tables): Arial 10pt Bold, --orange500, no fill

### 6.4 Row Heights
- Info block rows (engagement header): 20pt minimum
- Table column header row: 30pt (allows wrapped text to be readable)
- Data rows: 15pt; set \`ws.row_dimensions[n].height = 15\` for all data rows explicitly
- Section label rows: 18pt
- NEVER leave row height at openpyxl default (None) — always set explicitly

### 6.5 Column Widths
Auto-fit is NOT sufficient. Apply these deterministic widths:
- ID columns (stakeholder_id, risk_id, etc.): width = 12
- Short enum/dropdown columns (status, RAG, type, Yes/No): width = 14
- Name columns (full_name, role_title): width = 28
- Organisation / group columns: width = 22
- Description / narrative / notes columns: width = 45, wrap_text = True
- Date columns: width = 14
- Score / numeric columns: width = 10
- All other columns: width = 20
- Do NOT call \`auto_fit\` after setting widths — it overrides explicit values

### 6.6 Text Wrapping and Alignment
- \`wrap_text = True\` + \`vertical = 'top'\`: all description, notes, narrative, free-text columns
- \`wrap_text = False\` + \`vertical = 'center'\`: all ID, date, status, score, short enum columns
- Table column header row: \`wrap_text = True\` + \`vertical = 'center'\` + \`horizontal = 'center'\`
- Set alignment explicitly on every cell written — do not rely on openpyxl defaults

### 6.7 Table Header and Row Styling (manual, applied in addition to TableStyleInfo)
Apply these fills and fonts explicitly to ensure consistency even if TableStyleInfo rendering varies:
- Column header row: \`PatternFill(fgColor="FD5108")\` + \`Font(bold=True, color="FFFFFF", size=10, name="Arial")\`
- Header row bottom border: \`Side(border_style="medium", color="FD5108")\`
- Odd data rows: fill \`FFFFFF\`; Even data rows: fill \`EEEFF1\`
- All cell borders: \`Side(border_style="thin", color="DFE3E6")\`

### 6.8 Info / Header Block (rows above each table)
Every sheet MUST have an info block above its first table:
- Row 1: "Client: {client_name}  |  Engagement: {engagement_name}" — Arial 12pt Bold --orange500; merged across used columns; fill --orange100 (#FFE8D4)
- Row 2: "Generated: {YYYY-MM-DD}  |  Version: v1.0  |  Status: Draft" — Arial 10pt --grey500; fill --grey100 (#EEEFF1)
- Row 3 (notices only): Arial 10pt Italic --danger (#C62828); fill --dangerBg (#FFEBEE). Only include if a warning is required (e.g. inferred data notice).
- Blank separator row before table header row: height = 6pt
- Info block rows must NOT be part of the Excel Table — they sit above the table start row

### 6.9 Freeze Panes
- Freeze AFTER all header block rows AND the table column header row
- Example: if table starts at row 4 (cols A–W), header in row 4: \`ws.freeze_panes = "C5"\` (freezes cols A:B + rows 1:4)
- Always freeze at minimum: all header block rows + table column header row

### 6.10 Tab Colours
- Primary/Operational sheets: #FD5108 (--orange500). Set via \`ws.sheet_properties.tabColor = "FD5108"\`
- Reference/Log sheets: #EEEFF1 (--grey100). Set via \`ws.sheet_properties.tabColor = "EEEFF1"\`

### 6.11 Dates, Currency, Percentages
- Dates: \`number_format = "YYYY-MM-DD"\` — set explicitly on all date cells and columns
- Currency: \`number_format = '#,##0.00'\`
- Percentages: \`number_format = '0.0%'\`

### 6.12 Dropdowns and Data Validation
- All enum columns MUST have \`DataValidation(type="list", ...)\` applied to the full table column range
- Use inline comma-separated lists or named ranges — NOT formula-based sources
- Apply validation to the full column range of the table, not just the first row

### 6.13 Conditional Formatting
- Use only status/severity tokens from Section 3.1 (--success, --warning, --danger, --info fills)
- Every rule MUST set both PatternFill AND Font colour (colour alone is inaccessible)
- Apply rules to the full table data range using explicit cell range (e.g. \`A5:W500\`)
- Inferred/unconfirmed data rows: light italic fill using --orange100 (#FFE8D4) + --grey500 italic font

### 6.14 Print Setup
- \`ws.print_title_rows = "1:4"\` (repeat header block + table header on every printed page)
- Fit to page width: \`ws.page_setup.fitToWidth = 1; ws.page_setup.fitToHeight = 0\`
- Confidentiality footer: \`ws.oddFooter.center.text = "PwC Private and Confidential — prepared for {client_name} only"\`

## 7) PowerPoint (.pptx) Style Standard
Size: 16:9. Background: --white for content slides.
Every slide: PwC logo placeholder top-left; 2pt --orange500 top rule; section label top-right uppercase --orange500 11pt; confidentiality bottom; slide number bottom-right.
Title slide: --orange500 background; --white title 28pt bold; --white subtitle 18pt.
Section divider: --grey100 background; --orange500 heading 28pt bold.
Content slide: max 5 bullets; split if exceeded.
Tables: --orange500 header; alternating --white/--grey100; max 6 rows per slide.
RAG indicators: filled circles; Red=--danger; Amber=--warning; Green=--success; Blue=--info; Grey=--grey500. Meaning per DD-1.

## 8) Cross-Artifact Consistency Rules
Colour tokens, status colours, confidentiality statement, dates, versioning, and titles MUST match across all artifacts for the same step.
"To be confirmed": italic in Word; grey italic in Excel; bracketed placeholder in PPT.

## 9) Non-Negotiable Prohibitions
- Do NOT invert RAG colours or redefine meanings (meanings live in DD-1).
- Do NOT use fixed magic row numbers for section boundaries (engineering lives in WE-1).
- Do NOT introduce additional palettes per prompt.
- Do NOT leave unlabelled placeholder tokens in final outputs.

## 10) Style QA Checklist (SS-1 Compliance)
Artifact is SS-1 compliant only if: metadata present; confidentiality applied; headings correct font/size/colour using --orange500; tables correct header styling using --orange500/--white/--grey100; callouts correct fill+rule using defined tokens; status colours use --success/--warning/--danger/--info tokens only; no mixed palettes; readable layout.

End SS-1.

End SS-1.`,
  DD1: `## DD-1 — Global Data Dictionary and Naming Conventions (v1.0)
Scope: Canonical field names, data types, enumerations, ID formats, and calculation semantics used across P1.1-P2.8 and all generated artifacts.
Authority: DD-1 is the single source of truth for data semantics. If any step specifies a conflicting meaning, DD-1 prevails unless an explicit override is declared in that step's Spec Precedence section.

## 1) Canonical Data Representation Rules

### 1.1 Field naming
- Canonical keys (machine): snake_case (e.g., engagement_name, risk_rating).
- Display labels (human): Title Case (e.g., "Engagement Name", "Risk Rating").
- No synonyms: each concept has exactly one canonical key.

### 1.2 Data types
- string: UTF-8, trimmed.
- date: ISO 8601 YYYY-MM-DD.
- datetime: ISO 8601 with timezone offset.
- integer: whole numbers only.
- decimal: numeric with defined precision.
- boolean: Yes/No user-facing; true/false JSON.

### 1.3 Unknown / not provided handling
- Structured data (XLSX/JSON): optional fields = blank/null; required but unknown = TBC.
- Narrative (DOCX/PPTX): use _Not specified — to be confirmed_ (italicised per SS-1).

### 1.4 Units and precision
- Effort: person_days (decimal). 1 person-day = 8 hours.
- Duration: working_days (integer).
- Currency: 2 decimal places; ISO 4217 (default AUD).
- Percent: decimal fraction in JSON (e.g., 0.25); display as % (e.g., 25%).

### 1.5 Timezone and calendar
- Timezone: Australia/Melbourne (AEDT/AEST).
- Working week: Monday-Friday.

## 2) Canonical Enumerations

### 2.1 delivery_methodology: Waterfall | Agile | Hybrid
### 2.2 fee_structure: Fixed_Price | Time_and_Materials | Capped_T_and_M
### 2.3 engagement_complexity: Low | Medium | High | Very_High
### 2.4 organisation_type: PwC | Client | Joint | Alliance_Partner | Third_Party | Regulator | Vendor | Other
### 2.5 yes_no: Yes | No

### 2.6 rag_status (non-negotiable meanings):
- Green: On Track
- Amber: At Risk (action in progress)
- Red: Off Track (requires intervention/escalation)
- Blue: Complete / Closed / Achieved
- Grey: Not Started / Not Assessed / N/A

### 2.7 priority: Critical | High | Medium | Low
### 2.8 confidence_level: High | Medium | Low | TBC
### 2.9 influence_level / interest_level: High | Medium | Low

### 2.10 engagement_strategy (derived from influence + interest):
- High influence + High interest = Manage_Closely
- High influence + Low/Medium interest = Keep_Satisfied
- Low/Medium influence + High interest = Keep_Informed
- Low/Medium influence + Low/Medium interest = Monitor

### 2.11 risk_response_strategy: Avoid | Mitigate | Transfer | Accept

### 2.12 risk_category: Strategic | Financial | Operational | Schedule | Resource | Technology | Regulatory_and_Compliance | Stakeholder | Scope | Quality | Third_Party | Cyber_and_Security | People | Environmental_and_ESG | Other

### 2.13 likelihood_level / impact_level: High=3 | Medium=2 | Low=1

### 2.14 risk_rating (derived from likelihood_score * impact_score):
- 9 = Critical | 6 = High | 3-4 = Medium | 1-2 = Low

### 2.15 Status codes:
- deliverable_status: Not_Started | In_Progress | Draft_Complete | In_Review | Approved | On_Hold | Cancelled
- milestone_status: Not_Started | On_Track | At_Risk | Off_Track | Complete | Cancelled
- task_status: Not_Started | In_Progress | Complete | On_Hold | Cancelled | Blocked
- action_status: Open | In_Progress | Complete | Deferred | Cancelled
- change_request_status: Pending_Assessment | Under_Review | Pending_Approval | Approved | Rejected | Deferred | Withdrawn | Implemented | Cancelled
- risk_status: Open | Mitigated | Accepted | Closed | Transferred | Eventuated
- issue_status: Open | In_Progress | Resolved | Escalated | Closed
- non_conformance_status: Open | In_Rework | Resolved | Closed | Accepted_as_Risk

## 3) Canonical ID Formats
STK-### | OBJ-### | SC-### | KPI-### | BEN-### | WBS hierarchical numeric | MS-### | SP-### | RES-### | BL-### | INV-### | DEC-### | ACT-### | RSK-### | ISS-### | DEP-### | ASM-### | CR-### | QG-### | NC-### | COM-### | TPL-### | OI-### | CHG-### (change log entries)

## 4) Core Entity Dictionaries

### 4.1 Engagement Context (brief-builder fields only)
The engagement context is sourced exclusively from the PwC Delivery Launchpad brief-builder form. Only the following fields will ever be present. Do not flag the absence of any other field as a gap, warning, or open item — they are not collected by design.
client_name (string, required) | engagement_name (string, required) | engagement_lead (string) | industry (string, required) | sector (string) | sub_sector (string) | delivery_methodology (enum) | fee_structure (enum) | start_date (date) | end_date (date) | total_budget (string) | engagement_description (string) | objectives (array, minimum 1 required) | service_offerings (array) | technology (array) | alliance_partners (array) | regulatory_profile (array) | risk_profile (array)
Required for chain to proceed: client_name, engagement_name, industry. All other fields are optional — if absent, set to null and do not raise an open item.

### 4.2 Stakeholder: stakeholder_id | full_name | role_title | organisation_name | organisation_type | engagement_role (Sponsor|Decision_Maker|Project_Owner|Programme_Manager|SME|End_User|Approver|Informed_Only|Other) | influence_level | interest_level | engagement_strategy | confirmed_or_placeholder | onboarded_to_engagement

### 4.3 WBS element: wbs_id | element_name | parent_wbs_id | wbs_level (1-4) | element_type (Engagement|Phase|Workstream|Deliverable|Work_Package) | owner_organisation_type | responsible_role | estimated_effort_days | estimated_duration_working_days | predecessor_wbs_ids | fixed_date | priority | task_status | percent_complete

### 4.4 Milestone: milestone_id | milestone_name | phase_or_workstream | wbs_reference | milestone_type (Phase_Gate|Deliverable_Signoff|Client_Approval|Regulatory_Submission|Go_Live|Review_Point|Steering_Committee|Sprint_Review|Other) | baseline_date | planned_date | forecast_date | actual_date | variance_from_baseline_days | milestone_status | owner | signoff_required | signoff_status

### 4.5 Sprint: sprint_id | sprint_name | sprint_number | start_date | end_date | duration_working_days | sprint_goals | key_deliverables | sprint_status | story_points_planned | story_points_completed | velocity_ratio | sprint_lead

### 4.6 Resource: resource_id | full_name | role_title | seniority_level (Partner|Director|Senior_Manager|Manager|Senior_Associate|Associate|Analyst|Specialist|Other) | organisation_type | primary_workstream | secondary_workstream | location (Onshore|Offshore|Near_Shore|Client_Site|Remote) | start_date | end_date | total_effort_days | fte_allocation | availability_percent | daily_rate | total_cost | confirmed_status (Confirmed|TBC|Proposed) | security_clearance_required

### 4.7 Budget line: budget_line_id | cost_item_description | phase_or_workstream | cost_type (Labour_PwC|Labour_Client|Labour_Alliance_Partner|Labour_Third_Party|Travel_and_Accommodation|Technology_and_Software|Training|Printing_and_Production|Contingency|Other) | resource_role | seniority_level | effort_days | daily_rate | baseline_amount | confidence_level | reimbursable | fixed_or_variable | notes

### 4.8 Risk: risk_id | risk_title | risk_category | risk_description | risk_source | risk_owner | owner_organisation_type | likelihood_level | impact_level | risk_score | risk_rating | risk_response_strategy | mitigation_actions | contingency_plan | residual_likelihood_level | residual_impact_level | residual_score | residual_rating | risk_status | escalation_required | next_review_date | restricted_distribution | date_raised | raised_by

### 4.9 Issue: issue_id | issue_title | issue_category | priority | issue_description | owner | target_resolution_date | issue_status | escalated | linked_risk_id

### 4.10 Dependency: dependency_id | dependency_title | dependency_description | dependency_type (Client|Third_Party|Internal_PwC|Regulator|Other) | owner | due_date | status | critical_path_related

### 4.11 Assumption: assumption_id | assumption_text | category (Scope|Resource|Technology|Timeline|Budget|Regulatory|Stakeholder|Other) | impact_if_wrong | confidence_level | status (Open|Confirmed|Invalidated) | owner | date_raised | date_confirmed_or_invalidated

### 4.12 Change request: change_request_id | change_title | change_description | change_type | classification (Minor|Major|Emergency) | requested_by | requestor_organisation_type | date_submitted | phase_or_workstream_affected | urgency | impact_assessment_owner | assessment_due_date | assessment_completed_date | change_request_status | approver | decision_date | schedule_impact_days | budget_impact_amount | resource_impact | contractual_amendment_required | baseline_updated | implementation_date

### 4.13 Quality gate: quality_gate_id | gate_name | phase_boundary | gate_criteria | approver | target_date | actual_date | gate_status (Not_Yet_Due|Pending_Review|Passed|Failed|Blocked|Waived) | criteria_met (All_Met|Partially_Met|Not_Met) | outstanding_criteria

## 5) Canonical Calculations
- working_days = NETWORKDAYS(start_date, end_date, HolidayList)
- fte_allocation = total_effort_days / working_days
- effective_fte = fte_allocation * (availability_percent / 100)
- variance_days = forecast_date - planned_date (positive = slip)
- utilisation: >100% Over-allocated | 80-100% Near capacity | 60-80% Optimal | <60% Under-utilised
- EVM: sv=ev-pv | cv=ev-ac | spi=ev/pv | cpi=ev/ac | eac=bac/cpi | vac=bac-eac | tcpi=(bac-ev)/(bac-ac)

## 6) Canonical Prompt Tokens (placeholders in prompts only)
[CLIENT_NAME] | [ENGAGEMENT_NAME] | [ENGAGEMENT_CODE] | [ENGAGEMENT_MANAGER] | [PARTNER] | [INDUSTRY] | [SERVICE_LINE] | [START_DATE] | [END_DATE] | [BUDGET]
Rule: tokens must not leak into generated structured datasets.

## 7) Controlled Vocabulary Mapping
"Start Date" = engagement_start_date | "End Date" = engagement_end_date | "Budget/Fee" = total_budget | "EM" = engagement_manager | "RAG"/"Status" = rag_status | "T&M" = Time_and_Materials | "Fixed Fee" = Fixed_Price

End DD-1.`,
  WE1: `## WE-1 — Global Workbook Engineering Rules (Canonical XLSX Engineering Standard)

## 0) Purpose
WE-1 defines non-negotiable engineering rules for all XLSX outputs to prevent brittle spreadsheets, reduce prompt duplication, and eliminate contradictions across the chain.
WE-1 is engineering-first: it may override prompt-level implementation details if those details would produce an unstable workbook.

## 1) Applicability and Precedence
Apply WE-1 only when XLSX is in ArtifactTypes.
Conflict resolution order: (1) STEP 3 output list + rationalisation constraints, (2) WE-1, (3) SS-1, (4) prompt-level sheet mechanics.
If a prompt requires a fixed row number and WE-1 forbids it, ignore the fixed row requirement and implement using WE-1 anchors and section headers instead.

## 2) Structural Engineering Rules (No brittleness)

### 2.1 No fixed coordinates
Do not hardcode row numbers (e.g., "row 501", "B4:B1000") as the structural basis of the workbook.
Fixed coordinates are allowed only for: small deliberate header areas (rows 1-2), constant-position summary KPI cells, table header rows.
All data regions must be anchored and discoverable by section headers and/or Excel tables.

### 2.2 Section headers as anchors (mandatory)
Every sheet with more than one logical area must use explicit section headers (single-row, full-width, styled per SS-1).
Each section header must be unique within the sheet.
Downstream logic must locate sections by: Excel Table name, Named range, or searching for the section header text and offsetting from it.

### 2.3 Prefer Excel Tables (ListObjects) and Structured References
All primary registers/logs must be implemented as Excel Tables.
Use structured references for formulas (e.g., =COUNTIF(RiskTable[Status],"Open")).
Each table must have: deterministic Table Name (see 2.5), header row, banded rows, filters enabled.

### 2.4 Prefer Named Ranges
Create named ranges for: key scalar values, threshold constants, lists used by validation, any non-table summary bar inputs.

### 2.5 Deterministic naming convention
Table names: {PromptID}_{SheetKey}_{Entity} (no spaces). Example: P2_7_RiskRegister_Risks
Named ranges: {PromptID}_{Name}. Example: P2_2_EngagementStartDate

### 2.6 Merges are restricted
Avoid merged cells inside data tables entirely.
Merged cells permitted only for: title blocks, section header rows, wide callout banner cells.

## 3) Formula and Reference Rules

### 3.1 No brittle ranges for growable data
Formulas that adapt to new rows must use structured references or dynamic named ranges, not static ranges.

### 3.2 Reconciliation after rationalisation merges (mandatory)
If rationalisation merges sheets: update all formulas to reference new table names/columns or named ranges.
Do not leave orphan references to deleted/merged sheets.

### 3.3 Consistent ID generation
IDs should use table-row logic where possible. Prefer deterministic ID formats from DD-1.

### 3.4 Calculation integrity
All formulas must avoid #REF!, #NAME?, circular references, and broken structured refs.

## 4) Data Validation and Conditional Formatting Rules

### 4.1 Validations must bind to canonical lists
Dropdown validations must reference a named range or explicit list table.
Do not embed long inline validation lists repeatedly across columns.

### 4.2 Conditional formatting scope discipline
Apply conditional formatting to table columns or dynamically computed ranges anchored to tables/section headers.
Avoid applying to large fixed blank ranges.

### 4.3 Input vs formula cell discipline
Inputs: unlocked (if protection enabled), styled per SS-1.
Formula cells: locked, protected.

## 5) Standard Sheet Engineering Defaults
Freeze panes: table sheets = freeze header row + key left identifier columns; dashboard sheets = freeze top header and left label column.
Filters: enable on every Excel Table and register-like range.
Column widths: set to content with sensible min/max.
Print: landscape for wide tables; repeat header row; fit to 1 page wide if reasonable.
Protection: protect sheets with formulas; unlock input cells; allow sorting/filtering.

## 6) QA Gates (XLSX must pass before returning)
1. Structure QA: no fixed row dependency; all growable datasets are Excel Tables with deterministic names; section headers unique.
2. Reference QA: no broken references; no orphan references to deleted sheets; named ranges exist for required constants/lists.
3. Validation QA: all required dropdowns exist and point to canonical list sources.
4. Formatting QA: freeze panes correct; filters enabled; protection applied.
5. Rationalisation QA: sheet count and names match rationalisation maximum; merged sections maintain anchor headers.

If any QA gate fails, STOP and output only: XLSX QA FAILED: followed by compact list of failures and locations.

## 7) Authoring Guidance for Codex Execution
Build order: tables first, then validations, then formulas, then conditional formatting, then protection.
When a prompt specifies "merge sheets" or "divider rows": implement as a single sheet with multiple Excel Tables separated by section header rows; all summaries reference table structured references, not fixed ranges.
Prefer deterministic table/range names.

End WE-1.`,
};

// ── UTILITIES ──
function slugify(str) {
  if (!str) return "";
  return String(str)
    .toLowerCase()
    .replace(/[^a-z0-9]+/g, "-")
    .replace(/(^-|-$)/g, "");
}
function showLoading(msg) {
  document.getElementById("loadingText").textContent = msg || "Loading...";
  document.getElementById("loadingOverlay").classList.add("visible");
}
function hideLoading() {
  document.getElementById("loadingOverlay").classList.remove("visible");
}
function showError(msg) {
  var _de = document.getElementById("dataError");
  if (_de) _de.innerHTML = `<div class="error-msg">${msg}</div>`;
  else console.warn("Form error:", msg);
}
function toggleSection(id) {
  // CHUNK 1: update dot after toggling
  setTimeout(function () {
    if (typeof updateSectionDot === "function") updateSectionDot(id);
  }, 100);
  const el = document.getElementById(id);
  el.classList.toggle("open");
  if (el.classList.contains("open")) {
    setTimeout(function () {
      el.scrollIntoView({ behavior: "smooth", block: "start" });
    }, 50);
  }
  updateFormProgress();
}
function updateFormProgress() {
  updateBriefStrength();
}

function updateBriefStrength() {
  // Score each section 0-2 using new fb DOM
  function fbScore(sectionId) {
    var sec = document.getElementById("fb-" + sectionId);
    if (!sec) return 0;
    var sel = sec.querySelectorAll(
      ".fb-pill.selected, .fb-chip.selected, .fb-bb-item.selected, .fb-check-item.checked, .fb-tab-item.has-data",
    ).length;
    var inputs = Array.from(
      sec.querySelectorAll(
        "input[type=text], input[type=date], select, textarea",
      ),
    ).filter(function (el) {
      return (el.value || "").trim();
    }).length;
    var n = sel + inputs;
    return n === 0 ? 0 : n >= 3 ? 2 : 1;
  }
  var total = ["s1", "s2", "s3", "s4", "s5", "s6", "s7", "s8"].reduce(function (
    acc,
    sid,
  ) {
    return acc + fbScore(sid);
  }, 0);
  var pct = Math.round((total / 16) * 100);
  var label, color;
  if (pct < 25) {
    label = "Weak";
    color = "#ef4444";
  } else if (pct < 50) {
    label = "Fair";
    color = "#f97316";
  } else if (pct < 80) {
    label = "Strong";
    color = "#22c55e";
  } else {
    label = "Excellent";
    color = "#16a34a";
  }
  var bar = document.getElementById("briefStrengthBar");
  var lbl = document.getElementById("briefStrengthLabel");
  if (bar) {
    bar.style.width = pct + "%";
    bar.style.background = color;
  }
  if (lbl) {
    lbl.textContent = label;
    lbl.style.color = color;
  }
}

function scoreSectionS1() {
  const vals = [
    "clientName",
    "engagementName",
    "deliveryMethodology",
    "feeStructure",
    "engagementDescription",
  ].map((id) => ((document.getElementById(id) || {}).value || "").trim());
  const n = vals.filter(Boolean).length;
  return n === 0 ? 0 : n <= 2 ? 1 : 2;
}
function scoreSectionS2() {
  const ind = (document.getElementById("industryDrop") || {}).value || "";
  const sec = (document.getElementById("sectorDrop") || {}).value || "";
  if (!ind && !sec) return 0;
  if (ind && sec) return 2;
  return 1;
}
function scoreSectionGrid(gid) {
  const g = document.getElementById(gid);
  if (!g) return 0;
  const n = g.querySelectorAll(".check-item.selected,.selected").length;
  return n === 0 ? 0 : n >= 2 ? 2 : 1;
}

function scrollToSection(id) {
  const el = document.getElementById(id);
  if (el) {
    if (!el.classList.contains("open")) el.classList.add("open");
    el.scrollIntoView({ behavior: "smooth", block: "start" });
  }
}
function toggleFreeText(btn, dropdownId, freeTextId) {
  const dropdown = document.getElementById(dropdownId);
  const freeText = document.getElementById(freeTextId);
  const isDropdown =
    freeText.style.display === "none" || freeText.style.display === "";
  if (isDropdown) {
    dropdown.style.display = "none";
    freeText.style.display = "block";
    btn.textContent = "Use dropdown";
  } else {
    dropdown.style.display = "block";
    freeText.style.display = "none";
    btn.textContent = "Enter manually";
  }
}
function toggleBtn(dropId, freeId) {
  return `<button class="btn-toggle-input" onclick="toggleFreeText(this,'${dropId}','${freeId}')">Enter manually</button>`;
}
function toggleCheckCascadeById(cascadeId, gridId) {
  const cascade = document.getElementById(cascadeId);
  if (!cascade) return;
  cascade.classList.remove("visible");
  const cci = cascade.parentElement;
  if (cci) {
    const chip = cci.querySelector(".check-item");
    if (chip) chip.classList.remove("selected");
  }
  if (typeof updateBriefStrength === "function") updateBriefStrength();
}
function toggleCheckCascade(el, cascadeId) {
  el.classList.toggle("selected");
  const cb = el.querySelector('input[type="checkbox"]');
  if (cb) cb.checked = el.classList.contains("selected");
  const cascade = document.getElementById(cascadeId);
  if (cascade)
    cascade.classList.toggle("visible", el.classList.contains("selected"));
}
function toggleCheckOnly(el) {
  el.classList.toggle("selected");
  const cb = el.querySelector('input[type="checkbox"]');
  if (cb) cb.checked = el.classList.contains("selected");
}
function getVal(dropId, freeId) {
  const drop = document.getElementById(dropId);
  const free = document.getElementById(freeId);
  if (!drop || !free) return "";
  return free.style.display === "block" ? free.value : drop.value;
}

// ── LOAD ALL DATA (standalone: uses inlined data) ──
function loadAllData() {
  Object.entries(INLINED_DATA).forEach(([key, val]) => (appData[key] = val));
  var _de = document.getElementById("dataError");
  if (_de) _de.innerHTML = "";
  renderAll();
  ["clientName", "engagementName"].forEach(function (fieldId) {
    const field = document.getElementById(fieldId);
    if (!field) return;
    field.addEventListener("input", function () {
      if ((field.value || "").trim()) {
        setFieldError(fieldId, "");
      }
    });
  });
  // CHUNK 1+2: auto-save, draft, dots, brief strength
  setTimeout(function () {
    initAutoSave();
    checkForDraft();
    updateAllSectionDots();
    if (typeof updateBriefStrength === "function") updateBriefStrength();
  }, 500);
}

// ── RENDER ALL SECTIONS ──

// ════════════════════════════════════════
// FORM BUILDER — NEW RENDER FUNCTIONS
// ════════════════════════════════════════

// ── Scroll to section & update active nav ──

// ── Highlight active nav on scroll ──

// ── Nav dot + section dot update ──

// ════ S2: INDUSTRY ════
function renderIndustry() {
  var data = appData.industries.industries;
  var pills = document.getElementById("industryPills");
  if (!pills) return;
  pills.innerHTML = data
    .map(function (ind) {
      return (
        '<span class="fb-pill" onclick="fbSelectIndustry(this,\'' +
        ind.industry.replace(/'/g, "\\'") +
        "')\">" +
        ind.industry +
        "</span>"
      );
    })
    .join("");
  // keep hidden drops for compileForm() compatibility
  var drop = document.getElementById("industryDrop");
  if (!drop) {
    var h = document.createElement("div");
    h.style.display = "none";
    h.innerHTML =
      '<select id="industryDrop"></select><select id="sectorDrop"></select><select id="subsectorDrop"></select>';
    document.getElementById("fb-s2").appendChild(h);
  }
  data.forEach(function (ind) {
    var opt = document.createElement("option");
    opt.value = ind.industry;
    opt.textContent = ind.industry;
    document.getElementById("industryDrop").appendChild(opt);
  });
}

function fbSelectIndustry(el, val) {
  document.querySelectorAll("#industryPills .fb-pill").forEach(function (p) {
    p.classList.remove("selected");
  });
  el.classList.add("selected");
  document.getElementById("industryDrop").value = val;
  // Populate sectors
  var ind = appData.industries.industries.find(function (i) {
    return i.industry === val;
  });
  var sp = document.getElementById("sectorPills");
  sp.innerHTML = ind.sectors
    .map(function (s) {
      return (
        '<span class="fb-pill" onclick="fbSelectSector(this,\'' +
        s.sector.replace(/'/g, "\\'") +
        "')\">" +
        s.sector +
        "</span>"
      );
    })
    .join("");
  document.getElementById("sectorDrop").innerHTML =
    '<option value="">Select sector...</option>' +
    ind.sectors
      .map(function (s) {
        return '<option value="' + s.sector + '">' + s.sector + "</option>";
      })
      .join("");
  document.getElementById("trail-sector").classList.add("ready");
  document.getElementById("trail-sector").classList.remove("fb-trail-dimmed");
  document.getElementById("subsectorPills").innerHTML =
    '<span class="fb-trail-placeholder">Select a sector first</span>';
  document.getElementById("trail-subsector").classList.remove("ready");
  document.getElementById("trail-subsector").classList.add("fb-trail-dimmed");
  fbFieldChange("s2");
}

function fbSelectSector(el, val) {
  document.querySelectorAll("#sectorPills .fb-pill").forEach(function (p) {
    p.classList.remove("selected");
  });
  el.classList.add("selected");
  document.getElementById("sectorDrop").value = val;
  var indVal = document.getElementById("industryDrop").value;
  var ind = appData.industries.industries.find(function (i) {
    return i.industry === indVal;
  });
  var sec =
    ind &&
    ind.sectors.find(function (s) {
      return s.sector === val;
    });
  var ssp = document.getElementById("subsectorPills");
  if (sec) {
    ssp.innerHTML = sec.sub_sectors
      .map(function (sub) {
        return (
          '<span class="fb-pill" onclick="fbSelectSubsector(this,\'' +
          sub.replace(/'/g, "\\'") +
          "')\">" +
          sub +
          "</span>"
        );
      })
      .join("");
    document.getElementById("subsectorDrop").innerHTML =
      '<option value="">Select sub-sector...</option>' +
      sec.sub_sectors
        .map(function (sub) {
          return '<option value="' + sub + '">' + sub + "</option>";
        })
        .join("");
    document.getElementById("trail-subsector").classList.add("ready");
    document
      .getElementById("trail-subsector")
      .classList.remove("fb-trail-dimmed");
  }
  fbFieldChange("s2");
}

function fbSelectSubsector(el, val) {
  document.querySelectorAll("#subsectorPills .fb-pill").forEach(function (p) {
    p.classList.remove("selected");
  });
  el.classList.add("selected");
  document.getElementById("subsectorDrop").value = val;
  fbFieldChange("s2");
}

// ════ S3: OBJECTIVES ════
function renderObjectives() {
  var data = appData.objectives.engagement_objectives.objective_types;
  var list = document.getElementById("objTypeList");
  if (!list) return;
  list.innerHTML = data
    .map(function (ot, i) {
      return (
        '<div class="fb-tab-item" onclick="fbSelectObjType(this,\'' +
        ot.objective_type.replace(/'/g, "\\'") +
        "')\">" +
        ot.objective_type +
        '<span class="fb-tab-dot"></span></div>'
      );
    })
    .join("");
}

var _fbObjData = {};

function fbSelectObjType(el, typeName) {
  _fssSaveObj();
  document.querySelectorAll("#objTypeList .fb-tab-item").forEach(function (t) {
    t.classList.remove("active");
  });
  el.classList.add("active");
  var data = appData.objectives.engagement_objectives.objective_types;
  var objType = data.find(function (o) {
    return o.objective_type === typeName;
  });
  if (!objType) return;
  var panel = document.getElementById("objThemePanel");
  var typeId = slugify(typeName);
  var rows = objType.themes
    .map(function (theme) {
      var tid = typeId + "-" + slugify(theme.theme);
      var opts =
        '<option value="">Select if applicable\u2026</option>' +
        theme.specific_objectives
          .filter(function (o) {
            return o && o !== "N/A";
          })
          .map(function (o) {
            return '<option value="' + o + '">' + o + "</option>";
          })
          .join("");
      return (
        '<div class="fb-theme-row">' +
        '<span class="fb-theme-name">' +
        theme.theme +
        "</span>" +
        '<div style="position:relative;">' +
        '<select id="obj-drop-' +
        tid +
        '" onchange="fbObjChange(\'' +
        typeId +
        "')\">" +
        opts +
        "</select>" +
        '<input type="text" id="obj-free-' +
        tid +
        '" style="display:none;" placeholder="Enter ' +
        theme.theme +
        ' objective...">' +
        "</div>" +
        '<button class="fb-manual-btn" onclick="fbToggleManual(\'obj-drop-' +
        tid +
        "','obj-free-" +
        tid +
        "',this)\">Manual</button>" +
        "</div>"
      );
    })
    .join("");
  panel.innerHTML =
    '<div class="fb-section-hint">Select a specific objective for each relevant theme</div>' +
    '<div class="fb-theme-table">' +
    rows +
    "</div>" +
    '<div class="fb-obj-context">' +
    '<div class="fb-label" style="margin-bottom:6px;">Additional Context</div>' +
    '<textarea id="obj-context-' +
    typeId +
    '" style="width:100%;padding:8px;border:1px solid var(--borderColor);border-radius:3px;font-size:13px;font-family:system-ui;min-height:64px;" placeholder="Any additional context for ' +
    typeName +
    '..." onchange="fbFieldChange(\'s3\')"></textarea>' +
    "</div>";
  _fssApplyObj(typeId);
}

function fbObjChange(typeId) {
  fbFieldChange("s3");
  fbEvalObjDot(typeId);
}
function fbEvalObjDot(typeId) {
  var tab = document.querySelector("#objTypeList .fb-tab-item.active");
  if (!tab) return;
  var filled = document.querySelectorAll('[id^="obj-drop-' + typeId + '"]');
  var hasVal = Array.from(filled).some(function (s) {
    return s.value;
  });
  tab.classList.toggle("has-data", hasVal);
  tab.querySelector(".fb-tab-dot").style.background = hasVal ? "#22c55e" : "";
  fbEvalDots();
}

function fbToggleManual(dropId, freeId, btn) {
  var drop = document.getElementById(dropId);
  var free = document.getElementById(freeId);
  if (!drop || !free) return;
  var isManual = free.style.display !== "none";
  drop.style.display = isManual ? "" : "none";
  free.style.display = isManual ? "none" : "";
  btn.textContent = isManual ? "Manual" : "Select";
}

// ════ S4: SERVICES ════
function renderServices() {
  var data = appData.services.domains;
  var list = document.getElementById("domainTabList");
  if (!list) return;
  list.innerHTML = data
    .map(function (d) {
      return (
        '<div class="fb-tab-item" onclick="fbSelectDomain(this,\'' +
        d.domain.replace(/'/g, "\\'") +
        "')\">" +
        d.domain +
        '<span class="fb-tab-dot"></span></div>'
      );
    })
    .join("");
}

function fbSelectDomain(el, domainName) {
  _fssSaveServices();
  document
    .querySelectorAll("#domainTabList .fb-tab-item")
    .forEach(function (t) {
      t.classList.remove("active");
    });
  el.classList.add("active");
  var data = appData.services.domains;
  var domain = data.find(function (d) {
    return d.domain === domainName;
  });
  if (!domain) return;
  var domId = slugify(domainName);
  var panel = document.getElementById("domainBlockPanel");
  var blocks = domain.building_blocks
    .map(function (bb) {
      var bbId = "bb-" + domId + "-" + slugify(bb.building_block);
      var descId = "bb-desc-" + bbId;
      var editId = "bb-edit-" + bbId;
      var shortDesc =
        bb.description.substring(0, 120) +
        (bb.description.length > 120 ? "…" : "");
      return (
        '<div class="fb-bb-item" id="' +
        bbId +
        '">' +
        "<div class=\"fb-bb-check\" onclick=\"fbToggleBB(this.closest('.fb-bb-item'),'" +
        domId +
        "')\">✓</div>" +
        '<div style="flex:1;min-width:0;">' +
        '<div style="display:flex;align-items:flex-start;gap:8px;">' +
        '<div class="fb-bb-name" style="flex:1;cursor:pointer;" onclick="fbToggleBB(this.closest(\'.fb-bb-item\'),\'' +
        domId +
        "')\">" +
        bb.building_block +
        "</div>" +
        '<button class="fb-bb-edit-btn" onclick="fbBBToggleEdit(\'' +
        descId +
        "','" +
        editId +
        '\',this)" id="' +
        editId +
        '">Edit</button>' +
        "</div>" +
        '<div class="fb-bb-desc fb-bb-tooltip" data-tip="' +
        bb.description.replace(/"/g, "&quot;") +
        '" id="' +
        descId +
        '-short" style="cursor:pointer;" onclick="fbToggleBB(this.closest(\'.fb-bb-item\'),\'' +
        domId +
        "')\">" +
        shortDesc +
        "</div>" +
        '<textarea class="fb-bb-desc-textarea" id="' +
        descId +
        '" style="display:none;" onchange="fbFieldChange(\'s4\')" placeholder="Edit description...">' +
        bb.description +
        "</textarea>" +
        "</div>" +
        "</div>"
      );
    })
    .join("");
  panel.innerHTML =
    '<div class="fb-bb-grid">' +
    blocks +
    "</div>" +
    '<div style="margin-top:14px;">' +
    '<div class="fb-label" style="margin-bottom:6px;">Additional Notes</div>' +
    '<textarea id="svc-notes-' +
    domId +
    '" style="width:100%;padding:8px;border:1px solid var(--borderColor);border-radius:3px;font-size:13px;font-family:system-ui;min-height:60px;" placeholder="Additional context for ' +
    domainName +
    '..." onchange="fbFieldChange(\'s4\')"></textarea>' +
    "</div>";
  _fssApplyServices(domId);
}

function fbBBToggleEdit(descId, editBtnId, btn) {
  var shortEl = document.getElementById(descId + "-short");
  var editEl = document.getElementById(descId);
  if (!shortEl || !editEl) return;
  var isEditing = editEl.style.display !== "none";
  if (isEditing) {
    shortEl.setAttribute("data-tip", editEl.value);
    var short =
      editEl.value.substring(0, 120) + (editEl.value.length > 120 ? "…" : "");
    shortEl.textContent = short;
    shortEl.style.display = "";
    editEl.style.display = "none";
    btn.textContent = "Edit";
  } else {
    shortEl.style.display = "none";
    editEl.style.display = "";
    editEl.focus();
    btn.textContent = "Done";
  }
}

function fbToggleBB(el, domId) {
  el.classList.toggle("selected");
  var tab = document.querySelector("#domainTabList .fb-tab-item.active");
  if (tab) {
    var hasAny =
      document.querySelectorAll("#domainBlockPanel .fb-bb-item.selected")
        .length > 0;
    tab.classList.toggle("has-data", hasAny);
    tab.querySelector(".fb-tab-dot").style.background = hasAny ? "#22c55e" : "";
  }
  fbEvalDots();
}

// ════ S5: TECHNOLOGY ════
function renderTechnologies() {
  var data = appData.technologies.technology_and_tools.categories;
  var list = document.getElementById("techCatList");
  if (!list) return;
  list.innerHTML = data
    .map(function (cat) {
      return (
        '<div class="fb-tab-item" onclick="fbSelectTechCat(this,\'' +
        cat.category.replace(/'/g, "\\'") +
        "')\">" +
        cat.category +
        '<span class="fb-tab-dot"></span></div>'
      );
    })
    .join("");
}

function fbSelectTechCat(el, catName) {
  _fssSaveTech();
  document.querySelectorAll("#techCatList .fb-tab-item").forEach(function (t) {
    t.classList.remove("active");
  });
  el.classList.add("active");
  var data = appData.technologies.technology_and_tools.categories;
  var cat = data.find(function (c) {
    return c.category === catName;
  });
  if (!cat) return;
  var catId = slugify(catName);
  var panel = document.getElementById("techDetailPanel");
  var subChips = cat.sub_categories
    .map(function (sub) {
      var subId = catId + "-" + slugify(sub.sub_category);
      return (
        '<span class="fb-chip" id="sub-' +
        subId +
        '" onclick="fbToggleTechSub(this,\'' +
        catId +
        "','" +
        sub.sub_category.replace(/'/g, "\\'") +
        "')\">" +
        sub.sub_category +
        "</span>"
      );
    })
    .join("");
  panel.innerHTML =
    '<div class="fb-detail-label">Sub-categories</div>' +
    '<div class="fb-chip-grid" id="tech-subs-' +
    catId +
    '">' +
    subChips +
    "</div>" +
    '<div id="tech-prods-' +
    catId +
    '"></div>' +
    '<div style="margin-top:14px;">' +
    '<div class="fb-label" style="margin-bottom:6px;">Additional Notes</div>' +
    '<textarea id="tech-notes-' +
    catId +
    '" style="width:100%;padding:8px;border:1px solid var(--borderColor);border-radius:3px;font-size:13px;font-family:system-ui;min-height:60px;" placeholder="Additional context..." onchange="fbFieldChange(\'s5\')"></textarea>' +
    "</div>";
  _fssApplyTech(slugify(catName));
}

function fbToggleTechSub(el, catId, subName) {
  el.classList.toggle("selected");
  var cat = appData.technologies.technology_and_tools.categories.find(
    function (c) {
      return slugify(c.category) === catId;
    },
  );
  var sub =
    cat &&
    cat.sub_categories.find(function (s) {
      return s.sub_category === subName;
    });
  var prodsDiv = document.getElementById("tech-prods-" + catId);
  // Rebuild all products for all selected subs
  if (prodsDiv && cat) {
    var selectedSubs = Array.from(
      document.querySelectorAll("#tech-subs-" + catId + " .fb-chip.selected"),
    ).map(function (c) {
      return c.textContent.trim();
    });
    if (selectedSubs.length === 0) {
      prodsDiv.innerHTML = "";
      return;
    }
    var html =
      '<div class="fb-detail-label">Products</div><div class="fb-chip-grid" id="tech-prod-chips-' +
      catId +
      '">';
    selectedSubs.forEach(function (sn) {
      var s = cat.sub_categories.find(function (x) {
        return x.sub_category === sn;
      });
      if (s && (s.products || s.options))
        (s.products || s.options).forEach(function (p) {
          html +=
            '<span class="fb-chip" onclick="this.classList.toggle(\'selected\');fbEvalDots();">' +
            p +
            "</span>";
        });
    });
    html += "</div>";
    prodsDiv.innerHTML = html;
  }
  // Update tab dot
  var tab = document.querySelector("#techCatList .fb-tab-item.active");
  if (tab) {
    var hasSel =
      document.querySelectorAll("#tech-subs-" + catId + " .fb-chip.selected")
        .length > 0;
    tab.classList.toggle("has-data", hasSel);
    tab.querySelector(".fb-tab-dot").style.background = hasSel ? "#22c55e" : "";
  }
  fbEvalDots();
}

// ════ S6: PARTNERS ════
function renderPartners() {
  var data = appData.partners.alliance_partners.partners;
  var list = document.getElementById("partnerTabList");
  if (!list) return;
  list.innerHTML = data
    .map(function (p) {
      return (
        '<div class="fb-tab-item" onclick="fbSelectPartner(this,\'' +
        p.partner.replace(/'/g, "\\'") +
        "')\">" +
        p.partner +
        '<span class="fb-tab-dot"></span></div>'
      );
    })
    .join("");
}

function fbSelectPartner(el, partnerName) {
  _fssSavePartners();
  document
    .querySelectorAll("#partnerTabList .fb-tab-item")
    .forEach(function (t) {
      t.classList.remove("active");
    });
  el.classList.add("active");
  var data = appData.partners.alliance_partners.partners;
  var partner = data.find(function (p) {
    return p.partner === partnerName;
  });
  if (!partner) return;
  var pid = slugify(partnerName);
  var panel = document.getElementById("partnerDetailPanel");
  var famChips = partner.product_families
    .map(function (fam) {
      return (
        '<span class="fb-chip" onclick="fbTogglePartnerFam(this,\'' +
        pid +
        "','" +
        fam.product_family.replace(/'/g, "\\'") +
        "')\">" +
        fam.product_family +
        "</span>"
      );
    })
    .join("");
  panel.innerHTML =
    '<div class="fb-detail-label">Product Families</div>' +
    '<div class="fb-chip-grid" id="partner-fams-' +
    pid +
    '">' +
    famChips +
    "</div>" +
    '<div id="partner-prods-' +
    pid +
    '"></div>' +
    '<div style="margin-top:14px;">' +
    '<div class="fb-label" style="margin-bottom:6px;">Additional Notes</div>' +
    '<textarea id="partner-notes-' +
    pid +
    '" style="width:100%;padding:8px;border:1px solid var(--borderColor);border-radius:3px;font-size:13px;font-family:system-ui;min-height:60px;" placeholder="Additional context for ' +
    partnerName +
    '..." onchange="fbFieldChange(\'s6\')"></textarea>' +
    "</div>";
  _fssApplyPartners(pid);
}

function fbTogglePartnerFam(el, pid, famName) {
  el.classList.toggle("selected");
  var partner = appData.partners.alliance_partners.partners.find(function (p) {
    return slugify(p.partner) === pid;
  });
  var prodsDiv = document.getElementById("partner-prods-" + pid);
  if (prodsDiv && partner) {
    var selFams = Array.from(
      document.querySelectorAll("#partner-fams-" + pid + " .fb-chip.selected"),
    ).map(function (c) {
      return c.textContent.trim();
    });
    if (selFams.length === 0) {
      prodsDiv.innerHTML = "";
    } else {
      var html =
        '<div class="fb-detail-label">Products</div><div class="fb-chip-grid">';
      selFams.forEach(function (fn) {
        var fam = partner.product_families.find(function (f) {
          return f.product_family === fn;
        });
        if (fam && fam.products)
          fam.products.forEach(function (p) {
            html +=
              '<span class="fb-chip" onclick="this.classList.toggle(\'selected\');fbEvalDots();">' +
              p +
              "</span>";
          });
      });
      html += "</div>";
      prodsDiv.innerHTML = html;
    }
  }
  var tab = document.querySelector("#partnerTabList .fb-tab-item.active");
  if (tab) {
    var hasSel =
      document.querySelectorAll("#partner-fams-" + pid + " .fb-chip.selected")
        .length > 0;
    tab.classList.toggle("has-data", hasSel);
    tab.querySelector(".fb-tab-dot").style.background = hasSel ? "#22c55e" : "";
  }
  fbEvalDots();
}

// ════ S7: REGULATORY ════
function renderRegulatory() {
  var data = appData.regulatory.regulatory_profile.industry_groups;
  var list = document.getElementById("regGroupList");
  if (!list) return;
  list.innerHTML = data
    .map(function (g) {
      return (
        '<div class="fb-tab-item" onclick="fbSelectRegGroup(this,\'' +
        g.industry_group.replace(/'/g, "\\'") +
        "')\">" +
        g.industry_group +
        '<span class="fb-tab-dot"></span></div>'
      );
    })
    .join("");
}

function fbSelectRegGroup(el, groupName) {
  _fssSaveReg();
  document.querySelectorAll("#regGroupList .fb-tab-item").forEach(function (t) {
    t.classList.remove("active");
  });
  el.classList.add("active");
  var data = appData.regulatory.regulatory_profile.industry_groups;
  var group = data.find(function (g) {
    return g.industry_group === groupName;
  });
  if (!group) return;
  var gid = slugify(groupName);
  var panel = document.getElementById("regDetailPanel");
  var items = group.regulators
    .map(function (reg) {
      var rid = gid + "-" + slugify(reg.regulator);
      var reqChips = reg.requirements
        .map(function (r) {
          return (
            '<span class="fb-chip" style="font-size:11px;" onclick="this.classList.toggle(\'selected\');fbEvalDots();">' +
            r +
            "</span>"
          );
        })
        .join("");
      return (
        '<div class="fb-check-group">' +
        '<div class="fb-check-item" onclick="fbToggleRegCheck(this,\'' +
        rid +
        "')\">" +
        '<div class="fb-check-box">✓</div>' +
        '<span class="fb-check-name">' +
        reg.regulator +
        "</span>" +
        '<span class="fb-check-expand">▾ Requirements</span>' +
        "</div>" +
        '<div class="fb-check-reqs" id="req-wrap-' +
        rid +
        '" style="display:none;">' +
        '<div class="fb-chip-grid">' +
        reqChips +
        "</div>" +
        "</div>" +
        "</div>"
      );
    })
    .join("");
  panel.innerHTML =
    '<div class="fb-section-hint">Select applicable regulators and their requirements</div>' +
    items;
  _fssApplyReg(gid);
}

function fbToggleRegCheck(el, rid) {
  el.classList.toggle("checked");
  el.classList.toggle("open", el.classList.contains("checked"));
  var wrap = document.getElementById("req-wrap-" + rid);
  if (wrap) wrap.style.display = el.classList.contains("checked") ? "" : "none";
  var tab = document.querySelector("#regGroupList .fb-tab-item.active");
  if (tab) {
    var hasSel =
      document.querySelectorAll("#regDetailPanel .fb-check-item.checked")
        .length > 0;
    tab.classList.toggle("has-data", hasSel);
    tab.querySelector(".fb-tab-dot").style.background = hasSel ? "#22c55e" : "";
  }
  fbEvalDots();
}

// ════ S8: RISK ════
function renderRisk() {
  var data = appData.risk.risk_profile.industry_groups;
  var list = document.getElementById("riskGroupList");
  if (!list) return;
  list.innerHTML = data
    .map(function (g) {
      return (
        '<div class="fb-tab-item" onclick="fbSelectRiskGroup(this,\'' +
        g.industry_group.replace(/'/g, "\\'") +
        "')\">" +
        g.industry_group +
        '<span class="fb-tab-dot"></span></div>'
      );
    })
    .join("");
}

function fbSelectRiskGroup(el, groupName) {
  _fssSaveRisk();
  document
    .querySelectorAll("#riskGroupList .fb-tab-item")
    .forEach(function (t) {
      t.classList.remove("active");
    });
  el.classList.add("active");
  var data = appData.risk.risk_profile.industry_groups;
  var group = data.find(function (g) {
    return g.industry_group === groupName;
  });
  if (!group) return;
  var gid = slugify(groupName);
  var panel = document.getElementById("riskDetailPanel");
  var items = group.risk_types
    .map(function (rt) {
      var rtid = gid + "-" + slugify(rt.risk_type);
      var chips = rt.specific_risks
        .map(function (r) {
          return (
            '<span class="fb-chip" style="font-size:11px;" onclick="this.classList.toggle(\'selected\');fbEvalDots();">' +
            r +
            "</span>"
          );
        })
        .join("");
      return (
        '<div class="fb-check-group">' +
        '<div class="fb-check-item" onclick="fbToggleRiskCheck(this,\'' +
        rtid +
        "')\">" +
        '<div class="fb-check-box">✓</div>' +
        '<span class="fb-check-name">' +
        rt.risk_type +
        "</span>" +
        '<span class="fb-check-expand">▾ Specific Risks</span>' +
        "</div>" +
        '<div class="fb-check-reqs" id="risk-wrap-' +
        rtid +
        '" style="display:none;">' +
        '<div class="fb-chip-grid">' +
        chips +
        "</div>" +
        "</div>" +
        "</div>"
      );
    })
    .join("");
  panel.innerHTML =
    '<div class="fb-section-hint">Select applicable risk types and specific risks</div>' +
    items;
  _fssApplyRisk(gid);
}

function fbToggleRiskCheck(el, rtid) {
  el.classList.toggle("checked");
  el.classList.toggle("open", el.classList.contains("checked"));
  var wrap = document.getElementById("risk-wrap-" + rtid);
  if (wrap) wrap.style.display = el.classList.contains("checked") ? "" : "none";
  var tab = document.querySelector("#riskGroupList .fb-tab-item.active");
  if (tab) {
    var hasSel =
      document.querySelectorAll("#riskDetailPanel .fb-check-item.checked")
        .length > 0;
    tab.classList.toggle("has-data", hasSel);
    tab.querySelector(".fb-tab-dot").style.background = hasSel ? "#22c55e" : "";
  }
  fbEvalDots();
}

// ════ renderAll override ════
function renderAll() {
  renderIndustry();
  renderObjectives();
  renderServices();
  renderTechnologies();
  renderPartners();
  renderRegulatory();
  renderRisk();
  fbInitScrollSpy();
  fbInitSections();
  setTimeout(fbEvalDots, 100);
}

function toggleRiskSpecifics(rtid, show) {
  const wrap = document.getElementById("risk-chips-" + rtid);
  if (wrap) wrap.style.display = show ? "flex" : "none";
}

function onRiskChange(gid, riskVal) {
  const specGrid = document.getElementById(`risk-spec-${gid}`);
  const cascade = document.getElementById(`risk-spec-cascade-${gid}`);
  if (!riskVal) {
    cascade.classList.remove("visible");
    return;
  }
  const group = appData.risk.risk_profile.industry_groups.find(
    (g) => slugify(g.industry_group) === gid,
  );
  if (!group) return;
  const rt = group.risk_types.find((r) => r.risk_type === riskVal);
  if (!rt) return;
  specGrid.innerHTML = rt.specific_risks
    .map(
      (r) =>
        `<div class="check-item" onclick="toggleCheckOnly(this)">${r}</div>`,
    )
    .join("");
  cascade.classList.add("visible");
}

// ── WORKFLOW ──
function setFieldError(fieldId, message) {
  var input = document.getElementById(fieldId);
  if (!input) return;
  // Support both old .field and new .fb-field wrappers
  var field = input.closest
    ? input.closest(".fb-field") || input.closest(".field")
    : null;
  var hasError = Boolean(message);
  if (field) field.classList.toggle("has-error", hasError);
  // New form error element
  var errEl = document.getElementById("err-" + fieldId);
  if (errEl) {
    errEl.textContent = message || "";
    errEl.style.display = hasError ? "block" : "none";
  }
  // Legacy error element
  var legacyErr = document.getElementById(fieldId + "Error");
  if (legacyErr) {
    legacyErr.textContent = message || "";
    legacyErr.style.display = hasError ? "block" : "none";
  }
}

function validateRequiredFields() {
  const required = [
    { id: "clientName", name: "Client name" },
    { id: "engagementName", name: "Engagement name" },
  ];
  let firstInvalid = null;
  let hasErrors = false;

  required.forEach(function (field) {
    const el = document.getElementById(field.id);
    const value = el && el.value ? el.value.trim() : "";
    if (!value) {
      hasErrors = true;
      if (!firstInvalid) firstInvalid = el;
      setFieldError(field.id, `${field.name} is required.`);
    } else {
      setFieldError(field.id, "");
    }
  });

  if (firstInvalid && typeof firstInvalid.focus === "function") {
    firstInvalid.focus();
  }

  if (hasErrors) {
    showToast(
      "Please complete all required fields before starting the workflow.",
      "error",
    );
  }
  return !hasErrors;
}

// #03 — count sections with meaningful data
function countFilledSections(data) {
  let count = 0;
  const ctx = data.engagement_context || {};
  if (ctx.industry || ctx.engagement_description || ctx.delivery_methodology)
    count++;
  if (
    (data.objectives || []).some(
      (o) => o.themes && o.themes.some((t) => t.specific_objective),
    )
  )
    count++;
  if (
    (data.service_offerings || []).some(
      (s) => s.building_blocks && s.building_blocks.length > 0,
    )
  )
    count++;
  if (
    (data.technology || []).some(
      (t) => t.sub_categories && t.sub_categories.length > 0,
    )
  )
    count++;
  if ((data.alliance_partners || []).length > 0) count++;
  if ((data.regulatory_profile || []).length > 0) count++;
  if ((data.risk_profile || []).length > 0) count++;
  return count;
}

function startWorkflow() {
  if (!appData || Object.keys(appData).length === 0) {
    showToast("Data is still loading — please wait a moment.", "warning");
    return;
  }
  if (!validateRequiredFields()) {
    return;
  }
  formData = compileForm();
  const filled = countFilledSections(formData);
  if (filled < 3) {
    openSparseBriefModal(filled);
    return; // modal will call confirmLaunchWorkflow() if user proceeds
  }
  openReviewPanel();
}
function confirmLaunchWorkflow() {
  closeReviewPanelDirect();
  // CHUNK 3: always do a fresh launch from review panel — bypass resume check
  completedSteps = new Set();
  doShowWorkflow();
}
function goBackToForm() {
  document.getElementById("formPage").classList.add("active");
  document.getElementById("workflowPage").classList.remove("active");
  document.getElementById("headerSubtitle").textContent = "Form";
}
function showWorkflow() {
  // CHUNK 3: if there is existing progress, offer resume vs restart
  if (completedSteps && completedSteps.size > 0) {
    document.getElementById("resumeStepCount").textContent =
      completedSteps.size;
    document.getElementById("resumeModal").classList.add("visible");
    return;
  }
  doShowWorkflow();
}
function doShowWorkflow() {
  document.getElementById("formPage").classList.remove("active");
  document.getElementById("workflowPage").classList.add("active");
  document.getElementById("headerSubtitle").textContent = "Workflow";
  document.getElementById("workflowTitle").textContent =
    `${formData.engagement_context.client_name} — ${formData.engagement_context.engagement_name}`;
  renderWorkflow();
  // CHANGE 5: Build phase filter pills after render
  buildPhaseFilterPills();
  // CHANGE 12: Show/hide tip banner based on localStorage
  try {
    var tipDismissed = localStorage.getItem("pwc_workflow_tip_dismissed");
    var tipBanner = document.getElementById("workflowTipBanner");
    if (tipBanner) tipBanner.style.display = tipDismissed ? "none" : "";
  } catch (e) {}
  const mainPanel = document.querySelector(".workflow-main");
  if (mainPanel) mainPanel.scrollTop = 0;
  setTimeout(function () {
    if (mainPanel) mainPanel.scrollTop = 0;
  }, 300);
  setTimeout(function () {
    if (mainPanel) mainPanel.scrollTop = 0;
  }, 700);
  // Always jump to the first workflow guidance step regardless of where the user was in the form guidance
  if (guidedMode && guidancePanel) {
    const firstWorkflowStep = guidanceSteps.findIndex(
      (s) => s.target === "promptCards",
    );
    if (firstWorkflowStep >= 0) {
      currentStep = firstWorkflowStep;
      setTimeout(function () {
        showGuidanceStep(currentStep);
      }, 500);
    }
  }
}

// ── RENDER WORKFLOW ──
function renderWorkflow() {
  const sidebar = document.getElementById("workflowSidebar");
  const cards = document.getElementById("promptCards");
  const workflow = appData.workflow;
  let sidebarHTML = "",
    cardsHTML = "";
  let totalSteps = 0;
  let phaseIndex = 0;

  workflow.phases.forEach((phase) => {
    phaseIndex++;
    const phaseStepCountForBadge = phase.prompts.length;
    sidebarHTML += `<div class="sidebar-phase"><div class="sidebar-phase-label"><span>Phase ${phaseIndex} &mdash; ${phase.phase_name}</span><span class="sidebar-phase-count-badge" id="sidebar-phase-badge-${phase.phase_id}">0/${phaseStepCountForBadge}</span></div>`;

    // CHANGE 1: Phase header banner in main cards area
    const phaseStepCount = phase.prompts.length;
    cardsHTML += `
        <div class="phase-divider" id="phase-divider-${phase.phase_id}" data-phase-id="${phase.phase_id}">
          <div class="phase-divider-left">
            <span class="phase-divider-number">Phase ${phaseIndex}</span>
            <span class="phase-divider-name">${phase.phase_name}</span>
          </div>
          <div class="phase-divider-right">
            <span class="phase-divider-count" id="phase-count-${phase.phase_id}">0 / ${phaseStepCount} complete</span>
            <div class="phase-divider-bar-outer"><div class="phase-divider-bar-inner" id="phase-bar-${phase.phase_id}" style="width:0%"></div></div>
          </div>
        </div>`;

    phase.prompts.forEach((prompt, idx) => {
      totalSteps++;
      const isFirst = phase.phase_id === "P1" && idx === 0;
      const status = isFirst ? "active" : "locked";

      // CHANGE 8: dependency tooltip text for locked cards
      const depsList =
        prompt.depends_on && prompt.depends_on.length
          ? prompt.depends_on.join(", ")
          : null;
      const depTooltip = depsList
        ? `Requires ${depsList} to be completed first.`
        : "";

      // CHANGE 10: aria attributes on sidebar items
      sidebarHTML += `
          <div class="sidebar-item ${status}" id="sidebar-${prompt.prompt_id}"
            role="button" tabindex="0"
            aria-label="Go to ${prompt.prompt_name}"
            onclick="scrollToCard('${prompt.prompt_id}')"
            onkeydown="if(event.key==='Enter'||event.key===' '){scrollToCard('${prompt.prompt_id}');}">
            <div class="step-dot">${prompt.prompt_id.replace("P", "")}</div>
            ${prompt.prompt_name}
          </div>`;

      const depsHTML = prompt.depends_on
        ? prompt.depends_on
            .map((d) => `<span class="dep-tag">${d}</span>`)
            .join(" ")
        : '<span class="dep-tag">None - first step</span>';

      cardsHTML += `
          <div class="prompt-card ${isFirst ? "active-card" : "locked-card"}" id="card-${prompt.prompt_id}" data-phase="${phase.phase_id}">
            <div class="prompt-card-header" onclick="toggleCard('${prompt.prompt_id}')"
              role="button" tabindex="0" aria-expanded="false" id="header-${prompt.prompt_id}"
              onkeydown="if(event.key==='Enter'||event.key===' '){toggleCard('${prompt.prompt_id}');}">
              <div class="prompt-card-header-left">
                <span class="prompt-id">${prompt.prompt_id}</span>
                <div>
                  <div class="prompt-name">${prompt.prompt_name}</div>
                  ${!isFirst && depTooltip ? `<div class="dep-sublabel">${depTooltip}</div>` : ""}
                </div>
              </div>
              <span class="status-badge ${isFirst ? "badge-ready" : "badge-locked"}" id="badge-${prompt.prompt_id}">
                ${isFirst ? "Ready" : "Locked"}
              </span>
            </div>
            <div class="prompt-card-body" id="body-${prompt.prompt_id}">
              <div class="meta-row">
                <span class="meta-label">Uses:</span>
                ${depsHTML}<span class="meta-label">Produces:</span>
                <span class="artifact-tag">${prompt.artifact}</span>
              </div>
              ${prompt.sign_off_gate ? `<div class="stage-gate">⚠ Stage Gate — sign-off required before proceeding</div>` : ""}
              <div class="prompt-box-header">
                <span class="prompt-box-label">Prompt:</span>
                <button class="btn-expand-prompt" id="expand-btn-${prompt.prompt_id}" onclick="toggleExpandPrompt('${prompt.prompt_id}')" aria-label="Expand prompt text">&#x26F6; Expand</button>
              </div>
              <div class="prompt-text-box" id="prompt-text-${prompt.prompt_id}"></div>
              <div class="prompt-actions">
                <div class="prompt-actions-left">
                  <button class="btn-copy" id="copy-btn-${prompt.prompt_id}" onclick="copyPrompt('${prompt.prompt_id}')" aria-label="Copy prompt to clipboard">Copy Prompt</button>
                  <button class="btn-export btn-secondary-action" id="export-btn-${prompt.prompt_id}" onclick="exportPrompt('${prompt.prompt_id}')" aria-label="Export prompt as text file">Export</button>
                  <button class="btn-edit-prompt" id="edit-btn-${prompt.prompt_id}" onclick="togglePromptEdit('${prompt.prompt_id}')">Edit</button>
                </div>
                <div class="prompt-actions-divider"></div>
                <div class="prompt-actions-right">
                  <button class="btn-mark-done" id="done-btn-${prompt.prompt_id}" onclick="markDone('${prompt.prompt_id}')">✓ Mark Complete</button>
                  <button class="btn-reopen" id="reopen-btn-${prompt.prompt_id}" onclick="reopenStep('${prompt.prompt_id}')">↩ Reopen</button>
                </div>
              </div>
            </div>
          </div>`;
    });
    sidebarHTML += `</div>`;
  });

  sidebar.innerHTML = sidebarHTML;
  cards.innerHTML = cardsHTML;
  document.getElementById("card-P1.1").classList.add("open");
  document.getElementById("header-P1.1") &&
    document
      .getElementById("header-P1.1")
      .setAttribute("aria-expanded", "true");
  setTimeout(function () {
    const mainPanel = document.querySelector(".workflow-main");
    if (mainPanel) mainPanel.scrollTop = 0;
  }, 600);
  document.getElementById("progressText").textContent =
    `0 of ${totalSteps} steps complete`;
  // Update sidebar summary initial state
  var sidebarCount = document.getElementById("sidebarSummaryCount");
  if (sidebarCount) sidebarCount.textContent = "0 of " + totalSteps + " steps";
  updatePhaseProgress();
  updateSidebarPhaseBadges();
  loadAllPrompts(workflow);
}

// ── LOAD PROMPTS FROM INLINED DATA ──
function loadAllPrompts(workflow) {
  for (const phase of workflow.phases) {
    for (const prompt of phase.prompts) {
      const el = document.getElementById(`prompt-text-${prompt.prompt_id}`);
      if (!el) continue;
      const json = INLINED_PROMPTS[prompt.file];
      if (!json) {
        el.textContent = `[Prompt not found: ${prompt.file}]`;
        el.style.color = "#f87171";
        continue;
      }
      const text = buildPromptText(prompt, json, formData);
      el.textContent = text;
    }
  }
}

// ── BUILD PROMPT TEXT ──
function buildPromptContext(data) {
  const context = {
    engagement_context: data.engagement_context || {},
    industry: data.industry || {},
    objectives: data.objectives || [],
    service_offerings: data.service_offerings || [],
    technology: data.technology || [],
    alliance_partners: data.alliance_partners || [],
    regulatory_profile: data.regulatory_profile || [],
    risk_profile: data.risk_profile || [],
  };
  return JSON.stringify(context, null, 2);
}

// ── PER-PROMPT DATA ROUTING TABLE (Chunk 5 — #21 & #22) ──
// Maps each prompt_id to the data keys it should receive.
// 'FULL' = entire compiled form (used only by P1.1).
// All other entries receive only the listed keys, ensuring each prompt
// gets the full relevant subset rather than a truncated 8-field snapshot.
const PROMPT_DATA_ROUTING = {
  "P1.1": "FULL",
  "P1.2": [
    "engagement_context",
    "industry",
    "objectives",
    "service_offerings",
    "technology",
    "alliance_partners",
  ],
  "P1.3": [
    "engagement_context",
    "industry",
    "objectives",
    "service_offerings",
    "technology",
    "regulatory_profile",
  ],
  "P1.4": [
    "engagement_context",
    "industry",
    "objectives",
    "service_offerings",
    "technology",
    "alliance_partners",
    "regulatory_profile",
    "risk_profile",
  ],
  "P1.5": [
    "engagement_context",
    "industry",
    "objectives",
    "service_offerings",
    "alliance_partners",
    "regulatory_profile",
  ],
  "P2.1": [
    "engagement_context",
    "industry",
    "objectives",
    "service_offerings",
    "technology",
  ],
  "P2.2": [
    "engagement_context",
    "industry",
    "objectives",
    "service_offerings",
    "technology",
    "alliance_partners",
  ],
  "P2.3": [
    "engagement_context",
    "industry",
    "objectives",
    "service_offerings",
    "technology",
  ],
  "P2.4": [
    "engagement_context",
    "industry",
    "objectives",
    "service_offerings",
    "technology",
    "regulatory_profile",
    "risk_profile",
  ],
  "P2.5": [
    "engagement_context",
    "industry",
    "objectives",
    "service_offerings",
    "alliance_partners",
  ],
  "P2.6": [
    "engagement_context",
    "industry",
    "objectives",
    "service_offerings",
    "regulatory_profile",
  ],
  "P2.7": [
    "engagement_context",
    "industry",
    "objectives",
    "service_offerings",
  ],
  "P2.8": [
    "engagement_context",
    "industry",
    "objectives",
    "service_offerings",
    "technology",
    "alliance_partners",
    "regulatory_profile",
    "risk_profile",
  ],
};

// Build a data slice for a given prompt_id from the full compiled form.
// Chunk 5 #22: engagement_context always carries the new S1 fields
// (delivery_methodology, fee_structure, total_budget, engagement_lead,
//  engagement_description) — they flow automatically to any prompt that
//  includes 'engagement_context' in its routing entry.
function buildPromptDataSlice(promptId, data) {
  const keys = PROMPT_DATA_ROUTING[promptId];
  if (!keys || keys === "FULL") return data;
  const slice = {};
  keys.forEach(function (k) {
    if (data[k] !== undefined) slice[k] = data[k];
  });
  return slice;
}

function buildPromptText(prompt, promptJson, data) {
  const instruction =
    promptJson.instruction || "[Instruction not found in prompt file]";
  const pid = prompt.prompt_id;

  // P1.1 — inject global standards + FULL engagement data
  if (pid === "P1.1") {
    const briefJson = JSON.stringify(data, null, 2);
    return instruction
      .replace("{{SS_1}}", GLOBAL_STANDARDS.SS1)
      .replace("{{DD_1}}", GLOBAL_STANDARDS.DD1)
      .replace("{{WE_1}}", GLOBAL_STANDARDS.WE1)
      .replace("{{ENGAGEMENT_DATA}}", briefJson);
  }

  // All other prompts — build curated data slice for this prompt
  const slice = buildPromptDataSlice(pid, data);
  const sliceJson = JSON.stringify(slice, null, 2);

  // If the instruction already contains {{ENGAGEMENT_DATA}}, replace it
  // with the curated slice (legacy support)
  if (instruction.includes("{{ENGAGEMENT_DATA}}")) {
    return instruction.replace("{{ENGAGEMENT_DATA}}", sliceJson);
  }

  // Standard path — replace {{PROMPT_DATA}} placeholder appended to each instruction
  if (instruction.includes("{{PROMPT_DATA}}")) {
    const dataBlock = buildPromptDataBlock(pid, slice, sliceJson);
    return instruction.replace("{{PROMPT_DATA}}", dataBlock);
  }

  // Fallback (should not be reached after Chunk 5 update)
  return (
    instruction + "\n\n---\n\n" + buildPromptDataBlock(pid, slice, sliceJson)
  );
}

// Format the data block with a descriptive header so the AI gets clear context
function buildPromptDataBlock(promptId, slice, sliceJson) {
  const keys = Object.keys(slice);
  const summary = keys
    .map(function (k) {
      const v = slice[k];
      if (Array.isArray(v))
        return (
          k + " (" + v.length + " item" + (v.length !== 1 ? "s" : "") + ")"
        );
      if (typeof v === "object" && v !== null)
        return k + " (" + Object.keys(v).length + " fields)";
      return k;
    })
    .join(", ");
  return (
    "ENGAGEMENT DATA FOR " +
    promptId +
    "\nFields: " +
    summary +
    "\n\n" +
    sliceJson
  );
}

// ── WORKFLOW CONTROLS ──
function toggleCard(id) {
  const card = document.getElementById(`card-${id}`);
  if (!card) return;
  // Locked cards can only be toggled if they have been overridden via sidebar navigation
  if (card.classList.contains("locked-card") && !card.classList.contains("sidebar-override")) return;
  card.classList.toggle("open");
  const headerEl = document.getElementById("header-" + id);
  if (headerEl)
    headerEl.setAttribute(
      "aria-expanded",
      card.classList.contains("open") ? "true" : "false",
    );
}
function scrollToCard(id) {
  const card = document.getElementById(`card-${id}`);
  if (!card) return;
  card.classList.add("open");
  // If the card is locked, add a sidebar-override so it becomes interactive
  if (card.classList.contains("locked-card")) {
    card.classList.add("sidebar-override");
  }
  // Update header aria state
  const headerEl = document.getElementById("header-" + id);
  if (headerEl) headerEl.setAttribute("aria-expanded", "true");
  setTimeout(function () {
    const mainPanel = document.querySelector(".workflow-main");
    const cardTop =
      card.getBoundingClientRect().top -
      mainPanel.getBoundingClientRect().top +
      mainPanel.scrollTop -
      120;
    mainPanel.scrollTo({ top: cardTop, behavior: "smooth" });
  }, 50);
}
function copyPrompt(id) {
  const text = document.getElementById(`prompt-text-${id}`).textContent;
  navigator.clipboard.writeText(text).then(() => {
    const btn = document.getElementById(`copy-btn-${id}`);
    btn.textContent = "✓ Copied!";
    btn.classList.add("copied");
    setTimeout(() => {
      btn.innerHTML = "Copy Prompt";
      btn.classList.remove("copied");
    }, 2000);
  });
}
function exportPrompt(id) {
  const text = document.getElementById(`prompt-text-${id}`).textContent;
  const blob = new Blob([text], { type: "text/plain" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  const clientSlug = (
    (document.getElementById("clientName") || {}).value || "Client"
  )
    .replace(/[^a-zA-Z0-9]/g, "_")
    .replace(/_+/g, "_")
    .replace(/^_|_$/g, "");
  const engSlug = (
    (document.getElementById("engagementName") || {}).value || "Engagement"
  )
    .replace(/[^a-zA-Z0-9]/g, "_")
    .replace(/_+/g, "_")
    .replace(/^_|_$/g, "");
  const promptNames = {};
  (appData.workflow || { phases: [] }).phases.forEach((ph) =>
    ph.prompts.forEach((p) => {
      promptNames[p.prompt_id] = p.prompt_name
        .replace(/[^a-zA-Z0-9]/g, "_")
        .replace(/_+/g, "_");
    }),
  );
  const pName = promptNames[id] || id;
  a.download = `${clientSlug}_${engSlug}_${id}_${pName}.txt`;
  document.body.appendChild(a);
  a.click();
  setTimeout(function () {
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
  }, 1000);
  const btn = document.getElementById(`export-btn-${id}`);
  if (btn) {
    btn.textContent = "✓ Exported!";
    setTimeout(() => {
      btn.innerHTML = "Export";
    }, 2000);
  }
}
function markDone(id) {
  // CHUNK 3: check if this is a sign-off gate
  let isGate = false;
  if (appData && appData.workflow) {
    appData.workflow.phases.forEach(function (ph) {
      ph.prompts.forEach(function (p) {
        if (p.prompt_id === id && p.sign_off_gate) isGate = true;
      });
    });
  }
  if (isGate) {
    _pendingGateId = id;
    document.getElementById("gateModalTitle").textContent =
      "Stage Gate Sign-Off";
    // reset checkboxes
    document
      .querySelectorAll("#gateModalChecklist input[type=checkbox]")
      .forEach(function (cb) {
        cb.checked = false;
      });
    checkGateReady();
    document.getElementById("gateModal").classList.add("visible");
    return;
  }
  doMarkDone(id);
}
function doMarkDone(id) {
  completedSteps.add(id);
  const card = document.getElementById("card-" + id);
  const badge = document.getElementById("badge-" + id);
  const sidebarItem = document.getElementById("sidebar-" + id);
  const headerEl = document.getElementById("header-" + id);
  if (card) {
    card.classList.remove("active-card");
    card.classList.add("completed-card");
    card.classList.remove("open");
  }
  if (badge) {
    badge.textContent = "Complete";
    badge.className = "status-badge badge-done";
  }
  if (sidebarItem) {
    sidebarItem.classList.remove("active");
    sidebarItem.classList.add("completed");
    sidebarItem.setAttribute("tabindex", "0");
  }
  if (headerEl) headerEl.setAttribute("aria-expanded", "false");
  unlockNextSteps();
  updateProgress();
  // Save progress to localStorage
  try {
    localStorage.setItem(
      "pwc_launchpad_progress",
      JSON.stringify(Array.from(completedSteps)),
    );
  } catch (e) {}
  // CHANGE 4: Open next ready card, scroll to it, and pulse-highlight it
  const allCards = document.querySelectorAll(".prompt-card");
  for (var i = 0; i < allCards.length; i++) {
    var c = allCards[i];
    if (
      c.classList.contains("active-card") &&
      !c.classList.contains("completed-card")
    ) {
      c.classList.add("open");
      var nextCard = c;
      var nextSidebar = document.getElementById(
        "sidebar-" + nextCard.id.replace("card-", ""),
      );
      if (nextSidebar) nextSidebar.setAttribute("tabindex", "0");
      setTimeout(
        (function (card) {
          return function () {
            var mainPanel = document.querySelector(".workflow-main");
            var cardTop =
              card.getBoundingClientRect().top -
              mainPanel.getBoundingClientRect().top +
              mainPanel.scrollTop -
              120;
            mainPanel.scrollTo({ top: cardTop, behavior: "smooth" });
            // Pulse highlight
            setTimeout(function () {
              card.classList.add("card-pulse");
              setTimeout(function () {
                card.classList.remove("card-pulse");
              }, 1200);
            }, 400);
          };
        })(c),
        50,
      );
      break;
    }
  }
}
function unlockNextSteps() {
  appData.workflow.phases.forEach((phase) => {
    phase.prompts.forEach((prompt) => {
      if (!prompt.depends_on) return;
      const allDepsDone = prompt.depends_on.every((dep) =>
        completedSteps.has(dep),
      );
      if (allDepsDone) {
        const card = document.getElementById(`card-${prompt.prompt_id}`);
        const badge = document.getElementById(`badge-${prompt.prompt_id}`);
        const sidebarItem = document.getElementById(
          `sidebar-${prompt.prompt_id}`,
        );
        const headerEl = document.getElementById(`header-${prompt.prompt_id}`);
        // Remove dep-sublabel once unlocked
        const depSub = card && card.querySelector(".dep-sublabel");
        if (card && card.classList.contains("locked-card")) {
          card.classList.remove("locked-card");
          card.classList.add("active-card");
          if (depSub) depSub.style.display = "none";
          if (badge) {
            badge.textContent = "Ready";
            badge.className = "status-badge badge-ready";
          }
          if (sidebarItem) {
            sidebarItem.classList.remove("locked");
            sidebarItem.classList.add("active");
            sidebarItem.setAttribute("tabindex", "0");
          }
          if (headerEl) {
            headerEl.setAttribute("tabindex", "0");
          }
        }
      }
    });
  });
}
function updateProgress() {
  const total = appData.workflow.phases.reduce(
    (sum, p) => sum + p.prompts.length,
    0,
  );
  const done = completedSteps.size;
  const pct = Math.round((done / total) * 100);
  document.getElementById("progressFill").style.width = `${pct}%`;
  document.getElementById("progressText").textContent =
    `${done} of ${total} steps complete`;
  // Per-phase breakdown text
  const phaseBreakdown = appData.workflow.phases
    .map((p) => {
      const pDone = p.prompts.filter((pr) =>
        completedSteps.has(pr.prompt_id),
      ).length;
      return `${p.phase_name}: ${pDone}/${p.prompts.length}`;
    })
    .join(" · ");
  const pbEl = document.getElementById("progressBreakdown");
  if (pbEl) pbEl.textContent = phaseBreakdown;
  // Update sidebar summary bar
  var sidebarBar = document.getElementById("sidebarSummaryBar");
  var sidebarCount = document.getElementById("sidebarSummaryCount");
  var sidebarSubtext = document.getElementById("sidebarSummarySubtext");
  if (sidebarBar) sidebarBar.style.width = pct + "%";
  if (sidebarCount) sidebarCount.textContent = done + " of " + total + " steps";
  if (sidebarSubtext) {
    if (done === 0) sidebarSubtext.textContent = "Get started below";
    else if (done === total) sidebarSubtext.textContent = "All steps complete!";
    else sidebarSubtext.textContent = pct + "% complete";
  }
  updatePhaseProgress();
  updateSidebarPhaseBadges();
}

function updateSidebarPhaseBadges() {
  if (!appData || !appData.workflow) return;
  appData.workflow.phases.forEach(function (phase) {
    var total = phase.prompts.length;
    var done = phase.prompts.filter(function (p) {
      return completedSteps.has(p.prompt_id);
    }).length;
    var badge = document.getElementById("sidebar-phase-badge-" + phase.phase_id);
    if (!badge) return;
    badge.textContent = done + "/" + total;
    if (done === total) {
      badge.classList.add("phase-all-done");
    } else {
      badge.classList.remove("phase-all-done");
    }
  });
}

function updatePhaseProgress() {
  if (!appData || !appData.workflow) return;
  appData.workflow.phases.forEach((phase) => {
    const total = phase.prompts.length;
    const done = phase.prompts.filter((p) =>
      completedSteps.has(p.prompt_id),
    ).length;
    const pct = total > 0 ? Math.round((done / total) * 100) : 0;
    const countEl = document.getElementById("phase-count-" + phase.phase_id);
    const barEl = document.getElementById("phase-bar-" + phase.phase_id);
    if (countEl) countEl.textContent = done + " / " + total + " complete";
    if (barEl) barEl.style.width = pct + "%";
  });
}

// ── FORM COMPILATION ──

/// CHANGE 5: Build phase filter pills dynamically
function buildPhaseFilterPills() {
  var container = document.getElementById("phaseFilterPills");
  if (!container || !appData || !appData.workflow) return;
  var html =
    '<span class="phase-filter-label">Filter:</span><button class="phase-filter-pill active" data-phase="all" onclick="filterByPhase(&quot;all&quot;)" tabindex="0">All</button>';
  appData.workflow.phases.forEach(function (p) {
    html +=
      '<button class="phase-filter-pill" data-phase="' +
      p.phase_id +
      '" onclick="filterByPhase(&quot;' +
      p.phase_id +
      '&quot;)" tabindex="0">' +
      p.phase_name +
      "</button>";
  });
  container.innerHTML = html;
}

// CHANGE 12: Dismiss workflow tip banner
function dismissWorkflowTip() {
  var tip = document.getElementById("workflowTipBanner");
  if (tip) {
    tip.style.display = "none";
    try {
      localStorage.setItem("pwc_workflow_tip_dismissed", "1");
    } catch (e) {}
  }
}

// CHANGE 5: Phase filter / jump to phase
function filterByPhase(phaseId) {
  // Update pill active state
  document.querySelectorAll(".phase-filter-pill").forEach(function (p) {
    p.classList.toggle("active", p.getAttribute("data-phase") === phaseId);
  });
  const allCards = document.querySelectorAll(".prompt-card");
  const allDividers = document.querySelectorAll(".phase-divider");
  if (phaseId === "all") {
    allCards.forEach(function (c) {
      c.style.display = "";
    });
    allDividers.forEach(function (d) {
      d.style.display = "";
    });
    return;
  }
  allCards.forEach(function (c) {
    c.style.display = c.getAttribute("data-phase") === phaseId ? "" : "none";
  });
  allDividers.forEach(function (d) {
    d.style.display = d.getAttribute("data-phase-id") === phaseId ? "" : "none";
  });
  // Scroll to the phase divider
  var divider = document.getElementById("phase-divider-" + phaseId);
  if (divider) {
    var mainPanel = document.querySelector(".workflow-main");
    var top =
      divider.getBoundingClientRect().top -
      mainPanel.getBoundingClientRect().top +
      mainPanel.scrollTop -
      8;
    mainPanel.scrollTo({ top: top, behavior: "smooth" });
  }
}

function compileForm() {
  return {
    engagement_context: {
      client_name: (document.getElementById("clientName") || {}).value || "",
      engagement_name:
        (document.getElementById("engagementName") || {}).value || "",
      engagement_lead:
        (document.getElementById("engagementLead") || {}).value || "",
      start_date: (document.getElementById("startDate") || {}).value || "",
      end_date: (document.getElementById("endDate") || {}).value || "",
      delivery_methodology:
        (document.getElementById("deliveryMethodology") || {}).value || "",
      fee_structure:
        (document.getElementById("feeStructure") || {}).value || "",
      total_budget: (document.getElementById("totalBudget") || {}).value || "",
      engagement_description:
        (document.getElementById("engagementDescription") || {}).value || "",
    },
    industry: {
      industry: (document.getElementById("industryDrop") || {}).value || "",
      sector: (document.getElementById("sectorDrop") || {}).value || "",
      sub_sector: (document.getElementById("subsectorDrop") || {}).value || "",
    },
    objectives: compileObjectives(),
    service_offerings: compileServices(),
    technology: compileTech(),
    alliance_partners: compilePartners(),
    regulatory_profile: compileReg(),
    risk_profile: compileRisk(),
  };
}

function compileObjectives() {
  var result = [];
  if (!appData.objectives) return result;
  appData.objectives.engagement_objectives.objective_types.forEach(
    function (objType) {
      var typeId = slugify(objType.objective_type);
      var themes = [];
      objType.themes.forEach(function (theme) {
        var themeId = typeId + "-" + slugify(theme.theme);
        var drop = document.getElementById("obj-drop-" + themeId);
        var free = document.getElementById("obj-free-" + themeId);
        var val = "";
        if (free && free.style.display !== "none")
          val = (free.value || "").trim();
        else if (drop) val = drop.value;
        if (val) themes.push({ theme: theme.theme, specific_objective: val });
      });
      var ctx = document.getElementById("obj-context-" + typeId);
      if (themes.length > 0 || (ctx && ctx.value)) {
        result.push({
          objective_type: objType.objective_type,
          themes: themes,
          context: ctx ? ctx.value : "",
        });
      }
    },
  );
  return result;
}

function compileServices() {
  var result = [];
  if (!appData.services) return result;
  appData.services.domains.forEach(function (domain) {
    var domId = slugify(domain.domain);
    var selected = [];
    domain.building_blocks.forEach(function (bb) {
      var bbId = "bb-" + domId + "-" + slugify(bb.building_block);
      var el = document.getElementById(bbId);
      if (el && el.classList.contains("selected")) {
        selected.push({
          building_block: bb.building_block,
          description: bb.description,
        });
      }
    });
    var notes = document.getElementById("svc-notes-" + domId);
    if (selected.length > 0 || (notes && notes.value)) {
      result.push({
        domain: domain.domain,
        building_blocks: selected,
        notes: notes ? notes.value : "",
      });
    }
  });
  return result;
}

function compileTech() {
  var result = [];
  if (!appData.technologies) return result;
  appData.technologies.technology_and_tools.categories.forEach(function (cat) {
    var catId = slugify(cat.category);
    var subChips = document.querySelectorAll(
      "#tech-subs-" + catId + " .fb-chip.selected",
    );
    if (subChips.length === 0) return;
    var subCats = Array.from(subChips).map(function (c) {
      return c.textContent.trim();
    });
    var prodChips = document.querySelectorAll(
      "#tech-prod-chips-" + catId + " .fb-chip.selected",
    );
    var products = Array.from(prodChips).map(function (c) {
      return c.textContent.trim();
    });
    var notes = document.getElementById("tech-notes-" + catId);
    result.push({
      category: cat.category,
      sub_categories: subCats,
      products: products,
      notes: notes ? notes.value : "",
    });
  });
  return result;
}

function compilePartners() {
  var result = [];
  if (!appData.partners) return result;
  appData.partners.alliance_partners.partners.forEach(function (partner) {
    var pid = slugify(partner.partner);
    var famChips = document.querySelectorAll(
      "#partner-fams-" + pid + " .fb-chip.selected",
    );
    if (famChips.length === 0) return;
    var families = Array.from(famChips).map(function (c) {
      return c.textContent.trim();
    });
    var prodChips = document.querySelectorAll(
      "#partner-prods-" + pid + " .fb-chip.selected",
    );
    var products = Array.from(prodChips).map(function (c) {
      return c.textContent.trim();
    });
    var notes = document.getElementById("partner-notes-" + pid);
    result.push({
      partner: partner.partner,
      product_families: families,
      products: products,
      notes: notes ? notes.value : "",
    });
  });
  return result;
}

function compileReg() {
  var result = [];
  var checked = document.querySelectorAll(
    "#regDetailPanel .fb-check-item.checked",
  );
  checked.forEach(function (el) {
    var name = el.querySelector(".fb-check-name");
    if (!name) return;
    var regName = name.textContent.trim();
    var reqDiv = el.nextElementSibling;
    var reqs = [];
    if (reqDiv) {
      reqDiv.querySelectorAll(".fb-chip.selected").forEach(function (c) {
        reqs.push(c.textContent.trim());
      });
    }
    result.push({ regulator: regName, requirements: reqs });
  });
  return result;
}

function compileRisk() {
  var result = [];
  var checked = document.querySelectorAll(
    "#riskDetailPanel .fb-check-item.checked",
  );
  checked.forEach(function (el) {
    var name = el.querySelector(".fb-check-name");
    if (!name) return;
    var riskType = name.textContent.trim();
    var riskDiv = el.nextElementSibling;
    var risks = [];
    if (riskDiv) {
      riskDiv.querySelectorAll(".fb-chip.selected").forEach(function (c) {
        risks.push(c.textContent.trim());
      });
    }
    result.push({ risk_type: riskType, specific_risks: risks });
  });
  return result;
}

// ── GUIDED EXPERIENCE ──
const guidanceSteps = [
  {
    target: "formPage",
    title: "Welcome to the Engagement Brief",
    text: "This form captures everything the AI needs to generate your full planning suite. Work through each section carefully - the more detail you provide, the better your planning documents will be.",
    example: null,
    position: "center",
  },
  {
    target: "clientName",
    title: "Client Name",
    text: "Enter the full legal name of the client organisation. This will appear on the cover of every document generated and in all engagement records.",
    example:
      "e.g. Commonwealth Bank of Australia, Department of Health, Telstra Corporation Limited",
    position: "below",
  },
  {
    target: "engagementName",
    title: "Engagement Name",
    text: "Give this engagement a clear, descriptive name that reflects what you are doing and for whom. Avoid internal codes - use a name that means something to the client.",
    example:
      "e.g. Finance Transformation Program, SAP S/4HANA Implementation, Operating Model Redesign",
    position: "below",
  },
  {
    target: "startDate",
    title: "Estimated Dates",
    text: "Enter the expected start and end date for the engagement. If not yet confirmed use your best estimate - it can be updated in the planning documents later.",
    example: null,
    position: "below",
  },
  {
    target: "s2",
    title: "Industry",
    text: "Select the client's industry, sector and sub-sector. This drives industry-specific content across all planning documents, regulatory requirements, risk profiles, stakeholder norms and more.",
    example:
      "e.g. Financial Services → Banking and Capital Markets → Retail Banking",
    position: "below",
    openSection: "s2",
  },
  {
    target: "s3",
    title: "Engagement Objectives",
    text: "Select all objective types that apply to this engagement then drill down to the specific objectives within each type. The more precisely you define the objectives the sharper the planning outputs will be.",
    example:
      "e.g. Business Problem → Technology & Systems → Ageing legacy technology",
    position: "below",
    openSection: "s3",
  },
  {
    target: "s4",
    title: "Service Offerings",
    text: "Select the PwC domains and building blocks that will be delivered in this engagement. When you select a building block its description will appear, you can edit this to reflect how it applies specifically to this client.",
    example: "e.g. Data & AI → Data Engineering & Data Modernization",
    position: "below",
    openSection: "s4",
  },
  {
    target: "s5",
    title: "Technology & Tools",
    text: "Select the technologies already in use or being implemented at the client. This gives the AI the context to tailor technical planning documents and identify technology-specific risks.",
    example: "e.g. ERP & Business Applications → Core ERP → SAP S/4HANA",
    position: "below",
    openSection: "s5",
  },
  {
    target: "s6",
    title: "Alliance Partners",
    text: "Select any alliance partners whose products are involved in this engagement. This helps the AI identify partner-specific workstreams, risks and governance considerations.",
    example: "e.g. SAP → ERP & Finance → SAP S/4HANA Cloud",
    position: "below",
    openSection: "s6",
  },
  {
    target: "s7",
    title: "Regulatory Profile",
    text: "Select the regulatory bodies and specific requirements applicable to this engagement. This drives the compliance content across the Risk Register, Scope Statement and Engagement Charter.",
    example: "e.g. Financial Services → APRA → CPS 234 Information Security",
    position: "below",
    openSection: "s7",
  },
  {
    target: "s8",
    title: "Risk Profile",
    text: "Select the risk categories and specific risks most relevant to this engagement. The more risks you identify here the more comprehensive your Risk Register will be from day one.",
    example:
      "e.g. All Industries → Technology & Cyber Risk → Legacy system risk",
    position: "below",
    openSection: "s8",
  },
  {
    target: "formPage",
    title: "How to Fill In Each Field",
    text: "For every field in the form you have three options: pick a value from the dropdown or multi-select grid, click <strong>Enter manually</strong> to type your own custom answer, or simply leave the field blank if it is not relevant. All three are valid.",
    example:
      'Tip: Dropdowns give you structured options, but "Enter manually" lets you say exactly what you mean.',
    position: "center",
    highlightToggleBtn: true,
  },
  {
    target: "formPage",
    title: 'Using "Enter Manually"',
    text: "Clicking <strong>Enter manually</strong> on any field replaces the dropdown with a free-text box so you can write your own value. This is useful when the pre-built options do not quite fit your engagement. Click it again to switch back to the dropdown.",
    example:
      "e.g. Type a bespoke service description, a niche regulator name, or a specific risk that is not in the list.",
    position: "center",
    highlightToggleBtn: true,
  },
  {
    target: "formPage",
    title: "Leaving Fields Blank",
    text: "You do not need to fill in every field. If a section is not relevant to your engagement, leave it blank, the AI will simply omit that context from the prompts it generates. Focus on the sections that matter most.",
    example:
      "Tip: A focused brief with accurate detail in fewer sections will produce better outputs than a partially-filled form across all sections.",
    position: "center",
  },
  {
    target: "formPage",
    title: "Ready to Go - Head to the Workflow",
    text: "Your Engagement Brief is complete. Click <strong>Start Workflow →</strong> at the top of this page to move to the Workflow tab and begin generating your planning suite.",
    example:
      "Tip: Keep this browser tab open throughout the workflow, each prompt references the outputs from previous steps.",
    position: "center",
    goToWorkflow: true,
  },
  {
    target: "promptCards",
    title: "Welcome to Your Workflow",
    text: "Each card is a planning step in sequence. Steps are <strong>locked</strong> until their pre-cursor prompts have been completed, this is intentional. Each prompt builds directly on the outputs of the ones before it, so the order matters.",
    example:
      "Tip: You will see steps unlock automatically as you mark earlier ones complete.",
    position: "side",
  },
  {
    target: "card-P1.1",
    title: "Start with P1.1",
    text: "P1.1 is already unlocked and ready to run. Click <strong>Copy Prompt</strong> to copy the full prompt text, then paste it into your AI tool. Once the AI has finished and you have reviewed the output, click <strong>Mark Complete</strong> to unlock the next step.",
    example: null,
    position: "side",
  },
  {
    target: "card-P1.1",
    title: "Enable Code Interpreter",
    text: "Before running any prompt, make sure <strong>Code Interpreter</strong> (or the equivalent tool in your AI platform) is enabled. The prompts rely on it to process structured data correctly. Without it, outputs may be incomplete or incorrectly formatted.",
    example:
      'In ChatGPT: open a new chat → click the "+" or tools icon → enable Code Interpreter. In other tools, look for "Advanced Data Analysis" or a similar setting.',
    position: "side",
  },
  {
    target: "card-P1.1",
    title: "Copy or Export Each Prompt",
    text: "Use <strong>Copy Prompt</strong> to paste the prompt directly into your AI tool. Use <strong>Export Prompt</strong> to save it as a .txt file. Exporting is recommended, it ensures you do not lose your context if your browser refreshes or your session times out.",
    example:
      "Tip: Export each prompt before you run it so you always have a local backup of your full engagement context.",
    position: "side",
  },
];

let currentStep = 0;
let highlightedEl = null;
let guidancePanel = null;

function initGuidedExperience() {
  guidedMode = true;
  currentStep = 0;

  if (!guidancePanel) {
    guidancePanel = document.createElement("div");
    guidancePanel.className = "guidance-panel";
    guidancePanel.id = "guidancePanel";
    document.body.appendChild(guidancePanel);
  }

  showGuidanceStep(currentStep);
}

function showGuidanceStep(index) {
  if (index < 0 || index >= guidanceSteps.length) return;

  const step = guidanceSteps[index];

  if (highlightedEl) {
    highlightedEl.classList.remove("guidance-highlight");
    highlightedEl = null;
  }

  if (step.openSection) {
    const section = document.getElementById(step.openSection);
    if (section && !section.classList.contains("open")) {
      section.classList.add("open");
    }
  }

  const targetEl = document.getElementById(step.target);
  const isFirst = index === 0;
  const isLast = index === guidanceSteps.length - 1;

  // Determine next-button label: if this step triggers workflow transition, label it accordingly
  const isGoToWorkflow = !!step.goToWorkflow;
  let nextLabel = isLast
    ? "Finish"
    : isGoToWorkflow
      ? "Go to Workflow"
      : "Next";

  guidancePanel.innerHTML = `
    <div class="guidance-panel-header">
      <span class="guidance-panel-title">Guided Experience</span>
      <span class="guidance-panel-counter">Step ${index + 1} of ${guidanceSteps.length}</span>
    </div>
    <div class="guidance-panel-body">
      <div class="guidance-panel-step-title">${step.title}</div>
      <p class="guidance-panel-text">${step.text}</p>
      ${step.example ? `<div class="guidance-panel-example">${step.example}</div>` : ""}
    </div>
    <div class="guidance-panel-footer">
      <button class="guidance-panel-skip" onclick="skipGuidance()">Skip Guidance</button>
      <div class="guidance-panel-actions">
        ${!isFirst ? `<button class="btn-guidance-back" onclick="prevGuidanceStep()">Back</button>` : ""}
        <button class="btn-guidance-next" onclick="nextGuidanceStep()">
          ${nextLabel}
        </button>
      </div>
    </div>
  `;

  guidancePanel.classList.add("visible");

  // Highlight the target element if it exists
  if (targetEl) {
    targetEl.classList.add("guidance-highlight");
    highlightedEl = targetEl;
    // Only scroll on the form page — on the workflow page the panel is fixed and no scroll is needed
    if (document.getElementById("formPage").classList.contains("active")) {
      targetEl.scrollIntoView({ behavior: "smooth", block: "center" });
    }
  }

  // Highlight a visible "Enter manually" toggle button for the how-to-fill steps
  if (step.highlightToggleBtn) {
    const toggleBtns = document.querySelectorAll(".btn-toggle-input");
    let firstVisible = null;
    for (const btn of toggleBtns) {
      const rect = btn.getBoundingClientRect();
      if (rect.width > 0 && rect.height > 0) {
        firstVisible = btn;
        break;
      }
    }
    if (firstVisible) {
      firstVisible.classList.add("guidance-highlight");
      highlightedEl = firstVisible;
      firstVisible.scrollIntoView({ behavior: "smooth", block: "center" });
    }
  }
}

function nextGuidanceStep() {
  const step = guidanceSteps[currentStep];
  // If this step is the "go to workflow" transition, fire it first
  if (step && step.goToWorkflow) {
    startWorkflow();
    currentStep++;
    // Give the workflow a moment to render before showing the next guidance card
    setTimeout(function () {
      showGuidanceStep(currentStep);
    }, 400);
    return;
  }
  if (currentStep < guidanceSteps.length - 1) {
    currentStep++;
    showGuidanceStep(currentStep);
  } else {
    skipGuidance();
  }
}

function prevGuidanceStep() {
  if (currentStep > 0) {
    currentStep--;
    showGuidanceStep(currentStep);
  }
}

function skipGuidance() {
  if (guidancePanel) {
    guidancePanel.classList.remove("visible");
  }
  if (highlightedEl) {
    highlightedEl.classList.remove("guidance-highlight");
    highlightedEl = null;
  }
  guidedMode = false;
}

// ═══════════════════════════════════════════════════════
// CHUNK 1 — AUTO-SAVE, DRAFT RESTORE, SECTION STATUS DOTS
// ═══════════════════════════════════════════════════════

const DRAFT_KEY = "pwc_launchpad_draft";

// ── Collect all saveable field values ──
function collectFormState() {
  // Flush current active panel selections into _formSelState before serialising
  _fssSaveObj();
  _fssSaveServices();
  _fssSaveTech();
  _fssSavePartners();
  _fssSaveReg();
  _fssSaveRisk();
  // Capture industry from hidden selects into selState
  _formSelState.industry = {
    industry:  (document.getElementById("industryDrop")  || {}).value || "",
    sector:    (document.getElementById("sectorDrop")    || {}).value || "",
    subsector: (document.getElementById("subsectorDrop") || {}).value || "",
  };
  var ids = [
    "clientName",
    "engagementName",
    "engagementLead",
    "startDate",
    "endDate",
    "deliveryMethodology",
    "feeStructure",
    "totalBudget",
    "engagementDescription",
  ];
  var state = { _ts: new Date().toISOString(), fields: {}, selState: null };
  ids.forEach(function (id) {
    var el = document.getElementById(id);
    if (el) state.fields[id] = el.value;
  });
  try { state.selState = JSON.parse(JSON.stringify(_formSelState)); } catch(e) {}
  return state;
}

// ── Restore saved state into form fields ──
function applyFormState(state) {
  if (!state) return;
  Object.entries(state.fields || {}).forEach(([id, val]) => {
    const el = document.getElementById(id);
    if (el) el.value = val;
  });
  Object.entries(state.selects || {}).forEach(([id, val]) => {
    const el = document.getElementById(id);
    if (el && val) el.value = val;
  });
  if (!state.selState) return;
  _formSelState = state.selState;

  // Restore industry cascade by simulating pill clicks
  var ind = _formSelState.industry || {};
  if (ind.industry) {
    var indPill = Array.from(document.querySelectorAll("#industryPills .fb-pill"))
      .find(function(p) { return p.textContent.trim() === ind.industry; });
    if (indPill) {
      indPill.click();
      setTimeout(function() {
        if (ind.sector) {
          var secPill = Array.from(document.querySelectorAll("#sectorPills .fb-pill"))
            .find(function(p) { return p.textContent.trim() === ind.sector; });
          if (secPill) {
            secPill.click();
            setTimeout(function() {
              if (ind.subsector) {
                var subPill = Array.from(document.querySelectorAll("#subsectorPills .fb-pill"))
                  .find(function(p) { return p.textContent.trim() === ind.subsector; });
                if (subPill) subPill.click();
              }
            }, 150);
          }
        }
      }, 150);
    }
  }

  // Update left-side tab dots for sections with saved selections
  setTimeout(function() {
    var dotSections = [
      { state: _formSelState.services, listId: "domainTabList", hasKey: function(s) { return Object.keys(s.bbs || {}).length > 0; } },
      { state: _formSelState.tech,     listId: "techCatList",   hasKey: function(s) { return (s.subs || []).length > 0; } },
      { state: _formSelState.partners, listId: "partnerTabList", hasKey: function(s) { return (s.families || []).length > 0; } },
      { state: _formSelState.reg,      listId: "regGroupList",  hasKey: function(s) { return (s.checked || []).length > 0; } },
      { state: _formSelState.risk,     listId: "riskGroupList", hasKey: function(s) { return (s.checked || []).length > 0; } },
    ];
    dotSections.forEach(function(ds) {
      if (!ds.state) return;
      Object.keys(ds.state).forEach(function(key) {
        if (!ds.hasKey(ds.state[key])) return;
        document.querySelectorAll("#" + ds.listId + " .fb-tab-item").forEach(function(t) {
          if (slugify(t.textContent.trim()) === key) {
            t.classList.add("has-data");
            var dot = t.querySelector(".fb-tab-dot"); if (dot) dot.style.background = "#22c55e";
          }
        });
      });
    });
    // Objectives tab dots
    if (_formSelState.obj) {
      Object.keys(_formSelState.obj).forEach(function(typeId) {
        var saved = _formSelState.obj[typeId];
        if (saved && Object.values(saved.drops || {}).some(function(v) { return v; })) {
          document.querySelectorAll("#objTypeList .fb-tab-item").forEach(function(t) {
            if (slugify(t.textContent.trim()) === typeId) {
              t.classList.add("has-data");
              var dot = t.querySelector(".fb-tab-dot"); if (dot) dot.style.background = "#22c55e";
            }
          });
        }
      });
    }
    fbEvalDots();
    if (typeof updateBriefStrength === "function") updateBriefStrength();
  }, 400);
}

// ── Auto-save on any input/change inside the form ──
function initAutoSave() {
  const formEl = document.getElementById("formPage");
  if (!formEl) return;
  formEl.addEventListener("input", debounceAutoSave);
  formEl.addEventListener("change", debounceAutoSave);
  // also hook clicks (for button-style selectors)
  formEl.addEventListener("click", debounceAutoSave);
}

let _autoSaveTimer = null;
function debounceAutoSave() {
  clearTimeout(_autoSaveTimer);
  _autoSaveTimer = setTimeout(function () {
    try {
      const state = collectFormState();
      localStorage.setItem(DRAFT_KEY, JSON.stringify(state));
    } catch (e) {
      /* quota exceeded — ignore */
    }
    updateAllSectionDots();
    if (typeof updateBriefStrength === "function") updateBriefStrength();
  }, 600);
}

// ── Check for draft on page load ──
function checkForDraft() {
  try {
    var raw = localStorage.getItem(DRAFT_KEY);
    if (!raw) return;
    var state = JSON.parse(raw);
    if (!state || !state._ts) return;
    var hasData = Object.keys(state.fields || {}).some(function (k) {
      return state.fields[k] && state.fields[k].trim();
    });
    if (!hasData) return;
    var ts = new Date(state._ts);
    var formatted =
      ts.toLocaleDateString("en-AU", {
        day: "numeric",
        month: "short",
        year: "numeric",
      }) +
      " at " +
      ts.toLocaleTimeString("en-AU", { hour: "2-digit", minute: "2-digit" });
    var dtEl = document.getElementById("draftTimestamp");
    if (dtEl) dtEl.textContent = formatted;
    var banner = document.getElementById("draftBanner");
    if (banner) banner.classList.add("visible");
  } catch (e) {}
}

function restoreDraft() {
  try {
    var raw = localStorage.getItem(DRAFT_KEY);
    if (!raw) return;
    var state = JSON.parse(raw);
    applyFormState(state);
    var banner = document.getElementById("draftBanner");
    if (banner) banner.classList.remove("visible");
    fbEvalDots();
    if (typeof updateBriefStrength === "function") updateBriefStrength();
    showToast("Draft restored.", "success");
  } catch (e) {}
}

function dismissDraft() {
  localStorage.removeItem(DRAFT_KEY);
  localStorage.removeItem("pwc_launchpad_progress");
  document.getElementById("draftBanner").classList.remove("visible");
}

// ── Section selection state — persists across tab switches and is included in drafts ──
var _formSelState = { industry: {}, obj: {}, services: {}, tech: {}, partners: {}, reg: {}, risk: {} };

function _fssSaveObj() {
  var tab = document.querySelector("#objTypeList .fb-tab-item.active");
  if (!tab) return;
  var typeName = tab.textContent.trim();
  var typeId = slugify(typeName);
  if (!_formSelState.obj) _formSelState.obj = {};
  var drops = {}, frees = {};
  document.querySelectorAll('[id^="obj-drop-' + typeId + '"]').forEach(function(el) { drops[el.id] = el.value; });
  document.querySelectorAll('[id^="obj-free-' + typeId + '"]').forEach(function(el) { if (el.value) frees[el.id] = { val: el.value, isManual: el.style.display !== "none" }; });
  var ctx = document.getElementById("obj-context-" + typeId);
  _formSelState.obj[typeId] = { typeName: typeName, drops: drops, frees: frees, context: ctx ? ctx.value : "" };
}
function _fssApplyObj(typeId) {
  var saved = _formSelState.obj && _formSelState.obj[typeId];
  if (!saved) return;
  Object.keys(saved.drops || {}).forEach(function(id) { var el = document.getElementById(id); if (el) el.value = saved.drops[id]; });
  Object.keys(saved.frees || {}).forEach(function(id) {
    var entry = saved.frees[id];
    var el = document.getElementById(id); if (!el || !entry.val) return;
    el.value = entry.val;
    if (entry.isManual) {
      el.style.display = "";
      var drop = document.getElementById(id.replace("obj-free-", "obj-drop-"));
      if (drop) drop.style.display = "none";
    }
  });
  var ctx = document.getElementById("obj-context-" + typeId); if (ctx && saved.context) ctx.value = saved.context;
  fbEvalObjDot(typeId);
}

function _fssSaveServices() {
  var tab = document.querySelector("#domainTabList .fb-tab-item.active");
  if (!tab) return;
  var domId = slugify(tab.textContent.trim());
  var bbs = {};
  document.querySelectorAll("#domainBlockPanel .fb-bb-item.selected").forEach(function(el) { bbs[el.id] = true; });
  var notes = document.getElementById("svc-notes-" + domId);
  if (!_formSelState.services) _formSelState.services = {};
  _formSelState.services[domId] = { bbs: bbs, notes: notes ? notes.value : "" };
}
function _fssApplyServices(domId) {
  var saved = _formSelState.services && _formSelState.services[domId];
  if (!saved) return;
  Object.keys(saved.bbs || {}).forEach(function(bbId) {
    var el = document.getElementById(bbId);
    if (el && !el.classList.contains("selected")) el.classList.add("selected");
  });
  var notes = document.getElementById("svc-notes-" + domId);
  if (notes && saved.notes) notes.value = saved.notes;
  var tab = document.querySelector("#domainTabList .fb-tab-item.active");
  if (tab) {
    var hasAny = document.querySelectorAll("#domainBlockPanel .fb-bb-item.selected").length > 0;
    tab.classList.toggle("has-data", hasAny);
    tab.querySelector(".fb-tab-dot").style.background = hasAny ? "#22c55e" : "";
  }
}

function _fssSaveTech() {
  var tab = document.querySelector("#techCatList .fb-tab-item.active");
  if (!tab) return;
  var catId = slugify(tab.textContent.trim());
  var subs = Array.from(document.querySelectorAll("#tech-subs-" + catId + " .fb-chip.selected")).map(function(c) { return c.textContent.trim(); });
  var prods = Array.from(document.querySelectorAll("#tech-prod-chips-" + catId + " .fb-chip.selected")).map(function(c) { return c.textContent.trim(); });
  var notes = document.getElementById("tech-notes-" + catId);
  if (!_formSelState.tech) _formSelState.tech = {};
  _formSelState.tech[catId] = { subs: subs, prods: prods, notes: notes ? notes.value : "" };
}
function _fssApplyTech(catId) {
  var saved = _formSelState.tech && _formSelState.tech[catId];
  if (!saved || !(saved.subs || []).length) return;
  (saved.subs || []).forEach(function(subText) {
    document.querySelectorAll("#tech-subs-" + catId + " .fb-chip").forEach(function(c) {
      if (c.textContent.trim() === subText && !c.classList.contains("selected")) c.classList.add("selected");
    });
  });
  var cat = appData.technologies && appData.technologies.technology_and_tools.categories.find(function(c) { return slugify(c.category) === catId; });
  var prodsDiv = document.getElementById("tech-prods-" + catId);
  if (cat && prodsDiv) {
    var html = '<div class="fb-detail-label">Products</div><div class="fb-chip-grid" id="tech-prod-chips-' + catId + '">';
    (saved.subs || []).forEach(function(sn) {
      var s = cat.sub_categories.find(function(x) { return x.sub_category === sn; });
      if (s && (s.products || s.options)) (s.products || s.options).forEach(function(p) {
        var sel = (saved.prods || []).indexOf(p) >= 0 ? " selected" : "";
        html += '<span class="fb-chip' + sel + '" onclick="this.classList.toggle(\'selected\');fbEvalDots();">' + p + "</span>";
      });
    });
    html += "</div>";
    prodsDiv.innerHTML = html;
  }
  var notes = document.getElementById("tech-notes-" + catId);
  if (notes && saved.notes) notes.value = saved.notes;
  var tab = document.querySelector("#techCatList .fb-tab-item.active");
  if (tab) { tab.classList.add("has-data"); tab.querySelector(".fb-tab-dot").style.background = "#22c55e"; }
}

function _fssSavePartners() {
  var tab = document.querySelector("#partnerTabList .fb-tab-item.active");
  if (!tab) return;
  var pid = slugify(tab.textContent.trim());
  var families = Array.from(document.querySelectorAll("#partner-fams-" + pid + " .fb-chip.selected")).map(function(c) { return c.textContent.trim(); });
  var prods = Array.from(document.querySelectorAll("#partner-prods-" + pid + " .fb-chip.selected")).map(function(c) { return c.textContent.trim(); });
  var notes = document.getElementById("partner-notes-" + pid);
  if (!_formSelState.partners) _formSelState.partners = {};
  _formSelState.partners[pid] = { families: families, prods: prods, notes: notes ? notes.value : "" };
}
function _fssApplyPartners(pid) {
  var saved = _formSelState.partners && _formSelState.partners[pid];
  if (!saved || !(saved.families || []).length) return;
  (saved.families || []).forEach(function(famText) {
    document.querySelectorAll("#partner-fams-" + pid + " .fb-chip").forEach(function(c) {
      if (c.textContent.trim() === famText && !c.classList.contains("selected")) c.classList.add("selected");
    });
  });
  var partner = appData.partners && appData.partners.alliance_partners.partners.find(function(p) { return slugify(p.partner) === pid; });
  var prodsDiv = document.getElementById("partner-prods-" + pid);
  if (partner && prodsDiv) {
    var html = '<div class="fb-detail-label">Products</div><div class="fb-chip-grid">';
    (saved.families || []).forEach(function(fn) {
      var fam = partner.product_families.find(function(f) { return f.product_family === fn; });
      if (fam && fam.products) fam.products.forEach(function(p) {
        var sel = (saved.prods || []).indexOf(p) >= 0 ? " selected" : "";
        html += '<span class="fb-chip' + sel + '" onclick="this.classList.toggle(\'selected\');fbEvalDots();">' + p + "</span>";
      });
    });
    html += "</div>";
    prodsDiv.innerHTML = html;
  }
  var notes = document.getElementById("partner-notes-" + pid);
  if (notes && saved.notes) notes.value = saved.notes;
  var tab = document.querySelector("#partnerTabList .fb-tab-item.active");
  if (tab) { tab.classList.add("has-data"); tab.querySelector(".fb-tab-dot").style.background = "#22c55e"; }
}

function _fssSaveReg() {
  var tab = document.querySelector("#regGroupList .fb-tab-item.active");
  if (!tab) return;
  var gid = slugify(tab.textContent.trim());
  var checked = [], reqs = {};
  document.querySelectorAll("#regDetailPanel .fb-check-item.checked").forEach(function(el) {
    var name = el.querySelector(".fb-check-name"); if (!name) return;
    var regName = name.textContent.trim(); checked.push(regName);
    var reqDiv = el.nextElementSibling;
    if (reqDiv) reqs[regName] = Array.from(reqDiv.querySelectorAll(".fb-chip.selected")).map(function(c) { return c.textContent.trim(); });
  });
  if (!_formSelState.reg) _formSelState.reg = {};
  _formSelState.reg[gid] = { checked: checked, reqs: reqs };
}
function _fssApplyReg(gid) {
  var saved = _formSelState.reg && _formSelState.reg[gid];
  if (!saved || !(saved.checked || []).length) return;
  (saved.checked || []).forEach(function(regName) {
    document.querySelectorAll("#regDetailPanel .fb-check-item").forEach(function(el) {
      var nameEl = el.querySelector(".fb-check-name");
      if (nameEl && nameEl.textContent.trim() === regName && !el.classList.contains("checked")) {
        var rid = gid + "-" + slugify(regName);
        fbToggleRegCheck(el, rid);
        var reqReqs = (saved.reqs && saved.reqs[regName]) || [];
        var wrap = document.getElementById("req-wrap-" + rid);
        if (wrap) reqReqs.forEach(function(reqText) {
          wrap.querySelectorAll(".fb-chip").forEach(function(c) { if (c.textContent.trim() === reqText) c.classList.add("selected"); });
        });
      }
    });
  });
}

function _fssSaveRisk() {
  var tab = document.querySelector("#riskGroupList .fb-tab-item.active");
  if (!tab) return;
  var gid = slugify(tab.textContent.trim());
  var checked = [], risks = {};
  document.querySelectorAll("#riskDetailPanel .fb-check-item.checked").forEach(function(el) {
    var name = el.querySelector(".fb-check-name"); if (!name) return;
    var riskType = name.textContent.trim(); checked.push(riskType);
    var riskDiv = el.nextElementSibling;
    if (riskDiv) risks[riskType] = Array.from(riskDiv.querySelectorAll(".fb-chip.selected")).map(function(c) { return c.textContent.trim(); });
  });
  if (!_formSelState.risk) _formSelState.risk = {};
  _formSelState.risk[gid] = { checked: checked, risks: risks };
}
function _fssApplyRisk(gid) {
  var saved = _formSelState.risk && _formSelState.risk[gid];
  if (!saved || !(saved.checked || []).length) return;
  (saved.checked || []).forEach(function(riskType) {
    document.querySelectorAll("#riskDetailPanel .fb-check-item").forEach(function(el) {
      var nameEl = el.querySelector(".fb-check-name");
      if (nameEl && nameEl.textContent.trim() === riskType && !el.classList.contains("checked")) {
        var rtid = gid + "-" + slugify(riskType);
        fbToggleRiskCheck(el, rtid);
        var riskRisks = (saved.risks && saved.risks[riskType]) || [];
        var wrap = document.getElementById("risk-wrap-" + rtid);
        if (wrap) riskRisks.forEach(function(riskText) {
          wrap.querySelectorAll(".fb-chip").forEach(function(c) { if (c.textContent.trim() === riskText) c.classList.add("selected"); });
        });
      }
    });
  });
}

function clearAllFormData() {
  if (!confirm("Start a new engagement? This will clear all current data and cannot be undone.")) return;
  ["clientName","engagementName","engagementLead","startDate","endDate","deliveryMethodology","feeStructure","totalBudget","engagementDescription"].forEach(function(id) {
    var el = document.getElementById(id); if (el) el.value = "";
  });
  ["industryDrop","sectorDrop","subsectorDrop"].forEach(function(id) { var el = document.getElementById(id); if (el) el.value = ""; });
  document.querySelectorAll("#industryPills .fb-pill, #sectorPills .fb-pill, #subsectorPills .fb-pill").forEach(function(p) { p.classList.remove("selected"); });
  var sp = document.getElementById("sectorPills"); if (sp) sp.innerHTML = '<span class="fb-cascade-placeholder">Select an industry first</span>';
  var ssp = document.getElementById("subsectorPills"); if (ssp) ssp.innerHTML = '<span class="fb-cascade-placeholder">Select a sector first</span>';
  var ts = document.getElementById("trail-sector"); if (ts) { ts.classList.remove("ready"); ts.classList.add("fb-cascade-dim"); }
  var tss = document.getElementById("trail-subsector"); if (tss) { tss.classList.remove("ready"); tss.classList.add("fb-cascade-dim"); }
  _formSelState = { industry: {}, obj: {}, services: {}, tech: {}, partners: {}, reg: {}, risk: {} };
  ["domainBlockPanel","techDetailPanel","partnerDetailPanel","regDetailPanel","riskDetailPanel","objThemePanel"].forEach(function(id) {
    var el = document.getElementById(id);
    if (el) el.innerHTML = '<div class="fb-panel-empty">Select an option on the left</div>';
  });
  document.querySelectorAll(".fb-tab-item").forEach(function(t) {
    t.classList.remove("active","has-data");
    var dot = t.querySelector(".fb-tab-dot"); if (dot) dot.style.background = "";
  });
  try { localStorage.removeItem(DRAFT_KEY); localStorage.removeItem("pwc_launchpad_progress"); } catch(e) {}
  var banner = document.getElementById("draftBanner"); if (banner) banner.classList.remove("visible");
  ["clientName","engagementName"].forEach(function(id) { if (typeof setFieldError === "function") setFieldError(id, ""); });
  fbEvalDots();
  if (typeof updateBriefStrength === "function") updateBriefStrength();
  fbGoToSection(1);
  showToast("Ready for a new engagement brief.", "success");
}

// ── Section completion dot logic ──
function getSectionCompleteness(sid) {
  // Try new fb-section first, fall back to old section
  var el = document.getElementById("fb-" + sid) || document.getElementById(sid);
  if (!el) return "empty";
  var selCount = el.querySelectorAll(
    ".fb-pill.selected,.fb-chip.selected,.fb-bb-item.selected,.fb-check-item.checked,.fb-tab-item.has-data,.selected",
  ).length;
  var inputCount = Array.from(
    el.querySelectorAll("input[type=text],input[type=date],textarea,select"),
  ).filter(function (i) {
    return (i.value || "").trim();
  }).length;
  var total = selCount + inputCount;
  if (total === 0) return "empty";
  if (total >= 3) return "filled";
  return "partial";
}

function updateSectionDot(sid) {
  // Delegate to fbEvalDots which handles the new fb-section-dot + fb-nav-dot classes
  if (typeof fbEvalDots === "function") fbEvalDots();
}

function updateAllSectionDots() {
  ["s1", "s2", "s3", "s4", "s5", "s6", "s7", "s8"].forEach(updateSectionDot);
}

// ── Wire up on init ──
const _origInit = typeof init === "function" ? init : null;

// ═══════════════════════════════════════════
// CHUNK 2 — REVIEW PANEL + SOFT VALIDATION + DEMO DATA
// ═══════════════════════════════════════════

function openReviewPanel() {
  formData = compileForm();
  renderReviewPanel();
  document.getElementById("reviewOverlay").classList.add("visible");
}
function closeReviewPanel(e) {
  if (e && e.target !== document.getElementById("reviewOverlay")) return;
  closeReviewPanelDirect();
}
function closeReviewPanelDirect() {
  document.getElementById("reviewOverlay").classList.remove("visible");
}

function checkBriefCompleteness() {
  const issues = [];
  if (!((document.getElementById("deliveryMethodology") || {}).value || ""))
    issues.push(
      "Delivery Methodology not selected — affects Planning and Charter prompts",
    );
  if (!((document.getElementById("feeStructure") || {}).value || ""))
    issues.push(
      "Fee Structure not selected — affects Budget and Charter prompts",
    );
  if (!((document.getElementById("engagementDescription") || {}).value || ""))
    issues.push(
      "Engagement Description is empty — improves quality of all documents",
    );
  if (!((document.getElementById("industryDrop") || {}).value || ""))
    issues.push(
      "Industry not selected — industry-specific content will be generic",
    );
  const og = document.getElementById("objectiveTypeGrid");
  if (!og || !og.querySelector(".selected"))
    issues.push(
      "No Engagement Objectives selected — planning outputs will be generic",
    );
  const dg = document.getElementById("domainGrid");
  if (!dg || !dg.querySelector(".selected"))
    issues.push(
      "No Service Offerings selected — building-block context will be missing",
    );
  const rg = document.getElementById("regulatoryIndustryGrid");
  if (!rg || !rg.querySelector(".selected"))
    issues.push(
      "No Regulatory Profile selected — compliance content will be generic",
    );
  const rkg = document.getElementById("riskIndustryGrid");
  if (!rkg || !rkg.querySelector(".selected"))
    issues.push("No Risk Profile selected — Risk Register will be generic");
  return issues;
}

function rv(v) {
  return v && String(v).trim() ? v : null;
}

function renderReviewPanel() {
  const d = formData || {};
  const ec = d.engagement_context || {};
  const issues = checkBriefCompleteness();
  let h = "";

  // Context
  // Context
  h +=
    '<div class="review-section"><div class="review-section-title">Engagement Context</div>';
  h +=
    '<div class="review-edit-hint">Click any value to edit it directly.</div>';
  var ecFieldMap = [
    ["Client Name", "clientName", ec.client_name, "input"],
    ["Engagement Name", "engagementName", ec.engagement_name, "input"],
    ["Engagement Lead", "engagementLead", ec.engagement_lead, "input"],
    ["Start Date", "startDate", ec.start_date, "input"],
    ["End Date", "endDate", ec.end_date, "input"],
    ["Methodology", "deliveryMethodology", ec.delivery_methodology, "input"],
    ["Fee Structure", "feeStructure", ec.fee_structure, "input"],
    ["Budget", "totalBudget", ec.total_budget, "input"],
    [
      "Description",
      "engagementDescription",
      ec.engagement_description,
      "textarea",
    ],
  ];
  ecFieldMap.forEach(function (row) {
    var label = row[0],
      fieldId = row[1],
      val = row[2],
      type = row[3];
    var display = rv(val) ? val : "—";
    var cls = rv(val) ? "review-val" : "review-val missing";
    h +=
      '<div class="review-row">' +
      '<span class="review-key">' +
      label +
      "</span>" +
      '<span class="' +
      cls +
      '" onclick="rvStartEdit(this,\'' +
      fieldId +
      "','" +
      type +
      '\')" title="Click to edit">' +
      display +
      "</span>" +
      "</div>";
  });
  h += "</div>";

  // Industry
  const ind = d.industry || {};
  h +=
    '<div class="review-section"><div class="review-section-title">Industry</div>';
  [
    ["Industry", ind.industry],
    ["Sector", ind.sector],
    ["Sub-sector", ind.sub_sector],
  ].forEach(function (row) {
    const display = rv(row[1]) ? row[1] : "—";
    const cls = rv(row[1]) ? "review-val" : "review-val missing";
    h +=
      '<div class="review-row"><span class="review-key">' +
      row[0] +
      '</span><span class="' +
      cls +
      '">' +
      display +
      "</span></div>";
  });
  h += "</div>";

  // Objectives
  const objs = (d.objectives || []).filter(function (o) {
    return o.themes && o.themes.length > 0;
  });
  h +=
    '<div class="review-section"><div class="review-section-title">Objectives (' +
    objs.length +
    " type" +
    (objs.length !== 1 ? "s" : "") +
    ")</div>";
  if (!objs.length) {
    h +=
      '<div class="review-row"><span class="review-val missing">None selected</span></div>';
  } else {
    objs.forEach(function (obj) {
      obj.themes.forEach(function (t) {
        h +=
          '<div class="review-list-item"><strong>' +
          obj.objective_type +
          "</strong> › " +
          t.theme +
          ": " +
          t.specific_objective +
          "</div>";
      });
    });
  }
  h += "</div>";

  // Services
  const svcs = (d.service_offerings || []).filter(function (s) {
    return s.building_blocks && s.building_blocks.length > 0;
  });
  const bbCount = svcs.reduce(function (a, s) {
    return a + s.building_blocks.length;
  }, 0);
  h +=
    '<div class="review-section"><div class="review-section-title">Service Offerings (' +
    bbCount +
    " building block" +
    (bbCount !== 1 ? "s" : "") +
    ")</div>";
  if (!bbCount) {
    h +=
      '<div class="review-row"><span class="review-val missing">None selected</span></div>';
  } else {
    svcs.forEach(function (s) {
      s.building_blocks.forEach(function (bb) {
        h +=
          '<div class="review-list-item"><strong>' +
          s.domain +
          "</strong> › " +
          bb.building_block +
          "</div>";
      });
    });
  }
  h += "</div>";

  // Tech
  const techs = (
    (d.technologies &&
      d.technologies.technology_and_tools &&
      d.technologies.technology_and_tools.categories) ||
    []
  ).filter(function (t) {
    return t.sub_categories && t.sub_categories.length > 0;
  });
  const techCount = techs.reduce(function (a, t) {
    return a + (t.sub_categories || []).length;
  }, 0);
  h +=
    '<div class="review-section"><div class="review-section-title">Technology & Tools (' +
    techCount +
    " item" +
    (techCount !== 1 ? "s" : "") +
    ")</div>";
  if (!techCount) {
    h +=
      '<div class="review-row"><span class="review-val missing">None selected</span></div>';
  } else {
    techs.slice(0, 5).forEach(function (t) {
      h +=
        '<div class="review-list-item"><strong>' +
        t.category +
        "</strong>: " +
        (t.sub_categories || []).slice(0, 3).join(", ") +
        "</div>";
    });
  }
  h += "</div>";

  // Regulatory
  const regs = (d.regulatory_profile || []).filter(function (r) {
    return r.requirements && r.requirements.length > 0;
  });
  const regCount = regs.reduce(function (a, r) {
    return a + (r.requirements || []).length;
  }, 0);
  h +=
    '<div class="review-section"><div class="review-section-title">Regulatory Profile (' +
    regCount +
    " item" +
    (regCount !== 1 ? "s" : "") +
    ")</div>";
  if (!regCount) {
    h +=
      '<div class="review-row"><span class="review-val missing">None selected</span></div>';
  } else {
    regs.slice(0, 4).forEach(function (r) {
      h +=
        '<div class="review-list-item"><strong>' +
        (r.body || r.group || "") +
        "</strong>: " +
        (r.requirements || []).slice(0, 3).join(", ") +
        "</div>";
    });
  }
  h += "</div>";

  // Risks
  const risks = (d.risk_profile || []).filter(function (r) {
    return r.risks && r.risks.length > 0;
  });
  const riskCount = risks.reduce(function (a, r) {
    return a + (r.risks || []).length;
  }, 0);
  h +=
    '<div class="review-section"><div class="review-section-title">Risk Profile (' +
    riskCount +
    " risk" +
    (riskCount !== 1 ? "s" : "") +
    ")</div>";
  if (!riskCount) {
    h +=
      '<div class="review-row"><span class="review-val missing">None selected</span></div>';
  } else {
    risks.slice(0, 4).forEach(function (r) {
      h +=
        '<div class="review-list-item"><strong>' +
        (r.category || r.group || "") +
        "</strong>: " +
        (r.risks || []).slice(0, 3).join(", ") +
        "</div>";
    });
  }
  h += "</div>";

  // Warnings
  if (issues.length) {
    h +=
      '<div class="review-callout"><strong>⚠ Missing data — some outputs may be generic:</strong><ul style="margin:6px 0 0 16px;">';
    issues.forEach(function (i) {
      h += '<li style="margin-bottom:3px;">' + i + "</li>";
    });
    h += "</ul></div>";
  }
  document.getElementById("reviewPanel-body").innerHTML = h;
}

// ── Load Example Data ──
function rvStartEdit(spanEl, fieldId, type) {
  if (spanEl.classList.contains("editing")) return;
  spanEl.classList.add("editing");
  var currentVal =
    (document.getElementById(fieldId) || {}).value || spanEl.textContent.trim();
  if (currentVal === "—") currentVal = "";
  var input;
  if (type === "textarea") {
    input = document.createElement("textarea");
    input.rows = 4;
  } else {
    input = document.createElement("input");
    input.type = "text";
  }
  input.className = "review-val-input";
  input.value = currentVal;
  spanEl.textContent = "";
  spanEl.appendChild(input);
  input.focus();
  function commit() {
    var newVal = input.value.trim();
    var liveField = document.getElementById(fieldId);
    if (liveField) {
      liveField.value = newVal;
      liveField.dispatchEvent(new Event("input"));
      liveField.dispatchEvent(new Event("change"));
    }
    formData = compileForm();
    spanEl.classList.remove("editing");
    spanEl.textContent = newVal || "—";
    if (!newVal) spanEl.classList.add("missing");
    else spanEl.classList.remove("missing");
  }
  input.addEventListener("blur", commit);
  input.addEventListener("keydown", function (e) {
    if (e.key === "Enter" && type !== "textarea") {
      e.preventDefault();
      commit();
    }
    if (e.key === "Escape") {
      input.removeEventListener("blur", commit);
      spanEl.classList.remove("editing");
      spanEl.textContent = currentVal || "—";
    }
  });
}

// ── Load Example Data ──
function loadExampleData() {
  if (!appData || !appData.industries) {
    showToast("Data is still loading — please wait a moment.", "warning");
    return;
  }
  var sv = function (id, v) {
    var e = document.getElementById(id);
    if (e) e.value = v;
  };
  // S1 fields
  sv("clientName", "Commonwealth Bank of Australia");
  sv("engagementName", "Core Banking Modernisation Program");
  sv("engagementLead", "Sarah Chen");
  sv("startDate", "2025-07-01");
  sv("endDate", "2026-12-31");
  sv("deliveryMethodology", "Hybrid");
  sv("feeStructure", "Time & Materials");
  sv("totalBudget", "$12,500,000");
  sv(
    "engagementDescription",
    "End-to-end modernisation of core banking platform, migrating from legacy on-premise infrastructure to cloud-native architecture on AWS. Encompasses data migration, API integration, regulatory compliance uplift, and change management across 8 business units.",
  );
  // S2: click industry pill then sector
  setTimeout(function () {
    var indPill = Array.from(
      document.querySelectorAll("#industryPills .fb-pill"),
    ).find(function (p) {
      return p.textContent.trim() === "Financial Services";
    });
    if (indPill) {
      indPill.click();
    }
    setTimeout(function () {
      var secPill = Array.from(
        document.querySelectorAll("#sectorPills .fb-pill"),
      ).find(function (p) {
        return p.textContent.trim() === "Banking and Capital Markets";
      });
      if (secPill) {
        secPill.click();
      }
      setTimeout(function () {
        var subPill = Array.from(
          document.querySelectorAll("#subsectorPills .fb-pill"),
        ).find(function (p) {
          return p.textContent.trim() === "Retail Banking";
        });
        if (subPill) subPill.click();
      }, 200);
    }, 200);
  }, 200);
  // S3: open Business Problem objective type
  setTimeout(function () {
    var objTab = Array.from(
      document.querySelectorAll("#objTypeList .fb-tab-item"),
    ).find(function (t) {
      return t.textContent.trim().indexOf("Business Problem") === 0;
    });
    if (objTab) objTab.click();
  }, 500);
  // S3: set objective dropdowns after panel has rendered
  setTimeout(function () {
    var sv2 = function (id, v) {
      var e = document.getElementById(id);
      if (e) e.value = v;
    };
    sv2(
      "obj-drop-business-problem-operational-performance",
      "Siloed operations across business units",
    );
    sv2(
      "obj-drop-business-problem-data-information",
      "Fragmented and siloed data",
    );
    sv2(
      "obj-drop-business-problem-technology-systems",
      "Ageing and legacy technology landscape",
    );
    if (typeof fbObjChange === "function") fbObjChange("business-problem");
  }, 700);
  // S4: open Data & AI domain
  setTimeout(function () {
    var domTab = Array.from(
      document.querySelectorAll("#domainTabList .fb-tab-item"),
    ).find(function (t) {
      return t.textContent.trim() === "Data & AI";
    });
    if (domTab) {
      domTab.click();
      setTimeout(function () {
        document
          .querySelectorAll("#domainBlockPanel .fb-bb-item")
          .forEach(function (bb, i) {
            if (i < 3) bb.click();
          });
      }, 200);
    }
  }, 800);
  // S5: open Data & Analytics tech category
  setTimeout(function () {
    var techTab = Array.from(
      document.querySelectorAll("#techCatList .fb-tab-item"),
    ).find(function (t) {
      return t.textContent.trim().indexOf("Data & Analytics") === 0;
    });
    if (techTab) {
      techTab.click();
      setTimeout(function () {
        var firstSub = document.querySelector("#techDetailPanel .fb-chip");
        if (firstSub) firstSub.click();
      }, 200);
    }
  }, 1100);
  // S6: open AWS partner and select product families
  setTimeout(function () {
    var partTab = Array.from(
      document.querySelectorAll("#partnerTabList .fb-tab-item"),
    ).find(function (t) {
      return t.textContent.trim() === "AWS";
    });
    if (partTab) {
      partTab.click();
      setTimeout(function () {
        document
          .querySelectorAll("#partnerDetailPanel .fb-chip")
          .forEach(function (chip, i) {
            if (i < 2) chip.click();
          });
      }, 200);
    }
  }, 1300);
  // S7: open Financial Services regulatory group
  setTimeout(function () {
    var regTab = Array.from(
      document.querySelectorAll("#regGroupList .fb-tab-item"),
    ).find(function (t) {
      return t.textContent.trim() === "Financial Services";
    });
    if (regTab) {
      regTab.click();
      setTimeout(function () {
        var firstReg = document.querySelector("#regDetailPanel .fb-check-item");
        if (firstReg) firstReg.click();
      }, 200);
    }
  }, 1500);
  // S8: open Financial Services risk group and select risk types
  setTimeout(function () {
    var riskTab = Array.from(
      document.querySelectorAll("#riskGroupList .fb-tab-item"),
    ).find(function (t) {
      return t.textContent.trim() === "Financial Services";
    });
    if (riskTab) {
      riskTab.click();
      setTimeout(function () {
        document
          .querySelectorAll("#riskDetailPanel .fb-check-item")
          .forEach(function (item, i) {
            if (i < 2) item.click();
          });
      }, 200);
    }
  }, 1700);
  setTimeout(function () {
    fbEvalDots();
    if (typeof updateBriefStrength === "function") updateBriefStrength();
    try {
      var st = collectFormState();
      localStorage.setItem(DRAFT_KEY, JSON.stringify(st));
    } catch (e) {}
    showToast("Example data loaded.", "success");
  }, 2200);
}

// Wire Brief Strength to all form interactions
document.addEventListener("change", function () {
  var fp = document.getElementById("formPage");
  if (
    fp &&
    fp.classList.contains("active") &&
    typeof updateBriefStrength === "function"
  )
    updateBriefStrength();
});
document.addEventListener("click", function () {
  var fp = document.getElementById("formPage");
  if (
    fp &&
    fp.classList.contains("active") &&
    typeof updateBriefStrength === "function"
  )
    setTimeout(updateBriefStrength, 150);
});

// CHUNK 3 — REOPEN, GATE MODAL, RESUME, INLINE EDIT
var _pendingGateId = null;

function reopenStep(id) {
  completedSteps.delete(id);
  var card = document.getElementById("card-" + id);
  var badge = document.getElementById("badge-" + id);
  var sidebar = document.getElementById("sidebar-" + id);
  var headerEl = document.getElementById("header-" + id);
  if (card) {
    card.classList.remove("completed-card");
    card.classList.add("active-card");
    card.classList.add("open");
  }
  if (badge) {
    badge.textContent = "Ready";
    badge.className = "status-badge badge-ready";
  }
  if (sidebar) {
    sidebar.classList.remove("completed");
    sidebar.classList.add("active");
    sidebar.setAttribute("tabindex", "0");
  }
  if (headerEl) {
    headerEl.setAttribute("aria-expanded", "true");
  }
  // Re-lock any steps that depended on this one and are not yet done
  if (appData && appData.workflow) {
    appData.workflow.phases.forEach(function (ph) {
      ph.prompts.forEach(function (p) {
        if (!p.depends_on || !p.depends_on.includes(id)) return;
        if (completedSteps.has(p.prompt_id)) return; // already done, leave it
        var dc = document.getElementById("card-" + p.prompt_id);
        var db = document.getElementById("badge-" + p.prompt_id);
        var ds = document.getElementById("sidebar-" + p.prompt_id);
        var dh = document.getElementById("header-" + p.prompt_id);
        if (
          dc &&
          dc.classList.contains("active-card") &&
          !dc.classList.contains("completed-card")
        ) {
          dc.classList.remove("active-card");
          dc.classList.add("locked-card");
          if (db) {
            db.textContent = "Locked";
            db.className = "status-badge badge-locked";
          }
          if (ds) {
            ds.classList.remove("active");
            ds.classList.add("locked");
            ds.setAttribute("tabindex", "0");
          }
          if (dh) {
            dh.setAttribute("tabindex", "-1");
          }
        }
      });
    });
  }
  updateProgress();
  try {
    localStorage.setItem(
      "pwc_launchpad_progress",
      JSON.stringify(Array.from(completedSteps)),
    );
  } catch (e) {}
}

// Gate modal
function checkGateReady() {
  var boxes = document.querySelectorAll(
    "#gateModalChecklist input[type=checkbox]",
  );
  var allChecked = true;
  boxes.forEach(function (b) {
    if (!b.checked) allChecked = false;
  });
  var btn = document.getElementById("gateConfirmBtn");
  if (btn) {
    btn.classList.toggle("ready", allChecked);
  }
}
function closeGateModal() {
  document.getElementById("gateModal").classList.remove("visible");
  _pendingGateId = null;
}
function confirmGateDone() {
  document.getElementById("gateModal").classList.remove("visible");
  if (_pendingGateId) {
    doMarkDone(_pendingGateId);
    _pendingGateId = null;
  }
}

// Sparse brief warning modal (#03)
function openSparseBriefModal(filledCount) {
  const msg = document.getElementById("sparseBriefMsg");
  if (msg)
    msg.textContent = `Only ${filledCount} of 7 sections have meaningful data. Sparse briefs produce generic AI output. Consider completing more sections for better results.`;
  document.getElementById("sparseBriefModal").classList.add("visible");
}
function closeSparseBriefModal() {
  document.getElementById("sparseBriefModal").classList.remove("visible");
}
function proceedSparse() {
  closeSparseBriefModal();
  openReviewPanel();
}

// Resume modal
function restartWorkflow() {
  document.getElementById("resumeModal").classList.remove("visible");
  completedSteps = new Set();
  doShowWorkflow();
}
function continueWorkflow() {
  document.getElementById("resumeModal").classList.remove("visible");
  // Transition to workflow page and restore visual state
  document.getElementById("formPage").classList.remove("active");
  document.getElementById("workflowPage").classList.add("active");
  document.getElementById("headerSubtitle").textContent = "Workflow";
  document.getElementById("workflowTitle").textContent =
    (formData.engagement_context.client_name || "") +
    " — " +
    (formData.engagement_context.engagement_name || "");
  renderWorkflow();
  // Restore completed visual state
  completedSteps.forEach(function (id) {
    var card = document.getElementById("card-" + id);
    var badge = document.getElementById("badge-" + id);
    var si = document.getElementById("sidebar-" + id);
    if (card) {
      card.classList.remove("active-card", "locked-card");
      card.classList.add("completed-card");
    }
    if (badge) {
      badge.textContent = "Complete";
      badge.className = "status-badge badge-done";
    }
    if (si) {
      si.classList.remove("active", "locked");
      si.classList.add("completed");
    }
  });
  unlockNextSteps();
  updateProgress();
  var mainPanel = document.querySelector(".workflow-main");
  if (mainPanel) mainPanel.scrollTop = 0;
}

// Inline prompt editing (#12)
function togglePromptEdit(id) {
  var box = document.getElementById("prompt-text-" + id);
  var btn = document.getElementById("edit-btn-" + id);
  if (!box || !btn) return;
  var editing = box.getAttribute("contenteditable") === "true";
  if (!editing) {
    // Store original text for reset
    box.setAttribute("data-original", box.textContent);
    box.setAttribute("contenteditable", "true");
    btn.textContent = "Reset";
    btn.classList.add("active");
    box.focus();
  } else {
    // Reset to original
    var orig = box.getAttribute("data-original");
    if (orig) box.textContent = orig;
    box.setAttribute("contenteditable", "false");
    btn.textContent = "Edit";
    btn.classList.remove("active");
  }
}

// ════════════════════════════════════
// CHUNK 4 — TOAST, PILLS, SEARCH, TOOLTIP, BULK EXPORT
// ════════════════════════════════════

// ── Toast notifications ──
// CHANGE 2: Expand/collapse prompt text box
function toggleExpandPrompt(id) {
  var box = document.getElementById("prompt-text-" + id);
  var btn = document.getElementById("expand-btn-" + id);
  if (!box || !btn) return;
  var expanded = box.classList.contains("prompt-text-expanded");
  if (expanded) {
    box.classList.remove("prompt-text-expanded");
    btn.innerHTML = "&#x26F6; Expand";
    btn.setAttribute("aria-label", "Expand prompt text");
  } else {
    box.classList.add("prompt-text-expanded");
    btn.innerHTML = "&#x26F4; Collapse";
    btn.setAttribute("aria-label", "Collapse prompt text");
  }
}

function showToast(msg, type, duration) {
  type = type || "info";
  duration = duration || 3000;
  var icons = { info: "ℹ", success: "✓", warning: "⚠", error: "✕" };
  var container = document.getElementById("toastContainer");
  if (!container) return;
  var t = document.createElement("div");
  t.className = "toast toast-" + type;
  t.innerHTML =
    '<span class="toast-icon">' +
    (icons[type] || "ℹ") +
    "</span>" +
    '<span class="toast-msg">' +
    msg +
    "</span>" +
    '<span class="toast-close" onclick="this.parentElement.remove()">×</span>';
  t.onclick = function (e) {
    if (!e.target.classList.contains("toast-close")) t.remove();
  };
  container.appendChild(t);
  setTimeout(function () {
    if (t.parentElement) t.remove();
  }, duration);
}

// ── Nav pill colour update ──
function updateNavPills() {
  var map = {
    s1: scoreSectionS1,
    s2: scoreSectionS2,
    s3: function () {
      return scoreSectionGrid("objectiveTypeGrid");
    },
    s4: function () {
      return scoreSectionGrid("domainGrid");
    },
    s5: function () {
      return scoreSectionGrid("techCategoryGrid");
    },
    s6: function () {
      return scoreSectionGrid("partnerGrid");
    },
    s7: function () {
      return scoreSectionGrid("regulatoryIndustryGrid");
    },
    s8: function () {
      return scoreSectionGrid("riskIndustryGrid");
    },
  };
  Object.keys(map).forEach(function (sid) {
    var pill = document.getElementById("pill-" + sid);
    if (!pill) return;
    var score = map[sid]();
    pill.classList.remove("pill-partial", "pill-complete");
    if (score === 2) pill.classList.add("pill-complete");
    else if (score === 1) pill.classList.add("pill-partial");
  });
}

// ── Grid filter ──
function filterGrid(gridId, query) {
  var grid = document.getElementById(gridId);
  if (!grid) return;
  var q = query.toLowerCase().trim();
  grid.querySelectorAll(".cci").forEach(function (cci) {
    var chip = cci.querySelector(":scope > .check-item");
    if (!chip) return;
    var match = !q || chip.textContent.toLowerCase().indexOf(q) !== -1;
    chip.style.display = match ? "" : "none";
    var cascade = cci.querySelector(":scope > .cascade-block");
    if (cascade && !match) cascade.classList.remove("visible");
  });
  grid.querySelectorAll(".check-item").forEach(function (item) {
    if (item.closest && item.closest(".cci")) return;
    item.style.display =
      !q || item.textContent.toLowerCase().indexOf(q) !== -1 ? "" : "none";
  });
}

// ── Building block tooltip ──
function showBBTooltip(e, desc) {
  e.stopPropagation();
  var tip = document.getElementById("bbTooltip");
  if (!tip) return;
  var clean = desc || "";
  tip.textContent = clean;
  tip.classList.add("visible");
  var x = e.clientX + 12,
    y = e.clientY + 12;
  if (x + 290 > window.innerWidth) x = e.clientX - 292;
  if (y + 120 > window.innerHeight) y = e.clientY - 124;
  tip.style.left = x + "px";
  tip.style.top = y + "px";
  var hide = function () {
    tip.classList.remove("visible");
    document.removeEventListener("click", hide);
  };
  setTimeout(function () {
    document.addEventListener("click", hide);
  }, 50);
}

// ── Bulk export all prompts ──
function exportAllPrompts() {
  var btn = document.getElementById("bulkExportBtn");
  var workflow = appData && appData.workflow;
  if (!workflow) {
    showToast("Workflow not loaded yet.", "warning");
    return;
  }
  var lines = [];
  var clientSlug = (
    (document.getElementById("clientName") || {}).value || "Client"
  )
    .replace(/[^a-zA-Z0-9]/g, "_")
    .replace(/_+/g, "_")
    .replace(/^_|_$/g, "");
  var engSlug = (
    (document.getElementById("engagementName") || {}).value || "Engagement"
  )
    .replace(/[^a-zA-Z0-9]/g, "_")
    .replace(/_+/g, "_")
    .replace(/^_|_$/g, "");
  var divider = "=".repeat(80);
  workflow.phases.forEach(function (phase) {
    lines.push(divider);
    lines.push("PHASE: " + phase.phase_name.toUpperCase());
    lines.push(divider);
    lines.push("");
    phase.prompts.forEach(function (prompt) {
      var el = document.getElementById("prompt-text-" + prompt.prompt_id);
      var text = el ? el.textContent : "[Prompt not available]";
      lines.push(
        "--- " + prompt.prompt_id + " | " + prompt.prompt_name + " ---",
      );
      lines.push("Produces: " + prompt.artifact);
      lines.push("");
      lines.push(text);
      lines.push("");
    });
  });
  var full = lines.join("\n");
  var blob = new Blob([full], { type: "text/plain" });
  var url = URL.createObjectURL(blob);
  var a = document.createElement("a");
  a.href = url;
  a.download = clientSlug + "_" + engSlug + "_AllPrompts.txt";
  document.body.appendChild(a);
  a.click();
  setTimeout(function () {
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
  }, 1000);
  if (btn) {
    btn.textContent = "✓ Exported!";
    btn.classList.add("exported");
    setTimeout(function () {
      btn.innerHTML = "⬇ Export All";
      btn.classList.remove("exported");
    }, 2500);
  }
  showToast("All prompts exported successfully.", "success");
}

// Wire nav pill updates into existing Brief Strength updater
var _origUpdateBriefStrength =
  typeof updateBriefStrength === "function" ? updateBriefStrength : null;
updateBriefStrength = function () {
  if (_origUpdateBriefStrength) _origUpdateBriefStrength();
  updateNavPills();
};

// Also update pills on load
document.addEventListener("DOMContentLoaded", function () {
  loadAllData();
  setTimeout(updateNavPills, 800);
});

// ─── LANDING PAGE ───
let guidedMode = false;
let selectedMode = "guided";

function selectMode(mode) {
  selectedMode = mode;
  var gBtn = document.getElementById("chip-guided");
  var qBtn = document.getElementById("chip-quick");
  if (gBtn) gBtn.classList.toggle("lp-chip-active", mode === "guided");
  if (qBtn) qBtn.classList.toggle("lp-chip-active", mode === "quick");
}

function launchSelected() {
  if (selectedMode === "guided") {
    guidedMode = true;
    showFormPage();
    setTimeout(initGuidedExperience, 300);
  } else {
    guidedMode = false;
    showFormPage();
  }
}

function showFormPage() {
  document.getElementById("landingPage").classList.remove("active");
  document.getElementById("formPage").classList.add("active");
  if (
    typeof loadAllData === "function" &&
    typeof appData !== "undefined" &&
    !appData.industries
  ) {
    loadAllData();
  }
  if (typeof updateHeader === "function") updateHeader();
  if (!guidedMode && !document.querySelector(".guidance-toggle")) {
    var t = document.createElement("button");
    t.className = "guidance-toggle";
    t.textContent = "▶ Start Guidance";
    t.onclick = initGuidedExperience;
    var fr = document.querySelector(".footer-right");
    if (fr) fr.prepend(t);
  }
}

// ── Conveyor autoplay ──
(function () {
  var cardWidth = 212; // 200px card + 12px gap
  var speed = 2800; // ms per step - increase to slow down

  function init() {
    var conveyor = document.getElementById("lp-conveyor");
    if (!conveyor) return;

    // Clone all original cards 10 times so the conveyor runs for a very long time
    var origCards = Array.from(conveyor.querySelectorAll(".lp-cv-card"));
    var n = origCards.length;
    for (var r = 0; r < 10; r++) {
      origCards.forEach(function (c) {
        var clone = c.cloneNode(true);
        clone.setAttribute("aria-hidden", "true");
        conveyor.appendChild(clone);
      });
    }

    var cur = 0;
    var totalCards = n * 11; // originals + 10 clones
    var paused = false;

    function centerOffset() {
      // How much to shift so the active card sits in the middle of the viewport
      return Math.round(window.innerWidth / 2 - cardWidth / 2);
    }

    function activate(i, animate) {
      // Highlight the matching card in the original set
      origCards.forEach(function (c, j) {
        c.classList.toggle("lp-cv-active", j === i % n);
      });
      conveyor.style.transition =
        animate === false ? "none" : "transform 0.6s cubic-bezier(0.4,0,0.2,1)";
      // Offset so active card is centered in viewport
      var shift = centerOffset() - i * cardWidth;
      conveyor.style.transform = "translateX(" + shift + "px)";
    }

    // Start immediately - no delay
    activate(0, false);

    // Pause on hover over the conveyor area
    conveyor.addEventListener("mouseenter", function () {
      paused = true;
    });
    conveyor.addEventListener("mouseleave", function () {
      paused = false;
    });

    // Step immediately after a tiny delay so first move is instant, then keep interval
    setTimeout(function () {
      cur = 1;
      activate(cur);
      setInterval(function () {
        if (paused) return;
        cur++;
        if (cur >= totalCards) {
          activate(0, false);
          cur = 0;
        } else {
          activate(cur);
        }
      }, speed);
    }, speed);
  }

  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", init);
  } else {
    init();
  }
})();
</script>

  <!-- ── CHUNK 1: Draft restore banner ── -->
  <div id="draftBanner">
    <span id="draftBannerMsg">📋 You have a saved draft from <strong id="draftTimestamp"></strong>. Would you like to restore it?</span>
    <div class="draft-banner-actions">
      <button class="btn-draft-restore" onclick="restoreDraft()">Restore Draft</button>
      <button class="btn-draft-dismiss" onclick="dismissDraft()">Discard</button>
    </div>
  </div>


  <!-- CHUNK 2: Review overlay -->
  <div id="reviewOverlay" onclick="closeReviewPanel(event)">
    <div id="reviewPanel">
      <div id="reviewPanel-header">
        <div><h3>Review Your Brief</h3><p>This is the data that will be sent to every AI prompt.</p></div>
        <button class="review-close-btn" onclick="closeReviewPanelDirect()">&times;</button>
      </div>
      <div id="reviewPanel-body"></div>
      <div id="reviewPanel-footer">
        <button class="btn-review-back" onclick="closeReviewPanelDirect()">Back to Form</button>
        <button class="btn-review-launch" onclick="confirmLaunchWorkflow()">Launch Workflow &rarr;</button>
      </div>
    </div>
  </div>


  <!-- CHUNK 3: Stage Gate Modal -->
  <div id="gateModal">
    <div id="gateModalBox">
      <div class="gate-modal-header">
        <span class="gate-modal-icon">&#9888;</span>
        <span class="gate-modal-title" id="gateModalTitle">Stage Gate Sign-Off</span>
      </div>
      <div class="gate-modal-body">
        <p>This is a <strong>stage gate</strong>. Before marking this step complete, confirm the artifact has been reviewed and approved by the appropriate stakeholders.</p>
        <ul class="gate-modal-checklist" id="gateModalChecklist">
          <li><input type="checkbox" onchange="checkGateReady()"> The artifact has been reviewed by the engagement lead</li>
          <li><input type="checkbox" onchange="checkGateReady()"> The client or internal approver has signed off</li>
          <li><input type="checkbox" onchange="checkGateReady()"> Any open issues have been logged in the Issues &amp; Dependency Log</li>
        </ul>
      </div>
      <div class="gate-modal-footer">
        <button class="btn-gate-cancel" onclick="closeGateModal()">Cancel</button>
        <button class="btn-gate-confirm" id="gateConfirmBtn" onclick="confirmGateDone()">Confirm Sign-Off &amp; Complete</button>
      </div>
    </div>
  </div>

  <!-- CHUNK 3: Resume/Restart Modal -->
  <div id="resumeModal">
    <div id="resumeModalBox">
      <div class="resume-modal-header">&#128196; Resume existing workflow?</div>
      <div class="resume-modal-body" id="resumeModalBody">
        You have <strong id="resumeStepCount">0</strong> completed step(s) from a previous session.<br><br>
        Would you like to <strong>continue</strong> where you left off, or <strong>restart</strong> the workflow from the beginning?
      </div>
      <div class="resume-modal-footer">
        <button class="btn-resume-restart" onclick="restartWorkflow()">Restart</button>
        <button class="btn-resume-continue" onclick="continueWorkflow()">Continue</button>
      </div>
    </div>
  </div>



  <!-- #03 Sparse Brief Warning Modal -->
  <div id="sparseBriefModal">
    <div id="sparseBriefModalBox">
      <div class="gate-modal-header">
        <span class="gate-modal-icon">&#9888;</span>
        <span class="gate-modal-title">Brief looks sparse</span>
      </div>
      <div class="gate-modal-body">
        <p id="sparseBriefMsg">Only a few sections have meaningful data. Sparse briefs produce generic AI output.</p>
        <p style="margin-top:10px;font-size:12px;color:var(--secondaryText);">You can go back and fill in more sections, or proceed with what you have.</p>
      </div>
      <div class="gate-modal-footer">
        <button class="btn-gate-cancel" onclick="closeSparseBriefModal()">&#8592; Go back &amp; improve</button>
        <button class="btn-gate-confirm" onclick="proceedSparse()">Proceed anyway</button>
      </div>
    </div>
  </div>

  <div id="toastContainer"></div>
  <div id="bbTooltip"></div>
</body>
</html>


