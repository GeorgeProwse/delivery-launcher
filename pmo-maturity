<!DOCTYPE html>
<html lang='en'>
<head>
<meta charset='UTF-8'>
<title>PMO Maturity Assessment Wizard (Improved)</title>
<style>
  /* PwC design system tokens */
  :root {
    --o500: #FD5108;
    --o300: #FFAA72;
    --o100: #FFE8D4;
    --black: #000;
    --white: #fff;
    --g100: #EEEFF1;
    --g200: #DFE3E6;
    --g300: #CBD1D6;
    --g400: #B5BCC4;
    --g500: #A1A8B3;
    --success: #22C55E;
    --warning: #EAB308;
    --error: #EF4444;
    --info: #3B82F6;
    --radius: 4px;
    --shadow: 0 1px 3px rgba(0,0,0,.08), 0 4px 16px rgba(0,0,0,.06);
  }

  body {
    font-family: system-ui, -apple-system, sans-serif;
    font-size: 14px;
    line-height: 1.6;
    margin: 24px;
    background-color: var(--g100);
    color: var(--black);
  }

  h1, h2 {
    color: var(--black);
    margin-top: 0;
    margin-bottom: 12px;
    font-weight: 600;
  }

  .hidden {
    display: none;
  }

  table {
    border-collapse: collapse;
    width: 100%;
    margin-bottom: 16px;
    font-size: 14px;
  }

  th, td {
    border: 1px solid var(--g200);
    padding: 8px 12px;
    text-align: left;
  }

  th {
    background-color: var(--g100);
    color: var(--black);
    font-weight: 600;
  }

  /* Wizard container as card */
  #wizard-container {
    max-width: 900px;
    margin: auto;
    background: var(--white);
    padding: 24px 32px;
    border: 1px solid var(--g200);
    border-radius: var(--radius);
    box-shadow: var(--shadow);
  }

  /* Step navigation buttons container */
  .step-buttons {
    margin-top: 24px;
    display: flex;
    justify-content: space-between;
    gap: 12px;
  }

  /* Base button style */
  button {
    padding: 10px 20px;
    border: 1px solid transparent;
    border-radius: var(--radius);
    cursor: pointer;
    font-size: 14px;
    font-weight: 600;
    line-height: 1;
    transition: background-color 0.2s ease, color 0.2s ease, border-color 0.2s ease;
  }

  /* Primary button – Orange 300 background, black text */
  .primary {
    background-color: var(--o300);
    color: var(--black);
    border-color: var(--o300);
  }

  .primary:hover {
    background-color: #f09a5e; /* slightly darker Orange 300 */
    border-color: #f09a5e;
  }

  /* Secondary button – transparent with black border */
  .secondary {
    background-color: transparent;
    color: var(--black);
    border-color: var(--black);
  }

  .secondary:hover {
    background-color: var(--g100);
  }

  .disabled {
    opacity: 0.6;
    cursor: not-allowed;
  }

  /* Step label and progress bar */
  #step-label {
    margin-bottom: 8px;
    font-size: 14px;
    font-weight: 600;
    color: var(--black);
  }

  .progress-container {
    width: 100%;
    background-color: var(--g200);
    border-radius: var(--radius);
    height: 8px;
    margin-bottom: 16px;
    overflow: hidden;
  }

  .progress-bar {
    height: 100%;
    width: 0%;
    background-color: var(--o300);
    transition: width 0.3s ease;
  }

  /* Save & Reset controls styled as secondary buttons */
  .save-controls {
    display: flex;
    gap: 12px;
    margin-bottom: 16px;
  }

  .save-controls button {
    padding: 8px 16px;
    border: 1px solid var(--black);
    border-radius: var(--radius);
    background-color: transparent;
    color: var(--black);
    font-size: 13px;
    font-weight: 600;
  }

  .save-controls button:hover {
    background-color: var(--g100);
  }

  /* Number inputs and selects for weights and levels */
  input[type='number'], select {
    padding: 6px 10px;
    border: 1px solid var(--g200);
    border-radius: var(--radius);
    font-size: 14px;
    font-family: inherit;
    background-color: var(--white);
    color: var(--black);
    width: auto;
  }

  input[type='number']:focus, select:focus {
    outline: none;
    border-color: var(--o500);
    box-shadow: 0 0 0 3px rgba(253,81,8,.1);
  }

  /* Responsive adjustments */
  @media (max-width: 600px) {
    table, th, td {
      font-size: 12px;
    }
    button {
      font-size: 12px;
      padding: 8px 14px;
    }
    .save-controls {
      flex-direction: column;
    }
    .save-controls button {
      width: 100%;
    }
  }
</style>
</head>
<body>
<div id='wizard-container'>
  <h1>PMO Maturity Assessment Wizard</h1>
  <!-- Step label and progress bar -->
  <div id='step-label' class='step-label'></div>
  <div class='progress-container'><div id='progress-bar' class='progress-bar'></div></div>
  <!-- Save and reset controls -->
  <div class='save-controls'>
    <button id='save-btn'>Save Progress</button>
    <button id='reset-btn'>Reset</button>
  </div>
  <!-- Domain weighting step -->
  <div id='domain-step'>
    <h2>Domain Weighting</h2>
    <p>Assign relative weights to each domain. They will be normalised to sum to 1.</p>
    <table id='domain-weight-table'>
      <thead><tr><th>Domain</th><th>Weight</th></tr></thead>
      <tbody></tbody>
    </table>
    <div class='step-buttons'>
      <span></span>
      <button id='domain-next' class='primary'>Start Assessment</button>
    </div>
  </div>
  <!-- Capability assessment step -->
  <div id='capability-step' class='hidden'>
    <h2>Capability Assessment</h2>
    <div id='capability-content'></div>
    <div class='step-buttons'>
      <button id='prev-btn' class='secondary'>Previous Capability</button>
      <button id='next-btn' class='primary'>Next Capability</button>
    </div>
  </div>
  <!-- Results step -->
  <div id='results-step' class='hidden'>
    <h2>Results</h2>
    <div id='results-content'></div>
    <div id='chart-section' class='chart-container hidden'>
      <h3>Domain Scores Chart</h3>
      <canvas id='scoreChart'></canvas>
    </div>
    <div id='rec-section'></div>
    <!-- Include Chart.js for bar charts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  </div>
</div>
<script>
/*
 * Improved PMO Maturity Assessment Wizard
 * - Displays a step label and progress bar for orientation.
 * - Uses descriptive navigation labels.
 * - Provides save and reset functions using localStorage for persistence.
 * - Shows capability details inline rather than in a modal overlay.
 * - Automatically loads saved progress if available.
 */

// Embedded JSON data for domains, capabilities and recommendations.
const domainsData = JSON.parse(`{"Strategy & Portfolio Alignment": [{"name": "Strategic alignment of investments", "levels": ["Initiatives are approved and started without a documented link to strategic objectives, so alignment is assumed rather than demonstrated.", "Some initiatives cite strategic themes, but the linkage is not tested consistently in governance and is often incomplete.", "Every initiative documents its alignment to one or more strategic objectives, and that alignment is reviewed during approval.", "Strategic contribution is quantified through agreed scoring criteria, and prioritisation decisions consider relative strategic value.", "Portfolio composition is actively optimised using strategic performance data and scenario analysis to maximise strategic outcomes."]}, {"name": "Portfolio objectives clarity", "levels": ["The organisation does not have formally agreed portfolio objectives, so portfolio success criteria are unclear.", "Portfolio objectives are stated at a high level, but they are not translated into measurable targets or consistently communicated.", "Portfolio objectives are documented and communicated, and they are supported by measurable targets used in portfolio reporting.", "Objectives cascade into programme and initiative targets, and governance forums review progress against them on a defined cadence.", "Objectives are periodically recalibrated using realised value, external changes, and strategic shifts, with clear decision records."]}, {"name": "Benefits definition quality", "levels": ["Expected benefits are rarely quantified, and ownership for benefits is not clearly assigned.", "Benefits are estimated in business cases, but baselines, measurement methods, and owners are often missing or inconsistent.", "Benefits are defined with clear measures, baselines, timeframes, and named owners, and they are approved as part of governance.", "Benefits are tracked during delivery and after implementation, with regular review by accountable executives and corrective actions.", "Benefits realisation is continuously monitored and is used to refine investment decisions, prioritisation, and future business cases."]}, {"name": "Value measurement discipline", "levels": ["Portfolio value is not measured at an aggregate level, and decisions rely mainly on anecdote or local reporting.", "Some financial and delivery metrics are reported, but definitions vary and the portfolio view is fragmented.", "A consistent set of portfolio value measures is defined and reported, enabling meaningful comparison across initiatives.", "Value measures influence funding, sequencing, and reprioritisation decisions, and material variances trigger governance actions.", "Advanced analytics and leading indicators are used to forecast value delivery and to optimise portfolio decisions."]}, {"name": "Executive sponsorship maturity", "levels": ["Executive sponsorship is informal and varies by initiative, with limited commitment and unclear responsibilities.", "Sponsors are assigned, but expectations for decision-making, escalation, and benefits ownership are not consistently applied.", "Sponsor roles and accountabilities are documented, and sponsors routinely participate in governance decisions for their initiatives.", "Sponsors actively steer delivery, manage escalations, and remain accountable for benefits, including post-implementation outcomes.", "Sponsorship effectiveness is measured (for example, decision timeliness and outcomes) and improved through feedback and coaching."]}, {"name": "Strategy-to-delivery traceability", "levels": ["There is no reliable traceability from strategic objectives to business cases, plans, and delivery reporting.", "Some traceability exists in documents, but the links are incomplete and are not maintained as initiatives change.", "Business cases and reporting explicitly reference strategic objectives, and traceability is maintained through standard artefacts.", "Integrated reporting connects strategy, delivery status, risk, and benefits so governance can see end-to-end progress.", "Digital traceability provides near real-time visibility from strategic objectives to delivered outcomes and realised benefits."]}, {"name": "Portfolio review cadence", "levels": ["Portfolio reviews occur only when problems arise, and decisions are made without a consistent governance cadence.", "Portfolio reviews occur periodically, but agendas, inputs, and decision outputs are inconsistent and not reliably recorded.", "Portfolio reviews occur on a defined cadence with standard inputs, decisions, and recorded actions that are tracked to completion.", "Reviews include value, risk, capacity, and dependency analysis, and outcomes drive reprioritisation and corrective action.", "Reviews use leading indicators and scenario insights to proactively reshape the portfolio before issues materialise."]}], "Demand & Investment Governance": [{"name": "Demand intake discipline", "levels": ["Demand is raised through informal channels, resulting in inconsistent information and limited visibility of the demand pipeline.", "A common intake form exists, but it is not mandatory and submissions vary widely in completeness and quality.", "All demand follows a structured intake process with minimum data requirements, defined roles, and transparent status tracking.", "Intake is integrated with capacity, financial, and risk validation so that only viable demand progresses to decision forums.", "Demand intake is digitally enabled with automated validation, scoring, and prioritisation to support fast, consistent decisions."]}, {"name": "Business case rigour", "levels": ["Business cases are often missing or superficial, and decisions are made with limited analysis of cost, risk, and benefits.", "Business cases are required, but quality varies and key sections (assumptions, baselines, risks) are often incomplete.", "A standard business case template is enforced, including quantified costs, benefits, risks, and clear options analysis.", "Business cases include sensitivity analysis, dependency impacts, and benefits measurement plans, and they are reviewed by SMEs.", "Business cases are continuously improved using post-implementation results and scenario modelling to validate assumptions and forecasts."]}, {"name": "Investment approval governance", "levels": ["Approval decisions are informal and can be influenced by politics rather than documented criteria and evidence.", "Approval forums exist, but decision criteria are not consistently applied and rationale is not always recorded.", "Formal approval bodies operate with defined decision rights, standard criteria, and documented decision outcomes.", "Approvals consider strategic score, portfolio impact, capacity, risk, and interdependencies, supported by consistent analysis.", "Approval decisions are optimised using portfolio analytics and scenario modelling to maximise enterprise value within constraints."]}, {"name": "Funding transparency", "levels": ["Funding allocations are reactive and opaque, with limited clarity on why investments are funded or deferred.", "Budgets are approved, but ongoing funding visibility and tracking against allocation are inconsistent across initiatives.", "Funding is aligned to prioritisation outcomes, and budget allocations and changes are transparent and traceable.", "Funding is reallocated based on performance, risk, and changing priorities, supported by formal governance decisions.", "A rolling investment model optimises capital deployment across the portfolio, balancing strategic value and delivery confidence."]}, {"name": "Prioritisation consistency", "levels": ["Prioritisation is largely subjective, and different groups apply different criteria or none at all.", "Prioritisation criteria exist, but they are applied inconsistently and are not supported by robust scoring.", "Transparent scoring criteria are applied consistently, and prioritisation outcomes are documented and communicated.", "Prioritisation incorporates capacity, dependencies, risk, and benefits to enable enterprise-level trade-off decisions.", "Advanced optimisation approaches model multiple scenarios and constraints to recommend the best portfolio ordering."]}, {"name": "Stage gate enforcement", "levels": ["Stage gates are absent or routinely bypassed, so initiatives progress without consistent readiness checks.", "Stage gates exist, but artefact requirements and approvals are applied inconsistently across initiatives.", "A gated lifecycle is enforced, with defined entry and exit criteria, required artefacts, and accountable approvers.", "Gates validate value, risk, readiness, and funding, and outcomes drive corrective action or re-scoping where needed.", "Gate decisions use leading indicators and predictive insights to prevent downstream failure and optimise sequencing."]}, {"name": "Decision rights clarity", "levels": ["Decision authority is unclear, leading to delays, duplicated approvals, and inconsistent escalation.", "Roles are defined in places, but overlaps persist and escalation paths are not consistently followed.", "Decision rights, RACI, and escalation thresholds are documented and understood across the portfolio.", "Decision rights are consistently applied, and escalations are managed within defined timeframes and governance forums.", "Decision effectiveness is monitored (for example, cycle time and rework) and refined to improve timeliness and quality."]}], "Portfolio Planning & Optimisation": [{"name": "Capacity planning accuracy", "levels": ["Capacity planning is not performed, so commitments exceed available resources and shortages are discovered late.", "High-level capacity estimates are produced, but they are not regularly updated or reconciled with actual availability.", "Capacity planning uses defined assumptions and is integrated with the demand pipeline to inform feasible plans.", "Capacity forecasts are refreshed on a rolling basis and used in governance to reprioritise work and resolve conflicts.", "Predictive workforce and capacity modelling optimises allocation and highlights future constraints before they impact delivery."]}, {"name": "Scenario modelling capability", "levels": ["The organisation does not model scenarios, so trade-offs are made without understanding portfolio impacts.", "What-if analysis is performed ad hoc, typically in spreadsheets, with limited consistency or auditability.", "Structured scenario modelling is used during planning cycles, with documented assumptions and comparable options.", "Scenario analysis supports funding and prioritisation decisions, including capacity and dependency impacts.", "Near real-time scenario modelling supports continuous optimisation as constraints, priorities, and performance change."]}, {"name": "Portfolio balancing approach", "levels": ["The portfolio is not balanced across risk, value, compliance, and capacity, and it evolves mainly by accumulation.", "Basic financial balancing is attempted, but risk exposure and strategic mix are not consistently considered.", "The portfolio is balanced using agreed dimensions (for example, value, risk, regulatory, and strategic themes) and documented rules.", "Balancing is actively managed using performance trends and governance decisions to adjust mix and sequencing.", "Continuous optimisation balances multiple constraints and objectives, supported by analytics and scenario insights."]}, {"name": "Dependency management visibility", "levels": ["Dependencies are not identified consistently, so delivery plans conflict or fail due to hidden constraints.", "Dependencies are documented inconsistently and are not maintained as plans and priorities change.", "Dependencies are identified, recorded, and reviewed across programmes, with clear owners and mitigation actions.", "An enterprise dependency view is maintained and used to coordinate sequencing, resourcing, and risk management.", "Dependency impacts are modelled to predict schedule and value effects, enabling proactive portfolio adjustments."]}, {"name": "Long-range planning integration", "levels": ["Planning focuses on the short term, and there is no coherent multi-year view of the portfolio.", "An annual plan exists, but it is not integrated with portfolio governance or updated when conditions change.", "A multi-year roadmap aligns initiatives to strategy and major milestones, and it is used as the baseline for governance.", "Rolling planning updates long-range plans using forecasts, dependencies, and benefits profiles.", "Long-range planning incorporates external signals and strategic scenarios to adapt the roadmap dynamically."]}, {"name": "Reprioritisation responsiveness", "levels": ["Reprioritisation is delayed and reactive, so changes are implemented late and with limited stakeholder alignment.", "Reprioritisation occurs periodically, but triggers, criteria, and decision processes are not clearly defined.", "Formal reprioritisation triggers and processes exist, with documented trade-off decisions and clear communications.", "Value, risk, capacity, and progress data is used to reprioritise quickly and transparently through governance.", "Automated alerts and scenario insights support rapid reprioritisation, minimising disruption and maximising value."]}, {"name": "Resource-to-demand alignment", "levels": ["Demand routinely exceeds capacity, and allocation decisions are made locally without an enterprise view.", "Allocation tracking exists, but resourcing decisions are not consistently aligned to portfolio priorities.", "Resource allocation is aligned to prioritised demand, supported by agreed planning assumptions and governance.", "Resource conflicts are resolved centrally using clear trade-off criteria and documented decisions.", "Enterprise optimisation maximises utilisation and outcomes by continuously aligning resources to changing demand and performance."]}], "Delivery Frameworks & Ways of Working": [{"name": "Methodology consistency", "levels": ["Delivery approaches vary widely, and teams rely on individual preferences rather than a common framework.", "A delivery framework exists, but adoption is uneven and key controls are applied inconsistently.", "A standard delivery methodology is defined, supported by templates and training, and used for most initiatives.", "The methodology is embedded in governance and tooling, enabling consistent reporting, controls, and assurance.", "The methodology is continuously improved using performance data and lessons learned to increase predictability and outcomes."]}, {"name": "Hybrid delivery integration", "levels": ["Agile and waterfall approaches operate in silos, with limited alignment of governance and reporting.", "Some hybrid practices exist, but integration between delivery types is inconsistent and often manual.", "Hybrid governance is defined so that agile, predictive, and hybrid initiatives are managed using comparable controls.", "Portfolio reporting normalises measures across delivery types, supporting consistent decision-making and trade-offs.", "Adaptive operating practices optimise governance and delivery approaches based on context, risk, and value outcomes."]}, {"name": "Schedule forecasting accuracy", "levels": ["Schedules are unreliable and are not maintained, so forecasts provide little confidence for stakeholders.", "Forecasting is performed, but updates are inconsistent and variance is not systematically analysed.", "Forecasting follows defined controls (baselines, critical path, and update cadence) and is used consistently.", "Variance analysis informs corrective action, and forecast accuracy is monitored and improved over time.", "Predictive forecasting and leading indicators improve accuracy and provide early warning of delivery risk."]}, {"name": "Scope control discipline", "levels": ["Scope changes frequently without control, resulting in unclear baselines and unpredictable impacts on cost and schedule.", "Change control exists, but it is applied inconsistently and impact assessment is often incomplete.", "Formal change control is enforced with documented baselines, approvals, and impact analysis.", "Change decisions consider value, risk, benefits, and portfolio impacts, and they are governed transparently.", "Scope is actively optimised using value-based trade-offs to maximise outcomes within capacity and constraints."]}, {"name": "Change management rigour", "levels": ["Change impacts on people and operations are not managed, leading to low adoption and avoidable disruption.", "Stakeholder and change plans exist, but execution is inconsistent and adoption is not measured reliably.", "Structured change management is applied, including stakeholder engagement, communications, training, and readiness activities.", "Adoption and change outcomes are measured, and actions are taken to address resistance and capability gaps.", "Advanced insights (including behavioural and operational data) are used to optimise adoption and sustain change."]}, {"name": "Delivery risk management", "levels": ["Delivery risks are handled reactively, and risk information is not consistently captured or reviewed.", "Risk registers exist, but they are not maintained consistently and mitigation actions are not tracked reliably.", "Risks are identified, assessed, and managed using defined processes, with clear owners and a regular review cadence.", "Risk trends are analysed across the portfolio, and governance uses this information to intervene early.", "Leading risk indicators and predictive signals are embedded to prevent issues and improve delivery confidence."]}, {"name": "Lessons learned integration", "levels": ["Lessons learned are rarely captured, and mistakes are repeated across initiatives.", "Lessons are recorded in some cases, but they are not shared or used to improve future delivery.", "Lessons learned are captured systematically and are used to improve templates, standards, and planning.", "A knowledge repository is maintained and referenced during initiation and governance, supported by clear ownership.", "Continuous improvement is embedded, with measurable enhancements driven by lessons, metrics, and retrospective insights."]}], "Risk, Controls & Assurance": [{"name": "Enterprise risk alignment", "levels": ["Portfolio and project risks are not aligned to enterprise risk management, and risk reporting is inconsistent.", "Some mapping to enterprise risk categories exists, but it is incomplete and not maintained consistently.", "Risks are mapped to the enterprise risk taxonomy, with consistent reporting and defined escalation thresholds.", "Portfolio risk insights feed into enterprise reporting, and governance uses them to adjust priorities and controls.", "Integrated risk analytics provide an enterprise view of exposure, trends, and forward-looking indicators."]}, {"name": "Control framework integration", "levels": ["Controls are not clearly defined, and key delivery controls depend on individual practice rather than a standard.", "Some controls are documented, but they are applied inconsistently and evidence is not retained reliably.", "A standard control framework is defined and enforced, with clear control owners and evidence requirements.", "Control effectiveness is measured, issues are tracked to closure, and control performance informs governance decisions.", "Automated control monitoring and continuous assurance reduce manual effort and improve reliability."]}, {"name": "Assurance review effectiveness", "levels": ["Assurance reviews are ad hoc, and findings are not consistently recorded or actioned.", "Periodic reviews occur, but scope and methods vary and follow-up actions are inconsistent.", "A structured assurance approach is defined, with consistent scope, templates, and reporting.", "Findings are tracked with accountable owners and due dates, and progress is monitored through governance.", "Independent, risk-based assurance is embedded and is used to optimise governance, controls, and delivery performance."]}, {"name": "Compliance traceability", "levels": ["Compliance obligations relevant to the portfolio are unclear, and initiatives do not address them consistently.", "Obligations are identified in places, but tracking to delivery activities and evidence is inconsistent.", "Compliance requirements are mapped to initiatives, controls, and evidence artefacts using a consistent register.", "Compliance status is reported through governance, and gaps trigger remediation plans and assurance activities.", "Real-time compliance dashboards and auditable traceability support continuous compliance management."]}, {"name": "Issue escalation clarity", "levels": ["Issues are escalated informally, which leads to delays and inconsistent decision-making.", "Escalation paths exist, but thresholds are unclear and teams do not use them consistently.", "Escalation thresholds, paths, and decision forums are defined and applied consistently across initiatives.", "Escalations are analysed for systemic patterns, and governance uses this insight to address root causes.", "Escalation effectiveness is monitored and improved, reducing cycle time and recurring issues."]}, {"name": "Audit readiness", "levels": ["Audit preparation is reactive, and required evidence is gathered late and inconsistently.", "Some documentation exists, but evidence is incomplete or dispersed across teams and systems.", "Evidence is centrally maintained with defined standards, enabling timely and consistent audit responses.", "Audit outcomes are analysed and used to strengthen controls, governance, and evidence practices.", "Continuous audit readiness is maintained through standard evidence routines and periodic self-assessments."]}, {"name": "Remediation governance", "levels": ["Remediation actions are not managed centrally, so issues remain open and accountability is unclear.", "Remediation is tracked in some areas, but prioritisation, ownership, and follow-up are inconsistent.", "Formal remediation plans are required, with owners, due dates, and governance oversight.", "Remediation progress is monitored through governance, and ageing issues trigger escalation and intervention.", "Root causes are systematically addressed and prevented through controls strengthening and continuous improvement."]}], "Financial Management & Benefits": [{"name": "Cost forecasting reliability", "levels": ["Cost forecasts are frequently inaccurate, and there is limited transparency over assumptions and cost drivers.", "Forecasting is performed, but methods vary and forecasts are not consistently updated or reconciled to actuals.", "Forecasting follows defined standards (assumptions, update cadence, and variance analysis) and is applied consistently.", "Forecast accuracy is monitored, and variance drivers are managed through corrective actions and governance decisions.", "Predictive cost modelling improves accuracy and supports proactive interventions to optimise spend and outcomes."]}, {"name": "Budget control discipline", "levels": ["Budget controls are weak, and initiatives exceed budgets without timely visibility or governance action.", "Budget tracking exists, but reporting cadence and control discipline are inconsistent across initiatives.", "Budget baselines, controls, and reporting are defined, and variances are managed through standard governance processes.", "Financial dashboards support decision-making, and funding adjustments are made using transparent criteria and evidence.", "Portfolio-level budget optimisation reallocates funding to maximise value and manage risk, using rolling forecasts."]}, {"name": "Benefits realisation tracking", "levels": ["Benefits are not tracked after delivery, so realised outcomes are largely unknown.", "Benefits are tracked during delivery in some cases, but post-implementation measurement is inconsistent.", "Benefits are tracked through the initiative lifecycle with defined measures, owners, and a review cadence.", "Post-implementation reviews validate benefits, and shortfalls trigger remediation actions and accountability.", "Benefits insights are used to refine strategy, prioritisation, and business case assumptions across the portfolio."]}, {"name": "Financial variance management", "levels": ["Cost and budget variances are not managed systematically, and issues are discovered late.", "Variances are reported, but thresholds and corrective actions are applied inconsistently.", "Variance thresholds are defined, variances are analysed, and actions are tracked to closure.", "Root causes are identified and addressed, and governance monitors recurring variance patterns for systemic improvement.", "Trend analytics and leading indicators reduce variance and improve predictability across the portfolio."]}, {"name": "Investment performance reporting", "levels": ["Investment performance is not reported consistently, and stakeholders lack a clear view of cost versus value.", "Basic financial reporting exists, but it is not integrated with delivery status, risk, and benefits information.", "Integrated reporting covers cost, schedule, risk, and benefits so performance can be compared across investments.", "Governance uses performance dashboards to make trade-offs, adjust funding, and intervene early on underperformance.", "Forward-looking performance insights forecast outcomes and support optimisation of the investment mix."]}, {"name": "Capex / Opex governance", "levels": ["Capex and opex classification and governance are unclear, leading to inconsistent treatment and reporting.", "Spend is categorised, but controls and decision rules for capex versus opex are inconsistently applied.", "Governance rules and decision criteria are defined for capex and opex, and they are applied consistently.", "Lifecycle cost visibility supports decisions, including operating costs, depreciation impacts, and ongoing run costs.", "Capital allocation is optimised using total cost of ownership and value outcomes across the portfolio."]}, {"name": "Post-implementation review rigour", "levels": ["Post-implementation reviews are not conducted, so outcomes and lessons are not validated.", "Reviews occur inconsistently and are not supported by standard templates or governance expectations.", "Post-implementation reviews are mandatory, using defined templates and evidence to assess outcomes against plans.", "Findings from reviews influence future funding, governance controls, and delivery practices.", "Post-implementation insights are systematically embedded into an optimisation loop for continuous improvement."]}], "Resource & Capability Management": [{"name": "Resource demand forecasting", "levels": ["Resource demand is not forecasted, so shortages and bottlenecks are discovered late.", "Headcount estimates exist, but they are not tied to prioritised demand and are not updated consistently.", "Resource demand forecasts are aligned to the portfolio plan, with clear assumptions and ownership.", "Rolling forecasts inform hiring, sourcing, and reprioritisation decisions through governance.", "Predictive models anticipate demand shifts and optimise sourcing and allocation before constraints emerge."]}, {"name": "Skills capability mapping", "levels": ["There is no reliable view of workforce skills, so capability gaps are identified informally.", "A partial skills register exists, but coverage and accuracy are inconsistent and quickly become outdated.", "Skills are mapped to roles and portfolio needs, enabling planned capability uplift and targeted resourcing.", "Capability gaps are proactively managed through training, hiring, and workforce planning, with measurable outcomes.", "Strategic workforce planning optimises capability supply and demand using data-driven insights and scenario planning."]}, {"name": "Role clarity and accountability", "levels": ["Roles and accountabilities are unclear, leading to duplication, gaps, and inconsistent decision-making.", "Role definitions exist, but they are not consistently applied and accountability is not enforced.", "Role accountabilities are clearly defined (for example, via RACI) and applied consistently across initiatives and governance.", "Accountability is reinforced through performance measures, governance routines, and timely escalation of non-compliance.", "Role effectiveness is reviewed and improved, reducing hand-offs, rework, and delivery friction."]}, {"name": "Capacity optimisation", "levels": ["Capacity is poorly managed, with frequent over-allocation, under-utilisation, and conflicting priorities.", "Capacity is monitored, but balancing decisions are inconsistent and not supported by enterprise governance.", "Capacity is balanced across the portfolio using agreed rules and prioritisation, with transparent allocation decisions.", "Resource trade-offs are governed centrally, and capacity constraints drive reprioritisation and sequencing decisions.", "Optimisation approaches maximise utilisation and outcomes, continuously adjusting allocation to demand and performance."]}, {"name": "Workforce planning integration", "levels": ["Workforce planning is disconnected from the portfolio roadmap and delivery commitments.", "Some coordination exists, but workforce plans are not consistently updated to reflect portfolio changes.", "Workforce planning is aligned to the portfolio roadmap, including hiring, training, and sourcing plans.", "Scenario modelling informs workforce decisions, enabling proactive responses to changing demand and constraints.", "Dynamic workforce optimisation integrates demand signals, performance data, and market conditions to adjust plans."]}, {"name": "Vendor resource governance", "levels": ["Vendor resourcing is unmanaged, and performance expectations are unclear or not monitored.", "Contracts are managed, but oversight of vendor delivery performance and realised value is inconsistent.", "Vendor performance is monitored using defined measures, governance routines, and clear accountability.", "Vendor outcomes are assessed against delivery and benefits, and sourcing decisions reflect performance evidence.", "Vendor strategy is optimised across the portfolio, balancing capability, cost, risk, and performance outcomes."]}, {"name": "PM capability development", "levels": ["Project and programme management capability development is ad hoc, with limited standards or progression.", "Training is provided, but it is not linked to a defined competency framework or role requirements.", "A PM competency framework exists, and development plans are aligned to roles and portfolio needs.", "Capability uplift is tracked and linked to performance outcomes, and communities of practice reinforce standards.", "A continuous professional development culture is embedded, with measurable improvements in delivery performance."]}], "Data, Reporting & Insights": [{"name": "Single source of truth integrity", "levels": ["Portfolio data is fragmented across multiple tools and spreadsheets, with inconsistent definitions and ownership.", "Multiple systems are used, and data is only partially reconciled, limiting trust in portfolio reporting.", "A central repository exists with defined data standards and ownership, enabling consistent portfolio reporting.", "Data governance controls maintain accuracy and timeliness, and data quality is monitored and addressed.", "An integrated data ecosystem provides near real-time, reliable portfolio data across systems of record."]}, {"name": "KPI framework definition", "levels": ["Portfolio KPIs are not clearly defined, so reporting focuses on activity rather than outcomes.", "Some KPIs exist, but definitions vary and KPIs are not consistently used in governance decisions.", "A standard KPI framework is defined, including definitions, calculation methods, owners, targets, and reporting cadence.", "KPI performance is reviewed in governance, and results drive decisions, escalations, and corrective actions.", "Leading KPIs and predictive indicators support proactive management and portfolio optimisation."]}, {"name": "Executive dashboard quality", "levels": ["Executive reporting is largely manual, static, and slow, limiting timely decision-making.", "Basic dashboards exist, but data quality issues and inconsistent definitions reduce confidence in the information.", "Interactive dashboards present consistent measures and are used routinely in executive governance.", "Dashboards integrate value, risk, capacity, and dependencies, enabling exception-focused executive decision-making.", "Advanced analytics and predictive views provide early warning and optimisation insights for executives."]}, {"name": "Data ownership clarity", "levels": ["Data ownership is not defined, resulting in unclear accountability for accuracy and updates.", "Ownership is defined for some data elements, but stewardship is inconsistent and not enforced.", "Data stewardship roles are defined and applied, with clear responsibilities for quality, timeliness, and definitions.", "Data quality metrics are monitored centrally, and issues trigger remediation with accountable owners.", "Data governance is continuously improved, with automated controls and ongoing refinement of standards."]}, {"name": "Reporting automation level", "levels": ["Reporting is predominantly manual, requiring significant effort and increasing the risk of errors.", "Some reporting is automated, but critical outputs still require manual consolidation and correction.", "Automated reporting supports standard portfolio views, reducing manual effort and improving consistency.", "Dashboards provide near real-time views, and reporting is integrated with governance cadences and decision forums.", "Self-service analytics and automation enable scalable reporting and rapid insight generation."]}, {"name": "Data quality controls", "levels": ["Data quality is not validated, and reporting frequently contains errors or inconsistencies.", "Basic validation checks exist, but they are not consistently applied, monitored, or enforced.", "Data quality standards and controls are defined and enforced, including validation routines and exception handling.", "Data quality is measured, trends are monitored, and remediation is managed through governance with clear ownership.", "Automated anomaly detection and controls continuously improve data quality and reliability."]}, {"name": "Insight-driven decision support", "levels": ["Decisions are largely intuition-based, and reporting is used mainly for retrospective status updates.", "Reports inform discussions, but decisions are not consistently driven by data and structured analysis.", "Insights are routinely presented in governance forums, and decisions reference agreed measures and supporting evidence.", "Data is used to evaluate trade-offs, allocate resources, and manage risks with transparency and accountability.", "Advanced analytics provide optimisation recommendations, and decision outcomes are measured and refined over time."]}], "PMO Structure, Mandate & Value": [{"name": "PMO mandate clarity", "levels": ["The PMO\u2019s purpose and authority are unclear, resulting in inconsistent expectations and limited influence.", "The mandate is informally understood, but it is not formally approved or consistently applied across the organisation.", "The PMO mandate is formally approved, communicated, and reflected in governance roles and responsibilities.", "The mandate is aligned to enterprise strategy and guides portfolio governance and service delivery.", "The mandate is periodically reviewed and updated based on performance, stakeholder needs, and strategic change."]}, {"name": "Service catalogue definition", "levels": ["PMO services are not defined, and support is provided inconsistently based on local requests.", "A basic list of services exists, but service scope, standards, and responsibilities are unclear.", "A service catalogue defines PMO offerings, service levels, and responsibilities, and it is applied consistently.", "Services are measured against defined service levels, and performance is reviewed with stakeholders and governance.", "Services are continuously optimised based on demand, outcomes, and feedback, improving value and efficiency."]}, {"name": "PMO performance measurement", "levels": ["PMO performance is not measured, so value is asserted rather than demonstrated.", "Activity metrics are tracked (for example, reports produced), but outcome measures are limited.", "Outcome-based KPIs measure PMO contribution (for example, predictability and governance effectiveness) and are reported regularly.", "Performance is reviewed in governance forums, and improvement actions are prioritised and tracked to completion.", "The PMO demonstrates ROI and continuous improvement through measurable impacts on portfolio outcomes."]}, {"name": "Governance model maturity", "levels": ["Governance is fragmented, with inconsistent forums, unclear decision rights, and variable discipline.", "Governance forums exist, but agendas, inputs, and decision records are not consistent or complete.", "A structured governance model defines forums, cadence, inputs, decisions, and escalation paths.", "Governance is integrated across the enterprise, enabling consistent portfolio-level decisions and oversight.", "Governance is continuously refined using performance insights, assurance findings, and stakeholder feedback."]}, {"name": "Stakeholder satisfaction measurement", "levels": ["Stakeholder feedback is not captured, so PMO services are not adjusted based on user needs.", "Feedback is collected occasionally, but it is not systematic and does not consistently drive improvement.", "Regular stakeholder satisfaction measurement is implemented with clear questions, coverage, and reporting.", "Feedback is analysed and used to prioritise improvements, and outcomes are communicated to stakeholders.", "Stakeholder value is actively optimised using feedback trends, segmentation, and targeted service improvements."]}, {"name": "Continuous improvement discipline", "levels": ["There is no formal improvement cycle, and improvements occur only when issues become severe.", "Improvements are reactive and are not managed through a consistent backlog or governance process.", "A structured continuous improvement process exists, with an improvement backlog, prioritisation, and clear ownership.", "Improvement outcomes are measured, and benefits are tracked to demonstrate impact and sustain changes.", "Continuous improvement is embedded culturally, supported by data, regular retrospectives, and ongoing optimisation."]}, {"name": "PMO strategic influence", "levels": ["The PMO is primarily administrative and has limited input into investment or strategic decisions.", "The PMO provides advice in some cases, but influence depends on relationships rather than formal role.", "The PMO contributes to investment decisions through standard analysis, governance support, and portfolio insights.", "The PMO shapes portfolio design and strategic planning by providing integrated views of value, risk, and capacity.", "The PMO is recognised as a strategic partner and continuously increases influence through demonstrable outcomes."]}]}`);

// Build domain list and capabilities array
const domainNames = Object.keys(domainsData);
const domainWeightInputs = {};
const capabilities = [];
const defaultCapWeights = {};
domainNames.forEach(domain => {
  const caps = domainsData[domain];
  const defaultWeight = 1 / caps.length;
  caps.forEach(cap => {
    capabilities.push({ domain: domain, name: cap.name, levels: cap.levels, defaultWeight: defaultWeight });
  });
});
const totalSteps = capabilities.length + 1; // include domain weighting as first step

// State to store selections for each capability
const selections = capabilities.map(cap => {
  return { level: 1, weight: cap.defaultWeight };
});
let currentStep = 0; // 0 = domain weighting, 1..N = capabilities, N+1 = results

// DOM references
const stepLabelDiv = document.getElementById('step-label');
const progressBar = document.getElementById('progress-bar');
const domainStepDiv = document.getElementById('domain-step');
const capabilityStepDiv = document.getElementById('capability-step');
const resultsStepDiv = document.getElementById('results-step');
const capabilityContent = document.getElementById('capability-content');
const domainNextBtn = document.getElementById('domain-next');
const prevBtn = document.getElementById('prev-btn');
const nextBtn = document.getElementById('next-btn');
const saveBtn = document.getElementById('save-btn');
const resetBtn = document.getElementById('reset-btn');

// Build domain weight table
const domainTableBody = document.querySelector('#domain-weight-table tbody');
domainNames.forEach(domain => {
  const tr = document.createElement('tr');
  const tdName = document.createElement('td');
  tdName.textContent = domain;
  const tdWeight = document.createElement('td');
  const input = document.createElement('input');
  input.type = 'number';
  input.min = '0';
  input.step = '0.01';
  input.value = (1 / domainNames.length).toFixed(3);
  domainWeightInputs[domain] = input;
  tdWeight.appendChild(input);
  tr.appendChild(tdName);
  tr.appendChild(tdWeight);
  domainTableBody.appendChild(tr);
});

/* Persistence functions */
function loadSavedProgress() {
  const saved = localStorage.getItem('pmoMaturityAssessment');
  if (!saved) return;
  try {
    const data = JSON.parse(saved);
    // load domain weights
    if (data.domainWeights) {
      domainNames.forEach(d => {
        if (data.domainWeights[d] !== undefined) {
          domainWeightInputs[d].value = data.domainWeights[d];
        }
      });
    }
    // load selections
    if (data.selections && Array.isArray(data.selections)) {
      data.selections.forEach((sel, idx) => {
        if (selections[idx]) {
          if (typeof sel.level === 'number') selections[idx].level = sel.level;
          if (typeof sel.weight === 'number') selections[idx].weight = sel.weight;
        }
      });
    }
    // load current step
    if (typeof data.currentStep === 'number') {
      currentStep = Math.min(data.currentStep, totalSteps); // prevent overflow
    }
  } catch (err) {
    console.warn('Failed to load saved progress', err);
  }
}

// Save progress to localStorage. If quiet is false, show a confirmation alert.
function saveProgress(quiet = true) {
  const data = { domainWeights: {}, selections: selections, currentStep: currentStep };
  domainNames.forEach(d => {
    const val = parseFloat(domainWeightInputs[d].value);
    data.domainWeights[d] = isNaN(val) ? 0 : val;
  });
  try {
    localStorage.setItem('pmoMaturityAssessment', JSON.stringify(data));
    if (!quiet) {
      alert('Progress saved. You can resume later.');
    }
  } catch (err) {
    console.warn('Failed to save progress', err);
  }
}

function resetProgress() {
  localStorage.removeItem('pmoMaturityAssessment');
  // reset domain weights and selections to defaults
  domainNames.forEach(d => {
    domainWeightInputs[d].value = (1 / domainNames.length).toFixed(3);
  });
  selections.forEach((sel, idx) => {
    sel.level = 1;
    sel.weight = capabilities[idx].defaultWeight;
  });
  currentStep = 0;
  showStep();
}

// Attach save/reset event listeners
saveBtn.addEventListener('click', () => saveProgress(false));
resetBtn.addEventListener('click', resetProgress);

// Step navigation logic
domainNextBtn.addEventListener('click', () => {
  currentStep = 1;
  saveProgress();
  showStep();
});

prevBtn.addEventListener('click', () => {
  if (currentStep > 0) {
    currentStep--;
    saveProgress();
    showStep();
  }
});

nextBtn.addEventListener('click', () => {
  if (currentStep < totalSteps - 1) {
    currentStep++;
    saveProgress();
    showStep();
  } else if (currentStep === totalSteps - 1) {
    // calculate results step
    currentStep++;
    saveProgress();
    showStep();
  }
});

/* Update progress bar and step label */
function updateProgressUI() {
  const stepNumber = currentStep + 1; // convert 0-based index to 1-based
  let label = '';
  if (currentStep === 0) {
    label = `Step ${stepNumber} of ${totalSteps}: Domain Weighting`;
  } else if (currentStep >= 1 && currentStep <= capabilities.length) {
    const capIndex = currentStep - 1;
    const cap = capabilities[capIndex];
    label = `Step ${stepNumber} of ${totalSteps}: ${cap.domain} – ${cap.name}`;
  } else {
    label = `Step ${stepNumber} of ${totalSteps}: Results`;
  }
  stepLabelDiv.textContent = label;
  const percent = (currentStep) / (totalSteps - 1) * 100; // domain weighting step is 0%, results step 100%
  progressBar.style.width = `${Math.min(percent, 100)}%`;
}

/* Render the appropriate step */
function showStep() {
  updateProgressUI();
  // Hide all steps initially
  domainStepDiv.classList.add('hidden');
  capabilityStepDiv.classList.add('hidden');
  resultsStepDiv.classList.add('hidden');
  // Adjust button disabled states
  if (currentStep === 0) {
    // Show domain weighting step
    domainStepDiv.classList.remove('hidden');
    prevBtn.classList.add('disabled');
    nextBtn.textContent = 'Next Capability';
  } else if (currentStep >= 1 && currentStep <= capabilities.length) {
    // Show capability step
    capabilityStepDiv.classList.remove('hidden');
    prevBtn.classList.remove('disabled');
    // Determine next button text
    if (currentStep === capabilities.length) {
      nextBtn.textContent = 'Calculate Results';
    } else {
      nextBtn.textContent = 'Next Capability';
    }
    showCapability();
  } else {
    // Show results
    resultsStepDiv.classList.remove('hidden');
    prevBtn.classList.remove('disabled');
    nextBtn.textContent = 'Next Capability';
    calculateResults();
  }
}

/* Display a single capability, including inline details */
function showCapability() {
  const idx = currentStep - 1;
  const cap = capabilities[idx];
  capabilityContent.innerHTML = '';
  // Display domain and capability names
  const title = document.createElement('p');
  title.innerHTML = `<strong>Domain:</strong> ${cap.domain}`;
  capabilityContent.appendChild(title);
  const name = document.createElement('p');
  name.innerHTML = `<strong>Capability:</strong> ${cap.name}`;
  capabilityContent.appendChild(name);
  // Level select
  const levelLabel = document.createElement('label');
  levelLabel.textContent = 'Level: ';
  const levelSelect = document.createElement('select');
  for (let i = 1; i <= 5; i++) {
    const opt = document.createElement('option');
    opt.value = i;
    opt.textContent = i;
    levelSelect.appendChild(opt);
  }
  levelSelect.value = selections[idx].level;
  levelLabel.appendChild(levelSelect);
  capabilityContent.appendChild(levelLabel);
  capabilityContent.appendChild(document.createElement('br'));
  // Capability weight input
  const weightLabel = document.createElement('label');
  weightLabel.textContent = 'Capability Weight: ';
  const weightInput = document.createElement('input');
  weightInput.type = 'number';
  weightInput.min = '0';
  weightInput.step = '0.01';
  weightInput.value = selections[idx].weight.toFixed(3);
  weightLabel.appendChild(weightInput);
  capabilityContent.appendChild(weightLabel);
  capabilityContent.appendChild(document.createElement('br'));
  // Details toggle button and container
  const detailsBtn = document.createElement('button');
  detailsBtn.textContent = 'Show Details';
  detailsBtn.className = 'secondary';
  detailsBtn.style.marginTop = '8px';
  const detailsDiv = document.createElement('div');
  detailsDiv.style.display = 'none';
  detailsDiv.style.marginTop = '8px';
  // Use design system colours for borders and backgrounds
  detailsDiv.style.border = '1px solid var(--g200)';
  detailsDiv.style.borderRadius = 'var(--radius)';
  detailsDiv.style.padding = '8px';
  detailsDiv.style.backgroundColor = 'var(--g100)';
  // Populate details
  function renderDetails() {
    detailsDiv.innerHTML = '';
    cap.levels.forEach((desc, index) => {
      const p = document.createElement('p');
      p.innerHTML = `<strong>Level ${index + 1}:</strong> ${desc}`;
      if ((index + 1) === parseInt(levelSelect.value)) {
        p.style.fontWeight = 'bold';
        // Highlight selected level using brand colour (Orange 500)
        p.style.color = '#FD5108';
      }
      detailsDiv.appendChild(p);
    });
  }
  renderDetails();
  detailsBtn.addEventListener('click', () => {
    const isHidden = detailsDiv.style.display === 'none';
    detailsDiv.style.display = isHidden ? 'block' : 'none';
    detailsBtn.textContent = isHidden ? 'Hide Details' : 'Show Details';
  });
  // Update highlight on level change
  levelSelect.addEventListener('change', () => {
    selections[idx].level = parseInt(levelSelect.value);
    renderDetails();
  });
  // Update selection weight on change
  weightInput.addEventListener('change', () => {
    const val = parseFloat(weightInput.value);
    selections[idx].weight = isNaN(val) ? 0 : val;
  });
  capabilityContent.appendChild(detailsBtn);
  capabilityContent.appendChild(detailsDiv);
}

/* Calculate and display results */
function calculateResults() {
  const resultsDiv = document.getElementById('results-content');
  resultsDiv.innerHTML = '';
  // Normalise domain weights
  const domWeights = {};
  let domSum = 0;
  domainNames.forEach(d => {
    const val = parseFloat(domainWeightInputs[d].value) || 0;
    domWeights[d] = val;
    domSum += val;
  });
  if (domSum === 0) domSum = 1;
  domainNames.forEach(d => {
    domWeights[d] = domWeights[d] / domSum;
  });
  // Normalise capability weights within each domain
  const capWeights = {};
  domainNames.forEach(d => { capWeights[d] = []; });
  capabilities.forEach((cap, idx) => {
    capWeights[cap.domain].push(selections[idx].weight);
  });
  domainNames.forEach(d => {
    const sum = capWeights[d].reduce((a, b) => a + b, 0) || 1;
    capWeights[d] = capWeights[d].map(w => w / sum);
  });
  // Compute scores per domain
  const domainScores = {};
  const domainAverages = {};
  const domainIndexStart = {}; // track start index of capabilities per domain for mapping
  let start = 0;
  domainNames.forEach(d => {
    domainIndexStart[d] = start;
    start += domainsData[d].length;
  });
  domainNames.forEach(d => {
    const caps = domainsData[d];
    let weightedSum = 0;
    let simpleSum = 0;
    caps.forEach((cap, j) => {
      const globalIdx = domainIndexStart[d] + j;
      const level = selections[globalIdx].level;
      weightedSum += level * capWeights[d][j];
      simpleSum += level;
    });
    domainScores[d] = weightedSum;
    domainAverages[d] = simpleSum / caps.length;
  });
  // Compute overall score (weighted by domain weights)
  let overallWeighted = 0;
  let overallSimple = 0;
  domainNames.forEach(d => {
    overallWeighted += domainScores[d] * domWeights[d];
    overallSimple += domainAverages[d];
  });
  overallSimple = overallSimple / domainNames.length;
  // Display table of results
  const resultsTable = document.createElement('table');
  const thead = document.createElement('thead');
  thead.innerHTML = '<tr><th>Domain</th><th>Weighted Score</th><th>Average Level</th></tr>';
  resultsTable.appendChild(thead);
  const tbody = document.createElement('tbody');
  domainNames.forEach(d => {
    const tr = document.createElement('tr');
    const tdName = document.createElement('td');
    tdName.textContent = d;
    const tdWeighted = document.createElement('td');
    tdWeighted.textContent = domainScores[d].toFixed(2);
    const tdAvg = document.createElement('td');
    tdAvg.textContent = domainAverages[d].toFixed(2);
    tr.appendChild(tdName);
    tr.appendChild(tdWeighted);
    tr.appendChild(tdAvg);
    tbody.appendChild(tr);
  });
  const tfoot = document.createElement('tfoot');
  const trFoot = document.createElement('tr');
  const tdOverallLabel = document.createElement('td');
  tdOverallLabel.textContent = 'Overall';
  const tdOverallWeighted = document.createElement('td');
  tdOverallWeighted.textContent = overallWeighted.toFixed(2);
  const tdOverallSimple = document.createElement('td');
  tdOverallSimple.textContent = overallSimple.toFixed(2);
  trFoot.appendChild(tdOverallLabel);
  trFoot.appendChild(tdOverallWeighted);
  trFoot.appendChild(tdOverallSimple);
  tfoot.appendChild(trFoot);
  resultsTable.appendChild(tbody);
  resultsTable.appendChild(tfoot);
  resultsDiv.appendChild(resultsTable);
  // Draw bar chart
  const chartSection = document.getElementById('chart-section');
  const ctx = document.getElementById('scoreChart').getContext('2d');
  chartSection.classList.remove('hidden');
  // Clean previous chart if exists
  if (window.scoreChart) {
    window.scoreChart.destroy();
  }
  // Use abbreviations for labels to avoid clutter
  const labels = domainNames.map(d => d.split(' ').map(w => w[0]).join(''));
  const data = domainNames.map(d => domainScores[d]);
  window.scoreChart = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: labels,
      datasets: [{
        label: 'Weighted Score',
        data: data,
        // Use PwC palette for bars
        backgroundColor: '#FFAA72',
        borderColor: '#FD5108',
        borderWidth: 1
      }]
    },
    options: {
      scales: {
        y: { beginAtZero: true, max: 5 }
      },
      plugins: { legend: { display: false } }
    }
  });
  // Recommendations placeholder
  const recSection = document.getElementById('rec-section');
  recSection.innerHTML = '<h3>Recommended Actions</h3><p>Detailed recommendations will appear here in a future version.</p>';
}

// Dummy recommendations placeholder. In a real implementation, this would be populated from a JSON structure similar to domainsData.
const recommendations = {};

// On load, try to load saved progress then show the current step
loadSavedProgress();
showStep();
</script>
</body>
</html>
